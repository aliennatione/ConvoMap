<!doctype html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
html {
  font-family: ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji',
    'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
.markmap-dark {
  background: #27272a;
  color: white;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.18/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.12/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/index.js"></script><script>((r) => {
          setTimeout(r);
        })(() => {
  const { markmap, mm } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute("style", "position:absolute;bottom:20px;right:20px");
  document.body.append(el);
})</script><script>((getMarkmap) => {
          window.WebFontConfig = {
            custom: {
              families: [
                "KaTeX_AMS",
                "KaTeX_Caligraphic:n4,n7",
                "KaTeX_Fraktur:n4,n7",
                "KaTeX_Main:n4,n7,i4,i7",
                "KaTeX_Math:i4,i7",
                "KaTeX_Script",
                "KaTeX_SansSerif:n4,n7,i4",
                "KaTeX_Size1",
                "KaTeX_Size2",
                "KaTeX_Size3",
                "KaTeX_Size4",
                "KaTeX_Typewriter"
              ]
            },
            active: () => {
              getMarkmap().refreshHook.call();
            }
          };
        })(() => window.markmap)</script><script src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js" defer></script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
              if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                document.documentElement.classList.add("markmap-dark");
              }
            })(() => window.markmap,null,{"content":"","children":[{"content":"1) Quando una shell nel container pu&#xf2; portare all&#x2019;host","children":[{"content":"il container gira <strong>come root</strong> (utente 0) &#x2192; molto pi&#xf9; pericoloso;","children":[],"payload":{"tag":"li","lines":"4,5"}},{"content":"sono montati volumi host sensibili (es. <code>/</code>, <code>/etc</code>, <code>/var/run/docker.sock</code>, <code>/home</code>) &#x2192; accesso diretto a file di host o al socket Docker = takeover facile;","children":[],"payload":{"tag":"li","lines":"5,6"}},{"content":"container eseguito in modalit&#xe0; <strong>--privileged</strong> o con troppe <strong>capabilities</strong> (es. <code>CAP_SYS_ADMIN</code>) &#x2192; ampia superficie d&#x2019;attacco;","children":[],"payload":{"tag":"li","lines":"6,7"}},{"content":"runtime/container engine o kernel hanno <strong>vulnerabilit&#xe0;</strong> (es. runC, OverlayFS, cgroups) che permettono escape;","children":[],"payload":{"tag":"li","lines":"7,8"}},{"content":"network/trust: servizi esposti senza autenticazione robusta permettono attacco iniziale pi&#xf9; semplice.<br>\nSe nessuno dei punti critici sopra &#xe8; vero (container non-root, nessun mount host sensibile, capabilities minime, runtime aggiornati), il rischio scende molto &#x2014; ma non &#xe8; zero (esistono zero&#x2011;day kernel/runtime).","children":[],"payload":{"tag":"li","lines":"8,10"}}],"payload":{"tag":"h1","lines":"2,3"}},{"content":"2) Checklist immediata &#x2014; verifica e mitigazioni (applica subito)","children":[{"content":"Controlli rapidi (cosa verificare ora)","children":[{"content":"Il container di codium-server <strong>gira come root?</strong><br>\n<code>docker inspect -f &apos;{{.Config.User}}&apos; &lt;container&gt;</code><br>\nse restituisce vuoto o <code>0</code> -&gt; gira come root.","children":[],"payload":{"tag":"li","lines":"12,15"}},{"content":"Hai montato il socket Docker?<br>\ncontrolla <code>-v /var/run/docker.sock:/var/run/docker.sock</code> nei run/compose -&gt; se s&#xec;, <strong>rimuovilo subito</strong>.","children":[],"payload":{"tag":"li","lines":"15,17"}},{"content":"Host mounts critici? (<code>/</code>, <code>/etc</code>, <code>/var</code>) -&gt; evita.","children":[],"payload":{"tag":"li","lines":"17,18"}},{"content":"&#xc8; stato avviato con <code>--privileged</code>? -&gt; se s&#xec;, stop/ricrea senza.","children":[],"payload":{"tag":"li","lines":"18,19"}},{"content":"Runtime e kernel aggiornati? controlla versione <code>docker info</code> e <code>uname -a</code>.","children":[],"payload":{"tag":"li","lines":"19,20"}}],"payload":{"tag":"h2","lines":"11,12"}},{"content":"Esempio: consigli per <code>docker run</code>","children":[{"content":"<pre data-lines=\"22,38\"><code class=\"language-bash\">docker run -d \\\n  --name codium-server \\\n  --user 1000:1000 \\\n  --cap-drop ALL \\\n  --security-opt no-new-privileges:<span class=\"hljs-literal\">true</span> \\\n  --security-opt seccomp=unconfined \\   <span class=\"hljs-comment\"># meglio usare profilo seccomp personalizzato; qui solo esempio</span>\n  --read-only \\\n  --tmpfs /tmp:rw,noexec,nosuid,size=64m \\\n  --pids-limit 100 \\\n  --memory 1g \\\n  --network bridge \\\n  -v /path/to/data:/home/codium:rw \\\n  -p 8443:8443 \\\n  codium-server-image\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"22,38"}}],"payload":{"tag":"h2","lines":"20,21"}},{"content":"Kubernetes (se applicabile)","children":[{"content":"<pre data-lines=\"45,56\"><code class=\"language-yaml\"><span class=\"hljs-attr\">securityContext:</span>\n  <span class=\"hljs-attr\">runAsNonRoot:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">runAsUser:</span> <span class=\"hljs-number\">1000</span>\n  <span class=\"hljs-attr\">allowPrivilegeEscalation:</span> <span class=\"hljs-literal\">false</span>\n  <span class=\"hljs-attr\">readOnlyRootFilesystem:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">capabilities:</span>\n    <span class=\"hljs-attr\">drop:</span> [<span class=\"hljs-string\">&quot;ALL&quot;</span>]\n  <span class=\"hljs-attr\">seccompProfile:</span>\n    <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">RuntimeDefault</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"45,56"}}],"payload":{"tag":"h2","lines":"43,44"}}],"payload":{"tag":"h1","lines":"10,11"}},{"content":"3) Proteggi l&#x2019;accesso web (Traefik / auth)","children":[{"content":"<strong>Password semplice via middleware</strong> &#xe8; un rischio: usa autenticazione pi&#xf9; forte (OAuth / OIDC, client certificates) o almeno password robuste e 2FA dietro un Identity Provider.","children":[],"payload":{"tag":"li","lines":"57,58"}},{"content":"Abilita <strong>rate limiting</strong> e blocco IP (fail2ban / Traefik middlewares).","children":[],"payload":{"tag":"li","lines":"58,59"}},{"content":"Usa HTTPS con certbot/Let&#x2019;s Encrypt (TLS) e HSTS.","children":[],"payload":{"tag":"li","lines":"59,60"}},{"content":"Considera il forward-auth (KeyCloak, Authelia) per Single Sign-On e 2FA.","children":[],"payload":{"tag":"li","lines":"60,61"}}],"payload":{"tag":"h1","lines":"56,57"}},{"content":"4) Riduci la superficie di attacco nel servizio (codium-server)","children":[{"content":"Disabilita il terminale integrato o limita i permessi dell&#x2019;account se possibile (se codium-server ha opzioni per disabilitare terminal shell, disabilitalo se non necessario).","children":[],"payload":{"tag":"li","lines":"62,63"}},{"content":"Disabilita estensioni remote inutili o limitare l&#x2019;installazione di estensioni.","children":[],"payload":{"tag":"li","lines":"63,64"}},{"content":"Mantieni l&#x2019;immagine aggiornata e minimizzata (non includere strumenti di system admin che facilitano la pivot).","children":[],"payload":{"tag":"li","lines":"64,65"}}],"payload":{"tag":"h1","lines":"61,62"}},{"content":"5) Hardening host e runtime","children":[{"content":"Aggiorna kernel e container runtime (docker, containerd, runc) alla versione pi&#xf9; recente disponibile dalla distro.","children":[],"payload":{"tag":"li","lines":"66,67"}},{"content":"Abilita AppArmor o SELinux (profilo restrittivo per il container).","children":[],"payload":{"tag":"li","lines":"67,68"}},{"content":"Usa user namespaces mapping (remap) per far girare root del container come user non-root sull&#x2019;host.","children":[],"payload":{"tag":"li","lines":"68,69"}},{"content":"Considera sandboxing pi&#xf9; forte (gVisor, Kata Containers) su workload che espongono terminale interattivo.","children":[],"payload":{"tag":"li","lines":"69,70"}},{"content":"Monitoraggio/logging: attiva logging centralizzato, alert su attivit&#xe0; sospette, integralo con fail2ban o IDS.","children":[],"payload":{"tag":"li","lines":"70,71"}}],"payload":{"tag":"h1","lines":"65,66"}},{"content":"6) Cosa fare subito (azioni pratiche, in ordine raccomandato)","children":[{"content":"1. Verifica se il container &#xe8; eseguito come root e se monta socket o path host sensibili. Rimuovi mount pericolosi.","children":[],"payload":{"tag":"li","lines":"72,73","listIndex":1}},{"content":"2. Ricrea il container con <code>--user</code>, <code>--cap-drop=ALL</code>, <code>--security-opt no-new-privileges:true</code>, <code>--read-only</code>.","children":[],"payload":{"tag":"li","lines":"73,74","listIndex":2}},{"content":"3. Rendi l&#x2019;autenticazione pi&#xf9; forte dietro Traefik (2FA/OIDC o almeno password robusta + rate limiting).","children":[],"payload":{"tag":"li","lines":"74,75","listIndex":3}},{"content":"4. Aggiorna kernel, Docker/containerd/runc.","children":[],"payload":{"tag":"li","lines":"75,76","listIndex":4}},{"content":"5. Abilita AppArmor/SELinux e usa seccomp.","children":[],"payload":{"tag":"li","lines":"76,77","listIndex":5}},{"content":"6. Considera sandboxing avanzato (gVisor/Kata) se vuoi isolamento quasi VM.","children":[],"payload":{"tag":"li","lines":"77,78","listIndex":6}}],"payload":{"tag":"h1","lines":"71,72"}},{"content":"7) Conclusione pratica","children":[{"content":"&#x2705; <strong>1. Dove siamo?</strong>","children":[{"content":"<pre data-lines=\"87,90\"><code class=\"language-bash\"><span class=\"hljs-built_in\">cat</span> /proc/1/cgroup\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"87,90"}},{"content":"<pre data-lines=\"91,94\"><code data-lines=\"91,94\"><span class=\"hljs-number\">0</span><span class=\"hljs-symbol\">:</span><span class=\"hljs-symbol\">:/docker/&lt;qualcosa&gt;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"91,94"}},{"content":"<pre data-lines=\"95,98\"><code data-lines=\"95,98\"><span class=\"hljs-number\">0</span><span class=\"hljs-symbol\">:</span><span class=\"hljs-symbol\">:/kubepods/</span>...\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"95,98"}}],"payload":{"tag":"h2","lines":"85,86"}},{"content":"&#x2705; <strong>2. Chi &#xe8; l&#x2019;utente?</strong>","children":[{"content":"<pre data-lines=\"102,106\"><code class=\"language-bash\"><span class=\"hljs-built_in\">whoami</span>\n<span class=\"hljs-built_in\">id</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"102,106"}}],"payload":{"tag":"h2","lines":"100,101"}},{"content":"&#x2705; <strong>3. Posso vedere il filesystem host?</strong>","children":[{"content":"<pre data-lines=\"109,114\"><code class=\"language-bash\"><span class=\"hljs-built_in\">ls</span> /host\n<span class=\"hljs-built_in\">ls</span> /mnt\n<span class=\"hljs-built_in\">ls</span> /etc/hostname\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"109,114"}},{"content":"<pre data-lines=\"115,118\"><code class=\"language-bash\">mount | grep -v overlay\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"115,118"}}],"payload":{"tag":"h2","lines":"107,108"}},{"content":"&#x2705; <strong>4. Socket Docker accessibile?</strong>","children":[{"content":"<pre data-lines=\"121,124\"><code class=\"language-bash\"><span class=\"hljs-built_in\">ls</span> -l /var/run/docker.sock\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"121,124"}},{"content":"<pre data-lines=\"126,129\"><code class=\"language-bash\">docker ps\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"126,129"}}],"payload":{"tag":"h2","lines":"119,120"}},{"content":"&#x2705; <strong>5. Proviamo un comando host-only</strong>","children":[{"content":"<pre data-lines=\"132,135\"><code class=\"language-bash\">lsblk\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"132,135"}}],"payload":{"tag":"h2","lines":"130,131"}},{"content":"&#x2705; <strong>6. Puoi uscire dal container?</strong>","children":[{"content":"<pre data-lines=\"138,141\"><code class=\"language-bash\">ps aux | grep root\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"138,141"}}],"payload":{"tag":"h2","lines":"136,137"}},{"content":"&#x2705; <strong>7. User namespace mapping (solo se root nel container)</strong>","children":[{"content":"<pre data-lines=\"144,147\"><code class=\"language-bash\"><span class=\"hljs-built_in\">cat</span> /proc/self/uid_map\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"144,147"}},{"content":"<pre data-lines=\"148,151\"><code data-lines=\"148,151\">         <span class=\"hljs-attribute\">0</span>          <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">4294967295</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"148,151"}},{"content":"<pre data-lines=\"153,156\"><code data-lines=\"153,156\">         <span class=\"hljs-attribute\">0</span>      <span class=\"hljs-number\">100000</span>      <span class=\"hljs-number\">65536</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"153,156"}}],"payload":{"tag":"h2","lines":"142,143"}},{"content":"&#x2705; <strong>8. Verifica capability del container</strong>","children":[{"content":"<pre data-lines=\"158,161\"><code class=\"language-bash\">capsh --<span class=\"hljs-built_in\">print</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"158,161"}}],"payload":{"tag":"h2","lines":"157,158"}},{"content":"&#x2795; Vuoi automatizzare?","children":[],"payload":{"tag":"h2","lines":"162,163"}},{"content":"&#x1f50d; Valutazione dei risultati","children":[{"content":"&#x2705; Indicatori positivi (rischio ridotto):","children":[{"content":"&#x2705; <strong>Utente non-root</strong> (<code>abc</code>, UID 1000): il processo interattivo gira come utente limitato.","children":[],"payload":{"tag":"li","lines":"236,237"}},{"content":"&#x2705; <strong>Nessun accesso a <code>/var/run/docker.sock</code></strong> &#x2192; non puoi controllare il VPS tramite Docker.","children":[],"payload":{"tag":"li","lines":"237,238"}},{"content":"&#x2705; <strong>Nessun path <code>/host</code>, <code>/mnt</code> esposto</strong> &#x2192; non stai montando parti esplicite dell&#x2019;host nel container.","children":[],"payload":{"tag":"li","lines":"238,239"}},{"content":"&#x2705; <code>docker</code> e <code>capsh</code> non disponibili &#x2192; immagine leggera, nessun tool di gestione host.","children":[],"payload":{"tag":"li","lines":"239,240"}}],"payload":{"tag":"h3","lines":"235,236"}},{"content":"&#x26a0;&#xfe0f; Indicatori neutri o a rischio contenuto:","children":[{"content":"&#x26a0;&#xfe0f; <code>/proc/1/cgroup</code> &#x2192; mostra <code>0::/</code> &#x2192; <strong>non indica esplicitamente che sei in un container</strong>, ma il nome host (<code>7d57ad7d93ce</code>) e i processi <code>s6</code> fanno pensare a un ambiente containerizzato. &#xc8; comune nei container pi&#xf9; minimali.","children":[],"payload":{"tag":"li","lines":"241,242"}},{"content":"&#x26a0;&#xfe0f; <strong>Filesystem host montato parzialmente</strong>: vedi questa riga:<pre data-lines=\"243,246\"><code data-lines=\"243,246\">/dev/vda1 on /etc/hostname <span class=\"hljs-built_in\">type</span> ext4 (rw,relatime,...)\n</code></pre>\n&#x2192; significa che il file <code>/etc/hostname</code> (e anche <code>/etc/hosts</code>, <code>/etc/resolv.conf</code>, <code>/workspace</code>, <code>/config</code>) <strong>sono reali file dell&#x2019;host</strong>, montati nel container.<br>\nNon &#xe8; sufficiente da solo per comprometterti, ma indica un legame <em>non isolato al 100%</em>.","children":[],"payload":{"tag":"li","lines":"242,248"}}],"payload":{"tag":"h3","lines":"240,241"}},{"content":"&#x274c; Indicatori di rischio serio:","children":[{"content":"&#x274c; <code>cat /proc/self/uid_map</code> &#x2192; restituisce:<pre data-lines=\"250,253\"><code data-lines=\"250,253\">         <span class=\"hljs-attribute\">0</span>          <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">4294967295</span>\n</code></pre>\n&#x2192; significa che <strong>il root del container &#xe8; anche root dell&apos;host</strong>.<br>\nAnche se stai usando l&#x2019;utente <code>abc</code>, il container <em>non</em> &#xe8; protetto da user namespaces.<br>\nQuesto <strong>aumenta la severit&#xe0;</strong> in caso di exploit del kernel (es. overlayfs, runC escape, etc.).","children":[],"payload":{"tag":"li","lines":"249,256"}},{"content":"&#x274c; <strong>Processi <code>root</code> attivi nel container</strong>, inclusi:<pre data-lines=\"257,260\"><code data-lines=\"257,260\"><span class=\"hljs-built_in\">sudo</span> apt install npm npx\n</code></pre>\n&#x2192; se un utente riesce a diventare root (es. <code>sudo</code>, exploit), ha la <em>stessa UID 0 anche sull&#x2019;host</em>, e pu&#xf2; potenzialmente comprometterti.","children":[],"payload":{"tag":"li","lines":"256,261"}}],"payload":{"tag":"h3","lines":"248,249"}},{"content":"&#x1f9e0; Diagnosi complessiva:","children":[],"payload":{"tag":"h3","lines":"261,262"}}],"payload":{"tag":"h2","lines":"234,235"}},{"content":"&#x1f6e0;&#xfe0f; Script automatico per valutazione del contenitore","children":[{"content":"&#x25b6;&#xfe0f; Come eseguirlo","children":[{"content":"1. Copia lo script in un file dal terminale:<pre data-lines=\"342,345\"><code class=\"language-bash\">nano check_container.sh\n</code></pre>","children":[],"payload":{"tag":"li","lines":"341,345","listIndex":1}},{"content":"2. Incolla il contenuto, salva con <code>CTRL+O</code>, <code>Invio</code>, poi <code>CTRL+X</code>.","children":[],"payload":{"tag":"li","lines":"345,346","listIndex":2}},{"content":"3. Rendi eseguibile:<pre data-lines=\"347,350\"><code class=\"language-bash\"><span class=\"hljs-built_in\">chmod</span> +x check_container.sh\n</code></pre>","children":[],"payload":{"tag":"li","lines":"346,350","listIndex":3}},{"content":"4. Esegui:<pre data-lines=\"351,354\"><code class=\"language-bash\">./check_container.sh\n</code></pre>","children":[],"payload":{"tag":"li","lines":"350,354","listIndex":4}}],"payload":{"tag":"h3","lines":"340,341"}}],"payload":{"tag":"h2","lines":"264,265"}},{"content":"&#x2705; Prossimo passo consigliato","children":[{"content":"","children":[{"content":"<strong>Abilita user namespaces remap</strong> (esegui il container con remapping UID &#x2192; root del container &#x2260; root dell&apos;host).","children":[],"payload":{"tag":"li","lines":"355,356"}},{"content":"Esegui <code>codium-server</code> come non-root all&apos;interno del container (ok, gi&#xe0; fatto).","children":[],"payload":{"tag":"li","lines":"356,357"}},{"content":"Monta solo i volumi strettamente necessari, <strong>usa read-only quando possibile</strong>.","children":[],"payload":{"tag":"li","lines":"357,358"}},{"content":"Imposta <code>--cap-drop=ALL</code> e abilita solo quelle richieste.","children":[],"payload":{"tag":"li","lines":"358,359"}},{"content":"Usa <code>--security-opt no-new-privileges:true</code> e seccomp.<br>\nPosso aiutarti a costruire una versione <strong>pi&#xf9; sicura del tuo <code>docker run</code> o <code>docker-compose.yml</code></strong>, se vuoi.<br>\nTi va?<br>\npreferirei che le modifiche venissero consiglate direttamente dallo script e che il suo output potesse essere loggato su file<br>\nOttima richiesta &#x2014; ti preparo uno <strong>script Bash completo</strong>, che:","children":[],"payload":{"tag":"li","lines":"359,364"}}],"payload":{"tag":"ul","lines":"355,364"}},{"content":"","children":[{"content":"1. <strong>analizza la configurazione del container</strong>, come gi&#xe0; fatto sopra;","children":[],"payload":{"tag":"li","lines":"364,365","listIndex":1}},{"content":"2. <strong>valuta il rischio</strong> su base euristica (con punteggio);","children":[],"payload":{"tag":"li","lines":"365,366","listIndex":2}},{"content":"3. <strong>fornisce consigli mirati</strong> su come migliorare la sicurezza;","children":[],"payload":{"tag":"li","lines":"366,367","listIndex":3}},{"content":"4. <strong>scrive tutto l&#x2019;output su un file di log</strong> (<code>container_check.log</code>).","children":[],"payload":{"tag":"li","lines":"367,368","listIndex":4}}],"payload":{"tag":"ol","lines":"364,368"}}],"payload":{"tag":"h2","lines":"354,355"}},{"content":"&#x2705; <strong>Script Bash: <code>secure_container_check.sh</code></strong>","children":[{"content":"<pre data-lines=\"369,502\"><code class=\"language-bash\"><span class=\"hljs-meta\">#!/bin/bash</span>\n\n<span class=\"hljs-comment\"># File di log</span>\nLOGFILE=<span class=\"hljs-string\">&quot;container_check.log&quot;</span>\n<span class=\"hljs-built_in\">exec</span> &gt; &gt;(<span class=\"hljs-built_in\">tee</span> -a <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;LOGFILE</span>&quot;</span>) 2&gt;&amp;1\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;==============================&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x1f6a7; Container Security Checker&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x1f4c5; Date: <span class=\"hljs-subst\">&#x24;(date)</span>&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;==============================&quot;</span>\n\nscore=0\n\n<span class=\"hljs-comment\"># --- 1. Rileva ambiente container ---</span>\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[1] &#x1f50d; Ambiente container:&quot;</span>\n<span class=\"hljs-keyword\">if</span> grep -qaE <span class=\"hljs-string\">&apos;docker|lxc&apos;</span> /proc/1/cgroup; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Ambiente container rilevato&quot;</span>\n<span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Ambiente non chiaramente containerizzato&quot;</span>\n    ((score+=<span class=\"hljs-number\">1</span>))\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\"># --- 2. Verifica utente ---</span>\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[2] &#x1f464; Utente attuale:&quot;</span>\n<span class=\"hljs-built_in\">whoami</span>\n<span class=\"hljs-built_in\">id</span>\n\n<span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-string\">&quot;<span class=\"hljs-subst\">&#x24;(id -u)</span>&quot;</span> -eq 0 ]; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; Attenzione: il container gira come root&quot;</span>\n    ((score+=<span class=\"hljs-number\">2</span>))\n<span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Il container gira come utente non-root&quot;</span>\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\"># --- 3. UID remap ---</span>\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[3] &#x1f510; UID Mapping:&quot;</span>\n<span class=\"hljs-built_in\">cat</span> /proc/self/uid_map\n<span class=\"hljs-keyword\">if</span> grep -q <span class=\"hljs-string\">&apos;0[[:space:]]\\+0&apos;</span> /proc/self/uid_map; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; Nessun remapping UID: root nel container = root sull&apos;host&quot;</span>\n    ((score+=<span class=\"hljs-number\">3</span>))\n<span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; UID remappato correttamente&quot;</span>\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\"># --- 4. Mount sensibili ---</span>\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[4] &#x1f4c2; Mount sensibili:&quot;</span>\nmount | grep -E <span class=\"hljs-string\">&apos;/etc/(hostname|hosts|resolv.conf)&apos;</span> | grep -v overlay\nmount | grep -E <span class=\"hljs-string\">&apos;/(workspace|config)&apos;</span> | grep -v overlay\n\n<span class=\"hljs-keyword\">if</span> mount | grep -Eq <span class=\"hljs-string\">&apos;/etc/(hostname|hosts|resolv.conf)&apos;</span>; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  File dell&apos;host montati nel container&quot;</span>\n    ((score+=<span class=\"hljs-number\">2</span>))\n<span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Nessun file critico dell&apos;host montato&quot;</span>\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\"># --- 5. Docker socket ---</span>\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[5] &#x1f433; Docker socket:&quot;</span>\n<span class=\"hljs-keyword\">if</span> [ -S /var/run/docker.sock ]; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; Docker socket accessibile: rischio alto di takeover&quot;</span>\n    ((score+=<span class=\"hljs-number\">5</span>))\n<span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Docker socket non accessibile&quot;</span>\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\"># --- 6. Comando docker ---</span>\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[6] &#x1f9f0; Comando Docker disponibile?&quot;</span>\n<span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v docker &amp;&gt;/dev/null; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Docker &#xe8; installato nel container&quot;</span>\n    ((score+=<span class=\"hljs-number\">1</span>))\n<span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Docker non presente&quot;</span>\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\"># --- 7. Capabilities ---</span>\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[7] &#x1f6e1;&#xfe0f;  Capabilities (capsh):&quot;</span>\n<span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v capsh &amp;&gt;/dev/null; <span class=\"hljs-keyword\">then</span>\n    capsh --<span class=\"hljs-built_in\">print</span> | grep <span class=\"hljs-string\">&quot;Current&quot;</span>\n<span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2139;&#xfe0f;  capsh non disponibile &#x2014; salta controllo&quot;</span>\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\"># --- 8. lsblk ---</span>\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[8] &#x1f4bd; lsblk output:&quot;</span>\nlsblk | grep -v <span class=\"hljs-string\">&quot;loop&quot;</span>\n\n<span class=\"hljs-comment\"># --- 9. Processi root ---</span>\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[9] &#x2699;&#xfe0f;  Processi root attivi nel container:&quot;</span>\nps -U root -u root u | <span class=\"hljs-built_in\">head</span> -n 10\n\n<span class=\"hljs-comment\"># --- 10. Consigli personalizzati ---</span>\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n==============================&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x1f9e0; CONSIGLI PERSONALIZZATI&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;==============================&quot;</span>\n\n<span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-string\">&quot;<span class=\"hljs-subst\">&#x24;(id -u)</span>&quot;</span> -eq 0 ]; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x27a1;&#xfe0f;  Esegui il container come utente non-root con:    --user 1000:1000&quot;</span>\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-keyword\">if</span> grep -q <span class=\"hljs-string\">&apos;0[[:space:]]\\+0&apos;</span> /proc/self/uid_map; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x27a1;&#xfe0f;  Abilita user namespaces remap per isolare root dal container: vedi &apos;userns-remap&apos; in Docker daemon&quot;</span>\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-keyword\">if</span> [ -S /var/run/docker.sock ]; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x27a1;&#xfe0f;  Rimuovi il mount di /var/run/docker.sock: pu&#xf2; dare accesso root all&apos;host!&quot;</span>\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-keyword\">if</span> mount | grep -Eq <span class=\"hljs-string\">&apos;/etc/(hostname|hosts|resolv.conf)&apos;</span>; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x27a1;&#xfe0f;  Evita di montare /etc/hostname, /etc/hosts nel container a meno che strettamente necessario&quot;</span>\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x27a1;&#xfe0f;  Aggiungi queste opzioni al run/compose per hardening:&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;    --cap-drop=ALL&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;    --security-opt no-new-privileges:true&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;    --read-only&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;    --tmpfs /tmp&quot;</span>\n\n<span class=\"hljs-comment\"># --- 11. Diagnosi finale ---</span>\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n==============================&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; VALUTAZIONE FINALE&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;==============================&quot;</span>\n\n<span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-variable\">&#x24;score</span> -ge 8 ]; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; RISCHIO ALTO: il container potrebbe compromettere l&apos;host&quot;</span>\n<span class=\"hljs-keyword\">elif</span> [ <span class=\"hljs-variable\">&#x24;score</span> -ge 4 ]; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  RISCHIO MEDIO: applica le correzioni consigliate&quot;</span>\n<span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; RISCHIO BASSO: configurazione generalmente sicura&quot;</span>\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n&#x1f4c4; Log salvato in: <span class=\"hljs-variable\">&#x24;LOGFILE</span>&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"369,502"}}],"payload":{"tag":"h2","lines":"368,369"}},{"content":"&#x25b6;&#xfe0f; Come usarlo","children":[{"content":"1. Crea il file:<pre data-lines=\"504,507\"><code class=\"language-bash\">nano secure_container_check.sh\n</code></pre>","children":[],"payload":{"tag":"li","lines":"503,507","listIndex":1}},{"content":"2. Incolla lo script, poi salva (<code>CTRL+O</code>, <code>Invio</code>, <code>CTRL+X</code>)","children":[],"payload":{"tag":"li","lines":"507,508","listIndex":2}},{"content":"3. Rendi eseguibile:<pre data-lines=\"509,512\"><code class=\"language-bash\"><span class=\"hljs-built_in\">chmod</span> +x secure_container_check.sh\n</code></pre>","children":[],"payload":{"tag":"li","lines":"508,512","listIndex":3}},{"content":"4. Esegui:<pre data-lines=\"513,516\"><code class=\"language-bash\">./secure_container_check.sh\n</code></pre>","children":[],"payload":{"tag":"li","lines":"512,516","listIndex":4}},{"content":"5. Visualizza il log completo:<pre data-lines=\"517,520\"><code class=\"language-bash\">less container_check.log\n</code></pre>","children":[],"payload":{"tag":"li","lines":"516,520","listIndex":5}}],"payload":{"tag":"h2","lines":"502,503"}},{"content":"&#x2705; Cosa fa in pi&#xf9; rispetto al test manuale","children":[{"content":"Valuta il rischio in base a un punteggio.","children":[],"payload":{"tag":"li","lines":"521,522"}},{"content":"Fornisce consigli personalizzati solo quando rileva problemi.","children":[],"payload":{"tag":"li","lines":"522,523"}},{"content":"Salva tutto il log per analisi successiva (anche utile per auditing o CI/CD).<br>\nVuoi che aggiunga anche:","children":[],"payload":{"tag":"li","lines":"523,525"}},{"content":"il check per AppArmor o Seccomp attivi?","children":[],"payload":{"tag":"li","lines":"525,526"}},{"content":"un controllo se i file del container sono scrivibili?","children":[],"payload":{"tag":"li","lines":"526,527"}},{"content":"generazione automatica di un comando <code>docker run</code> sicuro?<br>\nsi, rendi lo cript migliore: con maggiori funzioni, pi&#xf9; ottimizzato, col codice modularizzato e commentato bene in italiano, ecc...","children":[],"payload":{"tag":"li","lines":"527,529"}},{"content":"&#x2705; Codice <strong>modularizzato in funzioni</strong>","children":[],"payload":{"tag":"li","lines":"529,530"}},{"content":"&#x2705; Commenti dettagliati <strong>in italiano</strong>","children":[],"payload":{"tag":"li","lines":"530,531"}},{"content":"&#x2705; Analisi pi&#xf9; completa (inclusi <strong>Seccomp</strong>, <strong>AppArmor</strong>, <strong>filesystem accessibile</strong>, ecc.)","children":[],"payload":{"tag":"li","lines":"531,532"}},{"content":"&#x2705; Log su file","children":[],"payload":{"tag":"li","lines":"532,533"}},{"content":"&#x2705; Diagnosi con punteggio finale","children":[],"payload":{"tag":"li","lines":"533,534"}},{"content":"&#x2705; Suggerimenti di hardening personalizzati","children":[],"payload":{"tag":"li","lines":"534,535"}}],"payload":{"tag":"h2","lines":"520,521"}},{"content":"&#x1f6e1;&#xfe0f; <strong><code>secure_container_check.sh</code> &#x2014; Versione Avanzata</strong>","children":[{"content":"<pre data-lines=\"536,767\"><code class=\"language-bash\"><span class=\"hljs-meta\">#!/bin/bash</span>\n\n<span class=\"hljs-comment\"># ================================</span>\n<span class=\"hljs-comment\"># &#x1f6e1;&#xfe0f; Secure Container Check Script</span>\n<span class=\"hljs-comment\"># &#x1f4e6; Verifica se il container &#xe8; isolato in modo sicuro dall&apos;host</span>\n<span class=\"hljs-comment\"># &#x1f4dd; Salva tutto l&apos;output in un file di log</span>\n<span class=\"hljs-comment\"># ================================</span>\n\nLOGFILE=<span class=\"hljs-string\">&quot;container_check.log&quot;</span>\n<span class=\"hljs-built_in\">exec</span> &gt; &gt;(<span class=\"hljs-built_in\">tee</span> -a <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;LOGFILE</span>&quot;</span>) 2&gt;&amp;1\nDATE=&#x24;(<span class=\"hljs-built_in\">date</span>)\n\n<span class=\"hljs-comment\"># Variabile punteggio di rischio</span>\nrisk_score=0\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Header</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">print_header</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;======================================&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x1f50d; Secure Container Security Checker&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x1f4c5; Data: <span class=\"hljs-variable\">&#x24;DATE</span>&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;======================================&quot;</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Verifica ambiente container</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_container_environment</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[1] &#x1f310; Verifica ambiente container...&quot;</span>\n    <span class=\"hljs-keyword\">if</span> grep -qaE <span class=\"hljs-string\">&apos;docker|lxc&apos;</span> /proc/1/cgroup || [ -f /.dockerenv ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Container rilevato&quot;</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Ambiente container non rilevato (potrebbe essere eseguito nativamente)&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">2</span>))\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Utente attuale</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_user</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[2] &#x1f464; Verifica utente attuale...&quot;</span>\n    USER_ID=&#x24;(<span class=\"hljs-built_in\">id</span> -u)\n    <span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;USER_ID</span>&quot;</span> -eq 0 ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; Il container gira come utente root&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">3</span>))\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Utente non-root: <span class=\"hljs-subst\">&#x24;(whoami)</span>&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: UID Mapping</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_uid_map</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[3] &#x1f510; Controllo UID remap (user namespaces)...&quot;</span>\n    UID_MAP=&#x24;(<span class=\"hljs-built_in\">cat</span> /proc/self/uid_map)\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;UID_MAP</span>&quot;</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;UID_MAP</span>&quot;</span> | grep -q <span class=\"hljs-string\">&quot;0[[:space:]]\\+0&quot;</span>; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; Nessun remap UID: root nel container = root sull&apos;host&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">3</span>))\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; UID remappato: isolamento attivo&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Verifica mount critici</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_sensitive_mounts</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[4] &#x1f4c2; Verifica mount sensibili...&quot;</span>\n    mounts=&#x24;(mount | grep -E <span class=\"hljs-string\">&apos;/etc/(hostname|hosts|resolv.conf)|/workspace|/config&apos;</span>)\n    <span class=\"hljs-keyword\">if</span> [ -n <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;mounts</span>&quot;</span> ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Alcuni file host sono montati nel container:&quot;</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;mounts</span>&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">2</span>))\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Nessun mount sensibile rilevato&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Docker socket</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_docker_socket</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[5] &#x1f433; Controllo accesso a Docker socket...&quot;</span>\n    <span class=\"hljs-keyword\">if</span> [ -S /var/run/docker.sock ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; Accesso a /var/run/docker.sock disponibile!&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">5</span>))\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Nessun accesso a Docker socket&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Comando docker</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_docker_command</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[6] &#x1f9f0; Comando docker installato?&quot;</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v docker &amp;&gt;/dev/null; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Docker &#xe8; installato all&apos;interno del container&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">1</span>))\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Docker non installato&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Capabilities</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_capabilities</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[7] &#x1f6e1;&#xfe0f;  Verifica delle capabilities (permessi speciali)...&quot;</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v capsh &amp;&gt;/dev/null; <span class=\"hljs-keyword\">then</span>\n        capsh --<span class=\"hljs-built_in\">print</span> | grep <span class=\"hljs-string\">&quot;Current:&quot;</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2139;&#xfe0f;  capsh non disponibile - non &#xe8; possibile controllare le capabilities&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Seccomp e AppArmor</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_seccomp_apparmor</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[8] &#x1f512; Controllo Seccomp e AppArmor...&quot;</span>\n    \n    <span class=\"hljs-keyword\">if</span> grep -q Seccomp /proc/1/status; <span class=\"hljs-keyword\">then</span>\n        SEC=&#x24;(grep Seccomp /proc/1/status | awk <span class=\"hljs-string\">&apos;{print &#x24;2}&apos;</span>)\n        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;SEC</span>&quot;</span> <span class=\"hljs-keyword\">in</span>\n            0) <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; Seccomp disabilitato&quot;</span>; ((risk_score+=<span class=\"hljs-number\">2</span>));;\n            1) <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Seccomp in modalit&#xe0; filtro SECCOMP_STRICT&quot;</span>; ((risk_score+=<span class=\"hljs-number\">1</span>));;\n            2) <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Seccomp attivo (SECCOMP_MODE_FILTER)&quot;</span>;;\n        <span class=\"hljs-keyword\">esac</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Seccomp non rilevabile&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n\n    <span class=\"hljs-keyword\">if</span> [ -f /proc/1/attr/current ]; <span class=\"hljs-keyword\">then</span>\n        AA=&#x24;(<span class=\"hljs-built_in\">cat</span> /proc/1/attr/current)\n        <span class=\"hljs-keyword\">if</span> [[ <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;AA</span>&quot;</span> == <span class=\"hljs-string\">&quot;unconfined&quot;</span> ]]; <span class=\"hljs-keyword\">then</span>\n            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; AppArmor disabilitato&quot;</span>\n            ((risk_score+=<span class=\"hljs-number\">2</span>))\n        <span class=\"hljs-keyword\">else</span>\n            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; AppArmor attivo: <span class=\"hljs-variable\">&#x24;AA</span>&quot;</span>\n        <span class=\"hljs-keyword\">fi</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  AppArmor non supportato o non attivo&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Accesso a disco</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_lsblk</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[9] &#x1f4bd; Controllo accesso a dischi (lsblk)...&quot;</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v lsblk &amp;&gt;/dev/null; <span class=\"hljs-keyword\">then</span>\n        lsblk_output=&#x24;(lsblk | grep -v <span class=\"hljs-string\">&quot;loop&quot;</span>)\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;lsblk_output</span>&quot;</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;lsblk_output</span>&quot;</span> | grep -qE <span class=\"hljs-string\">&apos;^vda|^sda&apos;</span>; <span class=\"hljs-keyword\">then</span>\n            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Accesso a device reali rilevato&quot;</span>\n            ((risk_score+=<span class=\"hljs-number\">2</span>))\n        <span class=\"hljs-keyword\">else</span>\n            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Nessun device host rilevato&quot;</span>\n        <span class=\"hljs-keyword\">fi</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2139;&#xfe0f;  lsblk non disponibile&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Processi root</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_root_processes</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[10] &#x2699;&#xfe0f;  Processi root attivi nel container:&quot;</span>\n    ps -U root -u root u | <span class=\"hljs-built_in\">head</span> -n 10\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Suggerimenti</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">print_suggestions</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n==============================&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x1f9e0; SUGGERIMENTI DI HARDENING&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;==============================&quot;</span>\n\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x27a1;&#xfe0f;  Esegui il container come utente non-root: --user 1000:1000&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x27a1;&#xfe0f;  Abilita userns-remap per isolare l&apos;UID 0 dal container&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x27a1;&#xfe0f;  Evita mount di /etc/hostname, /etc/hosts, ecc.&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x27a1;&#xfe0f;  Non montare /var/run/docker.sock nel container&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x27a1;&#xfe0f;  Aggiungi flag di sicurezza:&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;    --cap-drop=ALL&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;    --security-opt no-new-privileges:true&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;    --read-only&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;    --tmpfs /tmp&quot;</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># Funzione: Diagnosi finale</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-function\"><span class=\"hljs-title\">final_assessment</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n==============================&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; VALUTAZIONE FINALE&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;==============================&quot;</span>\n    <span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-variable\">&#x24;risk_score</span> -ge 10 ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; RISCHIO ALTO: la sicurezza del container &#xe8; debole&quot;</span>\n    <span class=\"hljs-keyword\">elif</span> [ <span class=\"hljs-variable\">&#x24;risk_score</span> -ge 5 ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  RISCHIO MEDIO: ci sono aree da migliorare&quot;</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; RISCHIO BASSO: isolamento generalmente buono&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x1f4c4; Log completo salvato in: <span class=\"hljs-variable\">&#x24;LOGFILE</span>&quot;</span>\n}\n\n<span class=\"hljs-comment\"># -------------------------------</span>\n<span class=\"hljs-comment\"># &#x1f501; Esecuzione sequenziale</span>\n<span class=\"hljs-comment\"># -------------------------------</span>\nprint_header\ncheck_container_environment\ncheck_user\ncheck_uid_map\ncheck_sensitive_mounts\ncheck_docker_socket\ncheck_docker_command\ncheck_capabilities\ncheck_seccomp_apparmor\ncheck_lsblk\ncheck_root_processes\nprint_suggestions\nfinal_assessment\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"536,767"}}],"payload":{"tag":"h2","lines":"535,536"}},{"content":"&#x1f4cc; Come usare lo script","children":[{"content":"1. <strong>Copia il codice in un file:</strong><pre data-lines=\"769,772\"><code class=\"language-bash\">nano secure_container_check.sh\n</code></pre>","children":[],"payload":{"tag":"li","lines":"768,772","listIndex":1}},{"content":"2. <strong>Rendi eseguibile:</strong><pre data-lines=\"773,776\"><code class=\"language-bash\"><span class=\"hljs-built_in\">chmod</span> +x secure_container_check.sh\n</code></pre>","children":[],"payload":{"tag":"li","lines":"772,776","listIndex":2}},{"content":"3. <strong>Esegui:</strong><pre data-lines=\"777,780\"><code class=\"language-bash\">./secure_container_check.sh\n</code></pre>","children":[],"payload":{"tag":"li","lines":"776,780","listIndex":3}},{"content":"4. <strong>Consulta il log:</strong><pre data-lines=\"781,784\"><code class=\"language-bash\">less container_check.log\n</code></pre>","children":[],"payload":{"tag":"li","lines":"780,784","listIndex":4}}],"payload":{"tag":"h2","lines":"767,768"}},{"content":"&#x1f680; Prossimi miglioramenti possibili (su richiesta):","children":[{"content":"","children":[],"payload":{"tag":"li","lines":"785,786"}},{"content":"","children":[{"content":"Integrazione con <code>docker inspect</code>","children":[],"payload":{"tag":"li","lines":"787,788"}},{"content":"Esportazione HTML dei risultati","children":[],"payload":{"tag":"li","lines":"788,789"}},{"content":"Notifiche Telegram/email in caso di rischio alto<br>\nmolto bene... come si potrebbe migliorare ulteriormente questo progetto?<br>\na me interessano molto, nell&apos;ordine:","children":[],"payload":{"tag":"li","lines":"789,792"}}],"payload":{"tag":"ul","lines":"787,792"}},{"content":"","children":[{"content":"Generare automaticamente un docker run e un compose sicuri (magari se fosse possibile potendo anche indicare i file originali da modificare, di modo che lo script li analizzi), basato sull&#x2019;output","children":[],"payload":{"tag":"li","lines":"792,793"}},{"content":"Output in JSON per CI/CD o automazione","children":[],"payload":{"tag":"li","lines":"793,794"}},{"content":"Integrazione con docker inspect","children":[],"payload":{"tag":"li","lines":"794,795"}},{"content":"Esportazione HTML dei risultati","children":[],"payload":{"tag":"li","lines":"795,796"}},{"content":"Notifiche Telegram/email in caso di rischio alto","children":[],"payload":{"tag":"li","lines":"796,797"}}],"payload":{"tag":"ul","lines":"792,797"}},{"content":"","children":[{"content":"1. Una descrizione chiara e dettagliata nel file <code>README.md</code>, comprensiva di:","children":[{"content":"Obiettivi del progetto","children":[],"payload":{"tag":"li","lines":"798,799"}},{"content":"Contesto e finalit&#xe0;","children":[],"payload":{"tag":"li","lines":"799,800"}},{"content":"Istruzioni per l&#x2019;installazione, l&#x2019;uso e l&#x2019;eventuale distribuzione","children":[],"payload":{"tag":"li","lines":"800,801"}},{"content":"Tecnologie utilizzate","children":[],"payload":{"tag":"li","lines":"801,802"}}],"payload":{"tag":"li","lines":"797,802","listIndex":1}},{"content":"2. La struttura completa delle cartelle e dei file del progetto, con un layout coerente e facilmente navigabile.","children":[],"payload":{"tag":"li","lines":"802,803","listIndex":2}},{"content":"3. Il codice sorgente completo e funzionante, incluso:","children":[{"content":"Tutti gli script o moduli principali","children":[],"payload":{"tag":"li","lines":"804,805"}},{"content":"Funzioni ben commentate e documentate","children":[],"payload":{"tag":"li","lines":"805,806"}},{"content":"Eventuali file di configurazione (<code>.env.example</code>, <code>config.json</code>, <code>settings.py</code>, ecc.)","children":[],"payload":{"tag":"li","lines":"806,807"}}],"payload":{"tag":"li","lines":"803,807","listIndex":3}},{"content":"4. Eventuali risorse accessorie:","children":[{"content":"Esempi d&#x2019;uso (<code>examples/</code>)","children":[],"payload":{"tag":"li","lines":"808,809"}},{"content":"Script di test o automazione (<code>tests/</code>, <code>scripts/</code>)","children":[],"payload":{"tag":"li","lines":"809,810"}},{"content":"Dipendenze elencate (<code>requirements.txt</code>, <code>package.json</code>, ecc.)","children":[],"payload":{"tag":"li","lines":"810,811"}}],"payload":{"tag":"li","lines":"807,811","listIndex":4}},{"content":"5. Un file <code>.gitignore</code> coerente con il progetto","children":[],"payload":{"tag":"li","lines":"811,812","listIndex":5}},{"content":"6. Licenza del progetto (<code>LICENSE</code>), preferibilmente una licenza open-source<br>\nL&#x2019;output deve essere completo, dettagliato e pronto per essere copiato/incollato come base per un vero repository su GitHub. Assicurati di non tralasciare nulla e di integrare tutte le informazioni discusse in chat in modo organico.<br>\nIl progetto analizza e rafforza la sicurezza dei container Docker, con funzioni avanzate di auditing, reportistica, generazione automatica di configurazioni sicure e alerting.","children":[],"payload":{"tag":"li","lines":"812,815","listIndex":6}}],"payload":{"tag":"ol","lines":"797,815"}}],"payload":{"tag":"h2","lines":"784,785"}},{"content":"&#x1f4c1; Struttura finale del progetto","children":[{"content":"<pre data-lines=\"816,842\"><code class=\"language-bash\">secure-container-check/\n*-- .gitignore\n*-- LICENSE\n*-- README.md\n*-- requirements.txt\n*-- secure_container_check.sh             <span class=\"hljs-comment\"># Script principale (Bash)</span>\n*-- src/\n    *-- generator.py                      <span class=\"hljs-comment\"># Generatore Docker Run e Compose sicuri</span>\n    *-- reporter.py                       <span class=\"hljs-comment\"># Output JSON/HTML</span>\n    *-- inspector.py                      <span class=\"hljs-comment\"># Analisi tramite docker inspect</span>\n    &#x2514;-- notifier.py                       <span class=\"hljs-comment\"># Notifiche Telegram / Email</span>\n*-- config/\n    &#x2514;-- config.json                       <span class=\"hljs-comment\"># Configurazioni generali</span>\n    &#x2514;-- .env.example                      <span class=\"hljs-comment\"># Esempio variabili d&#x2019;ambiente</span>\n*-- examples/\n    *-- docker-compose.insecure.yml       <span class=\"hljs-comment\"># Esempio insicuro</span>\n    &#x2514;-- docker-compose.secure.generated.yml\n*-- scripts/\n    &#x2514;-- run_full_analysis.sh              <span class=\"hljs-comment\"># Esecuzione completa integrata</span>\n*-- tests/\n    &#x2514;-- test_generator.py\n    &#x2514;-- test_reporter.py\n&#x2514;-- docs/\n    &#x2514;-- SECURITY_GUIDELINES.md           <span class=\"hljs-comment\"># Linee guida container hardening</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"816,842"}}],"payload":{"tag":"h2","lines":"815,816"}},{"content":"&#x1f4d8; <code>README.md</code>","children":[{"content":"<pre data-lines=\"843,882\"><code class=\"language-markdown\"><span class=\"hljs-section\"># &#x1f510; Secure Container Check</span>\n\nUn toolkit avanzato per l&apos;analisi e la messa in sicurezza dei container Docker, progettato per sviluppatori, DevOps e team di sicurezza.\n\n---\n\n<span class=\"hljs-section\">## &#x1f680; Obiettivi</span>\n\n<span class=\"hljs-bullet\">-</span> Analizzare l&apos;ambiente container per scoprire vulnerabilit&#xe0; di configurazione\n<span class=\"hljs-bullet\">-</span> Generare comandi <span class=\"hljs-code\">`docker run`</span> e file <span class=\"hljs-code\">`docker-compose.yml`</span> sicuri automaticamente\n<span class=\"hljs-bullet\">-</span> Fornire output in formato JSON/HTML per automazione CI/CD\n<span class=\"hljs-bullet\">-</span> Inviare alert via Telegram/Email se il rischio &#xe8; elevato\n\n---\n\n<span class=\"hljs-section\">## &#x1f4da; Contesto</span>\n\nL&#x2019;uso di container Docker &#xe8; estremamente diffuso, ma spesso vengono eseguiti con permessi troppo elevati o configurazioni poco sicure. Questo progetto aiuta ad automatizzare e standardizzare le verifiche di sicurezza, anche in ambienti CI/CD, con funzionalit&#xe0; di audit, suggerimenti e correzione automatica.\n\n---\n\n<span class=\"hljs-section\">## &#x1f6e0;&#xfe0f; Tecnologie utilizzate</span>\n\n<span class=\"hljs-bullet\">-</span> &#x1f41a; Bash (per audit rapido e portatile)\n<span class=\"hljs-bullet\">-</span> &#x1f40d; Python 3.10+ (<span class=\"hljs-code\">`src/`</span> per automazioni avanzate)\n<span class=\"hljs-bullet\">-</span> &#x1f4e6; Docker\n<span class=\"hljs-bullet\">-</span> &#x1f4dc; JSON / YAML\n<span class=\"hljs-bullet\">-</span> &#x1f4e1; Telegram Bot API (opzionale)\n\n---\n\n<span class=\"hljs-section\">## &#x1f4e6; Installazione</span>\n\n<span class=\"hljs-code\">```bash\ngit clone https://github.com/tuo-utente/secure-container-check.git\ncd secure-container-check\npip install -r requirements.txt\n</span></code></pre>","children":[],"payload":{"tag":"pre","lines":"843,882"}}],"payload":{"tag":"h2","lines":"842,843"}},{"content":"&#x25b6;&#xfe0f; Utilizzo rapido","children":[{"content":"<pre data-lines=\"887,893\"><code class=\"language-bash\"><span class=\"hljs-comment\"># Solo check statico (Bash)</span>\nbash secure_container_check.sh\n<span class=\"hljs-comment\"># Analisi completa con output JSON/HTML, generazione compose, notifiche</span>\nbash scripts/run_full_analysis.sh\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"887,893"}}],"payload":{"tag":"h2","lines":"885,886"}},{"content":"&#x1f9ea; Esempi","children":[{"content":"<pre data-lines=\"898,902\"><code class=\"language-bash\"><span class=\"hljs-comment\"># Genera file docker-compose sicuro partendo da uno insicuro</span>\npython3 src/generator.py examples/docker-compose.insecure.yml\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"898,902"}}],"payload":{"tag":"h2","lines":"896,897"}},{"content":"&#x2699;&#xfe0f; Configurazione notifiche","children":[{"content":"<pre data-lines=\"909,914\"><code class=\"language-env\">TELEGRAM_TOKEN=123456:ABC-DEF\nTELEGRAM_CHAT_ID=987654321\nENABLE_EMAIL=false\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"909,914"}}],"payload":{"tag":"h2","lines":"905,906"}},{"content":"&#x1f4c4; Output","children":[{"content":"<code>container_check.log</code>: Log completo","children":[],"payload":{"tag":"li","lines":"919,920"}},{"content":"<code>output/report.json</code>: Output JSON dettagliato","children":[],"payload":{"tag":"li","lines":"920,921"}},{"content":"<code>output/report.html</code>: Report visuale","children":[],"payload":{"tag":"li","lines":"921,922"}},{"content":"<code>output/docker-compose.secure.generated.yml</code>: File sicuro generato","children":[],"payload":{"tag":"li","lines":"922,924"}}],"payload":{"tag":"h2","lines":"917,918"}},{"content":"&#x1faaa; Licenza","children":[{"content":"<pre data-lines=\"930,940\"><code data-lines=\"930,940\"><span class=\"hljs-comment\">## &#x1f4dd; `LICENSE` (MIT)</span>\n```<span class=\"hljs-built_in\">text</span>\nMIT License\n\nCopyright (c) <span class=\"hljs-number\">2025</span> ...\n\nPermission <span class=\"hljs-keyword\">is</span> hereby granted, free <span class=\"hljs-keyword\">of</span> charge, <span class=\"hljs-keyword\">to</span> any person obtaining a <span class=\"hljs-keyword\">copy</span>...\n...\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"930,940"}}],"payload":{"tag":"h2","lines":"926,927"}},{"content":"&#x2699;&#xfe0f; <code>.gitignore</code>","children":[{"content":"<pre data-lines=\"941,949\"><code class=\"language-gitignore\">__pycache__/\n.env\n*.log\noutput/\n*.pyc\n*.swp\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"941,949"}}],"payload":{"tag":"h2","lines":"940,941"}},{"content":"&#x1f4e6; <code>requirements.txt</code>","children":[{"content":"<pre data-lines=\"950,956\"><code class=\"language-text\">PyYAML\nrequests\njinja2\npython-dotenv\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"950,956"}}],"payload":{"tag":"h2","lines":"949,950"}},{"content":"&#x1f4c1; <code>config/config.json</code>","children":[{"content":"<pre data-lines=\"957,968\"><code class=\"language-json\"><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">&quot;risk_threshold&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">5</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;generate_secure_files&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;output_formats&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;json&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;html&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;notify&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">&quot;telegram&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;email&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n  <span class=\"hljs-punctuation\">}</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"957,968"}}],"payload":{"tag":"h2","lines":"956,957"}},{"content":"&#x1f9ea; Esempio Compose Insecure (<code>examples/docker-compose.insecure.yml</code>)","children":[{"content":"<pre data-lines=\"969,981\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&apos;3&apos;</span>\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">vscode:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">codercom/code-server</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8080:8080&quot;</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./data:/home/coder</span>\n    <span class=\"hljs-attr\">user:</span> <span class=\"hljs-string\">root</span>\n    <span class=\"hljs-attr\">privileged:</span> <span class=\"hljs-literal\">true</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"969,981"}}],"payload":{"tag":"h2","lines":"968,969"}},{"content":"&#x1f510; Esempio Compose Sicuro Generato (<code>examples/docker-compose.secure.generated.yml</code>)","children":[{"content":"<pre data-lines=\"982,1000\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&apos;3&apos;</span>\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">vscode:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">codercom/code-server</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8080:8080&quot;</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./data:/home/coder</span>\n    <span class=\"hljs-attr\">user:</span> <span class=\"hljs-string\">&quot;1000:1000&quot;</span>\n    <span class=\"hljs-attr\">read_only:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-attr\">tmpfs:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/tmp</span>\n    <span class=\"hljs-attr\">cap_drop:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">ALL</span>\n    <span class=\"hljs-attr\">security_opt:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-literal\">no</span><span class=\"hljs-string\">-new-privileges:true</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"982,1000"}}],"payload":{"tag":"h2","lines":"981,982"}},{"content":"&#x1f527; <code>scripts/run_full_analysis.sh</code>","children":[{"content":"<pre data-lines=\"1001,1016\"><code class=\"language-bash\"><span class=\"hljs-meta\">#!/bin/bash</span>\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;[*] Avvio verifica container...&quot;</span>\nbash secure_container_check.sh\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;[*] Generazione output JSON/HTML...&quot;</span>\npython3 src/reporter.py\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;[*] Generazione docker-compose sicuro...&quot;</span>\npython3 src/generator.py examples/docker-compose.insecure.yml\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;[*] Notifica (se abilitata)...&quot;</span>\npython3 src/notifier.py\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1001,1016"}}],"payload":{"tag":"h2","lines":"1000,1001"}},{"content":"&#x1f9e0; <code>src/generator.py</code> (semplificato)","children":[{"content":"<pre data-lines=\"1017,1042\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> yaml, sys, os\n<span class=\"hljs-keyword\">from</span> pathlib <span class=\"hljs-keyword\">import</span> Path\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">harden_compose</span>(<span class=\"hljs-params\">compose_data</span>):\n    service = <span class=\"hljs-built_in\">next</span>(<span class=\"hljs-built_in\">iter</span>(compose_data[<span class=\"hljs-string\">&apos;services&apos;</span>].values()))\n    service[<span class=\"hljs-string\">&apos;user&apos;</span>] = <span class=\"hljs-string\">&apos;1000:1000&apos;</span>\n    service[<span class=\"hljs-string\">&apos;read_only&apos;</span>] = <span class=\"hljs-literal\">True</span>\n    service[<span class=\"hljs-string\">&apos;cap_drop&apos;</span>] = [<span class=\"hljs-string\">&apos;ALL&apos;</span>]\n    service[<span class=\"hljs-string\">&apos;tmpfs&apos;</span>] = [<span class=\"hljs-string\">&apos;/tmp&apos;</span>]\n    service[<span class=\"hljs-string\">&apos;security_opt&apos;</span>] = [<span class=\"hljs-string\">&apos;no-new-privileges:true&apos;</span>]\n    <span class=\"hljs-keyword\">return</span> compose_data\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">main</span>(<span class=\"hljs-params\">path</span>):\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(path, <span class=\"hljs-string\">&apos;r&apos;</span>) <span class=\"hljs-keyword\">as</span> f:\n        data = yaml.safe_load(f)\n    hardened = harden_compose(data)\n    out = <span class=\"hljs-string\">&apos;examples/docker-compose.secure.generated.yml&apos;</span>\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(out, <span class=\"hljs-string\">&apos;w&apos;</span>) <span class=\"hljs-keyword\">as</span> f:\n        yaml.dump(hardened, f)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;[+] File sicuro generato: <span class=\"hljs-subst\">{out}</span>&quot;</span>)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n    main(sys.argv[<span class=\"hljs-number\">1</span>])\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1017,1042"}}],"payload":{"tag":"h2","lines":"1016,1017"}},{"content":"&#x1f9fe; <code>src/reporter.py</code> (semplificato)","children":[{"content":"<pre data-lines=\"1043,1063\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> json, os\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n\nresult = {\n    <span class=\"hljs-string\">&quot;date&quot;</span>: <span class=\"hljs-built_in\">str</span>(datetime.now()),\n    <span class=\"hljs-string\">&quot;risk_score&quot;</span>: <span class=\"hljs-number\">6</span>,\n    <span class=\"hljs-string\">&quot;status&quot;</span>: <span class=\"hljs-string\">&quot;medium&quot;</span>,\n    <span class=\"hljs-string\">&quot;details&quot;</span>: {\n        <span class=\"hljs-string\">&quot;user&quot;</span>: <span class=\"hljs-string\">&quot;root&quot;</span>,\n        <span class=\"hljs-string\">&quot;docker_socket&quot;</span>: <span class=\"hljs-literal\">False</span>,\n        <span class=\"hljs-string\">&quot;uid_remap&quot;</span>: <span class=\"hljs-literal\">False</span>\n    }\n}\n\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&quot;output/report.json&quot;</span>, <span class=\"hljs-string\">&quot;w&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n    json.dump(result, f, indent=<span class=\"hljs-number\">2</span>)\n\n<span class=\"hljs-comment\"># HTML via Jinja2 (esempio semplificato omesso)</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1043,1063"}}],"payload":{"tag":"h2","lines":"1042,1043"}},{"content":"&#x1f4e1; <code>src/notifier.py</code> (Telegram)","children":[{"content":"<pre data-lines=\"1064,1079\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> os, requests\n<span class=\"hljs-keyword\">from</span> dotenv <span class=\"hljs-keyword\">import</span> load_dotenv\nload_dotenv()\n\nTOKEN = os.getenv(<span class=\"hljs-string\">&quot;TELEGRAM_TOKEN&quot;</span>)\nCHAT_ID = os.getenv(<span class=\"hljs-string\">&quot;TELEGRAM_CHAT_ID&quot;</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">notify</span>(<span class=\"hljs-params\">msg</span>):\n    url = <span class=\"hljs-string\">f&quot;https://api.telegram.org/bot<span class=\"hljs-subst\">{TOKEN}</span>/sendMessage&quot;</span>\n    requests.post(url, json={<span class=\"hljs-string\">&quot;chat_id&quot;</span>: CHAT_ID, <span class=\"hljs-string\">&quot;text&quot;</span>: msg})\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n    notify(<span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f; Rischio sicurezza container: livello MEDIO&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1064,1079"}}],"payload":{"tag":"h2","lines":"1063,1064"}},{"content":"&#x2705; <code>tests/test_generator.py</code>","children":[{"content":"<pre data-lines=\"1080,1090\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> yaml\n<span class=\"hljs-keyword\">from</span> src <span class=\"hljs-keyword\">import</span> generator\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">test_user_added</span>():\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&quot;examples/docker-compose.insecure.yml&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        data = yaml.safe_load(f)\n    hardened = generator.harden_compose(data)\n    <span class=\"hljs-keyword\">assert</span> hardened[<span class=\"hljs-string\">&apos;services&apos;</span>][<span class=\"hljs-string\">&apos;vscode&apos;</span>][<span class=\"hljs-string\">&apos;user&apos;</span>] == <span class=\"hljs-string\">&quot;1000:1000&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1080,1090"}}],"payload":{"tag":"h2","lines":"1079,1080"}},{"content":"&#x1f4c4; <code>docs/SECURITY_GUIDELINES.md</code> (estratto)","children":[{"content":"<pre data-lines=\"1091,1099\"><code class=\"language-markdown\"><span class=\"hljs-section\"># &#x1f9f0; Best Practices per la Sicurezza dei Container</span>\n\n<span class=\"hljs-bullet\">-</span> &#x1f9cd; Esegui sempre i container come utente non-root\n<span class=\"hljs-bullet\">-</span> &#x1f9f7; Usa <span class=\"hljs-code\">`--cap-drop=ALL`</span> e <span class=\"hljs-code\">`--security-opt no-new-privileges:true`</span>\n<span class=\"hljs-bullet\">-</span> &#x1f512; Evita mount pericolosi come <span class=\"hljs-code\">`/var/run/docker.sock`</span>\n<span class=\"hljs-bullet\">-</span> &#x1f9ca; Usa filesystem <span class=\"hljs-code\">`read-only`</span> e <span class=\"hljs-code\">`tmpfs`</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1091,1099"}}],"payload":{"tag":"h2","lines":"1090,1091"}},{"content":"&#x1f5c2; Struttura del progetto","children":[{"content":"<pre data-lines=\"1101,1130\"><code data-lines=\"1101,1130\">secure<span class=\"hljs-operator\">-</span>container<span class=\"hljs-operator\">-</span><span class=\"hljs-keyword\">check</span><span class=\"hljs-operator\">/</span>\n<span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- .gitignore</span>\n<span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- LICENSE</span>\n<span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- README.md</span>\n<span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- requirements.txt</span>\n<span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- secure_container_check.sh</span>\n<span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- src/</span>\n    <span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- __init__.py</span>\n    <span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- generator.py</span>\n    <span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- reporter.py</span>\n    <span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- inspector.py</span>\n    <span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- notifier.py</span>\n    &#x2514;<span class=\"hljs-comment\">-- utils.py</span>\n<span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- config/</span>\n    <span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- config.json</span>\n    &#x2514;<span class=\"hljs-comment\">-- .env.example</span>\n<span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- examples/</span>\n    <span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- docker-compose.insecure.yml</span>\n    &#x2514;<span class=\"hljs-comment\">-- docker-compose.secure.generated.yml</span>\n<span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- scripts/</span>\n    &#x2514;<span class=\"hljs-comment\">-- run_full_analysis.sh</span>\n<span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- tests/</span>\n    <span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- __init__.py</span>\n    <span class=\"hljs-operator\">*</span><span class=\"hljs-comment\">-- test_generator.py</span>\n    &#x2514;<span class=\"hljs-comment\">-- test_reporter.py</span>\n&#x2514;<span class=\"hljs-comment\">-- docs/</span>\n    &#x2514;<span class=\"hljs-comment\">-- SECURITY_GUIDELINES.md</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1101,1130"}}],"payload":{"tag":"h2","lines":"1100,1101"}},{"content":"&#x1f4c4; Contenuto completo dei file","children":[{"content":"<code>.gitignore</code>","children":[{"content":"<pre data-lines=\"1132,1156\"><code class=\"language-gitignore\"># Byte-compiled / optimized / DLL files\n__pycache__/\n*.py[cod]\n*&#x24;py.class\n\n# Env files\n.env\n.env.local\n.env.*.local\n\n# Logs and outputs\n*.log\noutput/\n*.html\n*.json\n\n# IDEs\n.vscode/\n.idea/\n\n# Others\n*.swp\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1132,1156"}}],"payload":{"tag":"h3","lines":"1131,1132"}},{"content":"<code>LICENSE</code>","children":[{"content":"<pre data-lines=\"1157,1180\"><code class=\"language-text\">MIT License\n\nCopyright (c) 2025\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the &quot;Software&quot;), to deal\nin the Software without restriction, including without limitation the rights \nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell \ncopies of the Software, and to permit persons to whom the Software is \nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in \nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER \nDEALINGS IN THE SOFTWARE.\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1157,1180"}}],"payload":{"tag":"h3","lines":"1156,1157"}},{"content":"<code>README.md</code>","children":[{"content":"<pre data-lines=\"1181,1229\"><code class=\"language-markdown\"><span class=\"hljs-section\"># Secure Container Check</span>\n\nUn toolkit completo per analizzare e rafforzare la sicurezza dei container Docker, pensato per sviluppatori, DevOps e chiunque voglia automatizzare verifiche, report e correzioni.\n\n---\n\n<span class=\"hljs-section\">## &#x1f3af; Obiettivi del progetto</span>\n\n<span class=\"hljs-bullet\">-</span> Eseguire controlli di sicurezza su container, rilevando configurazioni rischiose  \n<span class=\"hljs-bullet\">-</span> Generare automaticamente un comando <span class=\"hljs-code\">`docker run`</span> e un file <span class=\"hljs-code\">`docker-compose.yml`</span> &#x201c;sicuri&#x201d; basati sulle verifiche e su configurazioni esistenti  \n<span class=\"hljs-bullet\">-</span> Fornire report in formati JSON e HTML per integrazione con pipeline CI/CD  \n<span class=\"hljs-bullet\">-</span> Integrare <span class=\"hljs-code\">`docker inspect`</span> per analizzare container in esecuzione  \n<span class=\"hljs-bullet\">-</span> Inviare notifiche (Telegram o email) se la situazione &#xe8; ad alto rischio\n\n---\n\n<span class=\"hljs-section\">## &#x1f4dc; Contesto e finalit&#xe0;</span>\n\nMolti container vengono eseguiti con privilegi e montaggi troppo permissivi, o senza meccanismi di isolamento adeguati. Questo strumento aiuta a identificare queste debolezze e a proporre (o generare) configurazioni migliori. &#xc8; utile per:\n\n<span class=\"hljs-bullet\">-</span> Ambienti di sviluppo personali  \n<span class=\"hljs-bullet\">-</span> Sistemi CI/CD automatizzati  \n<span class=\"hljs-bullet\">-</span> Audit periodici su server di produzione  \n<span class=\"hljs-bullet\">-</span> Sicurezza DevOps / Team di infrastrutture\n\n---\n\n<span class=\"hljs-section\">## &#x2699;&#xfe0f; Tecnologie utilizzate</span>\n\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-strong\">**Bash**</span>: per il controllo rapido del container  \n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-strong\">**Python 3.x**</span>: per moduli pi&#xf9; avanzati (generazione, reportistica, notifica)  \n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-strong\">**PyYAML**</span>, <span class=\"hljs-strong\">**Jinja2**</span>, <span class=\"hljs-strong\">**python-dotenv**</span>, <span class=\"hljs-strong\">**requests**</span>  \n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-strong\">**Docker**</span> (comando <span class=\"hljs-code\">`docker inspect`</span> integrato)  \n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-strong\">**Telegram Bot API**</span> (facoltativa) per notifiche  \n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-strong\">**HTML / JSON**</span> per output leggibili e integrabili\n\n---\n\n<span class=\"hljs-section\">## &#x1f6e0; Installazione</span>\n\n<span class=\"hljs-code\">```bash\ngit clone https://github.com/tuo-utente/secure-container-check.git\ncd secure-container-check\npython3 -m venv venv\nsource venv/bin/activate\npip install -r requirements.txt\n</span></code></pre>","children":[],"payload":{"tag":"pre","lines":"1181,1229"}}],"payload":{"tag":"h3","lines":"1180,1181"}}],"payload":{"tag":"h2","lines":"1130,1131"}},{"content":"&#x25b6;&#xfe0f; Uso","children":[{"content":"1. Solo audit (Bash)","children":[{"content":"<pre data-lines=\"1236,1240\"><code class=\"language-bash\">bash secure_container_check.sh\n<span class=\"hljs-comment\"># Generer&#xe0; log in container_check.log</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1236,1240"}}],"payload":{"tag":"h3","lines":"1234,1235"}},{"content":"2. Analisi completa + generazione + notifiche","children":[{"content":"<pre data-lines=\"1243,1246\"><code class=\"language-bash\">bash scripts/run_full_analysis.sh\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1243,1246"}}],"payload":{"tag":"h3","lines":"1241,1242"}},{"content":"3. Generazione &#x201c;sicura&#x201d; da un docker-compose esistente","children":[{"content":"<pre data-lines=\"1249,1253\"><code class=\"language-bash\">python3 src/generator.py examples/docker-compose.insecure.yml \\\n    -o examples/docker-compose.secure.generated.yml\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1249,1253"}}],"payload":{"tag":"h3","lines":"1247,1248"}}],"payload":{"tag":"h2","lines":"1232,1233"}},{"content":"&#x2699; Configurazione notifiche","children":[{"content":"<pre data-lines=\"1260,1270\"><code data-lines=\"1260,1270\"><span class=\"hljs-attr\">TELEGRAM_TOKEN</span>=il_tuo_token\n<span class=\"hljs-attr\">TELEGRAM_CHAT_ID</span>=tuo_chat_id\n<span class=\"hljs-attr\">EMAIL_HOST</span>=smtp.example.com\n<span class=\"hljs-attr\">EMAIL_PORT</span>=<span class=\"hljs-number\">587</span>\n<span class=\"hljs-attr\">EMAIL_USER</span>=tuo@esempio.com\n<span class=\"hljs-attr\">EMAIL_PASS</span>=segreta\n<span class=\"hljs-attr\">ENABLE_EMAIL</span>=<span class=\"hljs-literal\">false</span>\n<span class=\"hljs-attr\">ENABLE_TELEGRAM</span>=<span class=\"hljs-literal\">true</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1260,1270"}}],"payload":{"tag":"h2","lines":"1256,1257"}},{"content":"&#x1f4c2; Output generati","children":[{"content":"<code>container_check.log</code> &#x2014; log dettagliato","children":[],"payload":{"tag":"li","lines":"1275,1276"}},{"content":"<code>output/report.json</code> &#x2014; report strutturato","children":[],"payload":{"tag":"li","lines":"1276,1277"}},{"content":"<code>output/report.html</code> &#x2014; report leggibile in HTML","children":[],"payload":{"tag":"li","lines":"1277,1278"}},{"content":"<code>examples/docker-compose.secure.generated.yml</code> &#x2014; versione &#x201c;sicura&#x201d; del compose","children":[],"payload":{"tag":"li","lines":"1278,1280"}}],"payload":{"tag":"h2","lines":"1273,1274"}},{"content":"&#x1f9ea; Testing","children":[{"content":"<pre data-lines=\"1284,1287\"><code class=\"language-bash\">pytest tests\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1284,1287"}}],"payload":{"tag":"h2","lines":"1282,1283"}},{"content":"&#x1f6e1; Linee guida di sicurezza","children":[],"payload":{"tag":"h2","lines":"1290,1291"}},{"content":"&#x1f4c4; Licenza","children":[{"content":"<code>secure_container_check.sh</code>","children":[{"content":"<pre data-lines=\"1309,1494\"><code class=\"language-bash\"><span class=\"hljs-meta\">#!/bin/bash</span>\n\n<span class=\"hljs-comment\"># ==================================================</span>\n<span class=\"hljs-comment\"># Secure Container Check (vers. avanzata)</span>\n<span class=\"hljs-comment\"># Script Bash per audit rapido del container</span>\n<span class=\"hljs-comment\"># ==================================================</span>\n\nLOGFILE=<span class=\"hljs-string\">&quot;container_check.log&quot;</span>\n<span class=\"hljs-comment\"># Redireziona stdout e stderr anche su file log</span>\n<span class=\"hljs-built_in\">exec</span> &gt; &gt;(<span class=\"hljs-built_in\">tee</span> -a <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;LOGFILE</span>&quot;</span>) 2&gt;&amp;1\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;================================&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot; Secure Container Check&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot; Data: <span class=\"hljs-subst\">&#x24;(date)</span>&quot;</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;================================&quot;</span>\n\nrisk_score=0\n\n<span class=\"hljs-comment\"># Funzioni modulari</span>\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_container_env</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[1] Verifica ambiente container...&quot;</span>\n    <span class=\"hljs-keyword\">if</span> grep -qaE <span class=\"hljs-string\">&apos;docker|lxc&apos;</span> /proc/1/cgroup || [ -f /.dockerenv ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Ambiente container rilevato&quot;</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Ambiente container non chiaramente rilevato&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">2</span>))\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_user</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[2] Verifica utente attuale...&quot;</span>\n    uid=&#x24;(<span class=\"hljs-built_in\">id</span> -u)\n    <span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;uid</span>&quot;</span> -eq 0 ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; Il container &#xe8; in esecuzione come root&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">3</span>))\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Utente non-root: <span class=\"hljs-subst\">&#x24;(whoami)</span>&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_uid_map</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[3] Controllo UID remap...&quot;</span>\n    map=&#x24;(<span class=\"hljs-built_in\">cat</span> /proc/self/uid_map)\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;map</span>&quot;</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;map</span>&quot;</span> | grep -q <span class=\"hljs-string\">&quot;0[[:space:]]\\+0&quot;</span>; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; Nessun remap dell&apos;UID 0&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">3</span>))\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; UID remappato&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_mounts</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[4] Verifica mount sensibili...&quot;</span>\n    mounts=&#x24;(mount | grep -E <span class=\"hljs-string\">&apos;/etc/(hostname|hosts|resolv.conf)|/workspace|/config&apos;</span>)\n    <span class=\"hljs-keyword\">if</span> [ -n <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;mounts</span>&quot;</span> ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Trovati mount sensibili:&quot;</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;mounts</span>&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">2</span>))\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Nessun mount sensibile rilevato&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_docker_socket</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[5] Verifica Docker socket...&quot;</span>\n    <span class=\"hljs-keyword\">if</span> [ -S /var/run/docker.sock ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; Docker socket accessibile&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">5</span>))\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Docker socket non accessibile&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_docker_cmd</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[6] Verifica comando docker...&quot;</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v docker &amp;&gt;/dev/null; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  &apos;docker&apos; &#xe8; presente dentro il container&quot;</span>\n        ((risk_score+=<span class=\"hljs-number\">1</span>))\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; &apos;docker&apos; non trovato&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_capabilities</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[7] Verifica capabilities con capsh...&quot;</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v capsh &amp;&gt;/dev/null; <span class=\"hljs-keyword\">then</span>\n        capsh --<span class=\"hljs-built_in\">print</span> | grep <span class=\"hljs-string\">&quot;Current&quot;</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2139;&#xfe0f;  capsh non disponibile&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_seccomp_apparmor</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[8] Verifica Seccomp e AppArmor...&quot;</span>\n    <span class=\"hljs-keyword\">if</span> grep -q Seccomp /proc/1/status; <span class=\"hljs-keyword\">then</span>\n        sec=&#x24;(grep Seccomp /proc/1/status | awk <span class=\"hljs-string\">&apos;{print &#x24;2}&apos;</span>)\n        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;sec</span>&quot;</span> <span class=\"hljs-keyword\">in</span>\n            0) <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; Seccomp disabilitato&quot;</span>; ((risk_score+=<span class=\"hljs-number\">2</span>));;\n            1) <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Seccomp in modalit&#xe0; 1&quot;</span>; ((risk_score+=<span class=\"hljs-number\">1</span>));;\n            2) <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Seccomp modalit&#xe0; filtro attivo&quot;</span>;;\n        <span class=\"hljs-keyword\">esac</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Seccomp non rilevabile&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n\n    <span class=\"hljs-keyword\">if</span> [ -f /proc/1/attr/current ]; <span class=\"hljs-keyword\">then</span>\n        aa=&#x24;(<span class=\"hljs-built_in\">cat</span> /proc/1/attr/current)\n        <span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;aa</span>&quot;</span> = <span class=\"hljs-string\">&quot;unconfined&quot;</span> ]; <span class=\"hljs-keyword\">then</span>\n            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; AppArmor disabilitato&quot;</span>\n            ((risk_score+=<span class=\"hljs-number\">2</span>))\n        <span class=\"hljs-keyword\">else</span>\n            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; AppArmor attivo: <span class=\"hljs-variable\">&#x24;aa</span>&quot;</span>\n        <span class=\"hljs-keyword\">fi</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  AppArmor non applicabile&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_lsblk</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[9] Verifica lsblk...&quot;</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v lsblk &amp;&gt;/dev/null; <span class=\"hljs-keyword\">then</span>\n        out=&#x24;(lsblk | grep -v <span class=\"hljs-string\">&quot;loop&quot;</span>)\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;out</span>&quot;</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">&#x24;out</span>&quot;</span> | grep -qE <span class=\"hljs-string\">&apos;^vda|^sda&apos;</span>; <span class=\"hljs-keyword\">then</span>\n            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  Device reali rilevati&quot;</span>\n            ((risk_score+=<span class=\"hljs-number\">2</span>))\n        <span class=\"hljs-keyword\">else</span>\n            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; Ossia nessun device host visibile&quot;</span>\n        <span class=\"hljs-keyword\">fi</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2139;&#xfe0f;  lsblk non presente&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">check_root_process</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n[10] Processi root attivi...&quot;</span>\n    ps -U root -u root u | <span class=\"hljs-built_in\">head</span> -n 10\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">print_suggestions</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n==============================&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x1f4cc; Suggerimenti di hardening&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;==============================&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2022; Esegui il container come utente non-root (es. --user 1000:1000)&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2022; Abilita user namespaces remap (userns-remap nel daemon Docker)&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2022; Evita mount di file host critici (hostname, hosts, etc.)&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2022; Non montare /var/run/docker.sock&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2022; Usa opzioni di sicurezza:&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;  --cap-drop=ALL&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;  --security-opt no-new-privileges:true&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;  --read-only&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;  --tmpfs /tmp&quot;</span>\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-title\">final_assessment</span></span>() {\n    <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\n==============================&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x1f4ca; Valutazione finale&quot;</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;==============================&quot;</span>\n    <span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-variable\">&#x24;risk_score</span> -ge 10 ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x274c; RISCHIO ALTO: molte vulnerabilit&#xe0; presenti&quot;</span>\n    <span class=\"hljs-keyword\">elif</span> [ <span class=\"hljs-variable\">&#x24;risk_score</span> -ge 5 ]; <span class=\"hljs-keyword\">then</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x26a0;&#xfe0f;  RISCHIO MEDIO: alcune modifiche raccomandate&quot;</span>\n    <span class=\"hljs-keyword\">else</span>\n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; RISCHIO BASSO: configurazione generalmente sicura&quot;</span>\n    <span class=\"hljs-keyword\">fi</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Log salvato in: <span class=\"hljs-variable\">&#x24;LOGFILE</span>&quot;</span>\n}\n\n<span class=\"hljs-comment\"># --- Ordine di esecuzione ---</span>\ncheck_container_env\ncheck_user\ncheck_uid_map\ncheck_mounts\ncheck_docker_socket\ncheck_docker_cmd\ncheck_capabilities\ncheck_seccomp_apparmor\ncheck_lsblk\ncheck_root_process\nprint_suggestions\nfinal_assessment\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1309,1494"}}],"payload":{"tag":"h3","lines":"1308,1309"}},{"content":"<code>src/__init__.py</code>","children":[{"content":"<pre data-lines=\"1495,1499\"><code class=\"language-python\"><span class=\"hljs-comment\"># Questo modulo pu&#xf2; restare vuoto oppure includere version info</span>\n__version__ = <span class=\"hljs-string\">&quot;1.0.0&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1495,1499"}}],"payload":{"tag":"h3","lines":"1494,1495"}},{"content":"<code>src/utils.py</code>","children":[{"content":"<pre data-lines=\"1500,1523\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">from</span> pathlib <span class=\"hljs-keyword\">import</span> Path\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">ensure_output_dir</span>():\n    out = Path(<span class=\"hljs-string\">&quot;output&quot;</span>)\n    out.mkdir(exist_ok=<span class=\"hljs-literal\">True</span>)\n    <span class=\"hljs-keyword\">return</span> out\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">load_config</span>(<span class=\"hljs-params\">config_path=<span class=\"hljs-string\">&quot;config/config.json&quot;</span></span>):\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(config_path, <span class=\"hljs-string\">&quot;r&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        <span class=\"hljs-keyword\">return</span> json.load(f)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">write_json</span>(<span class=\"hljs-params\">data, filename</span>):\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(filename, <span class=\"hljs-string\">&quot;w&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        json.dump(data, f, indent=<span class=\"hljs-number\">2</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">write_text</span>(<span class=\"hljs-params\">data, filename</span>):\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(filename, <span class=\"hljs-string\">&quot;w&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        f.write(data)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1500,1523"}}],"payload":{"tag":"h3","lines":"1499,1500"}},{"content":"<code>src/inspector.py</code>","children":[{"content":"<pre data-lines=\"1524,1538\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> subprocess\n<span class=\"hljs-keyword\">import</span> json\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">inspect_container</span>(<span class=\"hljs-params\">container_name_or_id</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;Esegue docker inspect e restituisce il risultato come dict.&quot;&quot;&quot;</span>\n    <span class=\"hljs-keyword\">try</span>:\n        out = subprocess.check_output([<span class=\"hljs-string\">&quot;docker&quot;</span>, <span class=\"hljs-string\">&quot;inspect&quot;</span>, container_name_or_id], text=<span class=\"hljs-literal\">True</span>)\n        parsed = json.loads(out)\n        <span class=\"hljs-keyword\">return</span> parsed[<span class=\"hljs-number\">0</span>] <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(parsed, <span class=\"hljs-built_in\">list</span>) <span class=\"hljs-keyword\">else</span> parsed\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;[inspector] Errore inspect: <span class=\"hljs-subst\">{e}</span>&quot;</span>)\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">None</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1524,1538"}}],"payload":{"tag":"h3","lines":"1523,1524"}},{"content":"<code>src/generator.py</code>","children":[{"content":"<pre data-lines=\"1539,1622\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> yaml\n<span class=\"hljs-keyword\">import</span> argparse\n<span class=\"hljs-keyword\">from</span> pathlib <span class=\"hljs-keyword\">import</span> Path\n<span class=\"hljs-keyword\">from</span> .utils <span class=\"hljs-keyword\">import</span> ensure_output_dir\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">harden_service_cfg</span>(<span class=\"hljs-params\">svc_def: <span class=\"hljs-built_in\">dict</span></span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;Applica le regole di hardening a una singola definizione di servizio.&quot;&quot;&quot;</span>\n    <span class=\"hljs-comment\"># imposta utente non-root se non gi&#xe0; presente</span>\n    svc_def[<span class=\"hljs-string\">&quot;user&quot;</span>] = svc_def.get(<span class=\"hljs-string\">&quot;user&quot;</span>, <span class=\"hljs-string\">&quot;1000:1000&quot;</span>)\n    <span class=\"hljs-comment\"># read-only root filesystem</span>\n    svc_def[<span class=\"hljs-string\">&quot;read_only&quot;</span>] = <span class=\"hljs-literal\">True</span>\n    <span class=\"hljs-comment\"># droppa tutte le capability</span>\n    svc_def[<span class=\"hljs-string\">&quot;cap_drop&quot;</span>] = [<span class=\"hljs-string\">&quot;ALL&quot;</span>]\n    <span class=\"hljs-comment\"># tmpfs su /tmp</span>\n    svc_def[<span class=\"hljs-string\">&quot;tmpfs&quot;</span>] = svc_def.get(<span class=\"hljs-string\">&quot;tmpfs&quot;</span>, []) + [<span class=\"hljs-string\">&quot;/tmp&quot;</span>]\n    <span class=\"hljs-comment\"># security options</span>\n    svc_def[<span class=\"hljs-string\">&quot;security_opt&quot;</span>] = svc_def.get(<span class=\"hljs-string\">&quot;security_opt&quot;</span>, []) + [<span class=\"hljs-string\">&quot;no-new-privileges:true&quot;</span>]\n    <span class=\"hljs-keyword\">return</span> svc_def\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">generate_secure_compose</span>(<span class=\"hljs-params\">src_path: <span class=\"hljs-built_in\">str</span>, dest_path: <span class=\"hljs-built_in\">str</span> = <span class=\"hljs-literal\">None</span></span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;Legge un docker-compose YAML, applica hardening e scrive un nuovo file.&quot;&quot;&quot;</span>\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(src_path, <span class=\"hljs-string\">&quot;r&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        doc = yaml.safe_load(f)\n\n    services = doc.get(<span class=\"hljs-string\">&quot;services&quot;</span>, {})\n    <span class=\"hljs-keyword\">for</span> name, svc <span class=\"hljs-keyword\">in</span> services.items():\n        services[name] = harden_service_cfg(svc)\n\n    doc[<span class=\"hljs-string\">&quot;services&quot;</span>] = services\n\n    <span class=\"hljs-keyword\">if</span> dest_path <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">None</span>:\n        dest_path = Path(src_path).parent / (Path(src_path).stem + <span class=\"hljs-string\">&quot;.secure.generated.yml&quot;</span>)\n\n    out_path = Path(dest_path)\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(out_path, <span class=\"hljs-string\">&quot;w&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        yaml.safe_dump(doc, f)\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">str</span>(out_path)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">generate_secure_run</span>(<span class=\"hljs-params\">existing_params: <span class=\"hljs-built_in\">dict</span></span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    Genera un comando `docker run` sicuro a partire da parametri esistenti.\n    existing_params &#xe8; un dict con chiavi come image, ports, volumes, etc.\n    &quot;&quot;&quot;</span>\n    cmd = [<span class=\"hljs-string\">&quot;docker run -d&quot;</span>]\n    <span class=\"hljs-comment\"># user</span>\n    user = existing_params.get(<span class=\"hljs-string\">&quot;user&quot;</span>, <span class=\"hljs-string\">&quot;1000:1000&quot;</span>)\n    cmd.append(<span class=\"hljs-string\">f&quot;--user <span class=\"hljs-subst\">{user}</span>&quot;</span>)\n    <span class=\"hljs-comment\"># read-only</span>\n    cmd.append(<span class=\"hljs-string\">&quot;--read-only&quot;</span>)\n    <span class=\"hljs-comment\"># drop capabilities</span>\n    cmd.append(<span class=\"hljs-string\">&quot;--cap-drop ALL&quot;</span>)\n    <span class=\"hljs-comment\"># security option</span>\n    cmd.append(<span class=\"hljs-string\">&quot;--security-opt no-new-privileges:true&quot;</span>)\n    <span class=\"hljs-comment\"># tmpfs</span>\n    cmd.append(<span class=\"hljs-string\">&quot;--tmpfs /tmp&quot;</span>)\n    <span class=\"hljs-comment\"># ports</span>\n    <span class=\"hljs-keyword\">for</span> p <span class=\"hljs-keyword\">in</span> existing_params.get(<span class=\"hljs-string\">&quot;ports&quot;</span>, []):\n        cmd.append(<span class=\"hljs-string\">f&quot;-p <span class=\"hljs-subst\">{p}</span>&quot;</span>)\n    <span class=\"hljs-comment\"># volumes</span>\n    <span class=\"hljs-keyword\">for</span> v <span class=\"hljs-keyword\">in</span> existing_params.get(<span class=\"hljs-string\">&quot;volumes&quot;</span>, []):\n        cmd.append(<span class=\"hljs-string\">f&quot;-v <span class=\"hljs-subst\">{v}</span>&quot;</span>)\n    <span class=\"hljs-comment\"># image</span>\n    cmd.append(existing_params.get(<span class=\"hljs-string\">&quot;image&quot;</span>, <span class=\"hljs-string\">&quot;your-image&quot;</span>))\n    <span class=\"hljs-comment\"># command or entrypoint</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">&quot;command&quot;</span> <span class=\"hljs-keyword\">in</span> existing_params:\n        cmd.append(existing_params[<span class=\"hljs-string\">&quot;command&quot;</span>])\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot; &quot;</span>.join(cmd)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">main</span>():\n    parser = argparse.ArgumentParser(\n        description=<span class=\"hljs-string\">&quot;Genera un docker-compose o comando docker run sicuro&quot;</span>\n    )\n    parser.add_argument(<span class=\"hljs-string\">&quot;input&quot;</span>, <span class=\"hljs-built_in\">help</span>=<span class=\"hljs-string\">&quot;Docker Compose YAML di input&quot;</span>)\n    parser.add_argument(<span class=\"hljs-string\">&quot;-o&quot;</span>, <span class=\"hljs-string\">&quot;--output&quot;</span>, <span class=\"hljs-built_in\">help</span>=<span class=\"hljs-string\">&quot;Path di output del file generato&quot;</span>)\n    args = parser.parse_args()\n\n    dest = generate_secure_compose(args.<span class=\"hljs-built_in\">input</span>, args.output)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;[generator] Compose sicuro generato: <span class=\"hljs-subst\">{dest}</span>&quot;</span>)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n    main()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1539,1622"}}],"payload":{"tag":"h3","lines":"1538,1539"}},{"content":"<code>src/reporter.py</code>","children":[{"content":"<pre data-lines=\"1623,1681\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">from</span> jinja2 <span class=\"hljs-keyword\">import</span> Environment, FileSystemLoader\n<span class=\"hljs-keyword\">from</span> .utils <span class=\"hljs-keyword\">import</span> ensure_output_dir, write_json\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n\nTEMPLATE_HTML = <span class=\"hljs-string\">&quot;&quot;&quot;\n&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;it&quot;&gt;\n&lt;head&gt;\n  &lt;meta charset=&quot;UTF-8&quot;&gt;\n  &lt;title&gt;Report Sicurezza Container&lt;/title&gt;\n  &lt;style&gt;\n    body { font-family: Arial, sans-serif; margin: 20px; }\n    .ok { color: green; }\n    .warn { color: orange; }\n    .fail { color: red; }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;h1&gt;Report Sicurezza Container&lt;/h1&gt;\n  &lt;p&gt;Data: {{ date }}&lt;/p&gt;\n  &lt;h2&gt;Punteggio di rischio: {{ score }}&lt;/h2&gt;\n  &lt;h3&gt;Dettaglio controlli:&lt;/h3&gt;\n  &lt;ul&gt;\n  {% for name, item in checks.items() %}\n    &lt;li&gt;&lt;strong&gt;{{ name }}&lt;/strong&gt;: {{ item.status }} &#x2014; {{ item.detail }}&lt;/li&gt;\n  {% endfor %}\n  &lt;/ul&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&quot;&quot;&quot;</span>\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">load_json_report</span>(<span class=\"hljs-params\">path=<span class=\"hljs-string\">&quot;output/report.json&quot;</span></span>):\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(path, <span class=\"hljs-string\">&quot;r&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        <span class=\"hljs-keyword\">return</span> json.load(f)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">generate_html_report</span>(<span class=\"hljs-params\">json_report: <span class=\"hljs-built_in\">dict</span>, out_path: <span class=\"hljs-built_in\">str</span> = <span class=\"hljs-literal\">None</span></span>):\n    env = Environment(loader=FileSystemLoader(<span class=\"hljs-string\">&quot;.&quot;</span>))\n    tpl = env.from_string(TEMPLATE_HTML)\n    html = tpl.render(date=json_report.get(<span class=\"hljs-string\">&quot;date&quot;</span>),\n                      score=json_report.get(<span class=\"hljs-string\">&quot;risk_score&quot;</span>),\n                      checks=json_report.get(<span class=\"hljs-string\">&quot;checks&quot;</span>, {}))\n    <span class=\"hljs-keyword\">if</span> out_path <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">None</span>:\n        out_path = <span class=\"hljs-string\">&quot;output/report.html&quot;</span>\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(out_path, <span class=\"hljs-string\">&quot;w&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        f.write(html)\n    <span class=\"hljs-keyword\">return</span> out_path\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">main</span>():\n    ensure_output_dir()\n    report = load_json_report()\n    html_path = generate_html_report(report)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;[reporter] HTML report generato: <span class=\"hljs-subst\">{html_path}</span>&quot;</span>)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n    main()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1623,1681"}}],"payload":{"tag":"h3","lines":"1622,1623"}},{"content":"<code>src/notifier.py</code>","children":[{"content":"<pre data-lines=\"1682,1752\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">import</span> smtplib\n<span class=\"hljs-keyword\">from</span> email.message <span class=\"hljs-keyword\">import</span> EmailMessage\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">from</span> dotenv <span class=\"hljs-keyword\">import</span> load_dotenv\n<span class=\"hljs-keyword\">from</span> .utils <span class=\"hljs-keyword\">import</span> load_config\n\nload_dotenv()\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">send_telegram</span>(<span class=\"hljs-params\">msg: <span class=\"hljs-built_in\">str</span></span>):\n    token = os.getenv(<span class=\"hljs-string\">&quot;TELEGRAM_TOKEN&quot;</span>)\n    chat_id = os.getenv(<span class=\"hljs-string\">&quot;TELEGRAM_CHAT_ID&quot;</span>)\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> token <span class=\"hljs-keyword\">or</span> <span class=\"hljs-keyword\">not</span> chat_id:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;[notifier] Token o chat ID Telegram mancanti&quot;</span>)\n        <span class=\"hljs-keyword\">return</span>\n    url = <span class=\"hljs-string\">f&quot;https://api.telegram.org/bot<span class=\"hljs-subst\">{token}</span>/sendMessage&quot;</span>\n    payload = {<span class=\"hljs-string\">&quot;chat_id&quot;</span>: chat_id, <span class=\"hljs-string\">&quot;text&quot;</span>: msg}\n    <span class=\"hljs-keyword\">try</span>:\n        resp = requests.post(url, json=payload)\n        <span class=\"hljs-keyword\">if</span> resp.status_code != <span class=\"hljs-number\">200</span>:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;[notifier] Telegram error: <span class=\"hljs-subst\">{resp.status_code}</span> &#x2014; <span class=\"hljs-subst\">{resp.text}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;[notifier] Errore invio Telegram: <span class=\"hljs-subst\">{e}</span>&quot;</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">send_email</span>(<span class=\"hljs-params\">msg: <span class=\"hljs-built_in\">str</span></span>):\n    host = os.getenv(<span class=\"hljs-string\">&quot;EMAIL_HOST&quot;</span>)\n    port = <span class=\"hljs-built_in\">int</span>(os.getenv(<span class=\"hljs-string\">&quot;EMAIL_PORT&quot;</span>, <span class=\"hljs-string\">&quot;587&quot;</span>))\n    user = os.getenv(<span class=\"hljs-string\">&quot;EMAIL_USER&quot;</span>)\n    pwd = os.getenv(<span class=\"hljs-string\">&quot;EMAIL_PASS&quot;</span>)\n    to_addr = os.getenv(<span class=\"hljs-string\">&quot;EMAIL_TO&quot;</span>)\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> host <span class=\"hljs-keyword\">or</span> <span class=\"hljs-keyword\">not</span> user <span class=\"hljs-keyword\">or</span> <span class=\"hljs-keyword\">not</span> to_addr:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;[notifier] Configurazione email incompleta&quot;</span>)\n        <span class=\"hljs-keyword\">return</span>\n    email = EmailMessage()\n    email[<span class=\"hljs-string\">&quot;From&quot;</span>] = user\n    email[<span class=\"hljs-string\">&quot;To&quot;</span>] = to_addr\n    email[<span class=\"hljs-string\">&quot;Subject&quot;</span>] = <span class=\"hljs-string\">&quot;Alert: sicurezza container&quot;</span>\n    email.set_content(msg)\n    <span class=\"hljs-keyword\">try</span>:\n        <span class=\"hljs-keyword\">with</span> smtplib.SMTP(host, port) <span class=\"hljs-keyword\">as</span> server:\n            server.starttls()\n            server.login(user, pwd)\n            server.send_message(email)\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;[notifier] Errore invio email: <span class=\"hljs-subst\">{e}</span>&quot;</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">main</span>():\n    config = load_config()\n    rpt = {}\n    <span class=\"hljs-keyword\">try</span>:\n        <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&quot;output/report.json&quot;</span>, <span class=\"hljs-string\">&quot;r&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n            rpt = json.load(f)\n    <span class=\"hljs-keyword\">except</span> FileNotFoundError:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;[notifier] report.json non trovato&quot;</span>)\n        <span class=\"hljs-keyword\">return</span>\n\n    score = rpt.get(<span class=\"hljs-string\">&quot;risk_score&quot;</span>, <span class=\"hljs-number\">0</span>)\n    threshold = config.get(<span class=\"hljs-string\">&quot;risk_threshold&quot;</span>, <span class=\"hljs-number\">5</span>)\n    <span class=\"hljs-keyword\">if</span> score &gt;= threshold:\n        msg = <span class=\"hljs-string\">f&quot;&#x26a0;&#xfe0f; Allerta: rischio container elevato, punteggio = <span class=\"hljs-subst\">{score}</span>&quot;</span>\n        <span class=\"hljs-keyword\">if</span> config.get(<span class=\"hljs-string\">&quot;notify&quot;</span>, {}).get(<span class=\"hljs-string\">&quot;telegram&quot;</span>, <span class=\"hljs-literal\">False</span>):\n            send_telegram(msg)\n        <span class=\"hljs-keyword\">if</span> config.get(<span class=\"hljs-string\">&quot;notify&quot;</span>, {}).get(<span class=\"hljs-string\">&quot;email&quot;</span>, <span class=\"hljs-literal\">False</span>):\n            send_email(msg)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;[notifier] Notifiche inviate&quot;</span>)\n    <span class=\"hljs-keyword\">else</span>:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;[notifier] Rischio sotto soglia: nessuna notifica inviata&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1682,1752"}}],"payload":{"tag":"h3","lines":"1681,1682"}},{"content":"<code>config/config.json</code>","children":[{"content":"<pre data-lines=\"1753,1764\"><code class=\"language-json\"><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">&quot;risk_threshold&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">5</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;generate_secure_files&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;output_formats&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;json&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;html&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;notify&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">&quot;telegram&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;email&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n  <span class=\"hljs-punctuation\">}</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1753,1764"}}],"payload":{"tag":"h3","lines":"1752,1753"}},{"content":"<code>config/.env.example</code>","children":[{"content":"<pre data-lines=\"1765,1779\"><code class=\"language-text\"># Telegram\nTELEGRAM_TOKEN=\nTELEGRAM_CHAT_ID=\n\n# Email (opzionale)\nEMAIL_HOST=\nEMAIL_PORT=\nEMAIL_USER=\nEMAIL_PASS=\nEMAIL_TO=\n\n# Altri parametri\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1765,1779"}}],"payload":{"tag":"h3","lines":"1764,1765"}},{"content":"<code>examples/docker-compose.insecure.yml</code>","children":[{"content":"<pre data-lines=\"1780,1792\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&quot;3&quot;</span>\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">vscode:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">codercom/code-server</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8080:8080&quot;</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;./data:/home/coder&quot;</span>\n    <span class=\"hljs-attr\">user:</span> <span class=\"hljs-string\">&quot;0:0&quot;</span>\n    <span class=\"hljs-attr\">privileged:</span> <span class=\"hljs-literal\">true</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1780,1792"}}],"payload":{"tag":"h3","lines":"1779,1780"}},{"content":"<code>examples/docker-compose.secure.generated.yml</code>","children":[{"content":"<pre data-lines=\"1793,1811\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&quot;3&quot;</span>\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">vscode:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">codercom/code-server</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8080:8080&quot;</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;./data:/home/coder&quot;</span>\n    <span class=\"hljs-attr\">user:</span> <span class=\"hljs-string\">&quot;1000:1000&quot;</span>\n    <span class=\"hljs-attr\">read_only:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-attr\">cap_drop:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">ALL</span>\n    <span class=\"hljs-attr\">tmpfs:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/tmp</span>\n    <span class=\"hljs-attr\">security_opt:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-literal\">no</span><span class=\"hljs-string\">-new-privileges:true</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1793,1811"}}],"payload":{"tag":"h3","lines":"1792,1793"}},{"content":"<code>scripts/run_full_analysis.sh</code>","children":[{"content":"<pre data-lines=\"1812,1828\"><code class=\"language-bash\"><span class=\"hljs-meta\">#!/bin/bash</span>\n<span class=\"hljs-built_in\">set</span> -e\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;[*] Esecuzione audit container (Bash)...&quot;</span>\nbash secure_container_check.sh\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;[*] Generazione report JSON e HTML...&quot;</span>\npython3 src/reporter.py\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;[*] Generazione docker-compose sicuro (se abilitato)...&quot;</span>\npython3 src/generator.py examples/docker-compose.insecure.yml\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;[*] Invio notifiche (se rischio alto)...&quot;</span>\npython3 src/notifier.py\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1812,1828"}}],"payload":{"tag":"h3","lines":"1811,1812"}},{"content":"<code>tests/__init__.py</code>","children":[{"content":"<pre data-lines=\"1829,1832\"><code class=\"language-python\"><span class=\"hljs-comment\"># Package tests</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1829,1832"}}],"payload":{"tag":"h3","lines":"1828,1829"}},{"content":"<code>tests/test_generator.py</code>","children":[{"content":"<pre data-lines=\"1833,1868\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> yaml\n<span class=\"hljs-keyword\">from</span> src.generator <span class=\"hljs-keyword\">import</span> harden_service_cfg, generate_secure_compose\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">test_harden_service_cfg_defaults</span>():\n    svc = {}\n    hardened = harden_service_cfg(svc)\n    <span class=\"hljs-keyword\">assert</span> hardened[<span class=\"hljs-string\">&quot;user&quot;</span>] == <span class=\"hljs-string\">&quot;1000:1000&quot;</span>\n    <span class=\"hljs-keyword\">assert</span> hardened[<span class=\"hljs-string\">&quot;read_only&quot;</span>] <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">True</span>\n    <span class=\"hljs-keyword\">assert</span> <span class=\"hljs-string\">&quot;ALL&quot;</span> <span class=\"hljs-keyword\">in</span> hardened[<span class=\"hljs-string\">&quot;cap_drop&quot;</span>]\n    <span class=\"hljs-keyword\">assert</span> <span class=\"hljs-string\">&quot;/tmp&quot;</span> <span class=\"hljs-keyword\">in</span> hardened[<span class=\"hljs-string\">&quot;tmpfs&quot;</span>]\n    <span class=\"hljs-keyword\">assert</span> <span class=\"hljs-string\">&quot;no-new-privileges:true&quot;</span> <span class=\"hljs-keyword\">in</span> hardened[<span class=\"hljs-string\">&quot;security_opt&quot;</span>]\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">test_generate_secure_compose</span>(<span class=\"hljs-params\">tmp_path</span>):\n    <span class=\"hljs-comment\"># crea file compose temporaneo</span>\n    data = {\n        <span class=\"hljs-string\">&quot;version&quot;</span>: <span class=\"hljs-string\">&quot;3&quot;</span>,\n        <span class=\"hljs-string\">&quot;services&quot;</span>: {\n            <span class=\"hljs-string\">&quot;app&quot;</span>: {\n                <span class=\"hljs-string\">&quot;image&quot;</span>: <span class=\"hljs-string\">&quot;myapp:latest&quot;</span>,\n                <span class=\"hljs-string\">&quot;ports&quot;</span>: [<span class=\"hljs-string\">&quot;80:80&quot;</span>]\n            }\n        }\n    }\n    p = tmp_path / <span class=\"hljs-string\">&quot;compose.yml&quot;</span>\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(p, <span class=\"hljs-string\">&quot;w&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        yaml.safe_dump(data, f)\n    out = generate_secure_compose(<span class=\"hljs-built_in\">str</span>(p), <span class=\"hljs-built_in\">str</span>(tmp_path / <span class=\"hljs-string\">&quot;out.yml&quot;</span>))\n    <span class=\"hljs-keyword\">assert</span> (tmp_path / <span class=\"hljs-string\">&quot;out.yml&quot;</span>).exists()\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(out) <span class=\"hljs-keyword\">as</span> f:\n        new = yaml.safe_load(f)\n    svc = new[<span class=\"hljs-string\">&quot;services&quot;</span>][<span class=\"hljs-string\">&quot;app&quot;</span>]\n    <span class=\"hljs-keyword\">assert</span> svc[<span class=\"hljs-string\">&quot;user&quot;</span>] == <span class=\"hljs-string\">&quot;1000:1000&quot;</span>\n    <span class=\"hljs-keyword\">assert</span> svc[<span class=\"hljs-string\">&quot;read_only&quot;</span>] <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">True</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1833,1868"}}],"payload":{"tag":"h3","lines":"1832,1833"}},{"content":"<code>tests/test_reporter.py</code>","children":[{"content":"<pre data-lines=\"1869,1895\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">from</span> src.reporter <span class=\"hljs-keyword\">import</span> generate_html_report, load_json_report\n<span class=\"hljs-keyword\">from</span> src.utils <span class=\"hljs-keyword\">import</span> ensure_output_dir\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">test_report_html</span>(<span class=\"hljs-params\">tmp_path</span>):\n    sample = {\n        <span class=\"hljs-string\">&quot;date&quot;</span>: <span class=\"hljs-string\">&quot;2025-01-01&quot;</span>,\n        <span class=\"hljs-string\">&quot;risk_score&quot;</span>: <span class=\"hljs-number\">2</span>,\n        <span class=\"hljs-string\">&quot;checks&quot;</span>: {\n            <span class=\"hljs-string\">&quot;user&quot;</span>: {<span class=\"hljs-string\">&quot;status&quot;</span>: <span class=\"hljs-string\">&quot;ok&quot;</span>, <span class=\"hljs-string\">&quot;detail&quot;</span>: <span class=\"hljs-string\">&quot;utente non-root&quot;</span>},\n            <span class=\"hljs-string\">&quot;docker_socket&quot;</span>: {<span class=\"hljs-string\">&quot;status&quot;</span>: <span class=\"hljs-string\">&quot;ok&quot;</span>, <span class=\"hljs-string\">&quot;detail&quot;</span>: <span class=\"hljs-string\">&quot;socket non accessibile&quot;</span>}\n        }\n    }\n    ensure_output_dir()\n    out_json = os.path.join(<span class=\"hljs-string\">&quot;output&quot;</span>, <span class=\"hljs-string\">&quot;test_report.json&quot;</span>)\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(out_json, <span class=\"hljs-string\">&quot;w&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        json.dump(sample, f)\n    <span class=\"hljs-comment\"># Cambia il path temporaneamente</span>\n    html = generate_html_report(sample, <span class=\"hljs-built_in\">str</span>(tmp_path / <span class=\"hljs-string\">&quot;r.html&quot;</span>))\n    <span class=\"hljs-keyword\">assert</span> os.path.exists(<span class=\"hljs-built_in\">str</span>(tmp_path / <span class=\"hljs-string\">&quot;r.html&quot;</span>))\n    content = <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-built_in\">str</span>(tmp_path / <span class=\"hljs-string\">&quot;r.html&quot;</span>)).read()\n    <span class=\"hljs-keyword\">assert</span> <span class=\"hljs-string\">&quot;Report Sicurezza Container&quot;</span> <span class=\"hljs-keyword\">in</span> content\n    <span class=\"hljs-keyword\">assert</span> <span class=\"hljs-string\">&quot;punteggio di rischio&quot;</span> <span class=\"hljs-keyword\">in</span> content.lower()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1869,1895"}}],"payload":{"tag":"h3","lines":"1868,1869"}},{"content":"<code>docs/SECURITY_GUIDELINES.md</code>","children":[{"content":"<pre data-lines=\"1896,1962\"><code class=\"language-markdown\"><span class=\"hljs-section\"># Linee guida per l&#x2019;hardening dei container</span>\n\nQuesta guida raccoglie best practice per eseguire container con maggiore sicurezza:\n\n---\n\n<span class=\"hljs-section\">## &#x1f510; Esegui con utente non-root</span>\n\nNon eseguire il container come root se non strettamente necessario. Usa opzioni come <span class=\"hljs-code\">`--user 1000:1000`</span> o <span class=\"hljs-code\">`runAsNonRoot`</span> in Kubernetes.\n\n---\n\n<span class=\"hljs-section\">## &#x1f9f7; Droppa capability inutili</span>\n\nUsa <span class=\"hljs-code\">`--cap-drop=ALL`</span> e aggiungi solo quelle indispensabili. Non concedere <span class=\"hljs-code\">`SYS_ADMIN`</span>, <span class=\"hljs-code\">`SETUID`</span>, ecc., se non richieste.\n\n---\n\n<span class=\"hljs-section\">## &#x1f6ab; Evita mount pericolosi</span>\n\nNon montare:\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-code\">`/var/run/docker.sock`</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-code\">`/etc/hostname`</span>, <span class=\"hljs-code\">`/etc/hosts`</span>, <span class=\"hljs-code\">`/etc/resolv.conf`</span> direttamente\n<span class=\"hljs-bullet\">-</span> Directory host sensitive senza motivazione\n\n---\n\n<span class=\"hljs-section\">## &#x1f4da; Filesystem in sola lettura</span>\n\nImposta <span class=\"hljs-code\">`--read-only`</span> e monta come <span class=\"hljs-code\">`tmpfs`</span> solo ci&#xf2; che serve (es. <span class=\"hljs-code\">`/tmp`</span>).\n\n---\n\n<span class=\"hljs-section\">## &#x1f6e1; no<span class=\"hljs-emphasis\">_new_</span>privileges, seccomp, AppArmor/SELinux</span>\n\n<span class=\"hljs-bullet\">-</span> Usa <span class=\"hljs-code\">`--security-opt no-new-privileges:true`</span>\n<span class=\"hljs-bullet\">-</span> Applica profilo <span class=\"hljs-strong\">**seccomp**</span> restrittivo\n<span class=\"hljs-bullet\">-</span> Usa profili AppArmor o SELinux per confinare il container\n\n---\n\n<span class=\"hljs-section\">## &#x1f4e6; Namespace utente (user namespaces remap)</span>\n\nAttiva <span class=\"hljs-code\">`userns-remap`</span> nel demone Docker per isolare l&#x2019;UID 0 del container da quello dell&#x2019;host.\n\n---\n\n<span class=\"hljs-section\">## &#x1f4c8; Monitoraggio e aggiornamenti</span>\n\n<span class=\"hljs-bullet\">-</span> Aggiorna regolarmente kernel, Docker, runtime (runc, containerd)\n<span class=\"hljs-bullet\">-</span> Tieni traccia di CVE legati ai componenti\n<span class=\"hljs-bullet\">-</span> Automatizza audit regolari\n\n---\n\n<span class=\"hljs-section\">## &#x1f4e2; Notifiche e alerting</span>\n\nIntegra alerting (Telegram, email) per segnalare condizioni di rischio elevato a team o operatori.\n\n---\n\n<span class=\"hljs-section\">## &#x1f504; Automatizzazione</span>\n\nUtilizza script come questo per generare automaticamente configurazioni sicure e report leggibili, integrabili in pipeline di CI/CD.\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1896,1962"}}],"payload":{"tag":"h3","lines":"1895,1896"}}],"payload":{"tag":"h2","lines":"1296,1297"}},{"content":"&#x2705; Spunti di miglioramento futuri","children":[{"content":"Aggiungere modulo che analizza automaticamente un container in esecuzione (usando <code>inspector.py</code>) e applica miglioramenti &#x201c;on the fly&#x201d;","children":[],"payload":{"tag":"li","lines":"1963,1964"}},{"content":"Supporto per altri orchestratori (Kubernetes, Podman)","children":[],"payload":{"tag":"li","lines":"1964,1965"}},{"content":"UI web/dashboard per visualizzare report e modifiche consigliate","children":[],"payload":{"tag":"li","lines":"1965,1966"}},{"content":"Plugin per integrazione con GitHub Actions / GitLab CI","children":[],"payload":{"tag":"li","lines":"1966,1967"}},{"content":"Algoritmi di valutazione pi&#xf9; sofisticata, con pesi configurabili","children":[],"payload":{"tag":"li","lines":"1967,1968"}},{"content":"Backup e rollback automatico delle configurazioni generate<br>\nno, torniamo al pratico: Vorrei capire se &#xe8; possibile davvero uscire dal mio container di vscodium-server.<br>\nproviamo, sono nel terminale dell&apos;interfaccia web.","children":[],"payload":{"tag":"li","lines":"1968,1971"}}],"payload":{"tag":"h2","lines":"1962,1963"}},{"content":"&#x1f9ed; Obiettivo","children":[{"content":"puoi <strong>eseguire comandi sull&#x2019;host</strong> (privilegi di root sull&apos;host)","children":[],"payload":{"tag":"li","lines":"1973,1974"}},{"content":"accedere a <strong>file o device host</strong>","children":[],"payload":{"tag":"li","lines":"1974,1975"}},{"content":"manipolare il <strong>demone Docker</strong> (se montato)","children":[],"payload":{"tag":"li","lines":"1975,1976"}},{"content":"ottenere un <strong>reverse shell</strong> o usare exploit per evasione","children":[],"payload":{"tag":"li","lines":"1976,1977"}}],"payload":{"tag":"h2","lines":"1971,1972"}},{"content":"&#x1f9ea; Fase 1: Controlli preliminari","children":[{"content":"<pre data-lines=\"1979,2005\"><code class=\"language-bash\"><span class=\"hljs-comment\"># 1. Chi sei?</span>\n<span class=\"hljs-built_in\">id</span>\n\n<span class=\"hljs-comment\"># 2. Dove sei?</span>\n<span class=\"hljs-built_in\">pwd</span> &amp;&amp; hostname &amp;&amp; <span class=\"hljs-built_in\">uname</span> -a\n\n<span class=\"hljs-comment\"># 3. Sei dentro un container?</span>\ngrep -qaE <span class=\"hljs-string\">&apos;docker|lxc&apos;</span> /proc/1/cgroup &amp;&amp; <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2713; Sei in un container&quot;</span> || <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2717; Non sembra un container&quot;</span>\n[ -f /.dockerenv ] &amp;&amp; <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2713; /.dockerenv presente&quot;</span> || <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2717; /.dockerenv mancante&quot;</span>\n\n<span class=\"hljs-comment\"># 4. Verifica se hai accesso al Docker socket</span>\n<span class=\"hljs-built_in\">ls</span> -la /var/run/docker.sock\n\n<span class=\"hljs-comment\"># 5. Prova ad accedere al demone Docker (rischioso)</span>\ndocker ps\n\n<span class=\"hljs-comment\"># 6. Hai lsblk? Mostra i dischi host</span>\n<span class=\"hljs-built_in\">which</span> lsblk &amp;&amp; lsblk || <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;lsblk non disponibile&quot;</span>\n\n<span class=\"hljs-comment\"># 7. Mount attuali</span>\nmount | grep -v <span class=\"hljs-string\">&quot;overlay&quot;</span>\n\n<span class=\"hljs-comment\"># 8. Root mapping</span>\n<span class=\"hljs-built_in\">cat</span> /proc/self/uid_map\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1979,2005"}}],"payload":{"tag":"h2","lines":"1977,1978"}},{"content":"&#x1f9ea; Fase 2: Tentativi di evasione (da fare solo a scopo didattico)","children":[{"content":"1. Docker socket disponibile?","children":[{"content":"<pre data-lines=\"2009,2012\"><code class=\"language-bash\">docker run -v /:/host alpine <span class=\"hljs-built_in\">chroot</span> /host\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2009,2012"}}],"payload":{"tag":"h3","lines":"2007,2008"}},{"content":"2. /proc/kcore o altri device host accessibili?","children":[{"content":"<pre data-lines=\"2015,2018\"><code class=\"language-bash\"><span class=\"hljs-built_in\">ls</span> -la /proc/kcore\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2015,2018"}}],"payload":{"tag":"h3","lines":"2013,2014"}}],"payload":{"tag":"h2","lines":"2006,2007"}},{"content":"&#x1f512; Fase 3: Sei in un container sicuro?","children":[{"content":"<table data-lines=\"2021,2029\">\n<thead data-lines=\"2021,2022\">\n<tr data-lines=\"2021,2022\">\n<th>Protezione</th>\n<th>Descrizione</th>\n<th>OK?</th>\n</tr>\n</thead>\n<tbody data-lines=\"2023,2029\">\n<tr data-lines=\"2023,2024\">\n<td>User non-root?</td>\n<td><code>id -u</code> &#x2260; 0</td>\n<td>&#x2705;/&#x274c;</td>\n</tr>\n<tr data-lines=\"2024,2025\">\n<td>Docker socket non montato?</td>\n<td><code>/var/run/docker.sock</code> assente</td>\n<td>&#x2705;/&#x274c;</td>\n</tr>\n<tr data-lines=\"2025,2026\">\n<td>Filesystem read-only?</td>\n<td><code>mount</code> &#x2192; nessuna scrittura su <code>/</code></td>\n<td>&#x2705;/&#x274c;</td>\n</tr>\n<tr data-lines=\"2026,2027\">\n<td>Cap-drop attivo?</td>\n<td><code>capsh --print</code> mostra meno capability</td>\n<td>&#x2705;/&#x274c;</td>\n</tr>\n<tr data-lines=\"2027,2028\">\n<td>AppArmor/Seccomp attivi?</td>\n<td><code>/proc/1/attr/current</code> e <code>/proc/1/status</code></td>\n<td>&#x2705;/&#x274c;</td>\n</tr>\n<tr data-lines=\"2028,2029\">\n<td>No device host visibili?</td>\n<td><code>lsblk</code>, <code>mount</code></td>\n<td>&#x2705;/&#x274c;</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2021,2029"}}],"payload":{"tag":"h2","lines":"2019,2020"}},{"content":"&#x1f527; Se vuoi, fammi vedere l&#x2019;output dei comandi sopra","children":[{"content":"puoi uscire dal container","children":[],"payload":{"tag":"li","lines":"2031,2032"}},{"content":"puoi ottenere un accesso sull&#x2019;host","children":[],"payload":{"tag":"li","lines":"2032,2033"}},{"content":"sei in un container configurato male (privileged, root, ecc.)<br>\nInviami i risultati e ti guido passo-passo.<br>\n(.venv) abc@7d57ad7d93ce:~/workspace&#x24; # 1. Chi sei?<br>\nid","children":[],"payload":{"tag":"li","lines":"2033,2037"}}],"payload":{"tag":"h2","lines":"2029,2030"}}],"payload":{"tag":"h1","lines":"78,79"}},{"content":"2. Dove sei?","children":[],"payload":{"tag":"h1","lines":"2037,2038"}},{"content":"3. Sei dentro un container?","children":[],"payload":{"tag":"h1","lines":"2039,2040"}},{"content":"4. Verifica se hai accesso al Docker socket","children":[],"payload":{"tag":"h1","lines":"2042,2043"}},{"content":"5. Prova ad accedere al demone Docker (rischioso)","children":[{"content":"&#x1f510; Sommario Sicurezza del Container","children":[{"content":"<table data-lines=\"2091,2103\">\n<thead data-lines=\"2091,2092\">\n<tr data-lines=\"2091,2092\">\n<th>Controllo</th>\n<th>Esito</th>\n<th>Valutazione</th>\n</tr>\n</thead>\n<tbody data-lines=\"2093,2103\">\n<tr data-lines=\"2093,2094\">\n<td>UID &#x2260; 0</td>\n<td>&#x2705; (<code>abc</code> = UID 1000, <strong>non root</strong>)</td>\n<td>&#x1f512; Buono</td>\n</tr>\n<tr data-lines=\"2094,2095\">\n<td>Docker socket montato</td>\n<td>&#x274c; <code>No such file or directory</code></td>\n<td>&#x2705; Sicuro</td>\n</tr>\n<tr data-lines=\"2095,2096\">\n<td>Comando <code>docker</code> disponibile?</td>\n<td>&#x274c; <code>docker: command not found</code></td>\n<td>&#x2705; Sicuro</td>\n</tr>\n<tr data-lines=\"2096,2097\">\n<td>Device host accessibili?</td>\n<td>&#x274c; Nessuno visibile, solo <code>vda1</code> (montato internamente)</td>\n<td>&#x2705; Limitato</td>\n</tr>\n<tr data-lines=\"2097,2098\">\n<td><code>/proc/1/cgroup</code> contiene &quot;docker&quot;?</td>\n<td>&#x274c; No</td>\n<td>&#x26a0;&#xfe0f; Inusuale, ma <code>.dockerenv</code> presente</td>\n</tr>\n<tr data-lines=\"2098,2099\">\n<td><code>.dockerenv</code> presente?</td>\n<td>&#x2705; S&#xec;</td>\n<td>&#x1f512; Conferma container</td>\n</tr>\n<tr data-lines=\"2099,2100\">\n<td>Montaggi sospetti (/etc, /var/run, etc.)</td>\n<td>&#x2705; Solo filesystem e workspace</td>\n<td>&#x1f512; Ok</td>\n</tr>\n<tr data-lines=\"2100,2101\">\n<td>UID mapping <code>0 0 4294967295</code></td>\n<td>&#x2705; No user remapping attivo</td>\n<td>&#x26a0;&#xfe0f; Moderato</td>\n</tr>\n<tr data-lines=\"2101,2102\">\n<td><code>capsh</code> mancante</td>\n<td>&#x2014;</td>\n<td>&#x2753; Capacit&#xe0; sconosciute</td>\n</tr>\n<tr data-lines=\"2102,2103\">\n<td><code>lsblk</code> mostra solo <code>/dev/vda1</code></td>\n<td>&#x2705; Limitato al container</td>\n<td>&#x1f512; Ok</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2091,2103"}}],"payload":{"tag":"h2","lines":"2090,2091"}},{"content":"&#x1f9e0; Conclusione","children":[{"content":"&#x1f7e2; Valutazione complessiva: <strong>Container isolato correttamente</strong>","children":[],"payload":{"tag":"h3","lines":"2110,2111"}}],"payload":{"tag":"h2","lines":"2103,2104"}},{"content":"&#x1f512; Suggerimenti per aumentare ancora la sicurezza","children":[{"content":"1. <strong>Drop delle capability</strong>","children":[{"content":"Esegui con <code>--cap-drop=ALL --cap-add=CHOWN --cap-add=SETUID</code> ecc.","children":[],"payload":{"tag":"li","lines":"2113,2114"}}],"payload":{"tag":"li","lines":"2112,2114","listIndex":1}},{"content":"2. <strong>Filesystem read-only</strong>","children":[{"content":"Usa <code>--read-only</code> o monta solo directory specifiche in RW","children":[],"payload":{"tag":"li","lines":"2115,2116"}}],"payload":{"tag":"li","lines":"2114,2116","listIndex":2}},{"content":"3. <strong>User namespaces</strong>","children":[{"content":"Abilita <code>userns-remap</code> su Docker (<code>dockerd</code>) per mappare utenti container &#x2260; utenti host","children":[],"payload":{"tag":"li","lines":"2117,2118"}}],"payload":{"tag":"li","lines":"2116,2118","listIndex":3}},{"content":"4. <strong>Seccomp/ AppArmor / SELinux</strong>","children":[{"content":"Attiva policy di restrizione specifiche per il container","children":[],"payload":{"tag":"li","lines":"2119,2120"}}],"payload":{"tag":"li","lines":"2118,2120","listIndex":4}},{"content":"5. <strong>Non mappare /etc/hosts /etc/resolv.conf /etc/hostname se non necessario</strong>","children":[],"payload":{"tag":"li","lines":"2120,2121","listIndex":5}}],"payload":{"tag":"h2","lines":"2111,2112"}},{"content":"&#x2753; Domande frequenti","children":[{"content":"&#x1f50d; Ma perch&#xe9; <code>/proc/1/cgroup</code> non mostra &quot;docker&quot;?","children":[{"content":"Docker configurato con <code>--cgroupns=host</code>","children":[],"payload":{"tag":"li","lines":"2124,2125"}},{"content":"Container rootless (es: <code>podman</code>)","children":[],"payload":{"tag":"li","lines":"2125,2126"}},{"content":"Configurazioni custom del runtime (<code>containerd</code>, <code>runc</code>)","children":[],"payload":{"tag":"li","lines":"2126,2127"}}],"payload":{"tag":"h3","lines":"2122,2123"}}],"payload":{"tag":"h2","lines":"2121,2122"}},{"content":"&#x1f680; Prossimo passo: vuoi testare una fuga?","children":[{"content":"un container male configurato (<code>--privileged</code>, Docker socket montato)","children":[],"payload":{"tag":"li","lines":"2128,2129"}},{"content":"oppure una <strong>reverse shell</strong> didattica per capire i rischi<br>\nallora perch&#xe8;<br>\nabc@7d57ad7d93ce:~/workspace&#x24; python3 -m http.server 8000 --directory markmap-client<br>\nServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...<br>\nsource /config/workspace/.venv/bin/activate<br>\nsource /config/workspace/.venv/bin/activate<br>\nnon funziona (se accedo da simpleBrowser interno da pagina bianca)?<br>\nOttima domanda. Analizziamo <strong>perch&#xe9; il tuo comando <code>python3 -m http.server</code> non &#xe8; accessibile dal browser interno di VS Codium (simpleBrowser)</strong>, anche se il server &#xe8; attivo su <code>0.0.0.0:8000</code>.","children":[],"payload":{"tag":"li","lines":"2129,2137"}}],"payload":{"tag":"h2","lines":"2127,2128"}},{"content":"&#x2705; Cosa sta succedendo?","children":[{"content":"<pre data-lines=\"2139,2142\"><code class=\"language-bash\">python3 -m http.server 8000 --directory markmap-client\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2139,2142"}},{"content":"<pre data-lines=\"2143,2146\"><code data-lines=\"2143,2146\"><span class=\"hljs-attribute\">Serving</span> HTTP <span class=\"hljs-literal\">on</span> <span class=\"hljs-number\">0.0.0.0</span> port <span class=\"hljs-number\">8000</span> (http://<span class=\"hljs-number\">0.0.0.0:8000</span>/)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2143,2146"}}],"payload":{"tag":"h2","lines":"2137,2138"}},{"content":"&#x1f50d; Diagnosi: 3 motivi possibili","children":[{"content":"1. &#x274c; <strong>Porta non esposta dal container</strong>","children":[{"content":"&#x1f50e; Se hai usato <code>docker run</code>, controlla:","children":[{"content":"<pre data-lines=\"2153,2156\"><code class=\"language-bash\">docker run -p 8000:8000 ...\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2153,2156"}}],"payload":{"tag":"h4","lines":"2152,2153"}},{"content":"&#x1f50e; Se usi Docker Compose, controlla <code>ports:</code>","children":[{"content":"<pre data-lines=\"2158,2162\"><code class=\"language-yaml\"><span class=\"hljs-attr\">ports:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8000:8000&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2158,2162"}}],"payload":{"tag":"h4","lines":"2157,2158"}}],"payload":{"tag":"h3","lines":"2149,2150"}},{"content":"2. &#x274c; <strong>Browser interno non fa richieste verso <code>localhost:8000</code></strong>","children":[{"content":"il browser cerca <code>localhost:8000</code> sul computer host","children":[],"payload":{"tag":"li","lines":"2166,2167"}},{"content":"ma il server gira nel container<br>\n&#x1f501; <strong>Soluzione alternativa</strong>: se <code>simpleBrowser</code> non mappa la rete container &#x2192; usa l&#x2019;indirizzo IP interno del container (se conosciuto) oppure accedi da fuori (vedi punto 3).","children":[],"payload":{"tag":"li","lines":"2167,2169"}}],"payload":{"tag":"h3","lines":"2163,2164"}},{"content":"3. &#x274c; <strong>Proxy reverse (traefik, nginx) non mappa la porta 8000</strong>","children":[{"content":"<pre data-lines=\"2174,2179\"><code class=\"language-yaml\"><span class=\"hljs-attr\">labels:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.vscodium-service.rule=Host(`codium.mydomain.com`)&quot;</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.services.vscodium-service.loadbalancer.server.port=3000&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2174,2179"}}],"payload":{"tag":"h3","lines":"2169,2170"}}],"payload":{"tag":"h2","lines":"2148,2149"}},{"content":"&#x2705; Come risolvere (in base al caso)","children":[{"content":"<table data-lines=\"2180,2186\">\n<thead data-lines=\"2180,2181\">\n<tr data-lines=\"2180,2181\">\n<th>Causa</th>\n<th>Soluzione</th>\n</tr>\n</thead>\n<tbody data-lines=\"2182,2186\">\n<tr data-lines=\"2182,2183\">\n<td>Porta non esposta</td>\n<td>Aggiungi <code>-p 8000:8000</code> a <code>docker run</code>, o <code>ports:</code> nel Compose</td>\n</tr>\n<tr data-lines=\"2183,2184\">\n<td>Browser interno non comunica</td>\n<td>Apri un browser esterno e prova <code>http://&lt;tuo_host&gt;:8000</code></td>\n</tr>\n<tr data-lines=\"2184,2185\">\n<td>Traefik non mappa la porta</td>\n<td>Aggiungi una nuova regola per <code>/markmap</code> o simile che punta a <code>8000</code></td>\n</tr>\n<tr data-lines=\"2185,2186\">\n<td>Container dietro un proxy</td>\n<td>Aggiungi route interna o fai forwarding tra container</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2180,2186"}}],"payload":{"tag":"h2","lines":"2179,2180"}},{"content":"&#x1f50e; Test rapido da dentro il container","children":[{"content":"<pre data-lines=\"2188,2191\"><code class=\"language-bash\">curl http://127.0.0.1:8000\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2188,2191"}}],"payload":{"tag":"h2","lines":"2186,2187"}},{"content":"&#x1f527; Se vuoi, ti aiuto a configurare <code>docker run</code> o <code>docker-compose.yml</code> per rendere accessibile quella porta anche nel browser.","children":[],"payload":{"tag":"h2","lines":"2195,2196"}},{"content":"&#x1f9e0; Diagnosi del problema","children":[],"payload":{"tag":"h2","lines":"2229,2230"}},{"content":"&#x2705; Soluzioni possibili","children":[{"content":"&#x1f501; <strong>Opzione 1 &#x2014; Aggiungere una rotta dedicata Traefik per la porta 8000</strong>","children":[{"content":"&#x1f527; Step 1: Cambia porta interna di <code>http.server</code> su <code>3001</code> (evita conflitto con 3000)","children":[{"content":"<pre data-lines=\"2237,2240\"><code class=\"language-bash\">python3 -m http.server 3001 --directory markmap-client\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2237,2240"}}],"payload":{"tag":"h4","lines":"2235,2236"}},{"content":"&#x1f527; Step 2: Aggiungi una rotta custom in Traefik (con path prefix)","children":[{"content":"<pre data-lines=\"2242,2256\"><code class=\"language-yaml\"><span class=\"hljs-attr\">labels:</span>\n  <span class=\"hljs-comment\"># (lascia le esistenti)</span>\n\n  <span class=\"hljs-comment\"># &#x21aa;&#xfe0f; Nuova rotta per HTTP server custom</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.markmap.rule=Host(`&#x24;{TRAEFIK_DOMAIN_NAME}`) &amp;&amp; PathPrefix(`/markmap`)&quot;</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.markmap.entrypoints=websecure&quot;</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.markmap.tls=true&quot;</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.markmap.middlewares=strip-markmap@docker&quot;</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.services.markmap.loadbalancer.server.port=3001&quot;</span>\n\n  <span class=\"hljs-comment\"># Middleware per rimuovere il prefisso /markmap</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.middlewares.strip-markmap.stripprefix.prefixes=/markmap&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2242,2256"}}],"payload":{"tag":"h4","lines":"2240,2241"}},{"content":"&#x1f9ea; Accesso:","children":[],"payload":{"tag":"h4","lines":"2256,2257"}}],"payload":{"tag":"h3","lines":"2234,2235"}},{"content":"&#x1f513; <strong>Opzione 2 &#x2014; Esporre direttamente la porta 8000 via Docker</strong>","children":[{"content":"<pre data-lines=\"2262,2266\"><code class=\"language-yaml\"><span class=\"hljs-attr\">ports:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8000:8000&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2262,2266"}},{"content":"<pre data-lines=\"2267,2270\"><code class=\"language-bash\">python3 -m http.server 8000 --directory markmap-client\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2267,2270"}}],"payload":{"tag":"h3","lines":"2260,2261"}}],"payload":{"tag":"h2","lines":"2232,2233"}},{"content":"&#x1f9ea; Test da dentro il container","children":[{"content":"<pre data-lines=\"2275,2278\"><code class=\"language-bash\">curl http://localhost:8000\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2275,2278"}}],"payload":{"tag":"h2","lines":"2274,2275"}},{"content":"&#x2705; Raccomandazione finale","children":[{"content":"<pre data-lines=\"2289,2359\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&quot;3.8&quot;</span>\n\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">openvscode-server:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">lscr.io/linuxserver/openvscode-server:latest</span>\n    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">openvscode-server</span>\n\n    <span class=\"hljs-comment\"># &#x1f4e6; Variabili d&apos;ambiente (meglio definirle in un file .env)</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">PUID=&#x24;{PUID}</span>                     <span class=\"hljs-comment\"># ID utente del host (per i permessi corretti)</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">PGID=&#x24;{PGID}</span>                     <span class=\"hljs-comment\"># ID gruppo del host</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TZ=&#x24;{TZ}</span>                         <span class=\"hljs-comment\"># Timezone (es. Europe/Rome)</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">SUDO_PASSWORD=&#x24;{SUDO_PASSWORD}</span>  <span class=\"hljs-comment\"># Password per sudo dentro VSCode</span>\n\n    <span class=\"hljs-comment\"># &#x1f5c2;&#xfe0f; Volumi montati</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./config:/config</span>                 <span class=\"hljs-comment\"># Configurazioni persistenti (es. estensioni, impostazioni utente)</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./workspace:/workspace</span>           <span class=\"hljs-comment\"># Directory di lavoro dove salvi i progetti</span>\n\n    <span class=\"hljs-comment\"># &#x1f4cd; Directory di lavoro predefinita nel container</span>\n    <span class=\"hljs-attr\">working_dir:</span> <span class=\"hljs-string\">/workspace</span>\n\n    <span class=\"hljs-comment\"># &#x1f501; Riavvio automatico in caso di crash</span>\n    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">unless-stopped</span>\n\n    <span class=\"hljs-comment\"># &#x1f500; Etichette per il reverse proxy Traefik</span>\n    <span class=\"hljs-attr\">labels:</span>\n      <span class=\"hljs-comment\"># &#x2705; Abilita Traefik per questo container</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.enable=true&quot;</span>\n\n      <span class=\"hljs-comment\">### &#x1f310; ROUTER HTTP (porta 80 &#x2192; redirect verso HTTPS)</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.openvscode-http.rule=Host(`&#x24;{TRAEFIK_DOMAIN_NAME}`)&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.openvscode-http.entrypoints=web&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.openvscode-http.middlewares=redirect-to-https&quot;</span>\n\n      <span class=\"hljs-comment\">### &#x1f512; ROUTER HTTPS (porta 443)</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.openvscode-https.rule=Host(`&#x24;{TRAEFIK_DOMAIN_NAME}`)&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.openvscode-https.entrypoints=websecure&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.openvscode-https.tls=true&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.openvscode-https.tls.certresolver=mytlschallenge&quot;</span>\n\n      <span class=\"hljs-comment\"># &#x1f510; Middleware personalizzate (es. autenticazione &amp; headers &#x2014; riutilizza quelle di Logseq)</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.openvscode-https.middlewares=logseq-auth@file,logseq-headers@docker&quot;</span>\n\n      <span class=\"hljs-comment\"># &#x1f501; Servizio e porta interna su cui ascolta OpenVSCode</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.services.openvscode.loadbalancer.server.port=3000&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.openvscode-https.service=openvscode@docker&quot;</span>\n\n      <span class=\"hljs-comment\">####################################################</span>\n      <span class=\"hljs-comment\"># (FACOLTATIVO) ROUTER DEDICATO per Markmap o altri</span>\n      <span class=\"hljs-comment\"># Accessibile da: https://&lt;dominio&gt;/markmap</span>\n      <span class=\"hljs-comment\">####################################################</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.markmap.rule=Host(`&#x24;{TRAEFIK_DOMAIN_NAME}`) &amp;&amp; PathPrefix(`/markmap`)&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.markmap.entrypoints=websecure&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.markmap.tls=true&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.markmap.middlewares=strip-markmap@docker&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.services.markmap.loadbalancer.server.port=3001&quot;</span>\n\n      <span class=\"hljs-comment\"># &#x1f527; Middleware per rimuovere il prefisso `/markmap` prima di inoltrare</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.middlewares.strip-markmap.stripprefix.prefixes=/markmap&quot;</span>\n\n    <span class=\"hljs-comment\"># &#x1f310; Rete condivisa con Traefik</span>\n    <span class=\"hljs-attr\">networks:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">traefik_network</span>\n\n<span class=\"hljs-attr\">networks:</span>\n  <span class=\"hljs-attr\">traefik_network:</span>\n    <span class=\"hljs-attr\">external:</span> <span class=\"hljs-literal\">true</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2289,2359"}}],"payload":{"tag":"h2","lines":"2279,2280"}},{"content":"&#x1f4c4; File <code>.env</code> consigliato","children":[{"content":"<pre data-lines=\"2361,2368\"><code class=\"language-dotenv\">PUID=1000\nPGID=1000\nTZ=Europe/Rome\nSUDO_PASSWORD=moltopasswordsicura\nTRAEFIK_DOMAIN_NAME=codium.tuodominio.it\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2361,2368"}}],"payload":{"tag":"h2","lines":"2359,2360"}},{"content":"&#x2705; Cosa puoi fare ora?","children":[{"content":"&#x1f4ac; Hai anche altre esigenze (es: autenticazione Telegram, output JSON, generazione Compose sicuro)? Posso aiutarti a modularizzare tutto il sistema.","children":[],"payload":{"tag":"h3","lines":"2381,2382"}},{"content":"&#x2705; <strong>Vantaggi principali</strong>","children":[{"content":"<table data-lines=\"2386,2392\">\n<thead data-lines=\"2386,2387\">\n<tr data-lines=\"2386,2387\">\n<th><strong>Vantaggio</strong></th>\n<th><strong>Spiegazione</strong></th>\n</tr>\n</thead>\n<tbody data-lines=\"2388,2392\">\n<tr data-lines=\"2388,2389\">\n<td>&#x1f501; <strong>Automazione ripetibile</strong></td>\n<td>Puoi ri-deployare tutti i tuoi container su pi&#xf9; VPS/server con un solo comando</td>\n</tr>\n<tr data-lines=\"2389,2390\">\n<td>&#x1f9f1; <strong>Infrastructure-as-Code</strong></td>\n<td>Tracciabile in Git, modificabile, versionabile</td>\n</tr>\n<tr data-lines=\"2390,2391\">\n<td>&#x1f6e1;&#xfe0f; <strong>Pi&#xf9; sicuro e centralizzato</strong></td>\n<td>Gestisci <code>.env</code>, permessi, reti, volumi, backup... tutto in modo coerente</td>\n</tr>\n<tr data-lines=\"2391,2392\">\n<td>&#x1f916; <strong>Estendibile</strong></td>\n<td>Puoi aggiungere alert (es. email, Telegram), monitoraggio, backup, ecc.</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2386,2392"}}],"payload":{"tag":"h3","lines":"2385,2386"}},{"content":"&#x1f4e6; Cosa fa Ansible in questo contesto?","children":[{"content":"Installare Docker e Docker Compose (se mancano)","children":[],"payload":{"tag":"li","lines":"2394,2395"}},{"content":"Deployare container da <code>docker-compose.yml</code>","children":[],"payload":{"tag":"li","lines":"2395,2396"}},{"content":"Gestire <code>.env</code> e file di configurazione","children":[],"payload":{"tag":"li","lines":"2396,2397"}},{"content":"Creare reti e volumi","children":[],"payload":{"tag":"li","lines":"2397,2398"}},{"content":"Aggiungere controlli di sicurezza (porte, utenti, firewall)","children":[],"payload":{"tag":"li","lines":"2398,2399"}},{"content":"Monitorare lo stato (con <code>ansible-pull</code>, cron o CI/CD)","children":[],"payload":{"tag":"li","lines":"2399,2400"}},{"content":"Aggiornare facilmente stack da GitHub","children":[],"payload":{"tag":"li","lines":"2400,2401"}}],"payload":{"tag":"h3","lines":"2392,2393"}}],"payload":{"tag":"h2","lines":"2368,2369"}},{"content":"&#x1f4a1; E s&#xec;, si pu&#xf2; fare anche <strong>in modo semi-automatico</strong> &#x1f447;","children":[{"content":"&#x1f527; Come passare da Docker Compose ad Ansible","children":[{"content":"&#x1f9ed; 1. <strong>Manuale assistito</strong> (consigliato se vuoi imparare)","children":[{"content":"<pre data-lines=\"2406,2436\"><code class=\"language-yaml\"><span class=\"hljs-comment\"># playbooks/deploy-codium.yml</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Deploy</span> <span class=\"hljs-string\">openvscode-server</span>\n  <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">myservers</span>\n  <span class=\"hljs-attr\">become:</span> <span class=\"hljs-literal\">true</span>\n\n  <span class=\"hljs-attr\">vars_files:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">../env/codium.env.yml</span>\n\n  <span class=\"hljs-attr\">tasks:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Clona</span> <span class=\"hljs-string\">repo</span> <span class=\"hljs-string\">con</span> <span class=\"hljs-string\">docker-compose.yml</span>\n      <span class=\"hljs-attr\">git:</span>\n        <span class=\"hljs-attr\">repo:</span> <span class=\"hljs-string\">https://github.com/tuo/repo.git</span>\n        <span class=\"hljs-attr\">dest:</span> <span class=\"hljs-string\">/opt/openvscode</span>\n        <span class=\"hljs-attr\">update:</span> <span class=\"hljs-literal\">yes</span>\n\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Copia</span> <span class=\"hljs-string\">file</span> <span class=\"hljs-string\">.env</span> <span class=\"hljs-string\">personalizzato</span>\n      <span class=\"hljs-attr\">copy:</span>\n        <span class=\"hljs-attr\">src:</span> <span class=\"hljs-string\">../env/codium.env</span>\n        <span class=\"hljs-attr\">dest:</span> <span class=\"hljs-string\">/opt/openvscode/.env</span>\n        <span class=\"hljs-attr\">owner:</span> <span class=\"hljs-string\">root</span>\n        <span class=\"hljs-attr\">group:</span> <span class=\"hljs-string\">root</span>\n        <span class=\"hljs-attr\">mode:</span> <span class=\"hljs-string\">&apos;0600&apos;</span>\n\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Avvia</span> <span class=\"hljs-string\">lo</span> <span class=\"hljs-string\">stack</span> <span class=\"hljs-string\">con</span> <span class=\"hljs-string\">Docker</span> <span class=\"hljs-string\">Compose</span>\n      <span class=\"hljs-attr\">community.docker.docker_compose:</span>\n        <span class=\"hljs-attr\">project_src:</span> <span class=\"hljs-string\">/opt/openvscode</span>\n        <span class=\"hljs-attr\">build:</span> <span class=\"hljs-literal\">false</span>\n        <span class=\"hljs-attr\">state:</span> <span class=\"hljs-string\">present</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2406,2436"}}],"payload":{"tag":"h4","lines":"2404,2405"}},{"content":"&#x2699;&#xfe0f; 2. <strong>Uso di strumenti di conversione assistita</strong>","children":[{"content":"<a href=\"https://github.com/kubernetes/kompose\"><strong>kompose</strong></a>: converte <code>docker-compose.yml</code> in Kubernetes","children":[],"payload":{"tag":"li","lines":"2438,2439"}},{"content":"Script personalizzati in Python/bash","children":[],"payload":{"tag":"li","lines":"2439,2440"}},{"content":"Oppure <strong>io</strong>, che posso analizzare il tuo <code>docker-compose.yml</code> e generare automaticamente uno o pi&#xf9; playbook","children":[],"payload":{"tag":"li","lines":"2440,2441"}}],"payload":{"tag":"h4","lines":"2436,2437"}},{"content":"&#x1f680; 3. <strong>Tutto automatizzato via AI</strong>","children":[{"content":"Uno o pi&#xf9; <code>docker-compose.yml</code>","children":[],"payload":{"tag":"li","lines":"2443,2444"}},{"content":"Struttura dei tuoi server (IP, utenti, SSH, DNS, ecc.)","children":[],"payload":{"tag":"li","lines":"2444,2445"}},{"content":"Policy di sicurezza (porte aperte, autenticazione, ecc.)<br>\nE io ti restituisco un progetto completo:<br>\n&#x1f4c1; <code>ansible/</code><br>\n*-- <code>inventories/</code><br>\n*-- <code>playbooks/</code><br>\n*-- <code>roles/</code> (es: <code>openvscode</code>, <code>traefik</code>, <code>portainer</code>, ecc.)<br>\n*-- <code>group_vars/</code><br>\n*-- <code>env/</code><br>\n&#x2514;-- <code>README.md</code>","children":[],"payload":{"tag":"li","lines":"2445,2454"}}],"payload":{"tag":"h4","lines":"2441,2442"}}],"payload":{"tag":"h3","lines":"2402,2403"}},{"content":"&#x1f4e6; Vuoi un esempio pratico ora?","children":[{"content":"Il ruolo Ansible","children":[],"payload":{"tag":"li","lines":"2455,2456"}},{"content":"Il playbook che lo usa","children":[],"payload":{"tag":"li","lines":"2456,2457"}},{"content":"File <code>.env</code> e variabili Ansible","children":[],"payload":{"tag":"li","lines":"2457,2458"}},{"content":"Pronto per essere avviato con <code>ansible-playbook</code>","children":[],"payload":{"tag":"li","lines":"2458,2459"}}],"payload":{"tag":"h3","lines":"2454,2455"}},{"content":"&#x1f6e0;&#xfe0f; Strumenti e moduli Ansible utili","children":[{"content":"<table data-lines=\"2460,2468\">\n<thead data-lines=\"2460,2461\">\n<tr data-lines=\"2460,2461\">\n<th>Modulo</th>\n<th>Uso</th>\n</tr>\n</thead>\n<tbody data-lines=\"2462,2468\">\n<tr data-lines=\"2462,2463\">\n<td><code>community.docker.docker_compose</code></td>\n<td>Lancia stack Compose</td>\n</tr>\n<tr data-lines=\"2463,2464\">\n<td><code>ansible.builtin.copy</code> / <code>template</code></td>\n<td>Gestione file di configurazione</td>\n</tr>\n<tr data-lines=\"2464,2465\">\n<td><code>ansible.builtin.git</code></td>\n<td>Clona repo remote</td>\n</tr>\n<tr data-lines=\"2465,2466\">\n<td><code>ansible.builtin.user</code> / <code>group</code></td>\n<td>Crea utenti</td>\n</tr>\n<tr data-lines=\"2466,2467\">\n<td><code>ansible.builtin.ufw</code> / <code>firewalld</code></td>\n<td>Configura il firewall</td>\n</tr>\n<tr data-lines=\"2467,2468\">\n<td><code>ansible.builtin.systemd</code></td>\n<td>Gestione servizi</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2460,2468"}}],"payload":{"tag":"h3","lines":"2459,2460"}}],"payload":{"tag":"h2","lines":"2401,2402"}},{"content":"&#x1f9e0; Conclusione","children":[{"content":"Un <code>docker-compose.yml</code>","children":[],"payload":{"tag":"li","lines":"2474,2475"}},{"content":"Dove vuoi deployarlo (IP/server/localhost)","children":[],"payload":{"tag":"li","lines":"2475,2476"}},{"content":"Se vuoi gestione <code>.env</code>, Traefik, rete, ecc.<br>\nE ti restituisco il <strong>progetto Ansible completo pronto da usare</strong>.<br>\ncome fornire:<br>\nI docker-compose.yml<br>\nStruttura dei tuoi server (IP, utenti, SSH, DNS, ecc.)<br>\nPolicy di sicurezza (porte aperte, autenticazione, ecc.)<br>\nDI TUTTO IL VPS?<br>\nOttima domanda. Se vuoi <strong>generare automaticamente playbook Ansible</strong> ben fatti per gestire tutto il tuo VPS (e non solo i singoli <code>docker-compose.yml</code>), serve raccogliere alcune informazioni in modo <strong>strutturato</strong> e <strong>riutilizzabile</strong>.<br>\nQui sotto ti spiego <strong>come fornire tutto</strong>, <strong>in che formato</strong> e <strong>con che strumenti</strong>. Alla fine trovi anche un <strong>template compilabile</strong>, pronto da copiare/incollare.","children":[],"payload":{"tag":"li","lines":"2476,2485"}}],"payload":{"tag":"h2","lines":"2468,2469"}},{"content":"&#x1f9fe; <strong>Cosa serve fornire, esattamente</strong>","children":[{"content":"&#x2705; 1. <strong>I tuoi file <code>docker-compose.yml</code></strong>","children":[{"content":"<pre data-lines=\"2491,2503\"><code data-lines=\"2491,2503\">compose-<span class=\"hljs-built_in\">files</span>/\n*<span class=\"hljs-comment\">-- openvscode/</span>\n    *<span class=\"hljs-comment\">-- docker-compose.yml</span>\n    &#x2514;<span class=\"hljs-comment\">-- .env</span>\n*<span class=\"hljs-comment\">-- traefik/</span>\n    *<span class=\"hljs-comment\">-- docker-compose.yml</span>\n    &#x2514;<span class=\"hljs-comment\">-- traefik.yml</span>\n    &#x2514;<span class=\"hljs-comment\">-- dynamic_conf/</span>\n*<span class=\"hljs-comment\">-- portainer/</span>\n    &#x2514;<span class=\"hljs-comment\">-- docker-compose.yml</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2491,2503"}}],"payload":{"tag":"h3","lines":"2486,2487"}},{"content":"&#x2705; 2. <strong>Struttura dei server (inventario Ansible)</strong>","children":[{"content":"<pre data-lines=\"2506,2523\"><code class=\"language-yaml\"><span class=\"hljs-attr\">all:</span>\n  <span class=\"hljs-attr\">hosts:</span>\n    <span class=\"hljs-attr\">vps1:</span>\n      <span class=\"hljs-attr\">ansible_host:</span> <span class=\"hljs-number\">123.456</span><span class=\"hljs-number\">.789</span><span class=\"hljs-number\">.101</span>\n      <span class=\"hljs-attr\">ansible_user:</span> <span class=\"hljs-string\">root</span>\n      <span class=\"hljs-attr\">ansible_port:</span> <span class=\"hljs-number\">22</span>\n      <span class=\"hljs-attr\">dns_name:</span> <span class=\"hljs-string\">codium.miodominio.it</span>\n      <span class=\"hljs-attr\">roles:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">traefik</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">openvscode</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">portainer</span>\n  <span class=\"hljs-attr\">children:</span>\n    <span class=\"hljs-attr\">docker_hosts:</span>\n      <span class=\"hljs-attr\">hosts:</span>\n        <span class=\"hljs-attr\">vps1:</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2506,2523"}},{"content":"<pre data-lines=\"2524,2529\"><code class=\"language-markdown\">| Nome   | IP             | Utente SSH | Porta | DNS                    | Ruoli                     |\n|--------|----------------|------------|-------|------------------------|----------------------------|\n| vps1   | 123.456.789.101| root       | 22    | codium.miodominio.it   | traefik, openvscode, portainer |\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2524,2529"}}],"payload":{"tag":"h3","lines":"2504,2505"}},{"content":"&#x2705; 3. <strong>Policy di sicurezza e configurazioni da applicare</strong>","children":[{"content":"&#x1f510; Esempio in YAML:","children":[{"content":"<pre data-lines=\"2532,2554\"><code class=\"language-yaml\"><span class=\"hljs-attr\">firewall:</span>\n  <span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">allow_ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-number\">22</span>        <span class=\"hljs-comment\"># SSH</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-number\">80</span>        <span class=\"hljs-comment\"># HTTP</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-number\">443</span>       <span class=\"hljs-comment\"># HTTPS</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-number\">9000</span>      <span class=\"hljs-comment\"># Portainer</span>\n  <span class=\"hljs-attr\">deny_all_other:</span> <span class=\"hljs-literal\">true</span>\n\n<span class=\"hljs-attr\">users:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">admin</span>\n    <span class=\"hljs-attr\">ssh_key:</span> <span class=\"hljs-string\">&quot;ssh-rsa AAAAB3...&quot;</span>\n    <span class=\"hljs-attr\">sudo:</span> <span class=\"hljs-literal\">true</span>\n\n<span class=\"hljs-attr\">traefik:</span>\n  <span class=\"hljs-attr\">domain:</span> <span class=\"hljs-string\">codium.miodominio.it</span>\n  <span class=\"hljs-attr\">certresolver:</span> <span class=\"hljs-string\">mytlschallenge</span>\n  <span class=\"hljs-attr\">middlewares:</span>\n    <span class=\"hljs-attr\">auth:</span> <span class=\"hljs-string\">basic</span>\n    <span class=\"hljs-attr\">headers:</span> <span class=\"hljs-string\">strict</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2532,2554"}}],"payload":{"tag":"h4","lines":"2531,2532"}},{"content":"&#x1f9fe; Oppure in linguaggio naturale ben formattato:","children":[],"payload":{"tag":"h4","lines":"2554,2555"}}],"payload":{"tag":"h3","lines":"2529,2530"}}],"payload":{"tag":"h2","lines":"2485,2486"}},{"content":"&#x1f9f0; <strong>Strumenti consigliati per preparare queste informazioni</strong>","children":[{"content":"<table data-lines=\"2556,2564\">\n<thead data-lines=\"2556,2557\">\n<tr data-lines=\"2556,2557\">\n<th>Scopo</th>\n<th>Strumento</th>\n<th>Comando utile</th>\n</tr>\n</thead>\n<tbody data-lines=\"2558,2564\">\n<tr data-lines=\"2558,2559\">\n<td>Esportare <code>docker-compose</code></td>\n<td><code>scp</code> o <code>rsync</code></td>\n<td><code>scp -r user@host:/path/to/docker .</code></td>\n</tr>\n<tr data-lines=\"2559,2560\">\n<td>Verificare IP/server</td>\n<td><code>hostname</code>, <code>ip a</code></td>\n<td></td>\n</tr>\n<tr data-lines=\"2560,2561\">\n<td>Elenco porte aperte</td>\n<td><code>ss -tulnp</code>, <code>ufw status</code></td>\n<td></td>\n</tr>\n<tr data-lines=\"2561,2562\">\n<td>Esportare utenti</td>\n<td><code>cat /etc/passwd</code> + <code>getent group</code></td>\n<td></td>\n</tr>\n<tr data-lines=\"2562,2563\">\n<td>Esportare chiavi SSH</td>\n<td><code>cat ~/.ssh/authorized_keys</code></td>\n<td></td>\n</tr>\n<tr data-lines=\"2563,2564\">\n<td>Elenco immagini/volumi</td>\n<td><code>docker ps -a</code>, <code>docker volume ls</code></td>\n<td></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2556,2564"}}],"payload":{"tag":"h2","lines":"2555,2556"}},{"content":"&#x1f9e9; TEMPLATE COMPILABILE (pronto all&#x2019;uso)","children":[{"content":"<pre data-lines=\"2565,2600\"><code class=\"language-yaml\"><span class=\"hljs-comment\"># &#x1f4e6; VPS Info</span>\n<span class=\"hljs-attr\">hostname:</span> <span class=\"hljs-string\">vps1</span>\n<span class=\"hljs-attr\">ip:</span> <span class=\"hljs-number\">192.0</span><span class=\"hljs-number\">.2</span><span class=\"hljs-number\">.1</span>\n<span class=\"hljs-attr\">ssh_user:</span> <span class=\"hljs-string\">root</span>\n<span class=\"hljs-attr\">ssh_port:</span> <span class=\"hljs-number\">22</span>\n<span class=\"hljs-attr\">dns_name:</span> <span class=\"hljs-string\">codium.example.com</span>\n\n<span class=\"hljs-comment\"># &#x1f510; Sicurezza</span>\n<span class=\"hljs-attr\">firewall:</span>\n  <span class=\"hljs-attr\">allow_ports:</span> [<span class=\"hljs-number\">22</span>, <span class=\"hljs-number\">80</span>, <span class=\"hljs-number\">443</span>, <span class=\"hljs-number\">9000</span>]\n  <span class=\"hljs-attr\">deny_all_other:</span> <span class=\"hljs-literal\">true</span>\n\n<span class=\"hljs-attr\">users:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">admin</span>\n    <span class=\"hljs-attr\">sudo:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-attr\">ssh_key:</span> <span class=\"hljs-string\">|\n      ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC...\n</span>\n<span class=\"hljs-comment\"># &#x1f680; Servizi da deployare</span>\n<span class=\"hljs-attr\">compose_services:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">openvscode</span>\n    <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">./compose-files/openvscode/docker-compose.yml</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">traefik</span>\n    <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">./compose-files/traefik/docker-compose.yml</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">portainer</span>\n    <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">./compose-files/portainer/docker-compose.yml</span>\n\n<span class=\"hljs-comment\"># &#x1f310; Traefik config</span>\n<span class=\"hljs-attr\">traefik:</span>\n  <span class=\"hljs-attr\">enable_https:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">cert_resolver:</span> <span class=\"hljs-string\">mytlschallenge</span>\n  <span class=\"hljs-attr\">auth_middleware:</span> <span class=\"hljs-string\">logseq-auth@file</span>\n  <span class=\"hljs-attr\">headers_middleware:</span> <span class=\"hljs-string\">logseq-headers@docker</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2565,2600"}}],"payload":{"tag":"h2","lines":"2564,2565"}},{"content":"&#x1f680; Una volta che hai tutto questo...","children":[{"content":"&#x1f4a5; Posso generarti:","children":[{"content":"Un progetto <strong>Ansible completo</strong>","children":[],"payload":{"tag":"li","lines":"2602,2603"}},{"content":"Con:","children":[{"content":"<code>roles/</code> per ogni servizio (traefik, vscode, ecc.)","children":[],"payload":{"tag":"li","lines":"2604,2605"}},{"content":"<code>playbooks/</code> modulari (es: <code>setup.yml</code>, <code>deploy.yml</code>, <code>hardening.yml</code>)","children":[],"payload":{"tag":"li","lines":"2605,2606"}},{"content":"<code>group_vars/</code> con le variabili che hai fornito","children":[],"payload":{"tag":"li","lines":"2606,2607"}},{"content":"<code>inventory.yml</code>","children":[],"payload":{"tag":"li","lines":"2607,2608"}},{"content":"<code>README.md</code> per la documentazione","children":[],"payload":{"tag":"li","lines":"2608,2609"}}],"payload":{"tag":"li","lines":"2603,2609"}}],"payload":{"tag":"h3","lines":"2601,2602"}},{"content":"&#x1f4ac; Vuoi partire?","children":[{"content":"I tuoi <code>docker-compose.yml</code>","children":[],"payload":{"tag":"li","lines":"2612,2613"}},{"content":"La descrizione strutturata del VPS (puoi usare i template sopra)<br>\nE ti genero un <strong>progetto Ansible completo, pronto da pushare su Git</strong> &#x2705;<br>\nPosso farlo anche a step se preferisci imparare mentre lo costruisci.<br>\naspetta... possibile che non esista un software per estrarre le mie configurazioni e le trasformarle in un playbook?<br>\nS&#xec;, la tua domanda &#xe8; perfettamente legittima e, sorprendentemente, <strong>non esiste (ancora) uno strumento mainstream che faccia tutto questo in modo automatico, completo e affidabile.</strong>","children":[],"payload":{"tag":"li","lines":"2613,2618"}}],"payload":{"tag":"h3","lines":"2609,2610"}}],"payload":{"tag":"h2","lines":"2600,2601"}},{"content":"&#x1f3af; TL;DR","children":[{"content":"Generare playbook da template","children":[],"payload":{"tag":"li","lines":"2621,2622"}},{"content":"Automatizzare l&#x2019;installazione di servizi","children":[],"payload":{"tag":"li","lines":"2622,2623"}},{"content":"Convertire <code>docker-compose</code> in altro formato","children":[],"payload":{"tag":"li","lines":"2623,2624"}},{"content":"Fare audit o discovery di sistema","children":[],"payload":{"tag":"li","lines":"2624,2625"}}],"payload":{"tag":"h2","lines":"2618,2619"}},{"content":"&#x1f916; Strumenti che ci si avvicinano (parzialmente)","children":[{"content":"<table data-lines=\"2626,2635\">\n<thead data-lines=\"2626,2627\">\n<tr data-lines=\"2626,2627\">\n<th>Strumento</th>\n<th>Cosa fa</th>\n<th>Limitazioni</th>\n</tr>\n</thead>\n<tbody data-lines=\"2628,2635\">\n<tr data-lines=\"2628,2629\">\n<td><strong>DebOps</strong></td>\n<td>Collezione modulare di ruoli Ansible preconfigurati per server Debian</td>\n<td>Complesso, poco intuitivo</td>\n</tr>\n<tr data-lines=\"2629,2630\">\n<td><strong>Ansible Molecule</strong></td>\n<td>Testing framework per ruoli Ansible</td>\n<td>Non genera i playbook</td>\n</tr>\n<tr data-lines=\"2630,2631\">\n<td><strong>Ansible Navigator</strong></td>\n<td>UI per eseguire playbook, non generarli</td>\n<td>Nessuna scoperta automatica</td>\n</tr>\n<tr data-lines=\"2631,2632\">\n<td><strong>Ansible Generator Tools</strong> (<code>cookiecutter</code>, <code>ansible-init</code>, ecc.)</td>\n<td>Generano strutture base di ruoli e playbook</td>\n<td>Non leggono la tua configurazione esistente</td>\n</tr>\n<tr data-lines=\"2632,2633\">\n<td><strong>kompose</strong></td>\n<td>Converte <code>docker-compose</code> in Kubernetes YAML</td>\n<td>Solo K8s, non Ansible</td>\n</tr>\n<tr data-lines=\"2633,2634\">\n<td><strong>Docker Discovery Tools</strong> (<code>docker inspect</code>, <code>ctop</code>, <code>docker-scan</code>)</td>\n<td>Raccolgono info, ma non generano codice</td>\n<td>Nessuna integrazione con Ansible</td>\n</tr>\n<tr data-lines=\"2634,2635\">\n<td><strong>AI (come me)</strong> &#x1f60e;</td>\n<td>Posso analizzare file e generare playbook personalizzati</td>\n<td>Serve input strutturato</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2626,2635"}}],"payload":{"tag":"h2","lines":"2625,2626"}},{"content":"&#x1f6e0;&#xfe0f; Cosa servirebbe davvero? (che ancora <strong>non esiste</strong>)","children":[{"content":"<pre data-lines=\"2637,2640\"><code class=\"language-bash\">discover-vps --output ansible-project/\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2637,2640"}}],"payload":{"tag":"h2","lines":"2635,2636"}},{"content":"&#x1f9e0; Cosa puoi fare oggi?","children":[{"content":"&#x2705; 1. Usare una <strong>struttura standard di progetto Ansible</strong>","children":[],"payload":{"tag":"h3","lines":"2656,2657"}},{"content":"&#x2705; 2. Usare <code>docker inspect</code>, <code>ufw</code>, <code>systemctl</code>, <code>lsblk</code>, ecc.","children":[],"payload":{"tag":"h3","lines":"2658,2659"}},{"content":"&#x2705; 3. Script semiautomatici","children":[{"content":"<pre data-lines=\"2663,2672\"><code class=\"language-bash\"><span class=\"hljs-comment\"># dump-config.sh</span>\n<span class=\"hljs-built_in\">mkdir</span> -p config_dump\ndocker inspect &#x24;(docker ps -q) &gt; config_dump/docker_inspect.json\n<span class=\"hljs-built_in\">cp</span> /etc/hostname config_dump/\n<span class=\"hljs-built_in\">cp</span> /etc/resolv.conf config_dump/\nufw status &gt; config_dump/ufw.txt\ngetent passwd &gt; config_dump/passwd.txt\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2663,2672"}}],"payload":{"tag":"h3","lines":"2660,2661"}}],"payload":{"tag":"h2","lines":"2655,2656"}},{"content":"&#x1f6a7; Conclusione","children":[{"content":"<strong>&#xc8; tecnicamente fattibile</strong>","children":[],"payload":{"tag":"li","lines":"2676,2677"}},{"content":"Si pu&#xf2; fare <strong>con AI e script semiautomatici</strong>","children":[],"payload":{"tag":"li","lines":"2677,2678"}},{"content":"Puoi costruirti un flusso <strong>personalizzato</strong>, oggi stesso (posso aiutarti passo-passo)","children":[],"payload":{"tag":"li","lines":"2678,2679"}}],"payload":{"tag":"h2","lines":"2673,2674"}},{"content":"&#x2705; Vuoi che ti costruisca un prototipo?","children":[{"content":"","children":[{"content":"Uno script (<code>discover.sh</code>)","children":[],"payload":{"tag":"li","lines":"2680,2681"}},{"content":"Un convertitore AI che analizza la struttura di <code>docker-compose</code> e <code>docker inspect</code>","children":[],"payload":{"tag":"li","lines":"2681,2682"}},{"content":"Un progetto base Ansible generato automaticamente<br>\nTu devi solo:","children":[],"payload":{"tag":"li","lines":"2682,2684"}}],"payload":{"tag":"ul","lines":"2680,2684"}},{"content":"","children":[{"content":"1. Eseguire lo script sul VPS","children":[],"payload":{"tag":"li","lines":"2684,2685","listIndex":1}},{"content":"2. Mandarmi gli output (o usarli localmente)","children":[],"payload":{"tag":"li","lines":"2685,2686","listIndex":2}},{"content":"3. Io (o tu con me) generiamo un progetto pronto al deploy<br>\npossiamo scriverlo noi usando le api di gemini, no?<br>\nS&#xec;, assolutamente: <strong>possiamo scriverlo noi</strong>, e usare <strong>Gemini (o GPT)</strong> come <em>motore AI</em> per analizzare, trasformare e generare i playbook Ansible &#x2014; a partire dai dati raccolti dal tuo VPS o dai tuoi progetti <code>docker-compose</code>.<br>\nQuesta &#xe8; un&#x2019;idea <strong>fattibile, potente e scalabile</strong>.","children":[],"payload":{"tag":"li","lines":"2686,2690","listIndex":3}}],"payload":{"tag":"ol","lines":"2684,2690"}}],"payload":{"tag":"h2","lines":"2679,2680"}},{"content":"&#x1f9e0; In breve: cosa andremmo a costruire?","children":[],"payload":{"tag":"h2","lines":"2690,2691"}},{"content":"&#x1f527; Tecnologie da usare","children":[{"content":"<table data-lines=\"2694,2702\">\n<thead data-lines=\"2694,2695\">\n<tr data-lines=\"2694,2695\">\n<th>Componente</th>\n<th>Tool consigliato</th>\n</tr>\n</thead>\n<tbody data-lines=\"2696,2702\">\n<tr data-lines=\"2696,2697\">\n<td>&#x1f41a; Discovery VPS</td>\n<td>Bash, Python</td>\n</tr>\n<tr data-lines=\"2697,2698\">\n<td>&#x1f916; AI Backend</td>\n<td>API Gemini (Google) o OpenAI</td>\n</tr>\n<tr data-lines=\"2698,2699\">\n<td>&#x1f9e0; Prompt design</td>\n<td>Prompt modulari e specializzati</td>\n</tr>\n<tr data-lines=\"2699,2700\">\n<td>&#x1f4e6; Output</td>\n<td>Filesystem (YAML, Markdown, ecc.)</td>\n</tr>\n<tr data-lines=\"2700,2701\">\n<td>&#x1f9ea; Validazione</td>\n<td>Ansible Lint, Molecule (opzionale)</td>\n</tr>\n<tr data-lines=\"2701,2702\">\n<td>&#x1f310; UI (opzionale)</td>\n<td>Web UI con Flask / Streamlit</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2694,2702"}}],"payload":{"tag":"h2","lines":"2693,2694"}},{"content":"&#x1f4c1; Struttura del progetto","children":[{"content":"<pre data-lines=\"2703,2723\"><code data-lines=\"2703,2723\">autoplaybook-ai/\n*<span class=\"hljs-comment\">-- cli/                            # CLI tool per discovery</span>\n    &#x2514;<span class=\"hljs-comment\">-- discover.sh                 # Shell script per raccolta dati</span>\n    &#x2514;<span class=\"hljs-comment\">-- gather.py                   # Parser in Python</span>\n*<span class=\"hljs-comment\">-- prompts/                        # Prompt per AI</span>\n    &#x2514;<span class=\"hljs-comment\">-- generate_roles.txt</span>\n    &#x2514;<span class=\"hljs-comment\">-- generate_inventory.txt</span>\n*<span class=\"hljs-comment\">-- ai/</span>\n    &#x2514;<span class=\"hljs-comment\">-- call_gemini.py              # Wrapper per le API Gemini</span>\n*<span class=\"hljs-comment\">-- output/</span>\n    &#x2514;<span class=\"hljs-comment\">-- [generated_ansible_project]/</span>\n*<span class=\"hljs-comment\">-- config/</span>\n    &#x2514;<span class=\"hljs-comment\">-- settings.yaml</span>\n*<span class=\"hljs-comment\">-- examples/</span>\n    &#x2514;<span class=\"hljs-comment\">-- sample_inventory.yml</span>\n*<span class=\"hljs-comment\">-- README.md</span>\n*<span class=\"hljs-comment\">-- main.py                         # Entrypoint: orchestri tutto</span>\n&#x2514;<span class=\"hljs-comment\">-- requirements.txt</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2703,2723"}}],"payload":{"tag":"h2","lines":"2702,2703"}},{"content":"&#x1f3af; Esempio di funzionamento","children":[{"content":"1. Esegui la CLI:","children":[{"content":"<pre data-lines=\"2725,2728\"><code class=\"language-bash\">python main.py --discover --host 192.168.1.100 --user root\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2725,2728"}}],"payload":{"tag":"h3","lines":"2724,2725"}},{"content":"2. Lo script:","children":[{"content":"Raccoglie <code>docker-compose</code>, <code>ufw</code>, <code>ps</code>, <code>docker inspect</code>, ecc.","children":[],"payload":{"tag":"li","lines":"2729,2730"}},{"content":"Crea file strutturati <code>.json</code> e <code>.yml</code>","children":[],"payload":{"tag":"li","lines":"2730,2731"}},{"content":"Prepara prompt dinamici per AI","children":[],"payload":{"tag":"li","lines":"2731,2732"}},{"content":"Invia il contenuto via API a Gemini","children":[],"payload":{"tag":"li","lines":"2732,2733"}}],"payload":{"tag":"h3","lines":"2728,2729"}},{"content":"3. Gemini restituisce:","children":[{"content":"<code>roles/</code>","children":[],"payload":{"tag":"li","lines":"2734,2735"}},{"content":"<code>playbook.yml</code>","children":[],"payload":{"tag":"li","lines":"2735,2736"}},{"content":"<code>inventory.yml</code>","children":[],"payload":{"tag":"li","lines":"2736,2737"}},{"content":"<code>.env.example</code>","children":[],"payload":{"tag":"li","lines":"2737,2738"}},{"content":"<code>README.md</code>","children":[],"payload":{"tag":"li","lines":"2738,2739"}}],"payload":{"tag":"h3","lines":"2733,2734"}},{"content":"4. Il tool salva tutto in <code>/output/&lt;project&gt;/</code>","children":[],"payload":{"tag":"h3","lines":"2739,2740"}}],"payload":{"tag":"h2","lines":"2723,2724"}},{"content":"&#x1f4a1; API Gemini: come si userebbe?","children":[{"content":"<pre data-lines=\"2742,2755\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> google.generativeai <span class=\"hljs-keyword\">import</span> GenerativeModel\n\nmodel = GenerativeModel(<span class=\"hljs-string\">&apos;gemini-pro&apos;</span>)\nresponse = model.generate_content(\n    prompt_text,\n    generation_config={\n        <span class=\"hljs-string\">&apos;temperature&apos;</span>: <span class=\"hljs-number\">0.4</span>,\n        <span class=\"hljs-string\">&apos;max_output_tokens&apos;</span>: <span class=\"hljs-number\">4096</span>\n    }\n)\noutput = response.text\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2742,2755"}}],"payload":{"tag":"h2","lines":"2740,2741"}},{"content":"&#x2705; Vantaggi di usare Gemini (o GPT)","children":[{"content":"Riconosce formati YAML, JSON, docker-compose","children":[],"payload":{"tag":"li","lines":"2757,2758"}},{"content":"Sa gi&#xe0; generare codice Ansible valido","children":[],"payload":{"tag":"li","lines":"2758,2759"}},{"content":"Pu&#xf2; adattarsi a <em>diverse strutture</em>","children":[],"payload":{"tag":"li","lines":"2759,2760"}},{"content":"Pu&#xf2; migliorare progressivamente (con prompt ben fatti)","children":[],"payload":{"tag":"li","lines":"2760,2761"}}],"payload":{"tag":"h2","lines":"2756,2757"}},{"content":"&#x1f9ea; Vuoi iniziare?","children":[{"content":"&#x2699;&#xfe0f; Requisiti minimi per iniziare:","children":[{"content":"API key Gemini (o OpenAI)","children":[],"payload":{"tag":"li","lines":"2767,2768"}},{"content":"Accesso SSH al VPS","children":[],"payload":{"tag":"li","lines":"2768,2769"}},{"content":"Python 3.10+","children":[],"payload":{"tag":"li","lines":"2769,2770"}}],"payload":{"tag":"h3","lines":"2766,2767"}}],"payload":{"tag":"h2","lines":"2761,2762"}},{"content":"&#x1f680; Conclusione","children":[{"content":"","children":[{"content":"&#x1f463; Un MVP base","children":[],"payload":{"tag":"li","lines":"2772,2773"}},{"content":"&#x1f52c; Un prototipo pi&#xf9; completo","children":[],"payload":{"tag":"li","lines":"2773,2774"}},{"content":"&#x1f393; Oppure vuoi imparare a costruirlo con me step by step<br>\nPronto quando vuoi &#x1f4bb;<br>\nUn prototipo pi&#xf9; completo che usa la apikey di gemini","children":[],"payload":{"tag":"li","lines":"2774,2777"}}],"payload":{"tag":"ul","lines":"2772,2777"}},{"content":"","children":[{"content":"1. Una descrizione chiara e dettagliata nel file <code>README.md</code>, comprensiva di:","children":[{"content":"Obiettivi del progetto","children":[],"payload":{"tag":"li","lines":"2778,2779"}},{"content":"Contesto e finalit&#xe0;","children":[],"payload":{"tag":"li","lines":"2779,2780"}},{"content":"Istruzioni per l&#x2019;installazione, l&#x2019;uso e l&#x2019;eventuale distribuzione","children":[],"payload":{"tag":"li","lines":"2780,2781"}},{"content":"Tecnologie utilizzate","children":[],"payload":{"tag":"li","lines":"2781,2782"}}],"payload":{"tag":"li","lines":"2777,2782","listIndex":1}},{"content":"2. La struttura completa delle cartelle e dei file del progetto, con un layout coerente e facilmente navigabile.","children":[],"payload":{"tag":"li","lines":"2782,2783","listIndex":2}},{"content":"3. Il codice sorgente completo e funzionante, incluso:","children":[{"content":"Tutti gli script o moduli principali","children":[],"payload":{"tag":"li","lines":"2784,2785"}},{"content":"Funzioni ben commentate e documentate","children":[],"payload":{"tag":"li","lines":"2785,2786"}},{"content":"Eventuali file di configurazione (<code>.env.example</code>, <code>config.json</code>, <code>settings.py</code>, ecc.)","children":[],"payload":{"tag":"li","lines":"2786,2787"}}],"payload":{"tag":"li","lines":"2783,2787","listIndex":3}},{"content":"4. Eventuali risorse accessorie:","children":[{"content":"Esempi d&#x2019;uso (<code>examples/</code>)","children":[],"payload":{"tag":"li","lines":"2788,2789"}},{"content":"Script di test o automazione (<code>tests/</code>, <code>scripts/</code>)","children":[],"payload":{"tag":"li","lines":"2789,2790"}},{"content":"Dipendenze elencate (<code>requirements.txt</code>, <code>package.json</code>, ecc.)","children":[],"payload":{"tag":"li","lines":"2790,2791"}}],"payload":{"tag":"li","lines":"2787,2791","listIndex":4}},{"content":"5. Un file <code>.gitignore</code> coerente con il progetto","children":[],"payload":{"tag":"li","lines":"2791,2792","listIndex":5}},{"content":"6. Licenza del progetto (<code>LICENSE</code>), preferibilmente una licenza open-source<br>\nL&#x2019;output deve essere completo, dettagliato e pronto per essere copiato/incollato come base per un vero repository su GitHub. Assicurati di non tralasciare nulla e di integrare tutte le informazioni discusse in chat in modo organico.","children":[],"payload":{"tag":"li","lines":"2792,2794","listIndex":6}}],"payload":{"tag":"ol","lines":"2777,2794"}}],"payload":{"tag":"h2","lines":"2770,2771"}}],"payload":{"tag":"h1","lines":"2044,2045"}},{"content":"&#x1f4c1; Struttura cartelle e file del progetto","children":[{"content":"<pre data-lines=\"2795,2824\"><code data-lines=\"2795,2824\">auto-ansible-playbook/\n*<span class=\"hljs-comment\">-- README.md</span>\n*<span class=\"hljs-comment\">-- LICENSE</span>\n*<span class=\"hljs-comment\">-- .gitignore</span>\n*<span class=\"hljs-comment\">-- requirements.txt</span>\n*<span class=\"hljs-comment\">-- .env.example</span>\n*<span class=\"hljs-comment\">-- config.json</span>\n*<span class=\"hljs-comment\">-- docker-compose.yml</span>\n*<span class=\"hljs-comment\">-- src/</span>\n    *<span class=\"hljs-comment\">-- __init__.py</span>\n    *<span class=\"hljs-comment\">-- discover.py             # Script per estrazione dati server e docker-compose</span>\n    *<span class=\"hljs-comment\">-- gemini_client.py       # Client API Gemini/OpenAI</span>\n    *<span class=\"hljs-comment\">-- ansible_generator.py   # Modulo generazione playbook Ansible da input JSON</span>\n    *<span class=\"hljs-comment\">-- notifier.py            # Modulo notifiche (Telegram, email)</span>\n    *<span class=\"hljs-comment\">-- utils.py               # Funzioni di utilit&#xe0; comuni</span>\n    &#x2514;<span class=\"hljs-comment\">-- main.py                # Orchestratore generale</span>\n*<span class=\"hljs-comment\">-- examples/</span>\n    *<span class=\"hljs-comment\">-- sample_docker_compose.yml</span>\n    *<span class=\"hljs-comment\">-- sample_config.json</span>\n    &#x2514;<span class=\"hljs-comment\">-- generated_playbook.yml</span>\n*<span class=\"hljs-comment\">-- tests/</span>\n    *<span class=\"hljs-comment\">-- test_discover.py</span>\n    *<span class=\"hljs-comment\">-- test_gemini_client.py</span>\n    *<span class=\"hljs-comment\">-- test_ansible_generator.py</span>\n    &#x2514;<span class=\"hljs-comment\">-- test_notifier.py</span>\n&#x2514;<span class=\"hljs-comment\">-- scripts/</span>\n    &#x2514;<span class=\"hljs-comment\">-- run_discovery.sh       # Script bash per lanciare discovery da VPS</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2795,2824"}}],"payload":{"tag":"h1","lines":"2794,2795"}},{"content":"&#x1f4c4; README.md","children":[{"content":"Uso","children":[{"content":"Scansione e generazione playbook","children":[{"content":"<pre data-lines=\"2894,2897\"><code class=\"language-bash\">python src/main.py --scan --generate\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2894,2897"}}],"payload":{"tag":"h3","lines":"2892,2893"}},{"content":"Parametri principali","children":[{"content":"<code>--scan</code>: avvia scansione automatica","children":[],"payload":{"tag":"li","lines":"2908,2909"}},{"content":"<code>--generate</code>: genera playbook da dati raccolti","children":[],"payload":{"tag":"li","lines":"2909,2910"}},{"content":"<code>--notify</code>: invia notifiche in caso di alert","children":[],"payload":{"tag":"li","lines":"2910,2912"}}],"payload":{"tag":"h3","lines":"2906,2907"}},{"content":"Esempio di output","children":[{"content":"<code>output/playbook.yml</code>: playbook Ansible generato","children":[],"payload":{"tag":"li","lines":"2914,2915"}},{"content":"<code>output/report.html</code>: report dettagliato","children":[],"payload":{"tag":"li","lines":"2915,2916"}},{"content":"<code>output/report.json</code>: dati strutturati per CI/CD","children":[],"payload":{"tag":"li","lines":"2916,2918"}}],"payload":{"tag":"h3","lines":"2912,2913"}}],"payload":{"tag":"h2","lines":"2890,2891"}},{"content":"Struttura file e cartelle","children":[{"content":"<code>src/</code>: codice sorgente Python modulare","children":[],"payload":{"tag":"li","lines":"2922,2923"}},{"content":"<code>examples/</code>: esempi di input/output","children":[],"payload":{"tag":"li","lines":"2923,2924"}},{"content":"<code>tests/</code>: test unitari e di integrazione","children":[],"payload":{"tag":"li","lines":"2924,2925"}},{"content":"<code>scripts/</code>: script bash di supporto","children":[],"payload":{"tag":"li","lines":"2925,2927"}}],"payload":{"tag":"h2","lines":"2920,2921"}},{"content":"Sviluppo e testing","children":[{"content":"\n<p data-lines=\"2931,2932\">Usa <code>pytest</code> per eseguire i test:</p>\n<pre data-lines=\"2933,2936\"><code class=\"language-bash\">pytest tests/\n</code></pre>","children":[],"payload":{"tag":"li","lines":"2931,2937"}},{"content":"\n<p data-lines=\"2937,2938\">Aggiungi nuove funzionalit&#xe0; modulari in <code>src/</code></p>","children":[],"payload":{"tag":"li","lines":"2937,2939"}}],"payload":{"tag":"h2","lines":"2929,2930"}},{"content":"Licenza","children":[],"payload":{"tag":"h2","lines":"2941,2942"}},{"content":"Contatti","children":[{"content":"<pre data-lines=\"2953,2975\"><code data-lines=\"2953,2975\"><span class=\"hljs-comment\"># &#x2699;&#xfe0f; .env.example</span>\n```dotenv\n<span class=\"hljs-comment\"># API key per Gemini / OpenAI</span>\n<span class=\"hljs-attribute\">GEMINI_API_KEY</span>=<span class=\"hljs-string\">&quot;tuo_api_key_gemini&quot;</span>\n\n<span class=\"hljs-comment\"># Telegram bot token per notifiche (opzionale)</span>\n<span class=\"hljs-attribute\">TELEGRAM_BOT_TOKEN</span>=<span class=\"hljs-string\">&quot;&quot;</span>\n\n<span class=\"hljs-comment\"># Telegram chat ID (opzionale)</span>\n<span class=\"hljs-attribute\">TELEGRAM_CHAT_ID</span>=<span class=\"hljs-string\">&quot;&quot;</span>\n\n<span class=\"hljs-comment\"># SMTP email (opzionale)</span>\n<span class=\"hljs-attribute\">SMTP_SERVER</span>=<span class=\"hljs-string\">&quot;&quot;</span>\n<span class=\"hljs-attribute\">SMTP_PORT</span>=587\n<span class=\"hljs-attribute\">SMTP_USER</span>=<span class=\"hljs-string\">&quot;&quot;</span>\n<span class=\"hljs-attribute\">SMTP_PASSWORD</span>=<span class=\"hljs-string\">&quot;&quot;</span>\n\n<span class=\"hljs-comment\"># VPS SSH Config</span>\n<span class=\"hljs-attribute\">SSH_USER</span>=<span class=\"hljs-string\">&quot;root&quot;</span>\n<span class=\"hljs-attribute\">SSH_PORT</span>=22\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2953,2975"}}],"payload":{"tag":"h2","lines":"2947,2948"}}],"payload":{"tag":"h1","lines":"2824,2825"}},{"content":"&#x1f4dc; requirements.txt","children":[{"content":"<pre data-lines=\"2976,2985\"><code data-lines=\"2976,2985\">requests\nparamiko\npyyaml\njinja2\nansible\npytest\n<span class=\"hljs-keyword\">python</span>-dotenv\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2976,2985"}}],"payload":{"tag":"h1","lines":"2975,2976"}},{"content":"&#x1f4dd; .gitignore","children":[{"content":"<pre data-lines=\"2986,2996\"><code data-lines=\"2986,2996\">__pycache__/\n*<span class=\"hljs-string\">.pyc</span>\n<span class=\"hljs-string\">.env</span>\noutput/\n<span class=\"hljs-string\">.venv/</span>\n<span class=\"hljs-string\">.vscode/</span>\n<span class=\"hljs-string\">.idea/</span>\n*<span class=\"hljs-string\">.log</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2986,2996"}}],"payload":{"tag":"h1","lines":"2985,2986"}},{"content":"&#x1f4dc; LICENSE (MIT)","children":[{"content":"<pre data-lines=\"2997,3010\"><code class=\"language-text\">MIT License\n\nCopyright (c) 2025 Tuo Nome\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the &quot;Software&quot;), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software...\n\n[il testo completo MIT License pu&#xf2; essere trovato qui: https://opensource.org/licenses/MIT]\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2997,3010"}}],"payload":{"tag":"h1","lines":"2996,2997"}},{"content":"&#x1f9e9; Codice sorgente completo","children":[{"content":"PLAYBOOK_TEMPLATE = &quot;&quot;&quot;","children":[{"content":"name: Playbook generato automaticamente<br>\nhosts: all<br>\nbecome: yes<br>\nvars:<br>\nansible_python_interpreter: /usr/bin/python3<br>\ntasks:<br>\n{% for service_name, service in docker_compose.services.items() %}","children":[{"content":"name: Assicura che il container {{ service_name }} sia presente<br>\ndocker_container:<br>\nname: {{ service_name }}<br>\nimage: {{ service.image }}<br>\nstate: started<br>\nrestart_policy: unless-stopped<br>\nvolumes:<br>\n{% for vol in service.volumes or [] %}","children":[{"content":"&quot;{{ vol }}&quot;<br>\n{% endfor %}<br>\nports:<br>\n{% for port in service.ports or [] %}","children":[],"payload":{"tag":"li","lines":"3166,3170"}},{"content":"&quot;{{ port }}&quot;<br>\n{% endfor %}<br>\n{% endfor %}","children":[],"payload":{"tag":"li","lines":"3170,3173"}}],"payload":{"tag":"li","lines":"3158,3173"}},{"content":"name: Configura utenti server<br>\nuser:<br>\nname: &quot;{{ item }}&quot;<br>\nstate: present<br>\nloop: &quot;{{ server_info.users }}&quot;","children":[],"payload":{"tag":"li","lines":"3173,3178"}},{"content":"name: Assicura che SSH sia configurato correttamente<br>\nlineinfile:<br>\npath: /etc/ssh/sshd_config<br>\nregexp: &apos;^PermitRootLogin&apos;<br>\nline: &apos;PermitRootLogin no&apos;<br>\nbackup: yes","children":[],"payload":{"tag":"li","lines":"3178,3184"}},{"content":"name: Riavvia sshd se necessario<br>\nservice:<br>\nname: sshd<br>\nstate: restarted<br>\nwhen: sshd_config_changed is defined and sshd_config_changed<br>\n&quot;&quot;&quot;<br>\ndef generate_playbook(data: Dict) -&gt; str:<br>\n&quot;&quot;&quot;<br>\nGenera playbook Ansible da dati raccolti<br>\n&quot;&quot;&quot;","children":[],"payload":{"tag":"li","lines":"3184,3194"}}],"payload":{"tag":"li","lines":"3151,3194"}}],"payload":{"tag":"h2","lines":"3150,3151"}}],"payload":{"tag":"h1","lines":"3010,3011"}},{"content":"Converte dict docker-compose in oggetto semplice","children":[{"content":"src/utils.py","children":[{"content":"<pre data-lines=\"3253,3271\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nutils.py\nFunzioni di utilit&#xe0; comuni al progetto\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">from</span> dotenv <span class=\"hljs-keyword\">import</span> load_dotenv\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">load_env</span>(<span class=\"hljs-params\">path: <span class=\"hljs-built_in\">str</span> = <span class=\"hljs-string\">&quot;.env&quot;</span></span>) -&gt; <span class=\"hljs-literal\">None</span>:\n    load_dotenv(dotenv_path=path)\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">save_json</span>(<span class=\"hljs-params\">path: <span class=\"hljs-built_in\">str</span>, data: <span class=\"hljs-built_in\">dict</span></span>) -&gt; <span class=\"hljs-literal\">None</span>:\n    <span class=\"hljs-keyword\">import</span> json\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(path, <span class=\"hljs-string\">&quot;w&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        json.dump(data, f, indent=<span class=\"hljs-number\">2</span>)\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">load_json</span>(<span class=\"hljs-params\">path: <span class=\"hljs-built_in\">str</span></span>) -&gt; <span class=\"hljs-built_in\">dict</span>:\n    <span class=\"hljs-keyword\">import</span> json\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(path, <span class=\"hljs-string\">&quot;r&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        <span class=\"hljs-keyword\">return</span> json.load(f)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3253,3271"}}],"payload":{"tag":"h3","lines":"3251,3252"}},{"content":"src/main.py","children":[{"content":"<pre data-lines=\"3276,3345\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nmain.py\nOrchestratore principale che esegue discovery, chiama Gemini API,\ngenera playbook Ansible, esporta report e invia notifiche.\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> argparse\n<span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">from</span> src <span class=\"hljs-keyword\">import</span> discover, gemini_client, ansible_generator, notifier, utils\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">main</span>():\n    parser = argparse.ArgumentParser(description=<span class=\"hljs-string\">&quot;Auto Ansible Playbook Generator&quot;</span>)\n    parser.add_argument(<span class=\"hljs-string\">&quot;--scan&quot;</span>, action=<span class=\"hljs-string\">&quot;store_true&quot;</span>, <span class=\"hljs-built_in\">help</span>=<span class=\"hljs-string\">&quot;Esegui scansione configurazioni&quot;</span>)\n    parser.add_argument(<span class=\"hljs-string\">&quot;--generate&quot;</span>, action=<span class=\"hljs-string\">&quot;store_true&quot;</span>, <span class=\"hljs-built_in\">help</span>=<span class=\"hljs-string\">&quot;Genera playbook da dati&quot;</span>)\n    parser.add_argument(<span class=\"hljs-string\">&quot;--notify&quot;</span>, action=<span class=\"hljs-string\">&quot;store_true&quot;</span>, <span class=\"hljs-built_in\">help</span>=<span class=\"hljs-string\">&quot;Invia notifiche&quot;</span>)\n    args = parser.parse_args()\n    utils.load_env()\n    output_dir = <span class=\"hljs-string\">&quot;output&quot;</span>\n    os.makedirs(output_dir, exist_ok=<span class=\"hljs-literal\">True</span>)\n    data_path = os.path.join(output_dir, <span class=\"hljs-string\">&quot;data.json&quot;</span>)\n    playbook_path = os.path.join(output_dir, <span class=\"hljs-string\">&quot;playbook.yml&quot;</span>)\n    <span class=\"hljs-keyword\">if</span> args.scan:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Avvio scansione configurazioni...&quot;</span>)\n        dc = discover.discover_docker_compose(<span class=\"hljs-string\">&quot;docker-compose.yml&quot;</span>)\n        server_info = discover.discover_server_info()\n        data = {\n            <span class=\"hljs-string\">&quot;docker_compose&quot;</span>: dc,\n            <span class=\"hljs-string\">&quot;server_info&quot;</span>: server_info\n        }\n        utils.save_json(data_path, data)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;Dati salvati in <span class=\"hljs-subst\">{data_path}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">if</span> args.generate:\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> os.path.exists(data_path):\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Errore: dati non trovati. Esegui prima --scan&quot;</span>)\n            <span class=\"hljs-keyword\">return</span>\n        data = utils.load_json(data_path)\n        api_key = os.getenv(<span class=\"hljs-string\">&quot;GEMINI_API_KEY&quot;</span>)\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> api_key:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Errore: GEMINI_API_KEY non impostata in .env&quot;</span>)\n            <span class=\"hljs-keyword\">return</span>\n        prompt = <span class=\"hljs-string\">f&quot;&quot;&quot;\n        Genera un playbook Ansible YAML sicuro e modulare a partire da questa configurazione Docker Compose e info server:\n        <span class=\"hljs-subst\">{json.dumps(data, indent=<span class=\"hljs-number\">2</span>)}</span>\n        &quot;&quot;&quot;</span>\n        client = gemini_client.GeminiClient(api_key)\n        response = client.call_api(prompt)\n        <span class=\"hljs-keyword\">if</span> response:\n            <span class=\"hljs-comment\"># Per semplicit&#xe0;: usiamo la generazione interna anche se API potrebbe generare playbook</span>\n            playbook = ansible_generator.generate_playbook(data)\n            <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(playbook_path, <span class=\"hljs-string\">&quot;w&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n                f.write(playbook)\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;Playbook generato e salvato in <span class=\"hljs-subst\">{playbook_path}</span>&quot;</span>)\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Errore nella generazione tramite API Gemini&quot;</span>)\n    <span class=\"hljs-keyword\">if</span> args.notify:\n        bot_token = os.getenv(<span class=\"hljs-string\">&quot;TELEGRAM_BOT_TOKEN&quot;</span>)\n        chat_id = os.getenv(<span class=\"hljs-string\">&quot;TELEGRAM_CHAT_ID&quot;</span>)\n        <span class=\"hljs-keyword\">if</span> bot_token <span class=\"hljs-keyword\">and</span> chat_id:\n            message = <span class=\"hljs-string\">&quot;Playbook Ansible generato con successo.&quot;</span>\n            sent = notifier.send_telegram_message(bot_token, chat_id, message)\n            <span class=\"hljs-keyword\">if</span> sent:\n                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Notifica Telegram inviata.&quot;</span>)\n            <span class=\"hljs-keyword\">else</span>:\n                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Errore invio notifica Telegram.&quot;</span>)\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Parametri Telegram non configurati. Notifica saltata.&quot;</span>)\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n    main()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3276,3345"}}],"payload":{"tag":"h3","lines":"3274,3275"}},{"content":"docker-compose.yml","children":[{"content":"<pre data-lines=\"3350,3364\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&quot;3.8&quot;</span>\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">auto-ansible:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">.</span>\n    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">auto-ansible</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./:/app</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">GEMINI_API_KEY=&#x24;{GEMINI_API_KEY}</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TELEGRAM_BOT_TOKEN=&#x24;{TELEGRAM_BOT_TOKEN}</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">TELEGRAM_CHAT_ID=&#x24;{TELEGRAM_CHAT_ID}</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">python</span> <span class=\"hljs-string\">src/main.py</span> <span class=\"hljs-string\">--scan</span> <span class=\"hljs-string\">--generate</span> <span class=\"hljs-string\">--notify</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3350,3364"}}],"payload":{"tag":"h3","lines":"3348,3349"}},{"content":"scripts/run_discovery.sh","children":[{"content":"<pre data-lines=\"3369,3376\"><code class=\"language-bash\"><span class=\"hljs-meta\">#!/bin/bash</span>\n<span class=\"hljs-comment\"># Script semplice per eseguire la discovery su VPS</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Esecuzione discovery...&quot;</span>\npython3 src/discover.py --compose docker-compose.yml &gt; output/discovery.json\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Discovery completata.&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3369,3376"}}],"payload":{"tag":"h3","lines":"3367,3368"}}],"payload":{"tag":"h1","lines":"3194,3195"}},{"content":"&#x1f9ea; Esempi","children":[{"content":"<code>examples/sample_docker_compose.yml</code>: esempio di docker-compose","children":[],"payload":{"tag":"li","lines":"3381,3382"}},{"content":"<code>examples/sample_config.json</code>: dati server simulati","children":[],"payload":{"tag":"li","lines":"3382,3383"}},{"content":"<code>examples/generated_playbook.yml</code>: playbook di esempio generato","children":[],"payload":{"tag":"li","lines":"3383,3385"}}],"payload":{"tag":"h1","lines":"3379,3380"}},{"content":"&#x1f4da; Testing","children":[{"content":"<pre data-lines=\"3391,3404\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> unittest\n<span class=\"hljs-keyword\">from</span> src <span class=\"hljs-keyword\">import</span> discover\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestDiscover</span>(unittest.TestCase):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">test_read_file</span>(<span class=\"hljs-params\">self</span>):\n        content = discover.read_file(<span class=\"hljs-string\">&quot;examples/sample_docker_compose.yml&quot;</span>)\n        <span class=\"hljs-variable language_\">self</span>.assertIsNotNone(content)\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">test_discover_docker_compose</span>(<span class=\"hljs-params\">self</span>):\n        dc = discover.discover_docker_compose(<span class=\"hljs-string\">&quot;examples/sample_docker_compose.yml&quot;</span>)\n        <span class=\"hljs-variable language_\">self</span>.assertIn(<span class=\"hljs-string\">&quot;services&quot;</span>, dc)\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n    unittest.main()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3391,3404"}}],"payload":{"tag":"h1","lines":"3387,3388"}}]},null)</script>
</body>
</html>
