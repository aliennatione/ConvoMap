<!doctype html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
html {
  font-family: ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji',
    'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
.markmap-dark {
  background: #27272a;
  color: white;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.12/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/index.js"></script><script>((r) => {
          setTimeout(r);
        })(() => {
  const { markmap, mm } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute("style", "position:absolute;bottom:20px;right:20px");
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
              if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                document.documentElement.classList.add("markmap-dark");
              }
            })(() => window.markmap,null,{"content":"","children":[{"content":"&#x1f680; Proposta Rivoluzionata: Workflow DSL <strong>Multidominio</strong>, Modularit&#xe0; Avanzata e Integrazione Nativa","children":[{"content":"1. Problemi chiave da risolvere nel modello base","children":[{"content":"YAML piatto limita la <strong>modularit&#xe0; e composizione</strong> dei workflow.","children":[],"payload":{"tag":"li","lines":"402,403"}},{"content":"Variabili globali singole possono causare <strong>collisioni e poca tracciabilit&#xe0;</strong>.","children":[],"payload":{"tag":"li","lines":"403,404"}},{"content":"<strong>Error handling</strong> e branching poco espressivi.","children":[],"payload":{"tag":"li","lines":"404,405"}},{"content":"Assenza di <strong>eventi e callback</strong> per integrazione realtime.","children":[],"payload":{"tag":"li","lines":"405,406"}},{"content":"Nessun supporto nativo a <strong>stati e monitoraggio</strong> (idempotenza runtime).","children":[],"payload":{"tag":"li","lines":"406,407"}},{"content":"Difficolt&#xe0; nell&#x2019;<strong>estendere tipi di task</strong> senza complicare il parsing.","children":[],"payload":{"tag":"li","lines":"407,408"}}],"payload":{"tag":"h2","lines":"401,402"}},{"content":"2. Linee guida di design rivoluzionario","children":[{"content":"Struttura <strong>nested e gerarchica</strong> ma leggibile (bilanciando flat e nested).","children":[],"payload":{"tag":"li","lines":"409,410"}},{"content":"Scope variabili per <strong>step, modulo, global</strong> con override controllato.","children":[],"payload":{"tag":"li","lines":"410,411"}},{"content":"Introduzione di <strong>flussi condizionali e branching dichiarativi</strong> (<code>if</code>, <code>switch</code>).","children":[],"payload":{"tag":"li","lines":"411,412"}},{"content":"Definizione di <strong>eventi e hook</strong> per callback custom (es. onSuccess, onError).","children":[],"payload":{"tag":"li","lines":"412,413"}},{"content":"Stato runtime con <strong>checkpoint e rollback</strong> per garantire idempotenza avanzata.","children":[],"payload":{"tag":"li","lines":"413,414"}},{"content":"Task tipizzati e modulari con plugin system per <strong>aggiungere moduli senza toccare core</strong>.","children":[],"payload":{"tag":"li","lines":"414,415"}},{"content":"Output dei task accessibili per decisioni e variabili dinamiche downstream.","children":[],"payload":{"tag":"li","lines":"415,416"}},{"content":"Supporto nativo per <strong>parallelismo dichiarativo</strong> (con limitazioni e fallback).","children":[],"payload":{"tag":"li","lines":"416,417"}}],"payload":{"tag":"h2","lines":"408,409"}},{"content":"3. Nuova sintassi YAML ottimizzata (con commenti)","children":[{"content":"<pre data-lines=\"418,488\"><code class=\"language-yaml\"><span class=\"hljs-attr\">workflow:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">&quot;Deploy completo app&quot;</span>\n  <span class=\"hljs-attr\">vars:</span>                           <span class=\"hljs-comment\"># Scope globale variabili</span>\n    <span class=\"hljs-attr\">env:</span> <span class=\"hljs-string\">production</span>\n    <span class=\"hljs-attr\">api_url:</span> <span class=\"hljs-string\">&quot;https://api.myapp.com&quot;</span>\n    <span class=\"hljs-attr\">api_token:</span> <span class=\"hljs-string\">&quot;secret-token&quot;</span>\n\n  <span class=\"hljs-attr\">stages:</span>                        <span class=\"hljs-comment\"># Modularit&#xe0; e struttura</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Provision</span> <span class=\"hljs-string\">infrastruttura</span>\n      <span class=\"hljs-attr\">vars:</span>                      <span class=\"hljs-comment\"># Override vars locali</span>\n        <span class=\"hljs-attr\">infra_type:</span> <span class=\"hljs-string\">&quot;bare-metal&quot;</span>\n\n      <span class=\"hljs-attr\">tasks:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">provision_servers</span>\n          <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ansible</span>\n          <span class=\"hljs-attr\">playbook:</span> <span class=\"hljs-string\">deploy_infra.yml</span>\n          <span class=\"hljs-attr\">extra_vars:</span>\n            <span class=\"hljs-attr\">environment:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ env }}</span>&quot;</span>\n            <span class=\"hljs-attr\">infra_type:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ infra_type }}</span>&quot;</span>\n          <span class=\"hljs-attr\">onSuccess:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">emit:</span> <span class=\"hljs-string\">infra_ready</span>\n\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Database</span> <span class=\"hljs-string\">e</span> <span class=\"hljs-string\">Backend</span>\n      <span class=\"hljs-attr\">tasks:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">migrate_db</span>\n          <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">http_request</span>\n          <span class=\"hljs-attr\">method:</span> <span class=\"hljs-string\">POST</span>\n          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ api_url }}</span>/db/migrate&quot;</span>\n          <span class=\"hljs-attr\">headers:</span>\n            <span class=\"hljs-attr\">Authorization:</span> <span class=\"hljs-string\">&quot;Bearer <span class=\"hljs-template-variable\">{{ api_token }}</span>&quot;</span>\n          <span class=\"hljs-attr\">output:</span> <span class=\"hljs-string\">migration_result</span>     <span class=\"hljs-comment\"># Salva output per riferimento</span>\n          <span class=\"hljs-attr\">retries:</span> <span class=\"hljs-number\">3</span>\n          <span class=\"hljs-attr\">retry_delay:</span> <span class=\"hljs-number\">5</span>\n          <span class=\"hljs-attr\">onError:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">rollback:</span> <span class=\"hljs-string\">provision_servers</span>\n\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">notify_users</span>\n          <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">http_request</span>\n          <span class=\"hljs-attr\">method:</span> <span class=\"hljs-string\">POST</span>\n          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ api_url }}</span>/notify&quot;</span>\n          <span class=\"hljs-attr\">headers:</span>\n            <span class=\"hljs-attr\">Authorization:</span> <span class=\"hljs-string\">&quot;Bearer <span class=\"hljs-template-variable\">{{ api_token }}</span>&quot;</span>\n          <span class=\"hljs-attr\">body:</span>\n            <span class=\"hljs-attr\">message:</span> <span class=\"hljs-string\">&quot;Deploy completato con successo&quot;</span>\n\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Frontend</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">&amp;</span> <span class=\"hljs-string\">Deploy</span>\n      <span class=\"hljs-attr\">parallel:</span> <span class=\"hljs-literal\">true</span>               <span class=\"hljs-comment\"># Parallelismo dichiarativo</span>\n      <span class=\"hljs-attr\">tasks:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">build_frontend</span>\n          <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">shell</span>\n          <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">&quot;npm run build&quot;</span>\n          <span class=\"hljs-attr\">cwd:</span> <span class=\"hljs-string\">&quot;./frontend&quot;</span>\n          <span class=\"hljs-attr\">onSuccess:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">emit:</span> <span class=\"hljs-string\">frontend_built</span>\n\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">deploy_frontend</span>\n          <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">shell</span>\n          <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">&quot;./deploy_frontend.sh&quot;</span>\n          <span class=\"hljs-attr\">when:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ frontend_built == true }}</span>&quot;</span>    <span class=\"hljs-comment\"># Branching semplice</span>\n\n  <span class=\"hljs-attr\">events:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra_ready</span>\n      <span class=\"hljs-attr\">actions:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">log:</span> <span class=\"hljs-string\">&quot;Infrastruttura pronta, procedo con DB&quot;</span>\n\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">frontend_built</span>\n      <span class=\"hljs-attr\">actions:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">log:</span> <span class=\"hljs-string\">&quot;Frontend compilato, pronto al deploy&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"418,488"}}],"payload":{"tag":"h2","lines":"417,418"}},{"content":"4. Spiegazione delle innovazioni","children":[{"content":"<table data-lines=\"489,498\">\n<thead data-lines=\"489,490\">\n<tr data-lines=\"489,490\">\n<th>Caratteristica</th>\n<th>Descrizione &amp; Vantaggi</th>\n</tr>\n</thead>\n<tbody data-lines=\"491,498\">\n<tr data-lines=\"491,492\">\n<td><strong>Stages</strong></td>\n<td>Modularizza workflow in fasi, facilita debugging e riusabilit&#xe0;.</td>\n</tr>\n<tr data-lines=\"492,493\">\n<td><strong>Variabili a scope</strong></td>\n<td>Permette override controllato senza conflitti.</td>\n</tr>\n<tr data-lines=\"493,494\">\n<td><strong>Task con <code>id</code> e output</strong></td>\n<td>Permette riferimenti dinamici, flussi condizionali precisi.</td>\n</tr>\n<tr data-lines=\"494,495\">\n<td><strong>Eventi &amp; hook</strong></td>\n<td>Permette callback asincrone, logging, trigger su stati.</td>\n</tr>\n<tr data-lines=\"495,496\">\n<td><strong>Error handling avanzato</strong></td>\n<td>Retry, rollback e branching nativi, per affidabilit&#xe0; migliorata.</td>\n</tr>\n<tr data-lines=\"496,497\">\n<td><strong>Parallelismo dichiarato</strong></td>\n<td>Migliora performance mantenendo leggibilit&#xe0;.</td>\n</tr>\n<tr data-lines=\"497,498\">\n<td><strong>Branching semplice (<code>when</code>)</strong></td>\n<td>Permette percorsi condizionali senza complicare sintassi.</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"489,498"}}],"payload":{"tag":"h2","lines":"488,489"}},{"content":"5. Come implementare il motore","children":[{"content":"Parsing YAML basato su librerie mature (es. PyYAML).","children":[],"payload":{"tag":"li","lines":"499,500"}},{"content":"Modello interno ad oggetti con gestione scope variabili e stato.","children":[],"payload":{"tag":"li","lines":"500,501"}},{"content":"Event bus interno per eventi/hook (pub/sub).","children":[],"payload":{"tag":"li","lines":"501,502"}},{"content":"Executor task estendibile tramite plugin (ansible-runner, requests HTTP, subprocess shell).","children":[],"payload":{"tag":"li","lines":"502,503"}},{"content":"Scheduler interno per parallelismo e retry.","children":[],"payload":{"tag":"li","lines":"503,504"}},{"content":"Logging centralizzato e report stato.","children":[],"payload":{"tag":"li","lines":"504,505"}}],"payload":{"tag":"h2","lines":"498,499"}},{"content":"6. Documentazione wiki migliorata","children":[{"content":"<pre data-lines=\"506,520\"><code data-lines=\"506,520\">/docs\n&#x251c;&#x2500;&#x2500; Home.md\n&#x251c;&#x2500;&#x2500; Concepts.md            <span class=\"hljs-comment\"># Design principles e overview DSL</span>\n&#x251c;&#x2500;&#x2500; Workflow_Syntax.md     <span class=\"hljs-comment\"># Descrizione sintassi avanzata (stages, events, tasks)</span>\n&#x251c;&#x2500;&#x2500; Tasks_Modules.md       <span class=\"hljs-comment\"># Task types, plugin system, esempi avanzati</span>\n&#x251c;&#x2500;&#x2500; Error_Handling.md      <span class=\"hljs-comment\"># Retry, rollback, condizioni, esempi pratici</span>\n&#x251c;&#x2500;&#x2500; Events_and_Parallel.md <span class=\"hljs-comment\"># Eventi, hook, e parallelismo dichiarati</span>\n&#x251c;&#x2500;&#x2500; Integration_Ansible.md <span class=\"hljs-comment\"># Come integrare playbook ansible reali</span>\n&#x251c;&#x2500;&#x2500; Integration_API.md     <span class=\"hljs-comment\"># Usare Django REST e altre API HTTP</span>\n&#x251c;&#x2500;&#x2500; Frontend_React.md      <span class=\"hljs-comment\"># Consigli per integrazione UI e notifiche real-time</span>\n&#x251c;&#x2500;&#x2500; Examples.md            <span class=\"hljs-comment\"># Workflow completi commentati</span>\n&#x2514;&#x2500;&#x2500; Contributing.md        <span class=\"hljs-comment\"># Linee guida per estensioni e moduli</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"506,520"}}],"payload":{"tag":"h2","lines":"505,506"}},{"content":"7. Conclusione","children":[{"content":"&#xc8; <strong>modulare, leggibile e potente</strong>,","children":[],"payload":{"tag":"li","lines":"522,523"}},{"content":"Gestisce <strong>errori, eventi, parallelismo e rollback</strong> senza ricorrere a logica imperativa,","children":[],"payload":{"tag":"li","lines":"523,524"}},{"content":"Facilita integrazione con Ansible, Django REST e frontend React,","children":[],"payload":{"tag":"li","lines":"524,525"}},{"content":"Permette di scalare e mantenere il progetto a lungo termine,","children":[],"payload":{"tag":"li","lines":"525,526"}},{"content":"Con una documentazione strutturata e facilmente navigabile in wiki Markdown.","children":[],"payload":{"tag":"li","lines":"526,527"}},{"content":"Un parser + executor Python minimal per provarlo,","children":[],"payload":{"tag":"li","lines":"527,528"}},{"content":"Un esempio reale di playbook Ansible integrato,","children":[],"payload":{"tag":"li","lines":"528,529"}},{"content":"Un template di wiki con esempi e best practice.<br>\nChe ne pensi? Vuoi partire da qualche parte specifica?<br>\ndjango e react sono le scielte migliori?<br>\nci sono altre cose che sono concettualmente mal gestite?<br>\nOttima domanda! Parliamo di <strong>Django e React</strong> come stack per un&#x2019;app web di automazione infrastrutturale basata su workflow YAML, e vediamo se ci sono punti deboli concettuali o alternative valide.","children":[],"payload":{"tag":"li","lines":"529,534"}}],"payload":{"tag":"h2","lines":"520,521"}},{"content":"1. Django + React: punti di forza","children":[{"content":"Django (Backend)","children":[{"content":"<strong>Full-stack framework maturo</strong> con ORM, autenticazione, admin panel integrato.","children":[],"payload":{"tag":"li","lines":"536,537"}},{"content":"Ottimo per costruire API REST con <strong>Django REST Framework</strong>.","children":[],"payload":{"tag":"li","lines":"537,538"}},{"content":"Gestione sicura e robusta di DB, utenti, permessi.","children":[],"payload":{"tag":"li","lines":"538,539"}},{"content":"Ecosistema maturo e community attiva.","children":[],"payload":{"tag":"li","lines":"539,540"}},{"content":"Facilmente scalabile e customizzabile.","children":[],"payload":{"tag":"li","lines":"540,541"}},{"content":"Supporto nativo a task asincroni (con Celery, Channels).","children":[],"payload":{"tag":"li","lines":"541,542"}},{"content":"Buona integrazione con sistemi di automazione (es. chiamate a shell, playbook).","children":[],"payload":{"tag":"li","lines":"542,543"}}],"payload":{"tag":"h3","lines":"535,536"}},{"content":"React (Frontend)","children":[{"content":"UI declarativa, component-based, con ottimo supporto per state management (Redux, Recoil).","children":[],"payload":{"tag":"li","lines":"544,545"}},{"content":"Ecosistema immenso e in continua evoluzione.","children":[],"payload":{"tag":"li","lines":"545,546"}},{"content":"Ottimo per dashboard, notifiche real-time, visualizzazione flussi.","children":[],"payload":{"tag":"li","lines":"546,547"}},{"content":"Facilmente integrabile con websocket (es. Django Channels).","children":[],"payload":{"tag":"li","lines":"547,548"}}],"payload":{"tag":"h3","lines":"543,544"}}],"payload":{"tag":"h2","lines":"534,535"}},{"content":"2. Possibili limiti e alternative da considerare","children":[{"content":"<table data-lines=\"549,556\">\n<thead data-lines=\"549,550\">\n<tr data-lines=\"549,550\">\n<th>Area</th>\n<th>Criticit&#xe0; Django + React</th>\n<th>Alternative da valutare</th>\n</tr>\n</thead>\n<tbody data-lines=\"551,556\">\n<tr data-lines=\"551,552\">\n<td><strong>Backend</strong></td>\n<td>- Django &#xe8; monolitico, pu&#xf2; essere pesante per microservizi. <br> - Complessit&#xe0; nel gestire task concorrenti nativi (serve Celery/Channels).</td>\n<td>- <strong>FastAPI</strong> (Python) per API ultra-veloci e async nativo. <br> - <strong>Node.js + Express/NestJS</strong> per full JS stack (se vuoi restare su JS). <br> - <strong>Go (Gin, Fiber)</strong> per alta concorrenza e performance.</td>\n</tr>\n<tr data-lines=\"552,553\">\n<td><strong>Frontend</strong></td>\n<td>- React pu&#xf2; richiedere complessit&#xe0; nella gestione dello stato su app grandi. <br> - Richiede toolchain complessa (Webpack, Babel).</td>\n<td>- <strong>Vue.js</strong> o <strong>Svelte</strong>: pi&#xf9; leggeri, pi&#xf9; semplici da apprendere e integrare. <br> - Framework full-stack come <strong>Next.js</strong> o <strong>Remix</strong>: gestione lato server + client integrata.</td>\n</tr>\n<tr data-lines=\"553,554\">\n<td><strong>Comunicazione realtime</strong></td>\n<td>- Django Channels non &#xe8; trivialmente semplice da scalare. <br> - React ha bisogno di librerie esterne per websocket e gestione eventi.</td>\n<td>- Backend con supporto nativo websocket (es. FastAPI + WebSocket, or Go + Gorilla). <br> - Frontend con librerie pi&#xf9; leggere o integrate (SvelteKit, Nuxt).</td>\n</tr>\n<tr data-lines=\"554,555\">\n<td><strong>Automazione e task</strong></td>\n<td>- Django ha bisogno di integrazioni (Celery) per task asincroni e code management.</td>\n<td>- Sistemi specializzati come <strong>Temporal</strong>, <strong>Argo Workflows</strong> o <strong>Apache Airflow</strong> per orchestrazione complessa.</td>\n</tr>\n<tr data-lines=\"555,556\">\n<td><strong>Learning curve &amp; manutenzione</strong></td>\n<td>- Stack Django + React richiede conoscenza separata di due ecosistemi e toolchain.</td>\n<td>- Soluzioni full-stack JS (NestJS + React o Vue) possono semplificare la manutenzione per team JS.</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"549,556"}}],"payload":{"tag":"h2","lines":"548,549"}},{"content":"3. Approccio concettualmente pi&#xf9; &#x201c;pulito&#x201d;?","children":[{"content":"<strong>Microservizi + API Gateway</strong>: separare backend di automazione (es. Python FastAPI o Go) da backend di business logica (Django o Node), comunicando via API REST/gRPC.","children":[],"payload":{"tag":"li","lines":"557,558"}},{"content":"<strong>Event-driven architecture</strong>: usare un message broker (RabbitMQ, Kafka) per decoupling tra workflow engine e app.","children":[],"payload":{"tag":"li","lines":"558,559"}},{"content":"<strong>Workflow engine dedicati</strong>: adottare motori come Temporal o Airflow che gi&#xe0; gestiscono stato, retry, parallelismo, e esporre API per UI.","children":[],"payload":{"tag":"li","lines":"559,560"}},{"content":"<strong>Serverless o Functions as a Service</strong>: per task infrastrutturali, per scalare on-demand senza gestire server.","children":[],"payload":{"tag":"li","lines":"560,561"}}],"payload":{"tag":"h2","lines":"556,557"}},{"content":"4. Consiglio pragmatico","children":[{"content":"Django REST + React &#xe8; una scelta solida e collaudata.","children":[],"payload":{"tag":"li","lines":"563,564"}},{"content":"Integra Celery per task asincroni, Channels per realtime.","children":[],"payload":{"tag":"li","lines":"564,565"}},{"content":"Mantieni la modularit&#xe0; per poter sostituire parti con alternative pi&#xf9; leggere (FastAPI o Vue) se serve.<br>\nSe invece vuoi qualcosa pi&#xf9; moderno e snello:","children":[],"payload":{"tag":"li","lines":"565,567"}},{"content":"Backend: <strong>FastAPI</strong> + Celery (async nativo, pi&#xf9; leggero).","children":[],"payload":{"tag":"li","lines":"567,568"}},{"content":"Frontend: <strong>Vue 3</strong> o <strong>Svelte</strong> per semplicit&#xe0; e reattivit&#xe0;.","children":[],"payload":{"tag":"li","lines":"568,569"}},{"content":"Workflow orchestration esterna: considera Temporal o Airflow.","children":[],"payload":{"tag":"li","lines":"569,570"}}],"payload":{"tag":"h2","lines":"561,562"}},{"content":"5. Per approfondire","children":[{"content":"Guarda come <strong>Pulumi</strong> ha scelto di integrare backend API (Go/Python/Node) e frontend web.","children":[],"payload":{"tag":"li","lines":"571,572"}},{"content":"Studia l&#x2019;architettura di piattaforme come <strong>GitHub Actions</strong>, che sono basate su workflow YAML con API REST e UI React.","children":[],"payload":{"tag":"li","lines":"572,573"}},{"content":"Valuta anche <strong>OpenTofu/Terraform Cloud</strong> per ispirazione su gestione stato e interfaccia.","children":[],"payload":{"tag":"li","lines":"573,574"}},{"content":"Scrivere un prototipo con Django REST + React.","children":[],"payload":{"tag":"li","lines":"574,575"}},{"content":"Fare un proof-of-concept con FastAPI + Vue.","children":[],"payload":{"tag":"li","lines":"575,576"}},{"content":"Disegnare l&#x2019;architettura scalabile usando microservizi/event-driven.<br>\nChe preferisci?<br>\nqualcosa pi&#xf9; moderno e snello:<br>\nBackend: FastAPI + Celery (async nativo, pi&#xf9; leggero).<br>\nFrontend: Svelte per semplicit&#xe0; e reattivit&#xe0;.<br>\nWorkflow orchestration esterna: considera Temporal o Airflow.<br>\no addirittura plumini+go?<br>\nOpenTofu e GitHub Actions on so ancora perch&#xe8; ma sicuramente li voglio usare","children":[],"payload":{"tag":"li","lines":"576,584"}}],"payload":{"tag":"h2","lines":"570,571"}}],"payload":{"tag":"h1","lines":"400,401"}},{"content":"&#x1f680; Stack moderno e snello per Automazione infrastrutturale con workflow YAML","children":[{"content":"1. Backend: <strong>FastAPI + Celery</strong>","children":[{"content":"Perch&#xe9; FastAPI?","children":[{"content":"<strong>Asincrono nativo</strong> con <code>async</code>/<code>await</code>, perfetto per IO-bound (chiamate API, file, DB).","children":[],"payload":{"tag":"li","lines":"587,588"}},{"content":"Molto pi&#xf9; leggero e performante di Django, startup rapido.","children":[],"payload":{"tag":"li","lines":"588,589"}},{"content":"Facile da integrare con Celery per task asincroni (es. esecuzione playbook Ansible, job lunghi).","children":[],"payload":{"tag":"li","lines":"589,590"}},{"content":"Documentazione automatica con Swagger/OpenAPI, ottimo per API pubbliche o interne.","children":[],"payload":{"tag":"li","lines":"590,591"}},{"content":"Semplice da testare e estendere.","children":[],"payload":{"tag":"li","lines":"591,592"}}],"payload":{"tag":"h3","lines":"586,587"}},{"content":"Perch&#xe9; Celery?","children":[{"content":"Task queue robusta per esecuzione asincrona e retry.","children":[],"payload":{"tag":"li","lines":"593,594"}},{"content":"Supporta broker diversi (RabbitMQ, Redis).","children":[],"payload":{"tag":"li","lines":"594,595"}},{"content":"Si integra bene con FastAPI, e ti permette di schedulare job complessi.","children":[],"payload":{"tag":"li","lines":"595,596"}},{"content":"Supporta workflow pi&#xf9; articolati (catene, gruppi, callback).","children":[],"payload":{"tag":"li","lines":"596,597"}}],"payload":{"tag":"h3","lines":"592,593"}}],"payload":{"tag":"h2","lines":"585,586"}},{"content":"2. Frontend: <strong>Svelte</strong>","children":[{"content":"Vantaggi di Svelte","children":[{"content":"<strong>Zero runtime framework</strong>: il codice &#xe8; compilato in vanilla JS, quindi app leggerissime e velocissime.","children":[],"payload":{"tag":"li","lines":"599,600"}},{"content":"Sintassi semplice e intuitiva, ideale per sviluppatori con esperienza JS che vogliono evitare boilerplate.","children":[],"payload":{"tag":"li","lines":"600,601"}},{"content":"Ottimo per UI reactive, dashboard di monitoring, notifiche in tempo reale.","children":[],"payload":{"tag":"li","lines":"601,602"}},{"content":"Supporto nativo per store e state management senza dipendenze esterne.","children":[],"payload":{"tag":"li","lines":"602,603"}},{"content":"Ottima integrazione con API REST o websocket.","children":[],"payload":{"tag":"li","lines":"603,604"}}],"payload":{"tag":"h3","lines":"598,599"}}],"payload":{"tag":"h2","lines":"597,598"}},{"content":"3. Workflow orchestration esterna: <strong>Temporal o Apache Airflow</strong>","children":[{"content":"Perch&#xe9; Temporal?","children":[{"content":"Gestione <strong>stateful workflows</strong> con retry automatici, timeout, parallelismo, rollback.","children":[],"payload":{"tag":"li","lines":"606,607"}},{"content":"SDK in Go, Java, Python (la tua combo pu&#xf2; interagire bene con SDK Python).","children":[],"payload":{"tag":"li","lines":"607,608"}},{"content":"Perfetto per pipeline di automazione infra che devono garantire consistenza.","children":[],"payload":{"tag":"li","lines":"608,609"}},{"content":"Event-driven, con visibilit&#xe0; e controllo centralizzati.","children":[],"payload":{"tag":"li","lines":"609,610"}},{"content":"Molto usato in ambito enterprise.","children":[],"payload":{"tag":"li","lines":"610,611"}}],"payload":{"tag":"h3","lines":"605,606"}},{"content":"Perch&#xe9; Apache Airflow?","children":[{"content":"Orchestratore di workflow pi&#xf9; tradizionale, basato su DAG Python.","children":[],"payload":{"tag":"li","lines":"612,613"}},{"content":"Ampia community e plugin per integrazione con cloud e strumenti.","children":[],"payload":{"tag":"li","lines":"613,614"}},{"content":"Interfaccia UI per monitorare e gestire i flussi.","children":[],"payload":{"tag":"li","lines":"614,615"}},{"content":"Pi&#xf9; complesso da integrare in un&#x2019;architettura microservices ma molto potente.","children":[],"payload":{"tag":"li","lines":"615,616"}}],"payload":{"tag":"h3","lines":"611,612"}}],"payload":{"tag":"h2","lines":"604,605"}},{"content":"4. Alternative o estensioni: <strong>Pulumi + Go</strong>","children":[{"content":"Pulumi ti permette di definire infrastruttura in linguaggi generali come Go, TypeScript, Python.","children":[],"payload":{"tag":"li","lines":"617,618"}},{"content":"Ottimo per infrastruttura &#x201c;as code&#x201d; programmabile e integra con CI/CD.","children":[],"payload":{"tag":"li","lines":"618,619"}},{"content":"Potresti usare Pulumi + Go per la parte di provisioning, chiamata da workflow orchestrati da Temporal/FastAPI.","children":[],"payload":{"tag":"li","lines":"619,620"}},{"content":"Ottimo compromesso tra potenza e controllo.","children":[],"payload":{"tag":"li","lines":"620,621"}},{"content":"Supporta gi&#xe0; concetti di stato e idempotenza.","children":[],"payload":{"tag":"li","lines":"621,622"}}],"payload":{"tag":"h2","lines":"616,617"}},{"content":"5. Integrazione con <strong>OpenTofu</strong> e <strong>GitHub Actions</strong>","children":[{"content":"<strong>OpenTofu</strong> (fork open source di Terraform) &#xe8; perfetto per provisioning infrastrutturale dichiarativo.","children":[],"payload":{"tag":"li","lines":"623,624"}},{"content":"Puoi orchestrare esecuzione OpenTofu tramite FastAPI (API) o tramite task Celery.","children":[],"payload":{"tag":"li","lines":"624,625"}},{"content":"<strong>GitHub Actions</strong>: puoi integrare la pipeline del workflow con eventi GitHub (push, PR) usando webhook o API.","children":[],"payload":{"tag":"li","lines":"625,626"}},{"content":"In pi&#xf9;, GitHub Actions pu&#xf2; lanciare workflow su Temporal o Airflow tramite API.","children":[],"payload":{"tag":"li","lines":"626,627"}},{"content":"Permette un ciclo di DevOps/GitOps perfettamente integrato.","children":[],"payload":{"tag":"li","lines":"627,628"}}],"payload":{"tag":"h2","lines":"622,623"}},{"content":"6. Schema architetturale semplice","children":[{"content":"<pre data-lines=\"629,638\"><code data-lines=\"629,638\">User &lt;--&gt; Svelte Frontend &lt;--&gt; FastAPI REST API &lt;--&gt; Celery Worker(s)\n                                       |\n                                       +--&gt; Temporal Workflow Engine\n                                       |\n                                       +--&gt; OpenTofu CLI / Pulumi Go SDK\n                                       |\n                                       +--&gt; GitHub Actions API (trigger/reports)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"629,638"}}],"payload":{"tag":"h2","lines":"628,629"}},{"content":"7. Prossimi passi concreti","children":[{"content":"Ti preparo un <strong>prototipo FastAPI + Celery</strong> che esegue task base (es. chiamata playbook Ansible).","children":[],"payload":{"tag":"li","lines":"639,640"}},{"content":"Un piccolo <strong>dashboard Svelte</strong> per monitorare task e notifiche realtime.","children":[],"payload":{"tag":"li","lines":"640,641"}},{"content":"Setup di un esempio base di workflow Temporal con Python SDK.","children":[],"payload":{"tag":"li","lines":"641,642"}},{"content":"Demo di integrazione OpenTofu e GitHub Actions (trigger API).<br>\naspetta, non ho capito: visto che la base resta sempre e comunque sfruttare ansible, cosa consigli per lo stack?<br>\nOttima domanda, facciamo chiarezza mettendo al centro <strong>Ansible</strong> come motore di automazione, e vediamo come costruire intorno a esso uno stack moderno, performante e manutenibile.","children":[],"payload":{"tag":"li","lines":"642,645"}}],"payload":{"tag":"h2","lines":"638,639"}}],"payload":{"tag":"h1","lines":"584,585"}},{"content":"Come costruire uno stack moderno partendo da Ansible","children":[{"content":"1. Ansible come motore core","children":[{"content":"<strong>Ansible</strong> &#xe8; il tuo executor dichiarativo: scrivi playbook YAML, gestisci configurazioni, provisioning, deployment.","children":[],"payload":{"tag":"li","lines":"647,648"}},{"content":"&#xc8; <strong>agentless</strong>, usa SSH, quindi semplice da integrare.","children":[],"payload":{"tag":"li","lines":"648,649"}},{"content":"Ha ottimi moduli per Linux, cloud, networking.","children":[],"payload":{"tag":"li","lines":"649,650"}},{"content":"Pu&#xf2; essere chiamato da CLI, API wrapper, o task queue.","children":[],"payload":{"tag":"li","lines":"650,651"}}],"payload":{"tag":"h2","lines":"646,647"}},{"content":"2. Backend: <strong>FastAPI + Celery</strong> (per orchestrazione e API)","children":[{"content":"Perch&#xe9;?","children":[{"content":"<strong>FastAPI</strong>: espone API REST/GraphQL per il frontend o altri sistemi. &#xc8; asincrono e leggero, ottimo per scalare.","children":[],"payload":{"tag":"li","lines":"653,654"}},{"content":"<strong>Celery</strong>: gestisce l&#x2019;esecuzione asincrona e parallela dei task Ansible (ad esempio, chiamate a <code>ansible-playbook</code> o tramite <code>ansible-runner</code>).","children":[],"payload":{"tag":"li","lines":"654,655"}},{"content":"In questo modo, puoi:","children":[{"content":"Accodare esecuzioni playbook.","children":[],"payload":{"tag":"li","lines":"656,657"}},{"content":"Gestire retries, timeout, errori.","children":[],"payload":{"tag":"li","lines":"657,658"}},{"content":"Avere visibilit&#xe0; sullo stato tramite API.","children":[],"payload":{"tag":"li","lines":"658,659"}}],"payload":{"tag":"li","lines":"655,659"}}],"payload":{"tag":"h3","lines":"652,653"}},{"content":"Esempio semplificato di task Celery che lancia Ansible:","children":[{"content":"<pre data-lines=\"660,672\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">import</span> subprocess\n\napp = Celery(<span class=\"hljs-string\">&apos;tasks&apos;</span>, broker=<span class=\"hljs-string\">&apos;redis://localhost:6379/0&apos;</span>)\n\n<span class=\"hljs-meta\">@app.task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>(<span class=\"hljs-params\">playbook_path, inventory_path</span>):\n    cmd = [<span class=\"hljs-string\">&apos;ansible-playbook&apos;</span>, <span class=\"hljs-string\">&apos;-i&apos;</span>, inventory_path, playbook_path]\n    result = subprocess.run(cmd, capture_output=<span class=\"hljs-literal\">True</span>, text=<span class=\"hljs-literal\">True</span>)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&apos;stdout&apos;</span>: result.stdout, <span class=\"hljs-string\">&apos;stderr&apos;</span>: result.stderr, <span class=\"hljs-string\">&apos;returncode&apos;</span>: result.returncode}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"660,672"}}],"payload":{"tag":"h3","lines":"659,660"}}],"payload":{"tag":"h2","lines":"651,652"}},{"content":"3. Frontend: <strong>Svelte</strong>","children":[{"content":"UI leggera e moderna per visualizzare:","children":[{"content":"Stato dei job (in esecuzione, completati, falliti).","children":[],"payload":{"tag":"li","lines":"674,675"}},{"content":"Log in tempo reale (tramite websocket o polling).","children":[],"payload":{"tag":"li","lines":"675,676"}},{"content":"Dashboard di controllo e configurazione.","children":[],"payload":{"tag":"li","lines":"676,677"}}],"payload":{"tag":"li","lines":"673,677"}},{"content":"Svelte permette reattivit&#xe0; e semplicit&#xe0; d&#x2019;uso senza complessit&#xe0; di toolchain e overhead.","children":[],"payload":{"tag":"li","lines":"677,678"}}],"payload":{"tag":"h2","lines":"672,673"}},{"content":"4. Workflow orchestration esterna (opzionale)","children":[{"content":"Puoi usare <strong>Temporal</strong> o <strong>Apache Airflow</strong> per orchestrare sequenze pi&#xf9; complesse di playbook Ansible, retries, rollback.","children":[],"payload":{"tag":"li","lines":"679,680"}},{"content":"Temporal ha SDK Python: puoi integrare i task Celery (o chiamate dirette ad Ansible) all&#x2019;interno di workflow con stato.","children":[],"payload":{"tag":"li","lines":"680,681"}},{"content":"Se il tuo sistema cresce in complessit&#xe0;, questo livello aiuta a mantenere controllo e visibilit&#xe0;.","children":[],"payload":{"tag":"li","lines":"681,682"}}],"payload":{"tag":"h2","lines":"678,679"}},{"content":"5. Integrazione con Pulumi + Go e OpenTofu","children":[{"content":"<strong>Pulumi + Go</strong> o <strong>OpenTofu</strong> possono essere usati per la parte di provisioning infrastrutturale pi&#xf9; strutturata, quando vuoi definire l&#x2019;infrastruttura come codice in modo programmabile.","children":[],"payload":{"tag":"li","lines":"683,684"}},{"content":"Puoi integrare i loro comandi all&#x2019;interno del workflow Celery/FastAPI, magari chiamandoli da playbook Ansible o da task dedicati.","children":[],"payload":{"tag":"li","lines":"684,685"}},{"content":"OpenTofu pu&#xf2; essere richiamato da backend come CLI o libreria.","children":[],"payload":{"tag":"li","lines":"685,686"}}],"payload":{"tag":"h2","lines":"682,683"}},{"content":"6. GitHub Actions come trigger e integrazione DevOps","children":[{"content":"GitHub Actions pu&#xf2; attivare workflow tramite webhook o API FastAPI.","children":[],"payload":{"tag":"li","lines":"687,688"}},{"content":"Puoi avere pipeline CI/CD che aggiornano playbook, triggerano deployment o rollback automatici.","children":[],"payload":{"tag":"li","lines":"688,689"}},{"content":"Il sistema pu&#xf2; fornire feedback a GitHub Actions via API, per status e notifiche.","children":[],"payload":{"tag":"li","lines":"689,690"}}],"payload":{"tag":"h2","lines":"686,687"}},{"content":"7. Schema finale consigliato","children":[{"content":"<pre data-lines=\"691,700\"><code data-lines=\"691,700\">Utente &lt;--&gt; Frontend Svelte &lt;--&gt; Backend FastAPI &lt;--&gt; Celery Worker (esegue Ansible)\n                                              |\n                                              +--&gt; Temporal / Airflow (workflow complessi)\n                                              |\n                                              +--&gt; Pulumi/Go, OpenTofu (provisioning IaC)\n                                              |\n                                              +--&gt; GitHub Actions (trigger / notifiche)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"691,700"}}],"payload":{"tag":"h2","lines":"690,691"}},{"content":"8. Vantaggi di questo approccio","children":[{"content":"<strong>Usi Ansible, che &#xe8; solido e diffuso, senza reinventare la ruota.</strong>","children":[],"payload":{"tag":"li","lines":"701,702"}},{"content":"Ottieni <strong>API moderne, asincronia e scalabilit&#xe0;</strong> grazie a FastAPI + Celery.","children":[],"payload":{"tag":"li","lines":"702,703"}},{"content":"UI semplice, moderna e performante con Svelte.","children":[],"payload":{"tag":"li","lines":"703,704"}},{"content":"Possibilit&#xe0; di integrare orchestratori di workflow per complessit&#xe0; futura.","children":[],"payload":{"tag":"li","lines":"704,705"}},{"content":"Puoi espandere con Pulumi/OpenTofu per IaC pi&#xf9; programmatico.","children":[],"payload":{"tag":"li","lines":"705,706"}},{"content":"Completa integrazione con pipeline DevOps/GitOps (GitHub Actions).<br>\nTi interessa?","children":[],"payload":{"tag":"li","lines":"706,708"}}],"payload":{"tag":"h2","lines":"700,701"}},{"content":"Step 1: Prototipo backend FastAPI + Celery per eseguire playbook Ansible","children":[{"content":"Esporre un&#x2019;API REST per avviare un playbook Ansible","children":[],"payload":{"tag":"li","lines":"710,711"}},{"content":"Gestire l&#x2019;esecuzione asincrona tramite Celery","children":[],"payload":{"tag":"li","lines":"711,712"}},{"content":"Restituire lo stato e i log dell&#x2019;esecuzione","children":[],"payload":{"tag":"li","lines":"712,713"}}],"payload":{"tag":"h2","lines":"708,709"}},{"content":"Step 2: Frontend Svelte minimale","children":[{"content":"Dashboard semplice per:","children":[{"content":"Inserire il path del playbook/inventory (o selezionare da lista)","children":[],"payload":{"tag":"li","lines":"715,716"}},{"content":"Triggerare l&#x2019;esecuzione","children":[],"payload":{"tag":"li","lines":"716,717"}},{"content":"Visualizzare lo stato e log in tempo reale (polling o websocket)","children":[],"payload":{"tag":"li","lines":"717,718"}}],"payload":{"tag":"li","lines":"714,718"}}],"payload":{"tag":"h2","lines":"713,714"}},{"content":"Step 3: Espandere (opzionale)","children":[{"content":"Integrazione con Temporal/Airflow per workflow complessi","children":[],"payload":{"tag":"li","lines":"719,720"}},{"content":"Supporto per Pulumi/OpenTofu tramite task Celery","children":[],"payload":{"tag":"li","lines":"720,721"}},{"content":"Integrazione GitHub Actions per trigger automatici<br>\nOppure preferisci una guida passo passo per configurare ambiente e tool?","children":[],"payload":{"tag":"li","lines":"721,723"}}],"payload":{"tag":"h2","lines":"718,719"}}],"payload":{"tag":"h1","lines":"645,646"}},{"content":"Backend FastAPI + Celery: esempio minimo","children":[{"content":"1. Prerequisiti","children":[{"content":"Python 3.9+","children":[],"payload":{"tag":"li","lines":"725,726"}},{"content":"Redis (broker Celery)","children":[],"payload":{"tag":"li","lines":"726,727"}},{"content":"Ansible installato sul sistema","children":[],"payload":{"tag":"li","lines":"727,728"}},{"content":"Virtualenv consigliato","children":[],"payload":{"tag":"li","lines":"728,729"}}],"payload":{"tag":"h3","lines":"724,725"}},{"content":"2. Installazione pacchetti Python","children":[{"content":"<pre data-lines=\"730,733\"><code class=\"language-bash\">pip install fastapi uvicorn celery redis ansible-runner\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"730,733"}}],"payload":{"tag":"h3","lines":"729,730"}},{"content":"3. Struttura progetto","children":[{"content":"<pre data-lines=\"734,743\"><code data-lines=\"734,743\">ansible_backend<span class=\"hljs-symbol\">/</span>\n&#x251c;&#x2500;&#x2500; app.py              <span class=\"hljs-comment\"># FastAPI app + API endpoint</span>\n&#x251c;&#x2500;&#x2500; tasks.py            <span class=\"hljs-comment\"># Celery tasks</span>\n&#x251c;&#x2500;&#x2500; celery_worker.py    <span class=\"hljs-comment\"># Avvio worker celery</span>\n&#x2514;&#x2500;&#x2500; playbooks<span class=\"hljs-symbol\">/</span>          <span class=\"hljs-comment\"># Cartella con playbook e inventory</span>\n    &#x251c;&#x2500;&#x2500; site.yml\n    &#x2514;&#x2500;&#x2500; inventory.ini\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"734,743"}}],"payload":{"tag":"h3","lines":"733,734"}},{"content":"4. Codice <code>tasks.py</code> (task Celery)","children":[{"content":"<pre data-lines=\"744,757\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">import</span> ansible_runner\n\napp = Celery(<span class=\"hljs-string\">&apos;tasks&apos;</span>, broker=<span class=\"hljs-string\">&apos;redis://localhost:6379/0&apos;</span>)\n\n<span class=\"hljs-meta\">@app.task(<span class=\"hljs-params\">bind=<span class=\"hljs-literal\">True</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>(<span class=\"hljs-params\">self, playbook_name: <span class=\"hljs-built_in\">str</span></span>):\n    r = ansible_runner.run(private_data_dir=<span class=\"hljs-string\">&apos;./playbooks&apos;</span>, playbook=playbook_name)\n    <span class=\"hljs-keyword\">if</span> r.rc != <span class=\"hljs-number\">0</span>:\n        <span class=\"hljs-keyword\">raise</span> Exception(<span class=\"hljs-string\">f&quot;Playbook failed with rc=<span class=\"hljs-subst\">{r.rc}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&apos;status&apos;</span>: <span class=\"hljs-string\">&apos;success&apos;</span>, <span class=\"hljs-string\">&apos;stats&apos;</span>: r.stats, <span class=\"hljs-string\">&apos;rc&apos;</span>: r.rc}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"744,757"}}],"payload":{"tag":"h3","lines":"743,744"}},{"content":"5. Codice <code>app.py</code> (FastAPI REST API)","children":[{"content":"<pre data-lines=\"758,786\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI, HTTPException\n<span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseModel\n<span class=\"hljs-keyword\">from</span> tasks <span class=\"hljs-keyword\">import</span> run_playbook\n<span class=\"hljs-keyword\">from</span> celery.result <span class=\"hljs-keyword\">import</span> AsyncResult\n\napp = FastAPI()\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">PlaybookRequest</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    playbook_name: <span class=\"hljs-built_in\">str</span>\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run-playbook/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook_endpoint</span>(<span class=\"hljs-params\">req: PlaybookRequest</span>):\n    task = run_playbook.delay(req.playbook_name)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task.<span class=\"hljs-built_in\">id</span>}\n\n<span class=\"hljs-meta\">@app.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/task-status/{task_id}&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_task_status</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span></span>):\n    task_result = AsyncResult(task_id)\n    <span class=\"hljs-keyword\">if</span> task_result.state == <span class=\"hljs-string\">&apos;PENDING&apos;</span>:\n        <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;state&quot;</span>: task_result.state, <span class=\"hljs-string\">&quot;status&quot;</span>: <span class=\"hljs-string\">&quot;Pending...&quot;</span>}\n    <span class=\"hljs-keyword\">elif</span> task_result.state == <span class=\"hljs-string\">&apos;SUCCESS&apos;</span>:\n        <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;state&quot;</span>: task_result.state, <span class=\"hljs-string\">&quot;result&quot;</span>: task_result.result}\n    <span class=\"hljs-keyword\">elif</span> task_result.state == <span class=\"hljs-string\">&apos;FAILURE&apos;</span>:\n        <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;state&quot;</span>: task_result.state, <span class=\"hljs-string\">&quot;error&quot;</span>: <span class=\"hljs-built_in\">str</span>(task_result.result)}\n    <span class=\"hljs-keyword\">else</span>:\n        <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;state&quot;</span>: task_result.state}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"758,786"}}],"payload":{"tag":"h3","lines":"757,758"}},{"content":"6. Codice <code>celery_worker.py</code> (avvio worker Celery)","children":[{"content":"<pre data-lines=\"787,793\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> tasks <span class=\"hljs-keyword\">import</span> app\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n    app.worker_main()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"787,793"}}],"payload":{"tag":"h3","lines":"786,787"}},{"content":"7. Esempio playbook e inventory (<code>playbooks/site.yml</code> e <code>playbooks/inventory.ini</code>)","children":[{"content":"<pre data-lines=\"795,801\"><code class=\"language-yaml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">all</span>\n  <span class=\"hljs-attr\">tasks:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Ping</span> <span class=\"hljs-string\">hosts</span>\n      <span class=\"hljs-attr\">ping:</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"795,801"}},{"content":"<pre data-lines=\"802,805\"><code data-lines=\"802,805\">localhost <span class=\"hljs-attribute\">ansible_connection</span>=local\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"802,805"}}],"payload":{"tag":"h3","lines":"793,794"}},{"content":"8. Come eseguire","children":[{"content":"<pre data-lines=\"808,811\"><code class=\"language-bash\">celery -A tasks worker --loglevel=info\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"808,811"}},{"content":"<pre data-lines=\"812,815\"><code class=\"language-bash\">uvicorn app:app --reload\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"812,815"}}],"payload":{"tag":"h3","lines":"805,806"}},{"content":"9. Test API","children":[{"content":"<pre data-lines=\"817,822\"><code class=\"language-json\"><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">&quot;playbook_name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;site.yml&quot;</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"817,822"}}],"payload":{"tag":"h3","lines":"815,816"}}],"payload":{"tag":"h1","lines":"723,724"}},{"content":"Frontend Svelte: dashboard base per eseguire playbook Ansible","children":[{"content":"1. Setup progetto Svelte","children":[{"content":"<pre data-lines=\"828,833\"><code class=\"language-bash\">npm create vite@latest ansible-frontend -- --template svelte\n<span class=\"hljs-built_in\">cd</span> ansible-frontend\nnpm install\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"828,833"}}],"payload":{"tag":"h3","lines":"826,827"}},{"content":"2. Creiamo un componente <code>App.svelte</code> semplice","children":[{"content":"<pre data-lines=\"834,900\"><code class=\"language-svelte\">&lt;script&gt;\n  import { onMount } from &apos;svelte&apos;;\n  let playbookName = &apos;site.yml&apos;;\n  let taskId = &apos;&apos;;\n  let taskStatus = &apos;&apos;;\n  let interval;\n\n  async function runPlaybook() {\n    const res = await fetch(&apos;http://localhost:8000/run-playbook/&apos;, {\n      method: &apos;POST&apos;,\n      headers: { &apos;Content-Type&apos;: &apos;application/json&apos; },\n      body: JSON.stringify({ playbook_name: playbookName })\n    });\n    const data = await res.json();\n    taskId = data.task_id;\n    taskStatus = &apos;Task started, id: &apos; + taskId;\n\n    // Polling status ogni 3 secondi\n    interval = setInterval(checkStatus, 3000);\n  }\n\n  async function checkStatus() {\n    if (!taskId) return;\n    const res = await fetch(`http://localhost:8000/task-status/&#x24;{taskId}`);\n    const data = await res.json();\n    taskStatus = JSON.stringify(data, null, 2);\n    if (data.state === &apos;SUCCESS&apos; || data.state === &apos;FAILURE&apos;) {\n      clearInterval(interval);\n    }\n  }\n&lt;/script&gt;\n\n&lt;main&gt;\n  &lt;h1&gt;Ansible Playbook Runner&lt;/h1&gt;\n  &lt;input type=&quot;text&quot; bind:value={playbookName} placeholder=&quot;Playbook name&quot; /&gt;\n  &lt;button on:click={runPlaybook}&gt;Run Playbook&lt;/button&gt;\n\n  &lt;pre&gt;{taskStatus}&lt;/pre&gt;\n&lt;/main&gt;\n\n&lt;style&gt;\n  main {\n    max-width: 600px;\n    margin: 2rem auto;\n    font-family: system-ui, sans-serif;\n  }\n  input {\n    width: 100%;\n    padding: 0.5rem;\n    margin-bottom: 1rem;\n    font-size: 1rem;\n  }\n  button {\n    padding: 0.5rem 1rem;\n    font-size: 1rem;\n    cursor: pointer;\n  }\n  pre {\n    background: #f0f0f0;\n    padding: 1rem;\n    margin-top: 1rem;\n    white-space: pre-wrap;\n  }\n&lt;/style&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"834,900"}}],"payload":{"tag":"h3","lines":"833,834"}},{"content":"3. Avvio frontend","children":[{"content":"<pre data-lines=\"901,904\"><code class=\"language-bash\">npm run dev\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"901,904"}}],"payload":{"tag":"h3","lines":"900,901"}},{"content":"4. Prova","children":[{"content":"Inserisci il nome del playbook (<code>site.yml</code>) e clicca &#x201c;Run Playbook&#x201d;","children":[],"payload":{"tag":"li","lines":"905,906"}},{"content":"Vedrai partire il task e il polling dello stato","children":[],"payload":{"tag":"li","lines":"906,907"}}],"payload":{"tag":"h3","lines":"904,905"}},{"content":"5. Possibili estensioni immediate","children":[{"content":"Lista playbook disponibili caricata da backend","children":[],"payload":{"tag":"li","lines":"908,909"}},{"content":"Visualizzazione log dettagliati (streaming websocket)","children":[],"payload":{"tag":"li","lines":"909,910"}},{"content":"Autenticazione utente","children":[],"payload":{"tag":"li","lines":"910,911"}},{"content":"UI pi&#xf9; ricca (es. selezione host, parametri playbook)","children":[],"payload":{"tag":"li","lines":"911,912"}},{"content":"Integrazione con GitHub Actions e notifiche<br>\nCome ti sembra fin qui? Vuoi continuare?<br>\nprima rispiegami come tutto ci&#xf2; mi porti ad una App web (frontend/backend) per Automazione infrastrutturale tramite Workflow e pipeline usando file YAML interpretati, poi ok:<br>\nLista playbook disponibili caricata da backend<br>\nVisualizzazione log dettagliati (streaming websocket)<br>\nUI pi&#xf9; ricca (es. selezione host, parametri playbook)<br>\nIntegrazione con GitHub per autenticazione utente Actions e notifiche (tramite app mobile, email, ecc... come permette github)","children":[],"payload":{"tag":"li","lines":"912,919"}}],"payload":{"tag":"h3","lines":"907,908"}}],"payload":{"tag":"h1","lines":"825,826"}},{"content":"Come il backend FastAPI+Celery + frontend Svelte diventa un&#x2019;App Web completa per automazione infrastrutturale","children":[{"content":"1. Punto di partenza: playbook YAML + Ansible","children":[{"content":"I tuoi file <strong>YAML (playbook Ansible)</strong> descrivono in modo dichiarativo la configurazione e le attivit&#xe0; da svolgere (es. installazione pacchetti, configurazioni, deploy).","children":[],"payload":{"tag":"li","lines":"921,922"}},{"content":"Ansible &#xe8; il motore che <strong>interpreta</strong> questi file e li esegue, garantendo idempotenza e gestione dello stato.","children":[],"payload":{"tag":"li","lines":"922,923"}}],"payload":{"tag":"h2","lines":"920,921"}},{"content":"2. Backend come <strong>motore di esecuzione e orchestrazione</strong>","children":[{"content":"Il backend (FastAPI + Celery):","children":[{"content":"Espone API per caricare/eseguire playbook e gestire il loro stato (start, in corso, completato, errore).","children":[],"payload":{"tag":"li","lines":"925,926"}},{"content":"Accoda l&#x2019;esecuzione dei playbook in modo <strong>asincrono</strong> e scalabile (con Celery).","children":[],"payload":{"tag":"li","lines":"926,927"}},{"content":"Consente di ottenere lo stato e i risultati in tempo reale (polling o websocket).","children":[],"payload":{"tag":"li","lines":"927,928"}},{"content":"Pu&#xf2; orchestrare pi&#xf9; playbook in sequenza, parallelismo, gestendo retry, errori, rollback (usando strumenti come Temporal o Airflow se vuoi workflow pi&#xf9; complessi).","children":[],"payload":{"tag":"li","lines":"928,929"}}],"payload":{"tag":"li","lines":"924,929"}}],"payload":{"tag":"h2","lines":"923,924"}},{"content":"3. Frontend come <strong>interfaccia utente di gestione</strong>","children":[{"content":"Il frontend (Svelte):","children":[{"content":"Permette agli utenti di selezionare o caricare playbook YAML.","children":[],"payload":{"tag":"li","lines":"931,932"}},{"content":"Visualizza lo stato dei workflow e i log in tempo reale.","children":[],"payload":{"tag":"li","lines":"932,933"}},{"content":"Offre strumenti di configurazione (parametri, selezione host, ecc).","children":[],"payload":{"tag":"li","lines":"933,934"}},{"content":"Gestisce autenticazione e autorizzazione utenti (es. OAuth GitHub).","children":[],"payload":{"tag":"li","lines":"934,935"}},{"content":"Notifica gli utenti via UI, email, mobile o integrazioni esterne.","children":[],"payload":{"tag":"li","lines":"935,936"}}],"payload":{"tag":"li","lines":"930,936"}}],"payload":{"tag":"h2","lines":"929,930"}},{"content":"4. Workflow &amp; pipeline tramite YAML interpretati","children":[{"content":"Ogni playbook &#xe8; un <strong>workflow</strong> o un <strong>passo di pipeline</strong>.","children":[],"payload":{"tag":"li","lines":"937,938"}},{"content":"Puoi comporre sequenze di playbook, creare dipendenze, condizioni e trigger.","children":[],"payload":{"tag":"li","lines":"938,939"}},{"content":"Il backend orchestra queste pipeline, facendo partire i playbook corretti al momento giusto.","children":[],"payload":{"tag":"li","lines":"939,940"}},{"content":"L&#x2019;utente ha pieno controllo da interfaccia o API REST.","children":[],"payload":{"tag":"li","lines":"940,941"}}],"payload":{"tag":"h2","lines":"936,937"}},{"content":"5. Integrazione con GitHub Actions &amp; autenticazione","children":[{"content":"Autenticazione con GitHub OAuth per accesso sicuro.","children":[],"payload":{"tag":"li","lines":"942,943"}},{"content":"Possibilit&#xe0; di:","children":[{"content":"<strong>Trigger automatici</strong> di workflow su push o PR via GitHub Actions che chiamano le API FastAPI.","children":[],"payload":{"tag":"li","lines":"944,945"}},{"content":"Ricevere notifiche sullo stato direttamente in GitHub, email o app mobile.","children":[],"payload":{"tag":"li","lines":"945,946"}}],"payload":{"tag":"li","lines":"943,946"}},{"content":"Questo permette una vera esperienza DevOps GitOps integrata.","children":[],"payload":{"tag":"li","lines":"946,947"}}],"payload":{"tag":"h2","lines":"941,942"}},{"content":"6. Estensioni gi&#xe0; proposte","children":[{"content":"<strong>Lista playbook disponibili</strong>: il backend scandisce la cartella dei playbook o interroga un repo Git e fornisce la lista al frontend.","children":[],"payload":{"tag":"li","lines":"948,949"}},{"content":"<strong>Log dettagliati e streaming websocket</strong>: per mostrare in tempo reale output Ansible e stato task.","children":[],"payload":{"tag":"li","lines":"949,950"}},{"content":"<strong>UI ricca</strong>: gestione dinamica parametri playbook, selezione host/inventory, ruoli utente.","children":[],"payload":{"tag":"li","lines":"950,951"}},{"content":"<strong>Notifiche e integrazioni</strong>: email, Slack, mobile push, webhook.","children":[],"payload":{"tag":"li","lines":"951,952"}}],"payload":{"tag":"h2","lines":"947,948"}}],"payload":{"tag":"h1","lines":"919,920"}},{"content":"Schema riassuntivo","children":[{"content":"<pre data-lines=\"953,961\"><code data-lines=\"953,961\">Utente &lt;--&gt; Frontend Svelte (UI ricca, autenticazione)\n          &lt;--&gt; Backend FastAPI (API REST + websocket)\n               &lt;--&gt; Celery (esecuzione async Ansible playbook)\n                    &lt;--&gt; Ansible (esecuzione YAML)\n               &lt;--&gt; Temporal/Airflow (orchestrazione workflow complessi)\n               &lt;--&gt; GitHub (OAuth, trigger Actions, notifiche)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"953,961"}}],"payload":{"tag":"h1","lines":"952,953"}},{"content":"In sintesi","children":[{"content":"","children":[{"content":"1. <strong>Il backend interpreta e esegue i playbook YAML tramite Ansible, gestendo l&#x2019;orchestrazione.</strong>","children":[],"payload":{"tag":"li","lines":"962,963","listIndex":1}},{"content":"2. <strong>Il frontend permette la gestione interattiva di questi workflow con feedback in tempo reale.</strong>","children":[],"payload":{"tag":"li","lines":"963,964","listIndex":2}},{"content":"3. <strong>La pipeline diventa un insieme di playbook YAML orchestrati con trigger, condizioni e notifiche.</strong>","children":[],"payload":{"tag":"li","lines":"964,965","listIndex":3}},{"content":"4. <strong>L&#x2019;integrazione GitHub Actions garantisce continuit&#xe0; con flussi DevOps esistenti.</strong>","children":[],"payload":{"tag":"li","lines":"965,966","listIndex":4}}],"payload":{"tag":"ol","lines":"962,966"}},{"content":"","children":[{"content":"Implementare la lista playbook disponibili via API","children":[],"payload":{"tag":"li","lines":"966,967"}},{"content":"Implementare streaming log via websocket","children":[],"payload":{"tag":"li","lines":"967,968"}},{"content":"Migliorare UI con selezione host e parametri","children":[],"payload":{"tag":"li","lines":"968,969"}},{"content":"Setup autenticazione GitHub e integrazione notifiche<br>\nOttima domanda, e giusto mettere le cose in prospettiva!","children":[],"payload":{"tag":"li","lines":"969,971"}}],"payload":{"tag":"ul","lines":"966,971"}}],"payload":{"tag":"h1","lines":"961,962"}},{"content":"Stiamo reinventando la ruota con questo frontend per automazione?","children":[{"content":"&#x1f50d; Spiegazione dettagliata:","children":[{"content":"&#x2705; Semaphore:","children":[{"content":"&#xc8; una piattaforma <strong>alternativa</strong> a GitHub Actions.","children":[],"payload":{"tag":"li","lines":"1011,1012"}},{"content":"Ha un proprio sistema di pipeline YAML, runner, job, agent, parallelismo, ecc.","children":[],"payload":{"tag":"li","lines":"1012,1013"}},{"content":"&#xc8; spesso usata <strong>invece di GitHub Actions</strong>, non in combinazione con essa.","children":[],"payload":{"tag":"li","lines":"1013,1014"}}],"payload":{"tag":"h3","lines":"1010,1011"}},{"content":"&#x274c; Non esiste:","children":[{"content":"Un&#x2019;integrazione nativa in cui <strong>GitHub Actions viene orchestrato o gestito da Semaphore</strong>.","children":[],"payload":{"tag":"li","lines":"1015,1016"}},{"content":"Un modo per usare <strong>workflow di GitHub Actions dentro Semaphore</strong>, o viceversa.","children":[],"payload":{"tag":"li","lines":"1016,1017"}}],"payload":{"tag":"h3","lines":"1014,1015"}}],"payload":{"tag":"h2","lines":"1009,1010"}},{"content":"&#x1f501; Per&#xf2; puoi collegarli &quot;indirettamente&quot;","children":[{"content":"&#x2795; Soluzioni ibride (tipiche in progetti avanzati):","children":[{"content":"1. <strong>GitHub Actions come trigger di build Semaphore</strong>","children":[{"content":"Usando <code>curl</code> o <code>webhook</code> GitHub Action per chiamare un endpoint di Semaphore.","children":[],"payload":{"tag":"li","lines":"1020,1021"}},{"content":"Scenario: usi GitHub Actions per l&#x2019;integrazione e triggeri Semaphore per fare build/deploy complessi.","children":[],"payload":{"tag":"li","lines":"1021,1022"}}],"payload":{"tag":"li","lines":"1019,1022","listIndex":1}},{"content":"2. <strong>Semaphore che invoca GitHub Actions</strong>","children":[{"content":"Avvia workflow GitHub via <a href=\"https://docs.github.com/en/rest/actions/workflows\">GitHub REST API</a>.","children":[],"payload":{"tag":"li","lines":"1023,1024"}},{"content":"Potresti farlo da uno step in Semaphore (<code>curl</code>, <code>gh</code> CLI, ecc.).","children":[],"payload":{"tag":"li","lines":"1024,1025"}}],"payload":{"tag":"li","lines":"1022,1025","listIndex":2}}],"payload":{"tag":"h3","lines":"1018,1019"}}],"payload":{"tag":"h2","lines":"1017,1018"}},{"content":"&#x1f504; GitHub Actions vs Semaphore: Ruoli distinti","children":[{"content":"<table data-lines=\"1026,1034\">\n<thead data-lines=\"1026,1027\">\n<tr data-lines=\"1026,1027\">\n<th></th>\n<th><strong>GitHub Actions</strong></th>\n<th><strong>Semaphore</strong></th>\n</tr>\n</thead>\n<tbody data-lines=\"1028,1034\">\n<tr data-lines=\"1028,1029\">\n<td>Integrato in GitHub</td>\n<td>&#x2705; nativamente</td>\n<td>&#x274c; no, &#xe8; esterno</td>\n</tr>\n<tr data-lines=\"1029,1030\">\n<td>DSL</td>\n<td>YAML (<code>.github/workflows/*.yml</code>)</td>\n<td>YAML (<code>semaphore.yml</code>)</td>\n</tr>\n<tr data-lines=\"1030,1031\">\n<td>Runner</td>\n<td>GitHub-hosted o self-hosted</td>\n<td>Runner hosted (cloud) o self-hosted</td>\n</tr>\n<tr data-lines=\"1031,1032\">\n<td>Trigger</td>\n<td>PR, push, tag, schedule, webhook, API</td>\n<td>Trigger via Git, webhook, API</td>\n</tr>\n<tr data-lines=\"1032,1033\">\n<td>Estensibilit&#xe0;</td>\n<td>Enorme ecosistema di Action e plugin</td>\n<td>Meno esteso ma personalizzabile</td>\n</tr>\n<tr data-lines=\"1033,1034\">\n<td>Pricing</td>\n<td>Ottimo per progetti open source</td>\n<td>Pi&#xf9; flessibile per team enterprise</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1026,1034"}}],"payload":{"tag":"h2","lines":"1025,1026"}},{"content":"&#x2705; Conclusione","children":[{"content":"<strong>Semaphore &#x2260; orchestratore di GitHub Actions</strong>","children":[],"payload":{"tag":"li","lines":"1035,1036"}},{"content":"Piuttosto: <strong>sono concorrenti</strong> e <strong>scelte alternative</strong>.","children":[],"payload":{"tag":"li","lines":"1036,1037"}},{"content":"Se vuoi <strong>usare GitHub Actions</strong>, ti conviene costruire l&#x2019;app intorno a <strong>GitHub come sistema centrale</strong>, integrando eventualmente esecuzioni custom da backend tuo (es. per Ansible, OpenTofu, ecc.).","children":[],"payload":{"tag":"li","lines":"1037,1038"}},{"content":"Se vuoi un <strong>CI/CD completamente personalizzabile</strong>, <strong>il tuo stack FastAPI + Ansible + Svelte</strong> potrebbe completare o estendere Actions o Semaphore, <strong>non duplicarli</strong>.<br>\nVuoi che ti mostri un esempio pratico in cui <strong>GitHub Actions triggera la tua API backend</strong> per eseguire playbook Ansible?<br>\ngit mi piace ma non voglio legarmi a github. semaphore o ho altre alternative?","children":[],"payload":{"tag":"li","lines":"1038,1041"}}],"payload":{"tag":"h2","lines":"1034,1035"}}],"payload":{"tag":"h1","lines":"971,972"}},{"content":"&#x2705; Riepilogo: Git s&#xec;, GitHub no &#x2014; che alternative hai?","children":[{"content":"&#x1f527; CI/CD + Workflow Engine alternativi (self-hosted o cloud)","children":[{"content":"<table data-lines=\"1044,1054\">\n<thead data-lines=\"1044,1045\">\n<tr data-lines=\"1044,1045\">\n<th>Nome</th>\n<th>Hosted / Self-hosted</th>\n<th>Note principali</th>\n</tr>\n</thead>\n<tbody data-lines=\"1046,1054\">\n<tr data-lines=\"1046,1047\">\n<td><strong>GitLab CI</strong></td>\n<td>&#x2705; entrambi</td>\n<td>YAML simile a GitHub, potente, integrato</td>\n</tr>\n<tr data-lines=\"1047,1048\">\n<td><strong>Woodpecker CI</strong></td>\n<td>&#x2705; self-hosted</td>\n<td>Minimal, leggero, fork di Drone CI</td>\n</tr>\n<tr data-lines=\"1048,1049\">\n<td><strong>Drone CI</strong></td>\n<td>&#x2705; self-hosted / SaaS</td>\n<td>Pipeline via YAML, container-native</td>\n</tr>\n<tr data-lines=\"1049,1050\">\n<td><strong>Jenkins</strong></td>\n<td>&#x2705; self-hosted</td>\n<td>Storico, estendibile, complesso per&#xf2; potente</td>\n</tr>\n<tr data-lines=\"1050,1051\">\n<td><strong>Buildkite</strong></td>\n<td>&#x2705; SaaS</td>\n<td>Git-agnostic, potente, usato da aziende top</td>\n</tr>\n<tr data-lines=\"1051,1052\">\n<td><strong>Tekton</strong></td>\n<td>&#x2705; Kubernetes-native</td>\n<td>Da Red Hat, cloud-native, estendibile</td>\n</tr>\n<tr data-lines=\"1052,1053\">\n<td><strong>Argo Workflows / Argo CD</strong></td>\n<td>&#x2705; cloud-native</td>\n<td>CI/CD su Kubernetes con dichiarativit&#xe0; spinta</td>\n</tr>\n<tr data-lines=\"1053,1054\">\n<td><strong>Concourse CI</strong></td>\n<td>&#x2705; container-native</td>\n<td>Pipeline come codice, compatibile Git</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1044,1054"}}],"payload":{"tag":"h2","lines":"1043,1044"}},{"content":"&#x2728; Lightweight / developer-friendly","children":[{"content":"<table data-lines=\"1055,1060\">\n<thead data-lines=\"1055,1056\">\n<tr data-lines=\"1055,1056\">\n<th>Nome</th>\n<th>Tipo</th>\n<th>Vantaggi principali</th>\n</tr>\n</thead>\n<tbody data-lines=\"1057,1060\">\n<tr data-lines=\"1057,1058\">\n<td><strong>Gitea Actions</strong></td>\n<td>Built-in CI in Gitea</td>\n<td>Se usi Gitea, integrazione nativa</td>\n</tr>\n<tr data-lines=\"1058,1059\">\n<td><strong>Dagger</strong></td>\n<td>CI/CD programmable via SDK (Go, Python, Node)</td>\n<td>Puoi comporre pipeline come codice</td>\n</tr>\n<tr data-lines=\"1059,1060\">\n<td><strong>Earthly</strong></td>\n<td>CI/CD container-based</td>\n<td>Semplifica e standardizza Docker + CI</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1055,1060"}}],"payload":{"tag":"h2","lines":"1054,1055"}},{"content":"&#x1f517; Git Hosting alternativi a GitHub","children":[{"content":"<table data-lines=\"1061,1068\">\n<thead data-lines=\"1061,1062\">\n<tr data-lines=\"1061,1062\">\n<th>Nome</th>\n<th>Tipo</th>\n<th>Note</th>\n</tr>\n</thead>\n<tbody data-lines=\"1063,1068\">\n<tr data-lines=\"1063,1064\">\n<td><strong>GitLab CE</strong></td>\n<td>Self-hosted</td>\n<td>Completo, con CI integrata</td>\n</tr>\n<tr data-lines=\"1064,1065\">\n<td><strong>Gitea</strong></td>\n<td>Self-hosted</td>\n<td>Leggero, veloce, open source</td>\n</tr>\n<tr data-lines=\"1065,1066\">\n<td><strong>Forgejo</strong></td>\n<td>Gitea fork</td>\n<td>Pi&#xf9; community-driven</td>\n</tr>\n<tr data-lines=\"1066,1067\">\n<td><strong>Bitbucket</strong></td>\n<td>SaaS</td>\n<td>Proprietario Atlassian</td>\n</tr>\n<tr data-lines=\"1067,1068\">\n<td><strong>SourceHut</strong></td>\n<td>SaaS</td>\n<td>Minimalista, shell-based</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1061,1068"}}],"payload":{"tag":"h2","lines":"1060,1061"}},{"content":"&#x1f680; E quindi cosa puoi fare tu?","children":[{"content":"&#x2705; Stack possibile (libero da GitHub):","children":[{"content":"Git Hosting:","children":[{"content":"<strong>Gitea</strong> (self-hosted, leggero)","children":[],"payload":{"tag":"li","lines":"1073,1074"}},{"content":"o <strong>GitLab CE</strong>","children":[],"payload":{"tag":"li","lines":"1074,1075"}}],"payload":{"tag":"h4","lines":"1072,1073"}},{"content":"CI/CD:","children":[{"content":"<strong>Woodpecker CI</strong>: se vuoi semplicit&#xe0; YAML","children":[],"payload":{"tag":"li","lines":"1076,1077"}},{"content":"o <strong>Drone CI</strong> (usato anche in aziende)","children":[],"payload":{"tag":"li","lines":"1077,1078"}},{"content":"o <strong>GitLab CI</strong> se gi&#xe0; usi GitLab","children":[],"payload":{"tag":"li","lines":"1078,1079"}}],"payload":{"tag":"h4","lines":"1075,1076"}},{"content":"Automazione:","children":[{"content":"La tua app con <strong>FastAPI + Celery + Ansible/OpenTofu</strong>","children":[],"payload":{"tag":"li","lines":"1080,1081"}},{"content":"Eventuali workflow orchestrati con <strong>Argo / Temporal / Airflow</strong>","children":[],"payload":{"tag":"li","lines":"1081,1082"}},{"content":"Notifiche: via webhook, email, Slack, o bot personalizzati","children":[],"payload":{"tag":"li","lines":"1082,1083"}}],"payload":{"tag":"h4","lines":"1079,1080"}}],"payload":{"tag":"h3","lines":"1071,1072"}},{"content":"&#x1f4e6; Esempio flusso completo:","children":[{"content":"<pre data-lines=\"1084,1093\"><code class=\"language-text\">&#x26ed; Git Hosting &#x2192; [Gitea]\n       &#x2193; webhook\n&#x1f680; CI/CD trigger &#x2192; [Woodpecker / Drone CI]\n       &#x2193; chiamata HTTP\n&#x2699;&#xfe0f; API FastAPI &#x2192; Esegue YAML con Ansible/OpenTofu\n       &#x2193;\n&#x1f4e2; Risultati &#x2192; Frontend (Svelte), + log, + notifiche\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1084,1093"}}],"payload":{"tag":"h3","lines":"1083,1084"}},{"content":"&#x1f512; Bonus: Tutto self-hosted, tutto tuo.","children":[{"content":"100% <strong>indipendente da GitHub</strong>","children":[],"payload":{"tag":"li","lines":"1095,1096"}},{"content":"Con <strong>file YAML come interfaccia principale</strong>","children":[],"payload":{"tag":"li","lines":"1096,1097"}},{"content":"Completamente estensibile","children":[],"payload":{"tag":"li","lines":"1097,1098"}},{"content":"Open Source (o quasi tutto)","children":[],"payload":{"tag":"li","lines":"1098,1099"}}],"payload":{"tag":"h3","lines":"1093,1094"}}],"payload":{"tag":"h2","lines":"1068,1069"}},{"content":"Vuoi che ti aiuti a progettare uno stack specifico tra questi?","children":[{"content":"Gitea + Woodpecker","children":[],"payload":{"tag":"li","lines":"1101,1102"}},{"content":"o Gitea + Drone + tua app FastAPI","children":[],"payload":{"tag":"li","lines":"1102,1103"}},{"content":"o Gitea + ArgoCD + runner custom<br>\nOttimo: se <strong>Gitea non ti convince</strong>, ci sono valide alternative <strong>open source</strong>, alcune pi&#xf9; moderne, altre pi&#xf9; community-driven. Ti elenco e confronto le principali, con attenzione a:","children":[],"payload":{"tag":"li","lines":"1103,1105"}},{"content":"supporto CI/CD","children":[],"payload":{"tag":"li","lines":"1105,1106"}},{"content":"apertura allo standard Git","children":[],"payload":{"tag":"li","lines":"1106,1107"}},{"content":"integrazione con strumenti esterni (es. Ansible, GitHub Actions, ecc.)","children":[],"payload":{"tag":"li","lines":"1107,1108"}},{"content":"supporto attivo e futuro sostenibile","children":[],"payload":{"tag":"li","lines":"1108,1109"}}],"payload":{"tag":"h2","lines":"1099,1100"}},{"content":"&#x2705; 1. <strong>Forgejo</strong> (consigliata)","children":[{"content":"<table data-lines=\"1110,1120\">\n<thead data-lines=\"1110,1111\">\n<tr data-lines=\"1110,1111\">\n<th></th>\n<th>Descrizione</th>\n</tr>\n</thead>\n<tbody data-lines=\"1112,1120\">\n<tr data-lines=\"1112,1113\">\n<td><strong>Origine</strong></td>\n<td>Fork community-driven di Gitea (a causa del crescente controllo aziendale su Gitea da parte di Gitea Ltd)</td>\n</tr>\n<tr data-lines=\"1113,1114\">\n<td><strong>Licenza</strong></td>\n<td>100% open source (MIT), no lock-in</td>\n</tr>\n<tr data-lines=\"1114,1115\">\n<td><strong>UI/UX</strong></td>\n<td>Identica a Gitea ma con fix e roadmap indipendente</td>\n</tr>\n<tr data-lines=\"1115,1116\">\n<td><strong>Integrazioni</strong></td>\n<td>GitHub Actions compatibili tramite <a href=\"https://github.com/forgejo/runner\">act runner</a> (in beta ma funziona)</td>\n</tr>\n<tr data-lines=\"1116,1117\">\n<td><strong>CI/CD</strong></td>\n<td>Integrato (Forgejo Actions), ispirato a GitHub Actions</td>\n</tr>\n<tr data-lines=\"1117,1118\">\n<td><strong>Hosting</strong></td>\n<td>Self-hosted, lightweight</td>\n</tr>\n<tr data-lines=\"1118,1119\">\n<td><strong>Note</strong></td>\n<td>&#xc8; oggi l&#x2019;opzione <em>pi&#xf9; vicina a GitHub self-hosted + Actions open source</em></td>\n</tr>\n<tr data-lines=\"1119,1120\">\n<td>&#x27a1;&#xfe0f; Se vuoi <strong>Git + UI GitHub-like + YAML Actions</strong>: <strong>Forgejo &#xe8; oggi la scelta open source migliore.</strong></td>\n<td></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1110,1120"}}],"payload":{"tag":"h2","lines":"1109,1110"}},{"content":"&#x2705; 2. <strong>SourceHut</strong> (sorgente hut)","children":[{"content":"<table data-lines=\"1121,1130\">\n<thead data-lines=\"1121,1122\">\n<tr data-lines=\"1121,1122\">\n<th></th>\n<th>Descrizione</th>\n</tr>\n</thead>\n<tbody data-lines=\"1123,1130\">\n<tr data-lines=\"1123,1124\">\n<td><strong>Origine</strong></td>\n<td>Creato da Drew DeVault, orientato a minimalismo, controllo da shell</td>\n</tr>\n<tr data-lines=\"1124,1125\">\n<td><strong>UI/UX</strong></td>\n<td>Nessuna UI JavaScript, tutto testuale (anche pipeline)</td>\n</tr>\n<tr data-lines=\"1125,1126\">\n<td><strong>CI/CD</strong></td>\n<td>Integrato (builds.sr.ht), YAML + scripting shell</td>\n</tr>\n<tr data-lines=\"1126,1127\">\n<td><strong>Filosofia</strong></td>\n<td>Massimo controllo, niente lock-in, niente bullshit</td>\n</tr>\n<tr data-lines=\"1127,1128\">\n<td><strong>Hosting</strong></td>\n<td>SaaS o self-hosted (richiede un po&#x2019; di setup)</td>\n</tr>\n<tr data-lines=\"1128,1129\">\n<td><strong>Adatto a</strong></td>\n<td>Sviluppatori esperti, team UNIX-oriented, dev terminal-centrici</td>\n</tr>\n<tr data-lines=\"1129,1130\">\n<td>&#x27a1;&#xfe0f; Se cerchi <strong>massimo controllo + scriptability + leggerezza assoluta</strong>, &#xe8; un&#x2019;ottima scelta, ma non per tutti.</td>\n<td></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1121,1130"}}],"payload":{"tag":"h2","lines":"1120,1121"}},{"content":"&#x2705; 3. <strong>GitLab CE / EE</strong>","children":[{"content":"<table data-lines=\"1131,1140\">\n<thead data-lines=\"1131,1132\">\n<tr data-lines=\"1131,1132\">\n<th></th>\n<th>Descrizione</th>\n</tr>\n</thead>\n<tbody data-lines=\"1133,1140\">\n<tr data-lines=\"1133,1134\">\n<td><strong>Licenza</strong></td>\n<td>CE &#xe8; open source (MIT), EE &#xe8; a pagamento</td>\n</tr>\n<tr data-lines=\"1134,1135\">\n<td><strong>UI/UX</strong></td>\n<td>Completa, simile a GitHub</td>\n</tr>\n<tr data-lines=\"1135,1136\">\n<td><strong>CI/CD</strong></td>\n<td>Estremamente potente, con runner flessibili e pipeline YAML</td>\n</tr>\n<tr data-lines=\"1136,1137\">\n<td><strong>Integrazioni</strong></td>\n<td>Forte supporto per Ansible, Terraform, Docker, Kubernetes, ecc.</td>\n</tr>\n<tr data-lines=\"1137,1138\">\n<td><strong>Hosting</strong></td>\n<td>Cloud o self-hosted (pi&#xf9; pesante di Forgejo/Gitea)</td>\n</tr>\n<tr data-lines=\"1138,1139\">\n<td><strong>Note</strong></td>\n<td>Richiede risorse, ma &#xe8; una suite completa all-in-one</td>\n</tr>\n<tr data-lines=\"1139,1140\">\n<td>&#x27a1;&#xfe0f; Se vuoi <strong>una suite DevOps potente, GitLab CE &#xe8; stabile e ben mantenuta</strong>, anche se pesante da gestire.</td>\n<td></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1131,1140"}}],"payload":{"tag":"h2","lines":"1130,1131"}},{"content":"&#x2705; 4. <strong>Pagure</strong> (da Red Hat, ma poco attivo)","children":[{"content":"<table data-lines=\"1141,1149\">\n<thead data-lines=\"1141,1142\">\n<tr data-lines=\"1141,1142\">\n<th></th>\n<th>Descrizione</th>\n</tr>\n</thead>\n<tbody data-lines=\"1143,1149\">\n<tr data-lines=\"1143,1144\">\n<td><strong>Origine</strong></td>\n<td>Utilizzato da Fedora, Red Hat, ecc.</td>\n</tr>\n<tr data-lines=\"1144,1145\">\n<td><strong>Licenza</strong></td>\n<td>MIT</td>\n</tr>\n<tr data-lines=\"1145,1146\">\n<td><strong>UI/UX</strong></td>\n<td>Buona ma datata</td>\n</tr>\n<tr data-lines=\"1146,1147\">\n<td><strong>CI/CD</strong></td>\n<td>Limitato, devi integrare sistemi esterni (es. Jenkins)</td>\n</tr>\n<tr data-lines=\"1147,1148\">\n<td><strong>Note</strong></td>\n<td>Progetto in declino, sviluppo molto rallentato</td>\n</tr>\n<tr data-lines=\"1148,1149\">\n<td>&#x27a1;&#xfe0f; Evitabile oggi, salvo motivazioni specifiche (es. contributi a Fedora o affinit&#xe0; Red Hat).</td>\n<td></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1141,1149"}}],"payload":{"tag":"h2","lines":"1140,1141"}},{"content":"&#x2705; 5. <strong>Codeberg (basato su Forgejo)</strong>","children":[{"content":"<table data-lines=\"1150,1157\">\n<thead data-lines=\"1150,1151\">\n<tr data-lines=\"1150,1151\">\n<th></th>\n<th>Descrizione</th>\n</tr>\n</thead>\n<tbody data-lines=\"1152,1157\">\n<tr data-lines=\"1152,1153\">\n<td><strong>Tipo</strong></td>\n<td>Hosting gratuito e open, gestito da no-profit</td>\n</tr>\n<tr data-lines=\"1153,1154\">\n<td><strong>Motore</strong></td>\n<td>Forgejo</td>\n</tr>\n<tr data-lines=\"1154,1155\">\n<td><strong>CI/CD</strong></td>\n<td>Forgejo Actions</td>\n</tr>\n<tr data-lines=\"1155,1156\">\n<td><strong>Ideale per</strong></td>\n<td>Progetti pubblici, piccoli team indipendenti</td>\n</tr>\n<tr data-lines=\"1156,1157\">\n<td>&#x27a1;&#xfe0f; Se non vuoi self-hosting ma vuoi evitare GitHub, <strong>Codeberg</strong> &#xe8; l&#x2019;hosting pubblico Forgejo pi&#xf9; etico e open.</td>\n<td></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1150,1157"}}],"payload":{"tag":"h2","lines":"1149,1150"}},{"content":"Confronto sintetico","children":[{"content":"<table data-lines=\"1158,1165\">\n<thead data-lines=\"1158,1159\">\n<tr data-lines=\"1158,1159\">\n<th>Nome</th>\n<th>CI/CD integrata</th>\n<th>GitHub Actions compatibili</th>\n<th>UI moderna</th>\n<th>Self-hosted leggero</th>\n<th>Attivit&#xe0; progetto</th>\n</tr>\n</thead>\n<tbody data-lines=\"1160,1165\">\n<tr data-lines=\"1160,1161\">\n<td><strong>Forgejo</strong></td>\n<td>&#x2705; Forgejo Actions</td>\n<td>&#x2705; (act runner)</td>\n<td>&#x2705;</td>\n<td>&#x2705;</td>\n<td>&#x1f7e2; attivo, community</td>\n</tr>\n<tr data-lines=\"1161,1162\">\n<td><strong>SourceHut</strong></td>\n<td>&#x2705; sr.ht builds</td>\n<td>&#x274c;</td>\n<td>&#x274c;</td>\n<td>&#x2705; (solo se shell-first)</td>\n<td>&#x1f7e2; attivo, stabile</td>\n</tr>\n<tr data-lines=\"1162,1163\">\n<td><strong>GitLab CE</strong></td>\n<td>&#x2705; GitLab CI</td>\n<td>&#x274c;</td>\n<td>&#x2705;</td>\n<td>&#x26a0;&#xfe0f; pesante</td>\n<td>&#x1f7e2; molto attivo</td>\n</tr>\n<tr data-lines=\"1163,1164\">\n<td><strong>Pagure</strong></td>\n<td>&#x274c; (CI esterna)</td>\n<td>&#x274c;</td>\n<td>&#x26a0;&#xfe0f; datata</td>\n<td>&#x2705;</td>\n<td>&#x1f534; poco attivo</td>\n</tr>\n<tr data-lines=\"1164,1165\">\n<td><strong>Codeberg</strong></td>\n<td>&#x2705; (Forgejo hosted)</td>\n<td>&#x2705;</td>\n<td>&#x2705;</td>\n<td>&#x274c; (non self-hosted)</td>\n<td>&#x1f7e2; stabile</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1158,1165"}}],"payload":{"tag":"h2","lines":"1157,1158"}},{"content":"&#x1f525; Raccomandazione finale","children":[{"content":"100% open source","children":[],"payload":{"tag":"li","lines":"1169,1170"}},{"content":"GitHub Actions compatibile (runner incluso)","children":[],"payload":{"tag":"li","lines":"1170,1171"}},{"content":"leggero come Gitea, ma mantenuto da una community etica","children":[],"payload":{"tag":"li","lines":"1171,1172"}},{"content":"pronto per essere esteso/integrato col tuo backend Ansible/OpenTofu","children":[],"payload":{"tag":"li","lines":"1172,1173"}}],"payload":{"tag":"h2","lines":"1165,1166"}},{"content":"Vuoi che ti aiuti a:","children":[{"content":"","children":[{"content":"creare uno stack <strong>Forgejo + act-runner</strong> (CI/CD YAML)?","children":[],"payload":{"tag":"li","lines":"1174,1175"}},{"content":"integrarlo col tuo backend (FastAPI + Celery)?","children":[],"payload":{"tag":"li","lines":"1175,1176"}},{"content":"costruire pipeline dichiarative collegate a Git push?<br>\nPosso anche generarti un <code>docker-compose.yml</code> pronto per deploy locale o su VPS.<br>\nDimmi solo dove vuoi partire.","children":[],"payload":{"tag":"li","lines":"1176,1179"}}],"payload":{"tag":"ul","lines":"1174,1179"}},{"content":"","children":[{"content":"creare uno stack Forgejo + act-runner (CI/CD YAML)","children":[],"payload":{"tag":"li","lines":"1179,1180"}},{"content":"integrarlo col tuo backend (FastAPI + Celery)","children":[],"payload":{"tag":"li","lines":"1180,1181"}},{"content":"costruire pipeline dichiarative collegate a Git push","children":[],"payload":{"tag":"li","lines":"1181,1182"}},{"content":"frontend con codebergPages-server","children":[],"payload":{"tag":"li","lines":"1182,1183"}},{"content":"un docker-compose.yml pronto per deploy locale o su VPS ed una alternativa docker-compose_traefik.yml con reverse proxy<br>\nPer procedere con la generazione dello stack richiesto in un file <code>docker-compose.yml</code> (con variante per Traefik), e l&#x2019;integrazione tra Forgejo, act-runner, FastAPI, Celery e frontend su Codeberg Pages-style, &#xe8; necessario <strong>usare ChatGPT Canvas</strong>.<br>\n&#x1f512; <strong>Accedi a ChatGPT per attivare questa funzione</strong>.<br>\nUna volta dentro, posso generare per te:","children":[],"payload":{"tag":"li","lines":"1183,1187"}}],"payload":{"tag":"ul","lines":"1179,1187"}},{"content":"","children":[{"content":"<code>docker-compose.yml</code>: stack base con Forgejo + runner + backend + redis + worker","children":[],"payload":{"tag":"li","lines":"1187,1188"}},{"content":"<code>docker-compose.traefik.yml</code>: variante con Traefik come reverse proxy (autoconfigurabile con label)","children":[],"payload":{"tag":"li","lines":"1188,1189"}},{"content":"<code>ci.yml</code> di esempio per pipeline compatibile GitHub Actions","children":[],"payload":{"tag":"li","lines":"1189,1190"}},{"content":"Struttura del frontend statico + server leggero per deploy tipo CodebergPages","children":[],"payload":{"tag":"li","lines":"1190,1191"}}],"payload":{"tag":"ul","lines":"1187,1191"}},{"content":"","children":[{"content":"1. Una descrizione chiara e dettagliata nel file <code>README.md</code>, comprensiva di:","children":[{"content":"Obiettivi del progetto","children":[],"payload":{"tag":"li","lines":"1192,1193"}},{"content":"Contesto e finalit&#xe0;","children":[],"payload":{"tag":"li","lines":"1193,1194"}},{"content":"Istruzioni per l&#x2019;installazione, l&#x2019;uso e l&#x2019;eventuale distribuzione","children":[],"payload":{"tag":"li","lines":"1194,1195"}},{"content":"Tecnologie utilizzate","children":[],"payload":{"tag":"li","lines":"1195,1196"}}],"payload":{"tag":"li","lines":"1191,1196","listIndex":1}},{"content":"2. La struttura completa delle cartelle e dei file del progetto, con un layout coerente e facilmente navigabile.","children":[],"payload":{"tag":"li","lines":"1196,1197","listIndex":2}},{"content":"3. Il codice sorgente completo e funzionante, incluso:","children":[{"content":"Tutti gli script o moduli principali","children":[],"payload":{"tag":"li","lines":"1198,1199"}},{"content":"Funzioni ben commentate e documentate","children":[],"payload":{"tag":"li","lines":"1199,1200"}},{"content":"Eventuali file di configurazione (<code>.env.example</code>, <code>config.json</code>, <code>settings.py</code>, ecc.)","children":[],"payload":{"tag":"li","lines":"1200,1201"}}],"payload":{"tag":"li","lines":"1197,1201","listIndex":3}},{"content":"4. Eventuali risorse accessorie:","children":[{"content":"Esempi d&#x2019;uso (<code>examples/</code>)","children":[],"payload":{"tag":"li","lines":"1202,1203"}},{"content":"Script di test o automazione (<code>tests/</code>, <code>scripts/</code>)","children":[],"payload":{"tag":"li","lines":"1203,1204"}},{"content":"Dipendenze elencate (<code>requirements.txt</code>, <code>package.json</code>, ecc.)","children":[],"payload":{"tag":"li","lines":"1204,1205"}}],"payload":{"tag":"li","lines":"1201,1205","listIndex":4}},{"content":"5. Un file <code>.gitignore</code> coerente con il progetto","children":[],"payload":{"tag":"li","lines":"1205,1206","listIndex":5}},{"content":"6. Licenza del progetto (<code>LICENSE</code>), preferibilmente una licenza open-source<br>\nL&#x2019;output deve essere completo, dettagliato e pronto per essere copiato/incollato come base per un vero repository su GitHub. Assicurati di non tralasciare nulla e di integrare tutte le informazioni discusse in chat in modo organico.","children":[],"payload":{"tag":"li","lines":"1206,1208","listIndex":6}}],"payload":{"tag":"ol","lines":"1191,1208"}}],"payload":{"tag":"h2","lines":"1173,1174"}}],"payload":{"tag":"h1","lines":"1041,1042"}},{"content":"&#x1f4c1; <strong>Struttura del progetto</strong>","children":[{"content":"<pre data-lines=\"1209,1241\"><code data-lines=\"1209,1241\">infrastructure-automation-app/\n&#x251c;&#x2500;&#x2500; README<span class=\"hljs-selector-class\">.md</span>\n&#x251c;&#x2500;&#x2500; LICENSE\n&#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-class\">.gitignore</span>\n&#x251c;&#x2500;&#x2500; docker-compose<span class=\"hljs-selector-class\">.yml</span>\n&#x251c;&#x2500;&#x2500; docker-compose<span class=\"hljs-selector-class\">.traefik</span><span class=\"hljs-selector-class\">.yml</span>\n&#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-class\">.env</span><span class=\"hljs-selector-class\">.example</span>\n&#x251c;&#x2500;&#x2500; backend/\n&#x2502;   &#x251c;&#x2500;&#x2500; app/\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-tag\">main</span><span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; worker<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; tasks<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; config<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; utils<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; requirements<span class=\"hljs-selector-class\">.txt</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; tests/\n&#x2502;       &#x2514;&#x2500;&#x2500; test_tasks<span class=\"hljs-selector-class\">.py</span>\n&#x251c;&#x2500;&#x2500; frontend/\n&#x2502;   &#x251c;&#x2500;&#x2500; public/\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; index<span class=\"hljs-selector-class\">.html</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; pages-server/\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; server<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; README<span class=\"hljs-selector-class\">.md</span>\n&#x251c;&#x2500;&#x2500; ci/\n&#x2502;   &#x2514;&#x2500;&#x2500; forgejo-workflows/\n&#x2502;       &#x2514;&#x2500;&#x2500; default<span class=\"hljs-selector-class\">.yml</span>\n&#x251c;&#x2500;&#x2500; examples/\n&#x2502;   &#x2514;&#x2500;&#x2500; playbook-sample<span class=\"hljs-selector-class\">.yml</span>\n&#x2514;&#x2500;&#x2500; scripts/\n    &#x2514;&#x2500;&#x2500; bootstrap<span class=\"hljs-selector-class\">.sh</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1209,1241"}}],"payload":{"tag":"h1","lines":"1208,1209"}},{"content":"&#x1f4dd; <code>README.md</code>","children":[{"content":"&#x1f9ea; Test","children":[{"content":"<pre data-lines=\"1303,1306\"><code class=\"language-bash\">docker-compose <span class=\"hljs-built_in\">exec</span> backend pytest\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1303,1306"}}],"payload":{"tag":"h2","lines":"1301,1302"}},{"content":"&#x1f9ec; Esecuzione Playbook","children":[{"content":"I file <code>.yml</code> vengono interpretati dal backend","children":[],"payload":{"tag":"li","lines":"1311,1312"}},{"content":"Sono eseguiti tramite Ansible in sandbox (via Celery worker)","children":[],"payload":{"tag":"li","lines":"1312,1313"}},{"content":"Output streammato via WebSocket","children":[],"payload":{"tag":"li","lines":"1313,1315"}}],"payload":{"tag":"h2","lines":"1309,1310"}},{"content":"&#x1f517; CI/CD con Forgejo","children":[{"content":"1. Clona il repository in un&apos;istanza Forgejo","children":[],"payload":{"tag":"li","lines":"1319,1320","listIndex":1}},{"content":"2. Usa la directory <code>ci/forgejo-workflows/default.yml</code>","children":[],"payload":{"tag":"li","lines":"1320,1321","listIndex":2}},{"content":"3. Il runner act &#xe8; gi&#xe0; incluso nel <code>docker-compose.yml</code>","children":[],"payload":{"tag":"li","lines":"1321,1323","listIndex":3}}],"payload":{"tag":"h2","lines":"1317,1318"}},{"content":"&#x1f9f0; Integrazione Git e Pipeline","children":[{"content":"Git push &#x2192; trigger su Forgejo CI &#x2192; webhook &#x2192; backend","children":[],"payload":{"tag":"li","lines":"1327,1328"}},{"content":"Il backend esegue il playbook definito","children":[],"payload":{"tag":"li","lines":"1328,1329"}},{"content":"Logs in tempo reale disponibili via WebSocket","children":[],"payload":{"tag":"li","lines":"1329,1331"}}],"payload":{"tag":"h2","lines":"1325,1326"}},{"content":"&#x1f5bc;&#xfe0f; Frontend","children":[{"content":"Interfaccia semplice e reattiva","children":[],"payload":{"tag":"li","lines":"1335,1336"}},{"content":"Static site servito via <code>frontend/pages-server/server.py</code>","children":[],"payload":{"tag":"li","lines":"1336,1337"}},{"content":"Supporto a log, selezione playbook, parametri","children":[],"payload":{"tag":"li","lines":"1337,1339"}}],"payload":{"tag":"h2","lines":"1333,1334"}},{"content":"&#x1f4e6; Distribuzione","children":[{"content":"\n<p data-lines=\"1343,1344\">Puoi pubblicare il frontend statico su:</p>","children":[{"content":"Codeberg Pages","children":[],"payload":{"tag":"li","lines":"1345,1346"}},{"content":"GitHub Pages","children":[],"payload":{"tag":"li","lines":"1346,1347"}},{"content":"qualsiasi CDN o server web","children":[],"payload":{"tag":"li","lines":"1347,1348"}}],"payload":{"tag":"li","lines":"1343,1348"}},{"content":"\n<p data-lines=\"1348,1349\">Il backend &#xe8; self-hosted con Docker</p>","children":[],"payload":{"tag":"li","lines":"1348,1350"}}],"payload":{"tag":"h2","lines":"1341,1342"}},{"content":"&#x1faaa; Licenza","children":[],"payload":{"tag":"h2","lines":"1352,1353"}},{"content":"&#x1f4c1; Struttura file","children":[{"content":"<pre data-lines=\"1362,1380\"><code data-lines=\"1362,1380\"><span class=\"hljs-comment\"># &#x1f4dd; `.gitignore`</span>\n```gitignore\n__pycache__/\n*<span class=\"hljs-string\">.pyc</span>\n*<span class=\"hljs-string\">.pyo</span>\n<span class=\"hljs-string\">.env</span>\n<span class=\"hljs-string\">.env.</span>*\n<span class=\"hljs-string\">.vscode/</span>\n<span class=\"hljs-string\">.idea/</span>\n*<span class=\"hljs-string\">.log</span>\n*<span class=\"hljs-string\">.sqlite3</span>\ncelerybeat-schedule\nnode_modules/\ndist/\nbuild/\nfrontend/public/*<span class=\"hljs-string\">.js</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1362,1380"}}],"payload":{"tag":"h2","lines":"1358,1359"}}],"payload":{"tag":"h1","lines":"1241,1242"}},{"content":"&#x1f9ea; <code>.env.example</code>","children":[{"content":"<pre data-lines=\"1381,1388\"><code class=\"language-env\">FASTAPI_HOST=0.0.0.0\nFASTAPI_PORT=8000\nREDIS_URL=redis://redis:6379/0\nFORGEJO_URL=http://forgejo:3000\nACT_RUNNER_TOKEN=changeme\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1381,1388"}}],"payload":{"tag":"h1","lines":"1380,1381"}},{"content":"&#x2699;&#xfe0f; <code>docker-compose.yml</code>","children":[{"content":"<pre data-lines=\"1389,1435\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&apos;3.8&apos;</span>\n\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:alpine</span>\n    <span class=\"hljs-attr\">ports:</span> [ <span class=\"hljs-string\">&quot;6379:6379&quot;</span> ]\n\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=&#x24;{REDIS_URL}</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./examples:/app/playbooks</span>\n    <span class=\"hljs-attr\">depends_on:</span> [ <span class=\"hljs-string\">redis</span> ]\n    <span class=\"hljs-attr\">ports:</span> [ <span class=\"hljs-string\">&quot;8000:8000&quot;</span> ]\n\n  <span class=\"hljs-attr\">celery-worker:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">-A</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">--loglevel=info</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=&#x24;{REDIS_URL}</span>\n    <span class=\"hljs-attr\">depends_on:</span> [ <span class=\"hljs-string\">redis</span>, <span class=\"hljs-string\">backend</span> ]\n\n  <span class=\"hljs-attr\">forgejo:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">codeberg.org/forgejo/forgejo:latest</span>\n    <span class=\"hljs-attr\">ports:</span> [ <span class=\"hljs-string\">&quot;3000:3000&quot;</span>, <span class=\"hljs-string\">&quot;22:22&quot;</span> ]\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">forgejo_data:/data</span>\n\n  <span class=\"hljs-attr\">act-runner:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">forgejo/act-runner:latest</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/var/run/docker.sock:/var/run/docker.sock</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">FORGEJO_INSTANCE=http://forgejo:3000</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">FORGEJO_TOKEN=&#x24;{ACT_RUNNER_TOKEN}</span>\n    <span class=\"hljs-attr\">depends_on:</span> [ <span class=\"hljs-string\">forgejo</span> ]\n\n  <span class=\"hljs-attr\">pages-server:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./frontend/pages-server</span>\n    <span class=\"hljs-attr\">ports:</span> [ <span class=\"hljs-string\">&quot;8080:80&quot;</span> ]\n\n<span class=\"hljs-attr\">volumes:</span>\n  <span class=\"hljs-attr\">forgejo_data:</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1389,1435"}}],"payload":{"tag":"h1","lines":"1388,1389"}},{"content":"&#x2699;&#xfe0f; <code>docker-compose.traefik.yml</code> (con Traefik)","children":[{"content":"<pre data-lines=\"1436,1463\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&apos;3.8&apos;</span>\n\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">traefik:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">traefik:v2.9</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;80:80&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;443:443&quot;</span>\n    <span class=\"hljs-attr\">command:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;--api.insecure=true&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;--providers.docker=true&quot;</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/var/run/docker.sock:/var/run/docker.sock</span>\n\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">labels:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.backend.rule=Host(`api.localhost`)&quot;</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=&#x24;{REDIS_URL}</span>\n\n  <span class=\"hljs-attr\">pages-server:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./frontend/pages-server</span>\n    <span class=\"hljs-attr\">labels:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.frontend.rule=Host(`frontend.localhost`)&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1436,1463"}}],"payload":{"tag":"h1","lines":"1435,1436"}},{"content":"&#x1f40d; <code>backend/app/main.py</code>","children":[{"content":"<pre data-lines=\"1464,1484\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI\n<span class=\"hljs-keyword\">from</span> fastapi.responses <span class=\"hljs-keyword\">import</span> JSONResponse\n<span class=\"hljs-keyword\">from</span> tasks <span class=\"hljs-keyword\">import</span> run_playbook\n<span class=\"hljs-keyword\">import</span> os\n\napp = FastAPI()\n\n<span class=\"hljs-meta\">@app.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">root</span>():\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;message&quot;</span>: <span class=\"hljs-string\">&quot;Infrastructure Automation API&quot;</span>}\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">execute_playbook</span>(<span class=\"hljs-params\">name: <span class=\"hljs-built_in\">str</span></span>):\n    path = <span class=\"hljs-string\">f&quot;/app/playbooks/<span class=\"hljs-subst\">{name}</span>.yml&quot;</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> os.path.exists(path):\n        <span class=\"hljs-keyword\">return</span> JSONResponse(status_code=<span class=\"hljs-number\">404</span>, content={<span class=\"hljs-string\">&quot;error&quot;</span>: <span class=\"hljs-string\">&quot;Playbook not found&quot;</span>})\n    task = run_playbook.delay(path)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task.<span class=\"hljs-built_in\">id</span>}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1464,1484"}}],"payload":{"tag":"h1","lines":"1463,1464"}},{"content":"&#x1f40d; <code>backend/app/tasks.py</code>","children":[{"content":"<pre data-lines=\"1485,1503\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">import</span> subprocess\n\napp = Celery(<span class=\"hljs-string\">&quot;worker&quot;</span>, broker=os.environ[<span class=\"hljs-string\">&quot;REDIS_URL&quot;</span>])\n\n<span class=\"hljs-meta\">@app.task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>(<span class=\"hljs-params\">playbook_path</span>):\n    <span class=\"hljs-keyword\">try</span>:\n        result = subprocess.run(\n            [<span class=\"hljs-string\">&quot;ansible-playbook&quot;</span>, playbook_path],\n            capture_output=<span class=\"hljs-literal\">True</span>,\n            text=<span class=\"hljs-literal\">True</span>\n        )\n        <span class=\"hljs-keyword\">return</span> result.stdout\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">str</span>(e)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1485,1503"}}],"payload":{"tag":"h1","lines":"1484,1485"}},{"content":"&#x1f40d; <code>backend/app/worker.py</code>","children":[{"content":"<pre data-lines=\"1504,1510\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> tasks <span class=\"hljs-keyword\">import</span> app <span class=\"hljs-keyword\">as</span> celery_app\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n    celery_app.start()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1504,1510"}}],"payload":{"tag":"h1","lines":"1503,1504"}},{"content":"&#x1f9ea; <code>backend/tests/test_tasks.py</code>","children":[{"content":"<pre data-lines=\"1511,1515\"><code class=\"language-python\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">test_dummy</span>():\n    <span class=\"hljs-keyword\">assert</span> <span class=\"hljs-number\">1</span> + <span class=\"hljs-number\">1</span> == <span class=\"hljs-number\">2</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1511,1515"}}],"payload":{"tag":"h1","lines":"1510,1511"}},{"content":"&#x1f4c4; <code>ci/forgejo-workflows/default.yml</code>","children":[{"content":"<pre data-lines=\"1516,1535\"><code class=\"language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">Ansible</span> <span class=\"hljs-string\">Playbook</span>\n\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">paths:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&apos;examples/*.yml&apos;</span>\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">run:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v3</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">Playbook</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          curl -X POST http://backend:8000\n</span></code></pre>","children":[],"payload":{"tag":"pre","lines":"1516,1535"}}],"payload":{"tag":"h1","lines":"1515,1516"}},{"content":"&#x1f4c4; <code>ci/forgejo-workflows/default.yml</code> (completato)","children":[{"content":"<pre data-lines=\"1536,1555\"><code class=\"language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">Ansible</span> <span class=\"hljs-string\">Playbook</span>\n\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">paths:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&apos;examples/*.yml&apos;</span>\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">run:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v3</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Trigger</span> <span class=\"hljs-string\">backend</span> <span class=\"hljs-string\">execution</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          curl -X POST http://backend:8000/run/?name=playbook-sample\n</span></code></pre>","children":[],"payload":{"tag":"pre","lines":"1536,1555"}}],"payload":{"tag":"h1","lines":"1535,1536"}},{"content":"&#x1f4c1; <code>examples/playbook-sample.yml</code>","children":[{"content":"<pre data-lines=\"1556,1571\"><code class=\"language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">&quot;Install Nginx&quot;</span>\n<span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">localhost</span>\n<span class=\"hljs-attr\">tasks:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Install</span> <span class=\"hljs-string\">nginx</span>\n    <span class=\"hljs-attr\">package:</span>\n      <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">nginx</span>\n      <span class=\"hljs-attr\">state:</span> <span class=\"hljs-string\">present</span>\n\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Ensure</span> <span class=\"hljs-string\">nginx</span> <span class=\"hljs-string\">is</span> <span class=\"hljs-string\">running</span>\n    <span class=\"hljs-attr\">service:</span>\n      <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">nginx</span>\n      <span class=\"hljs-attr\">state:</span> <span class=\"hljs-string\">started</span>\n      <span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1556,1571"}}],"payload":{"tag":"h1","lines":"1555,1556"}},{"content":"&#x1f5a5;&#xfe0f; <code>frontend/public/index.html</code> (pagina minimale)","children":[{"content":"<pre data-lines=\"1572,1600\"><code class=\"language-html\"><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">html</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;en&quot;</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">charset</span>=<span class=\"hljs-string\">&quot;UTF-8&quot;</span> /&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;viewport&quot;</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">&quot;width=device-width, initial-scale=1.0&quot;</span>/&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Infrastructure Automation<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Welcome to the Automation UI<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">form</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;playbook-form&quot;</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;text&quot;</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;playbook-name&quot;</span> <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Enter playbook name&quot;</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;submit&quot;</span>&gt;</span>Run<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">form</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pre</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;output&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pre</span>&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">\n    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;playbook-form&quot;</span>).<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&quot;submit&quot;</span>, <span class=\"hljs-title function_\">async</span> (e) =&gt; {\n      e.<span class=\"hljs-title function_\">preventDefault</span>();\n      <span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;playbook-name&quot;</span>).<span class=\"hljs-property\">value</span>;\n      <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`/run/?name=<span class=\"hljs-subst\">&#x24;{name}</span>`</span>, { <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span> });\n      <span class=\"hljs-keyword\">const</span> data = <span class=\"hljs-keyword\">await</span> res.<span class=\"hljs-title function_\">json</span>();\n      <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;output&quot;</span>).<span class=\"hljs-property\">textContent</span> = <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(data, <span class=\"hljs-literal\">null</span>, <span class=\"hljs-number\">2</span>);\n    });\n  </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1572,1600"}}],"payload":{"tag":"h1","lines":"1571,1572"}},{"content":"&#x1f40d; <code>frontend/pages-server/server.py</code>","children":[{"content":"<pre data-lines=\"1601,1616\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> http.server <span class=\"hljs-keyword\">import</span> SimpleHTTPRequestHandler\n<span class=\"hljs-keyword\">from</span> socketserver <span class=\"hljs-keyword\">import</span> TCPServer\n\nPORT = <span class=\"hljs-number\">80</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Handler</span>(<span class=\"hljs-title class_ inherited__\">SimpleHTTPRequestHandler</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">end_headers</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-variable language_\">self</span>.send_header(<span class=\"hljs-string\">&apos;Cache-Control&apos;</span>, <span class=\"hljs-string\">&apos;no-store&apos;</span>)\n        <span class=\"hljs-built_in\">super</span>().end_headers()\n\n<span class=\"hljs-keyword\">with</span> TCPServer((<span class=\"hljs-string\">&quot;&quot;</span>, PORT), Handler) <span class=\"hljs-keyword\">as</span> httpd:\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;Serving frontend on port <span class=\"hljs-subst\">{PORT}</span>&quot;</span>)\n    httpd.serve_forever()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1601,1616"}}],"payload":{"tag":"h1","lines":"1600,1601"}},{"content":"&#x1f4c4; <code>frontend/README.md</code>","children":[{"content":"<pre data-lines=\"1617,1633\"><code class=\"language-markdown\"><span class=\"hljs-section\"># Frontend - Static Pages</span>\n\nQuesta directory contiene l&apos;interfaccia utente minimale servita come sito statico (simile a CodebergPages o GitHub Pages).\n\n<span class=\"hljs-section\">### Contenuto</span>\n\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-code\">`public/index.html`</span>: UI base\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-code\">`pages-server/server.py`</span>: server Python semplice per development/local hosting\n\n<span class=\"hljs-section\">### Avvio locale</span>\n\n<span class=\"hljs-code\">```bash\ncd frontend/pages-server\npython server.py\n</span></code></pre>","children":[],"payload":{"tag":"pre","lines":"1617,1633"}},{"content":"<pre data-lines=\"1636,1647\"><code data-lines=\"1636,1647\"><span class=\"hljs-comment\"># &#x1f41a; `scripts/bootstrap.sh`</span>\n```bash\n<span class=\"hljs-comment\">#!/bin/bash</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x1f527; Bootstrapping Environment...&quot;</span>\n<span class=\"hljs-built_in\">cp</span> .env.example .<span class=\"hljs-built_in\">env</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; .env file created.&quot;</span>\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;&#x1f680; Starting Docker stack...&quot;</span>\ndocker-compose up -d\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1636,1647"}}],"payload":{"tag":"h1","lines":"1616,1617"}},{"content":"&#x1f4dc; <code>LICENSE</code> (MIT)","children":[{"content":"<pre data-lines=\"1648,1656\"><code class=\"language-text\">MIT License\n\nCopyright (c) 2025 YourName\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\n...\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1648,1656"}}],"payload":{"tag":"h1","lines":"1647,1648"}},{"content":"&#x1f4cc; Considerazioni finali","children":[{"content":"&#x1f3f7;&#xfe0f; <strong>Nome e Descrizione per la Repo GitHub</strong>","children":[{"content":"&#x1f539; <strong>Nome repository</strong>","children":[{"content":"<pre data-lines=\"1672,1675\"><code class=\"language-txt\">infraflow\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1672,1675"}}],"payload":{"tag":"h3","lines":"1671,1672"}},{"content":"&#x1f539; <strong>Descrizione breve</strong>","children":[{"content":"<pre data-lines=\"1676,1679\"><code class=\"language-txt\">Web-based infrastructure automation platform using declarative YAML workflows, Ansible/OpenTofu execution, and Git-integrated pipelines.\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1676,1679"}}],"payload":{"tag":"h3","lines":"1675,1676"}},{"content":"&#x1f539; <strong>Descrizione lunga (per il README e GitHub)</strong>","children":[],"payload":{"tag":"h3","lines":"1679,1680"}}],"payload":{"tag":"h2","lines":"1670,1671"}},{"content":"&#x1f9e9; <strong>Task 1: WebSocket per log realtime nel frontend</strong>","children":[{"content":"&#x2705; Obiettivo","children":[],"payload":{"tag":"h3","lines":"1681,1682"}},{"content":"&#x1f527; Modifiche necessarie","children":[{"content":"1. <strong>Backend (FastAPI + Celery)</strong>:","children":[{"content":"Usa un canale WebSocket (<code>/ws/logs/{task_id}</code>) per inviare progressivamente i log.","children":[],"payload":{"tag":"li","lines":"1685,1686"}},{"content":"Il Celery task invia messaggi su Redis Pub/Sub.","children":[],"payload":{"tag":"li","lines":"1686,1687"}},{"content":"Il server FastAPI ascolta e trasmette i log al client via WebSocket.","children":[],"payload":{"tag":"li","lines":"1687,1688"}}],"payload":{"tag":"li","lines":"1684,1688","listIndex":1}},{"content":"2. <strong>Frontend (HTML o Svelte)</strong>:","children":[{"content":"Connetti a <code>ws://localhost:8000/ws/logs/&lt;task_id&gt;</code>","children":[],"payload":{"tag":"li","lines":"1689,1690"}},{"content":"Mostra i log man mano che arrivano.","children":[],"payload":{"tag":"li","lines":"1690,1691"}}],"payload":{"tag":"li","lines":"1688,1691","listIndex":2}},{"content":"3. <strong>Tecnologia WebSocket consigliata:</strong>","children":[{"content":"<code>websockets</code> + <code>asyncio</code> nel backend","children":[],"payload":{"tag":"li","lines":"1692,1693"}},{"content":"Vanilla JS o <code>svelte-websocket-store</code> nel frontend","children":[],"payload":{"tag":"li","lines":"1693,1694"}}],"payload":{"tag":"li","lines":"1691,1694","listIndex":3}}],"payload":{"tag":"h3","lines":"1683,1684"}}],"payload":{"tag":"h2","lines":"1680,1681"}},{"content":"&#x1f310; <strong>Task 2: Supporto a OpenTofu per provisioning</strong>","children":[{"content":"&#x2705; Obiettivo","children":[],"payload":{"tag":"h3","lines":"1695,1696"}},{"content":"&#x1f527; Come fare:","children":[{"content":"<pre data-lines=\"1703,1709\"><code data-lines=\"1703,1709\">infrastructure/\n&#x2514;&#x2500;&#x2500; example-vm/\n    &#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-tag\">main</span><span class=\"hljs-selector-class\">.tf</span>\n    &#x2514;&#x2500;&#x2500; variables<span class=\"hljs-selector-class\">.tf</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1703,1709"}}],"payload":{"tag":"h3","lines":"1697,1698"}}],"payload":{"tag":"h2","lines":"1694,1695"}},{"content":"&#x1f4bb; <strong>Task 3: Interfaccia utente con Svelte o React</strong>","children":[{"content":"&#x2705; Obiettivo","children":[],"payload":{"tag":"h3","lines":"1710,1711"}},{"content":"&#x1f527; Stack suggerito:","children":[{"content":"<strong>SvelteKit</strong> (pi&#xf9; leggero, semplice, integrabile in Pages)","children":[],"payload":{"tag":"li","lines":"1713,1714"}},{"content":"Oppure <strong>React + Vite + Zustand</strong> (pi&#xf9; standard e flessibile)","children":[],"payload":{"tag":"li","lines":"1714,1715"}}],"payload":{"tag":"h3","lines":"1712,1713"}},{"content":"&#x1f527; Funzionalit&#xe0; UI:","children":[{"content":"Login/logout","children":[],"payload":{"tag":"li","lines":"1716,1717"}},{"content":"Lista playbook disponibili (da API)","children":[],"payload":{"tag":"li","lines":"1717,1718"}},{"content":"Parametri personalizzabili","children":[],"payload":{"tag":"li","lines":"1718,1719"}},{"content":"Visualizzazione log WebSocket live","children":[],"payload":{"tag":"li","lines":"1719,1720"}},{"content":"Stato job Celery","children":[],"payload":{"tag":"li","lines":"1720,1721"}},{"content":"Cronologia esecuzioni<br>\n&#x1f4e6; Puoi usare:","children":[],"payload":{"tag":"li","lines":"1721,1723"}},{"content":"<code>axios</code> o <code>fetch</code> per API","children":[],"payload":{"tag":"li","lines":"1723,1724"}},{"content":"<code>svelte-websocket-store</code> per log realtime","children":[],"payload":{"tag":"li","lines":"1724,1725"}},{"content":"Routing e moduli dinamici (modular YAML editor)","children":[],"payload":{"tag":"li","lines":"1725,1726"}}],"payload":{"tag":"h3","lines":"1715,1716"}}],"payload":{"tag":"h2","lines":"1709,1710"}},{"content":"&#x1f464; <strong>Task 4: Ruoli utente e login GitHub/GitLab</strong>","children":[{"content":"&#x2705; Obiettivo","children":[{"content":"Limitare accesso a UI/API","children":[],"payload":{"tag":"li","lines":"1729,1730"}},{"content":"Associare job/log a utenti","children":[],"payload":{"tag":"li","lines":"1730,1731"}},{"content":"In futuro, trigger da webhook autenticati","children":[],"payload":{"tag":"li","lines":"1731,1732"}}],"payload":{"tag":"h3","lines":"1727,1728"}},{"content":"&#x1f527; Stack consigliato:","children":[{"content":"<strong>Backend</strong>: FastAPI + <code>fastapi-users</code> con <code>OAuth2PasswordBearer</code> + GitHub/GitLab provider","children":[],"payload":{"tag":"li","lines":"1733,1734"}},{"content":"<strong>Frontend</strong>: login OAuth via redirect, token JWT usato nelle API","children":[],"payload":{"tag":"li","lines":"1734,1735"}},{"content":"<strong>Permessi</strong>: ruoli <code>admin</code>, <code>user</code>, <code>viewer</code>","children":[],"payload":{"tag":"li","lines":"1735,1736"}}],"payload":{"tag":"h3","lines":"1732,1733"}}],"payload":{"tag":"h2","lines":"1726,1727"}},{"content":"&#x2638;&#xfe0f; <strong>Task 5: Packaging con Helm/Kubernetes</strong>","children":[{"content":"&#x2705; Obiettivo","children":[],"payload":{"tag":"h3","lines":"1737,1738"}},{"content":"&#x1f4e6; Helm chart include:","children":[{"content":"<pre data-lines=\"1753,1764\"><code data-lines=\"1753,1764\">helm/\n&#x2514;&#x2500;&#x2500; infraflow/\n    &#x251c;&#x2500;&#x2500; Chart<span class=\"hljs-selector-class\">.yaml</span>\n    &#x251c;&#x2500;&#x2500; values<span class=\"hljs-selector-class\">.yaml</span>\n    &#x251c;&#x2500;&#x2500; templates/\n    &#x2502;   &#x251c;&#x2500;&#x2500; deployment-backend<span class=\"hljs-selector-class\">.yaml</span>\n    &#x2502;   &#x251c;&#x2500;&#x2500; service-backend<span class=\"hljs-selector-class\">.yaml</span>\n    &#x2502;   &#x251c;&#x2500;&#x2500; ingress<span class=\"hljs-selector-class\">.yaml</span>\n    &#x2502;   &#x2514;&#x2500;&#x2500; redis<span class=\"hljs-selector-class\">.yaml</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1753,1764"}}],"payload":{"tag":"h3","lines":"1739,1740"}}],"payload":{"tag":"h2","lines":"1736,1737"}},{"content":"&#x2705; Riassunto Prossimi Passi Implementativi","children":[{"content":"<table data-lines=\"1765,1774\">\n<thead data-lines=\"1765,1766\">\n<tr data-lines=\"1765,1766\">\n<th>Task</th>\n<th>Status</th>\n</tr>\n</thead>\n<tbody data-lines=\"1767,1774\">\n<tr data-lines=\"1767,1768\">\n<td>Nome repo e descrizione</td>\n<td>&#x2705; Fatto</td>\n</tr>\n<tr data-lines=\"1768,1769\">\n<td>WebSocket log realtime</td>\n<td>&#x1f51c; Da implementare</td>\n</tr>\n<tr data-lines=\"1769,1770\">\n<td>Supporto OpenTofu</td>\n<td>&#x1f51c; Da implementare</td>\n</tr>\n<tr data-lines=\"1770,1771\">\n<td>UI moderna (Svelte/React)</td>\n<td>&#x1f51c; Da implementare</td>\n</tr>\n<tr data-lines=\"1771,1772\">\n<td>Autenticazione GitHub/GitLab</td>\n<td>&#x1f51c; Da implementare</td>\n</tr>\n<tr data-lines=\"1772,1773\">\n<td>Helm/K8s packaging</td>\n<td>&#x1f51c; Da generare</td>\n</tr>\n<tr data-lines=\"1773,1774\">\n<td>&#x1f7e2; Vuoi che inizi a generare <strong>uno per uno questi moduli</strong> con codice dettagliato e integrato nello stack esistente?</td>\n<td></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1765,1774"}}],"payload":{"tag":"h2","lines":"1764,1765"}}],"payload":{"tag":"h1","lines":"1657,1658"}},{"content":"&#x2705; Obiettivo","children":[{"content":"&#x1f4e6; Struttura generale dei componenti coinvolti","children":[{"content":"<pre data-lines=\"1779,1787\"><code class=\"language-text\">backend/\n&#x251c;&#x2500;&#x2500; main.py              # FastAPI app\n&#x251c;&#x2500;&#x2500; tasks.py             # Celery tasks\n&#x251c;&#x2500;&#x2500; websocket.py         # WebSocket handler\n&#x251c;&#x2500;&#x2500; log_queue.py         # Gestione coda/pub-sub per log (in memoria o Redis)\n&#x2514;&#x2500;&#x2500; utils.py             # Helpers (esecuzione subprocessi, ecc.)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1779,1787"}}],"payload":{"tag":"h2","lines":"1778,1779"}},{"content":"&#x1f501; Strategia: Pub/Sub per log in tempo reale","children":[{"content":"1. Quando parte un task (<code>run_playbook</code>), esegue Ansible via <code>subprocess</code>.","children":[],"payload":{"tag":"li","lines":"1788,1789","listIndex":1}},{"content":"2. Ogni riga di output viene pubblicata su una coda (es. <code>asyncio.Queue</code> o Redis Pub/Sub).","children":[],"payload":{"tag":"li","lines":"1789,1790","listIndex":2}},{"content":"3. Il WebSocket, collegato a <code>/ws/logs/{task_id}</code>, riceve quei log e li invia al client.","children":[],"payload":{"tag":"li","lines":"1790,1791","listIndex":3}},{"content":"4. Al termine del task, viene chiuso il canale.","children":[],"payload":{"tag":"li","lines":"1791,1792","listIndex":4}}],"payload":{"tag":"h2","lines":"1787,1788"}},{"content":"&#x1f9e0; Step 1 &#x2013; <code>log_queue.py</code>: coda per messaggi log","children":[{"content":"<pre data-lines=\"1794,1809\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/log_queue.py</span>\n\n<span class=\"hljs-keyword\">import</span> asyncio\n<span class=\"hljs-keyword\">from</span> collections <span class=\"hljs-keyword\">import</span> defaultdict\n\n<span class=\"hljs-comment\"># Una mappa: task_id -&gt; coda di messaggi</span>\nlog_queues = defaultdict(asyncio.Queue)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_log_queue</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span></span>) -&gt; asyncio.Queue:\n    <span class=\"hljs-keyword\">return</span> log_queues[task_id]\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">remove_log_queue</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span></span>):\n    log_queues.pop(task_id, <span class=\"hljs-literal\">None</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1794,1809"}}],"payload":{"tag":"h2","lines":"1792,1793"}},{"content":"&#x2699;&#xfe0f; Step 2 &#x2013; <code>tasks.py</code>: esecuzione del playbook e pubblicazione log","children":[{"content":"<pre data-lines=\"1810,1840\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/tasks.py</span>\n\n<span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> shared_task\n<span class=\"hljs-keyword\">import</span> subprocess\n<span class=\"hljs-keyword\">from</span> .log_queue <span class=\"hljs-keyword\">import</span> get_log_queue, remove_log_queue\n\n<span class=\"hljs-meta\">@shared_task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span>, playbook_path: <span class=\"hljs-built_in\">str</span></span>):\n    queue = get_log_queue(task_id)\n    <span class=\"hljs-keyword\">try</span>:\n        process = subprocess.Popen(\n            [<span class=\"hljs-string\">&quot;ansible-playbook&quot;</span>, playbook_path],\n            stdout=subprocess.PIPE,\n            stderr=subprocess.STDOUT,\n            text=<span class=\"hljs-literal\">True</span>,\n            bufsize=<span class=\"hljs-number\">1</span>,\n        )\n\n        <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> process.stdout:\n            queue.put_nowait(line.strip())\n\n        process.wait()\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[exit] code: <span class=\"hljs-subst\">{process.returncode}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[error] <span class=\"hljs-subst\">{<span class=\"hljs-built_in\">str</span>(e)}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">finally</span>:\n        queue.put_nowait(<span class=\"hljs-string\">&quot;[end]&quot;</span>)\n        remove_log_queue(task_id)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1810,1840"}}],"payload":{"tag":"h2","lines":"1809,1810"}},{"content":"&#x1f310; Step 3 &#x2013; <code>websocket.py</code>: endpoint WebSocket","children":[{"content":"<pre data-lines=\"1841,1862\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/websocket.py</span>\n\n<span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter, WebSocket, WebSocketDisconnect\n<span class=\"hljs-keyword\">from</span> .log_queue <span class=\"hljs-keyword\">import</span> get_log_queue\n\nrouter = APIRouter()\n\n<span class=\"hljs-meta\">@router.websocket(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/ws/logs/{task_id}&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">websocket_log_stream</span>(<span class=\"hljs-params\">websocket: WebSocket, task_id: <span class=\"hljs-built_in\">str</span></span>):\n    <span class=\"hljs-keyword\">await</span> websocket.accept()\n    queue = get_log_queue(task_id)\n    <span class=\"hljs-keyword\">try</span>:\n        <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n            message = <span class=\"hljs-keyword\">await</span> queue.get()\n            <span class=\"hljs-keyword\">await</span> websocket.send_text(message)\n            <span class=\"hljs-keyword\">if</span> message == <span class=\"hljs-string\">&quot;[end]&quot;</span>:\n                <span class=\"hljs-keyword\">break</span>\n    <span class=\"hljs-keyword\">except</span> WebSocketDisconnect:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;Client disconnected from task <span class=\"hljs-subst\">{task_id}</span>&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1841,1862"}}],"payload":{"tag":"h2","lines":"1840,1841"}},{"content":"&#x1f680; Step 4 &#x2013; <code>main.py</code>: registrazione router WebSocket e API","children":[{"content":"<pre data-lines=\"1863,1893\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/main.py</span>\n\n<span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI, BackgroundTasks\n<span class=\"hljs-keyword\">from</span> fastapi.middleware.cors <span class=\"hljs-keyword\">import</span> CORSMiddleware\n<span class=\"hljs-keyword\">import</span> uuid\n\n<span class=\"hljs-keyword\">from</span> .tasks <span class=\"hljs-keyword\">import</span> run_playbook\n<span class=\"hljs-keyword\">from</span> .websocket <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> websocket_router\n<span class=\"hljs-keyword\">from</span> .log_queue <span class=\"hljs-keyword\">import</span> get_log_queue\n\napp = FastAPI()\napp.include_router(websocket_router)\n\n<span class=\"hljs-comment\"># Permetti richieste CORS dal frontend</span>\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[<span class=\"hljs-string\">&quot;*&quot;</span>],  <span class=\"hljs-comment\"># o specifica il dominio del frontend</span>\n    allow_credentials=<span class=\"hljs-literal\">True</span>,\n    allow_methods=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_headers=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span class=\"hljs-params\">background_tasks: BackgroundTasks</span>):\n    task_id = <span class=\"hljs-built_in\">str</span>(uuid.uuid4())\n    playbook_path = <span class=\"hljs-string\">&quot;examples/playbook-sample.yml&quot;</span>\n    background_tasks.add_task(run_playbook.delay, task_id, playbook_path)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task_id}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1863,1893"}}],"payload":{"tag":"h2","lines":"1862,1863"}},{"content":"&#x1f5a5;&#xfe0f; Step 5 &#x2013; Frontend HTML (esempio base)","children":[{"content":"<pre data-lines=\"1894,1916\"><code class=\"language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;text&quot;</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;task-id&quot;</span> <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Task ID&quot;</span> /&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onclick</span>=<span class=\"hljs-string\">&quot;connect()&quot;</span>&gt;</span>Connect to Logs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pre</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;log-output&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pre</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">\n  <span class=\"hljs-keyword\">let</span> socket;\n\n  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">connect</span>(<span class=\"hljs-params\"></span>) {\n    <span class=\"hljs-keyword\">const</span> taskId = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;task-id&quot;</span>).<span class=\"hljs-property\">value</span>;\n    socket = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WebSocket</span>(<span class=\"hljs-string\">`ws://localhost:8000/ws/logs/<span class=\"hljs-subst\">&#x24;{taskId}</span>`</span>);\n\n    socket.<span class=\"hljs-property\">onmessage</span> = <span class=\"hljs-function\">(<span class=\"hljs-params\">event</span>) =&gt;</span> {\n      <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;log-output&quot;</span>).<span class=\"hljs-property\">textContent</span> += event.<span class=\"hljs-property\">data</span> + <span class=\"hljs-string\">&quot;\\n&quot;</span>;\n    };\n\n    socket.<span class=\"hljs-property\">onclose</span> = <span class=\"hljs-function\">() =&gt;</span> {\n      <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;log-output&quot;</span>).<span class=\"hljs-property\">textContent</span> += <span class=\"hljs-string\">&quot;[connection closed]\\n&quot;</span>;\n    };\n  }\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1894,1916"}}],"payload":{"tag":"h2","lines":"1893,1894"}},{"content":"&#x2705; Test veloce end-to-end","children":[{"content":"1. Avvia backend e Celery:<pre data-lines=\"1918,1921\"><code class=\"language-bash\">docker-compose up -d\n</code></pre>","children":[],"payload":{"tag":"li","lines":"1917,1921","listIndex":1}},{"content":"2. Chiama <code>/run/</code> via API &#x2192; ottieni un <code>task_id</code>.","children":[],"payload":{"tag":"li","lines":"1921,1922","listIndex":2}},{"content":"3. Connettiti via WebSocket a <code>ws://localhost:8000/ws/logs/{task_id}</code> &#x2192; visualizza i log in tempo reale!","children":[],"payload":{"tag":"li","lines":"1922,1923","listIndex":3}}],"payload":{"tag":"h2","lines":"1916,1917"}},{"content":"&#x1f4e6; Estensioni future","children":[{"content":"<table data-lines=\"1924,1931\">\n<thead data-lines=\"1924,1925\">\n<tr data-lines=\"1924,1925\">\n<th>Funzionalit&#xe0;</th>\n<th>Possibile via</th>\n</tr>\n</thead>\n<tbody data-lines=\"1926,1931\">\n<tr data-lines=\"1926,1927\">\n<td>Multipli task concorrenti</td>\n<td><code>task_id</code> distinto</td>\n</tr>\n<tr data-lines=\"1927,1928\">\n<td>Salvataggio log persistente</td>\n<td>scrittura su file/log storage</td>\n</tr>\n<tr data-lines=\"1928,1929\">\n<td>Redis al posto di <code>asyncio.Queue</code></td>\n<td><code>aioredis</code>, Redis Streams</td>\n</tr>\n<tr data-lines=\"1929,1930\">\n<td>Sicurezza WebSocket</td>\n<td>JWT nei parametri o header</td>\n</tr>\n<tr data-lines=\"1930,1931\">\n<td>&#x1f501; Vuoi ora che estenda questo con il <strong>Supporto OpenTofu (Modulo 2)</strong>, seguendo lo stesso schema?</td>\n<td></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1924,1931"}}],"payload":{"tag":"h2","lines":"1923,1924"}}],"payload":{"tag":"h1","lines":"1776,1777"}},{"content":"&#x2705; Modulo 2 &#x2013; Supporto a OpenTofu per provisioning","children":[{"content":"&#x1f3af; Obiettivo","children":[{"content":"Eseguire progetti <strong>OpenTofu</strong> scritti in <code>.tf</code> o <code>.tf.json</code>","children":[],"payload":{"tag":"li","lines":"1934,1935"}},{"content":"Usare <code>subprocess</code> per eseguire i comandi <code>tofu init</code> + <code>tofu apply -auto-approve</code>","children":[],"payload":{"tag":"li","lines":"1935,1936"}},{"content":"Inviare i log dell&#x2019;esecuzione in <strong>real-time via WebSocket</strong>, esattamente come per i playbook Ansible","children":[],"payload":{"tag":"li","lines":"1936,1937"}}],"payload":{"tag":"h2","lines":"1932,1933"}},{"content":"&#x1f4c1; Directory suggerita","children":[{"content":"<pre data-lines=\"1938,1944\"><code class=\"language-text\">infrastructure/\n&#x2514;&#x2500;&#x2500; sample/\n    &#x251c;&#x2500;&#x2500; main.tf\n    &#x2514;&#x2500;&#x2500; variables.tf\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1938,1944"}}],"payload":{"tag":"h2","lines":"1937,1938"}},{"content":"&#x1f501; Strategia","children":[{"content":"<code>task_id</code> per isolare l&apos;esecuzione","children":[],"payload":{"tag":"li","lines":"1946,1947"}},{"content":"log inviati via <code>asyncio.Queue</code>","children":[],"payload":{"tag":"li","lines":"1947,1948"}},{"content":"WebSocket gi&#xe0; esistente (<code>/ws/logs/{task_id}</code>)","children":[],"payload":{"tag":"li","lines":"1948,1949"}}],"payload":{"tag":"h2","lines":"1944,1945"}},{"content":"&#x1f9e0; Step 1 &#x2013; Esecuzione Tofu via subprocess","children":[{"content":"&#x1f527; <code>tasks.py</code> &#x2013; Aggiungi nuova funzione","children":[{"content":"<pre data-lines=\"1951,1993\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/tasks.py (continua)</span>\n\n<span class=\"hljs-meta\">@shared_task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_tofu</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span>, project_path: <span class=\"hljs-built_in\">str</span></span>):\n    queue = get_log_queue(task_id)\n    <span class=\"hljs-keyword\">try</span>:\n        <span class=\"hljs-comment\"># Init</span>\n        process_init = subprocess.Popen(\n            [<span class=\"hljs-string\">&quot;tofu&quot;</span>, <span class=\"hljs-string\">&quot;init&quot;</span>],\n            cwd=project_path,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.STDOUT,\n            text=<span class=\"hljs-literal\">True</span>,\n            bufsize=<span class=\"hljs-number\">1</span>,\n        )\n        <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> process_init.stdout:\n            queue.put_nowait(<span class=\"hljs-string\">f&quot;[init] <span class=\"hljs-subst\">{line.strip()}</span>&quot;</span>)\n\n        process_init.wait()\n\n        <span class=\"hljs-comment\"># Apply</span>\n        process_apply = subprocess.Popen(\n            [<span class=\"hljs-string\">&quot;tofu&quot;</span>, <span class=\"hljs-string\">&quot;apply&quot;</span>, <span class=\"hljs-string\">&quot;-auto-approve&quot;</span>],\n            cwd=project_path,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.STDOUT,\n            text=<span class=\"hljs-literal\">True</span>,\n            bufsize=<span class=\"hljs-number\">1</span>,\n        )\n\n        <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> process_apply.stdout:\n            queue.put_nowait(<span class=\"hljs-string\">f&quot;[apply] <span class=\"hljs-subst\">{line.strip()}</span>&quot;</span>)\n\n        process_apply.wait()\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[exit] code: <span class=\"hljs-subst\">{process_apply.returncode}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[error] <span class=\"hljs-subst\">{<span class=\"hljs-built_in\">str</span>(e)}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">finally</span>:\n        queue.put_nowait(<span class=\"hljs-string\">&quot;[end]&quot;</span>)\n        remove_log_queue(task_id)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1951,1993"}}],"payload":{"tag":"h3","lines":"1950,1951"}}],"payload":{"tag":"h2","lines":"1949,1950"}},{"content":"&#x1f680; Step 2 &#x2013; Nuovo endpoint <code>/run/tofu/</code>","children":[{"content":"&#x1f527; <code>main.py</code>","children":[{"content":"<pre data-lines=\"1995,2005\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/main.py (continua)</span>\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/tofu/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_tofu_handler</span>(<span class=\"hljs-params\">background_tasks: BackgroundTasks</span>):\n    task_id = <span class=\"hljs-built_in\">str</span>(uuid.uuid4())\n    project_path = <span class=\"hljs-string\">&quot;infrastructure/sample&quot;</span>\n    background_tasks.add_task(run_tofu.delay, task_id, project_path)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task_id}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1995,2005"}}],"payload":{"tag":"h3","lines":"1994,1995"}}],"payload":{"tag":"h2","lines":"1993,1994"}},{"content":"&#x1f5a5;&#xfe0f; Step 3 &#x2013; Frontend HTML d&apos;esempio","children":[{"content":"<pre data-lines=\"2007,2025\"><code class=\"language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onclick</span>=<span class=\"hljs-string\">&quot;runTofu()&quot;</span>&gt;</span>Run OpenTofu<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">runTofu</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&quot;/run/tofu/&quot;</span>, { <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span> });\n  <span class=\"hljs-keyword\">const</span> data = <span class=\"hljs-keyword\">await</span> res.<span class=\"hljs-title function_\">json</span>();\n  <span class=\"hljs-title function_\">connectToLogs</span>(data.<span class=\"hljs-property\">task_id</span>);\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">connectToLogs</span>(<span class=\"hljs-params\">taskId</span>) {\n  <span class=\"hljs-keyword\">const</span> socket = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WebSocket</span>(<span class=\"hljs-string\">`ws://localhost:8000/ws/logs/<span class=\"hljs-subst\">&#x24;{taskId}</span>`</span>);\n  socket.<span class=\"hljs-property\">onmessage</span> = <span class=\"hljs-function\">(<span class=\"hljs-params\">event</span>) =&gt;</span> {\n    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;log-output&quot;</span>).<span class=\"hljs-property\">textContent</span> += event.<span class=\"hljs-property\">data</span> + <span class=\"hljs-string\">&quot;\\n&quot;</span>;\n  };\n}\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2007,2025"}}],"payload":{"tag":"h2","lines":"2005,2006"}},{"content":"&#x1f4c2; Esempio <code>main.tf</code>","children":[{"content":"&#x1f527; <code>infrastructure/sample/main.tf</code>","children":[{"content":"<pre data-lines=\"2027,2043\"><code class=\"language-hcl\">terraform {\n  required_providers {\n    local = {\n      source = &quot;hashicorp/local&quot;\n    }\n  }\n}\n\nprovider &quot;local&quot; {}\n\nresource &quot;local_file&quot; &quot;test&quot; {\n  content  = &quot;Hello from OpenTofu&quot;\n  filename = &quot;&#x24;{path.module}/hello.txt&quot;\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2027,2043"}}],"payload":{"tag":"h3","lines":"2026,2027"}}],"payload":{"tag":"h2","lines":"2025,2026"}},{"content":"&#x2705; Verifica: Test completo","children":[{"content":"1. Assicurati di avere <code>tofu</code> installato nel container o nel path.","children":[],"payload":{"tag":"li","lines":"2044,2045","listIndex":1}},{"content":"2. Avvia il backend + Celery worker.","children":[],"payload":{"tag":"li","lines":"2045,2046","listIndex":2}},{"content":"3. Chiama <code>POST /run/tofu/</code> &#x2192; ricevi <code>task_id</code>","children":[],"payload":{"tag":"li","lines":"2046,2047","listIndex":3}},{"content":"4. Connettiti al WebSocket <code>ws://localhost:8000/ws/logs/{task_id}</code>","children":[],"payload":{"tag":"li","lines":"2047,2048","listIndex":4}},{"content":"5. Guarda i log dell&#x2019;invocazione <code>init</code> + <code>apply</code> in tempo reale","children":[],"payload":{"tag":"li","lines":"2048,2049","listIndex":5}}],"payload":{"tag":"h2","lines":"2043,2044"}},{"content":"&#x1f6e0;&#xfe0f; Prossimi miglioramenti (extra)","children":[{"content":"&#x27a1;&#xfe0f; Modulo 3: <strong>UI moderna (Svelte o React)?</strong>","children":[],"payload":{"tag":"h3","lines":"2058,2059"}}],"payload":{"tag":"h2","lines":"2049,2050"}}],"payload":{"tag":"h1","lines":"1931,1932"}},{"content":"&#x2705; Modulo 3 &#x2013; Interfaccia Web con Svelte","children":[{"content":"&#x1f9f1; Stack scelto per il frontend","children":[{"content":"<table data-lines=\"2062,2069\">\n<thead data-lines=\"2062,2063\">\n<tr data-lines=\"2062,2063\">\n<th>Tecnologia</th>\n<th>Ruolo</th>\n</tr>\n</thead>\n<tbody data-lines=\"2064,2069\">\n<tr data-lines=\"2064,2065\">\n<td><a href=\"https://kit.svelte.dev/\">SvelteKit</a></td>\n<td>UI interattiva, routing e SSR</td>\n</tr>\n<tr data-lines=\"2065,2066\">\n<td>TailwindCSS</td>\n<td>UI moderna e responsive</td>\n</tr>\n<tr data-lines=\"2066,2067\">\n<td>Axios / Fetch</td>\n<td>API REST con FastAPI</td>\n</tr>\n<tr data-lines=\"2067,2068\">\n<td>WebSocket API</td>\n<td>Log in realtime</td>\n</tr>\n<tr data-lines=\"2068,2069\">\n<td>Zustand-like Store</td>\n<td>Stato client minimale</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2062,2069"}}],"payload":{"tag":"h2","lines":"2061,2062"}},{"content":"&#x1f4c1; Struttura del frontend","children":[{"content":"<pre data-lines=\"2070,2085\"><code class=\"language-txt\">frontend/\n&#x251c;&#x2500;&#x2500; src/\n&#x2502;   &#x251c;&#x2500;&#x2500; lib/\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; api.ts                # Funzioni API (run/playbook, tofu, ecc.)\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; websocket.ts          # Log stream WebSocket client\n&#x2502;   &#x251c;&#x2500;&#x2500; routes/\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; +page.svelte          # Dashboard principale\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; playbook/[id]/+page.svelte  # Pagina dettaglio task\n&#x2502;   &#x2514;&#x2500;&#x2500; app.html\n&#x251c;&#x2500;&#x2500; static/\n&#x251c;&#x2500;&#x2500; svelte.config.js\n&#x251c;&#x2500;&#x2500; tailwind.config.js\n&#x2514;&#x2500;&#x2500; package.json\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2070,2085"}}],"payload":{"tag":"h2","lines":"2069,2070"}},{"content":"&#x1f680; Step 1 &#x2013; Setup SvelteKit + Tailwind","children":[{"content":"&#x270f;&#xfe0f; <code>tailwind.config.js</code>","children":[{"content":"<pre data-lines=\"2097,2104\"><code class=\"language-js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = {\n  <span class=\"hljs-attr\">content</span>: [<span class=\"hljs-string\">&apos;./src/**/*.{html,js,svelte,ts}&apos;</span>],\n  <span class=\"hljs-attr\">theme</span>: { <span class=\"hljs-attr\">extend</span>: {} },\n  <span class=\"hljs-attr\">plugins</span>: [],\n};\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2097,2104"}}],"payload":{"tag":"h3","lines":"2096,2097"}},{"content":"&#x270f;&#xfe0f; <code>src/app.css</code>","children":[{"content":"<pre data-lines=\"2105,2110\"><code class=\"language-css\"><span class=\"hljs-keyword\">@tailwind</span> base;\n<span class=\"hljs-keyword\">@tailwind</span> components;\n<span class=\"hljs-keyword\">@tailwind</span> utilities;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2105,2110"}}],"payload":{"tag":"h3","lines":"2104,2105"}},{"content":"&#x270f;&#xfe0f; <code>src/routes/+layout.svelte</code>","children":[{"content":"<pre data-lines=\"2111,2118\"><code class=\"language-svelte\">&lt;script&gt;\n  import &quot;../app.css&quot;;\n&lt;/script&gt;\n\n&lt;slot /&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2111,2118"}}],"payload":{"tag":"h3","lines":"2110,2111"}}],"payload":{"tag":"h2","lines":"2085,2086"}},{"content":"&#x2699;&#xfe0f; Step 2 &#x2013; API client base (<code>lib/api.ts</code>)","children":[{"content":"<pre data-lines=\"2119,2134\"><code class=\"language-ts\"><span class=\"hljs-comment\">// src/lib/api.ts</span>\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">API_BASE</span> = <span class=\"hljs-string\">&quot;http://localhost:8000&quot;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">runPlaybook</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`<span class=\"hljs-subst\">&#x24;{API_BASE}</span>/run/`</span>, { <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span> });\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> res.<span class=\"hljs-title function_\">json</span>(); <span class=\"hljs-comment\">// { task_id: &quot;...&quot; }</span>\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">runTofu</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`<span class=\"hljs-subst\">&#x24;{API_BASE}</span>/run/tofu/`</span>, { <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span> });\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> res.<span class=\"hljs-title function_\">json</span>(); <span class=\"hljs-comment\">// { task_id: &quot;...&quot; }</span>\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2119,2134"}}],"payload":{"tag":"h2","lines":"2118,2119"}},{"content":"&#x1f50c; Step 3 &#x2013; WebSocket client (<code>lib/websocket.ts</code>)","children":[{"content":"<pre data-lines=\"2135,2152\"><code class=\"language-ts\"><span class=\"hljs-comment\">// src/lib/websocket.ts</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">connectToLogStream</span>(<span class=\"hljs-params\"><span class=\"hljs-attr\">task_id</span>: <span class=\"hljs-built_in\">string</span>, <span class=\"hljs-attr\">onMessage</span>: (line: <span class=\"hljs-built_in\">string</span>) =&gt; <span class=\"hljs-built_in\">void</span></span>) {\n  <span class=\"hljs-keyword\">const</span> ws = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WebSocket</span>(<span class=\"hljs-string\">`ws://localhost:8000/ws/logs/<span class=\"hljs-subst\">&#x24;{task_id}</span>`</span>);\n\n  ws.<span class=\"hljs-property\">onmessage</span> = <span class=\"hljs-function\">(<span class=\"hljs-params\">event</span>) =&gt;</span> {\n    <span class=\"hljs-title function_\">onMessage</span>(event.<span class=\"hljs-property\">data</span>);\n  };\n\n  ws.<span class=\"hljs-property\">onclose</span> = <span class=\"hljs-function\">() =&gt;</span> {\n    <span class=\"hljs-title function_\">onMessage</span>(<span class=\"hljs-string\">&quot;[WebSocket closed]&quot;</span>);\n  };\n\n  <span class=\"hljs-keyword\">return</span> ws;\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2135,2152"}}],"payload":{"tag":"h2","lines":"2134,2135"}},{"content":"&#x1f9ea; Step 4 &#x2013; Pagina principale (<code>routes/+page.svelte</code>)","children":[{"content":"<pre data-lines=\"2153,2191\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { runPlaybook, runTofu } from &apos;&#x24;lib/api&apos;;\n  import { connectToLogStream } from &apos;&#x24;lib/websocket&apos;;\n\n  let logOutput = &quot;&quot;;\n  let currentWs: WebSocket | null = null;\n\n  async function handleRunPlaybook() {\n    const { task_id } = await runPlaybook();\n    startLog(task_id);\n  }\n\n  async function handleRunTofu() {\n    const { task_id } = await runTofu();\n    startLog(task_id);\n  }\n\n  function startLog(task_id: string) {\n    logOutput = `Task ID: &#x24;{task_id}\\n`;\n    currentWs?.close();\n    currentWs = connectToLogStream(task_id, (line) =&gt; {\n      logOutput += line + &quot;\\n&quot;;\n    });\n  }\n&lt;/script&gt;\n\n&lt;main class=&quot;p-6 space-y-4&quot;&gt;\n  &lt;h1 class=&quot;text-2xl font-bold&quot;&gt;InfraFlow Dashboard&lt;/h1&gt;\n\n  &lt;div class=&quot;space-x-2&quot;&gt;\n    &lt;button class=&quot;bg-blue-500 text-white px-4 py-2 rounded&quot; on:click={handleRunPlaybook}&gt;Run Playbook&lt;/button&gt;\n    &lt;button class=&quot;bg-green-600 text-white px-4 py-2 rounded&quot; on:click={handleRunTofu}&gt;Run OpenTofu&lt;/button&gt;\n  &lt;/div&gt;\n\n  &lt;pre class=&quot;bg-black text-green-400 p-4 rounded h-96 overflow-y-auto&quot;&gt;{logOutput}&lt;/pre&gt;\n&lt;/main&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2153,2191"}}],"payload":{"tag":"h2","lines":"2152,2153"}},{"content":"&#x2705; Cosa funziona ora?","children":[{"content":"Pulsante &quot;Run Playbook&quot; &#x2192; chiama <code>/run/</code> e apre WebSocket su <code>/ws/logs/{task_id}</code>","children":[],"payload":{"tag":"li","lines":"2192,2193"}},{"content":"Pulsante &quot;Run OpenTofu&quot; &#x2192; chiama <code>/run/tofu/</code> e stessa logica","children":[],"payload":{"tag":"li","lines":"2193,2194"}},{"content":"I log arrivano in tempo reale sulla UI","children":[],"payload":{"tag":"li","lines":"2194,2195"}},{"content":"Il codice &#xe8; modulare e gi&#xe0; pronto per routing dinamico, miglioramenti, gestione utenti, ecc.","children":[],"payload":{"tag":"li","lines":"2195,2196"}}],"payload":{"tag":"h2","lines":"2191,2192"}},{"content":"&#x1f510; Step 5 (prossimo): Autenticazione GitHub/GitLab","children":[{"content":"OAuth login GitHub o GitLab (<code>fastapi-users</code>)","children":[],"payload":{"tag":"li","lines":"2198,2199"}},{"content":"Limitazioni via ruoli: solo utenti autorizzati possono eseguire playbook","children":[],"payload":{"tag":"li","lines":"2199,2200"}},{"content":"Token salvato nel localStorage / header <code>Authorization</code> nelle API","children":[],"payload":{"tag":"li","lines":"2200,2201"}}],"payload":{"tag":"h2","lines":"2196,2197"}},{"content":"&#x1f4a1; Vuoi estendere?","children":[{"content":"Editor YAML integrato per modificare i playbook prima dell&#x2019;esecuzione","children":[],"payload":{"tag":"li","lines":"2202,2203"}},{"content":"Lista task recenti (con stato, cronologia)","children":[],"payload":{"tag":"li","lines":"2203,2204"}},{"content":"Tab separati (Tofu, Ansible, Logs)","children":[],"payload":{"tag":"li","lines":"2204,2205"}},{"content":"Modalit&#xe0; Dark","children":[],"payload":{"tag":"li","lines":"2205,2206"}},{"content":"Hosting su Codeberg Pages o Vite + nginx<br>\n&#x27a1;&#xfe0f; <strong>Modulo 4: Autenticazione GitHub/GitLab</strong><br>\noppure vuoi raffinare prima l&#x2019;interfaccia o iniziare a impacchettare il tutto in Helm/Kubernetes.","children":[],"payload":{"tag":"li","lines":"2206,2209"}}],"payload":{"tag":"h2","lines":"2201,2202"}},{"content":"&#x1f3af; Obiettivo: Refinamento UI","children":[{"content":"&#x2705; Cosa aggiungiamo ora:","children":[{"content":"1. &#x2705; Interfaccia a schede (tab) per separare:","children":[{"content":"Dashboard","children":[],"payload":{"tag":"li","lines":"2212,2213"}},{"content":"Esecuzione Playbook","children":[],"payload":{"tag":"li","lines":"2213,2214"}},{"content":"Esecuzione OpenTofu","children":[],"payload":{"tag":"li","lines":"2214,2215"}},{"content":"Log Console","children":[],"payload":{"tag":"li","lines":"2215,2216"}}],"payload":{"tag":"li","lines":"2211,2216","listIndex":1}},{"content":"2. &#x2705; Selettore YAML da UI per i playbook disponibili","children":[],"payload":{"tag":"li","lines":"2216,2217","listIndex":2}},{"content":"3. &#x2705; Stato attivit&#xe0; con spinner, stato <code>running</code>/<code>completed</code>","children":[],"payload":{"tag":"li","lines":"2217,2218","listIndex":3}},{"content":"4. &#x2705; Dark mode toggle","children":[],"payload":{"tag":"li","lines":"2218,2219","listIndex":4}},{"content":"5. &#x1f9e0; Preparazione per:","children":[{"content":"Login utente","children":[],"payload":{"tag":"li","lines":"2220,2221"}},{"content":"Gestione ruoli","children":[],"payload":{"tag":"li","lines":"2221,2222"}},{"content":"Lista cronologica attivit&#xe0;","children":[],"payload":{"tag":"li","lines":"2222,2223"}}],"payload":{"tag":"li","lines":"2219,2223","listIndex":5}}],"payload":{"tag":"h3","lines":"2210,2211"}}],"payload":{"tag":"h2","lines":"2209,2210"}},{"content":"&#x1f9f1; Struttura rivisitata","children":[{"content":"<pre data-lines=\"2224,2232\"><code class=\"language-txt\">src/routes/\n&#x251c;&#x2500;&#x2500; +layout.svelte       &#x2192; layout comune (es. navbar)\n&#x251c;&#x2500;&#x2500; +layout.ts           &#x2192; setup app-wide (darkmode, auth, ecc.)\n&#x251c;&#x2500;&#x2500; +page.svelte         &#x2192; dashboard (tab interface)\n&#x251c;&#x2500;&#x2500; logs/+page.svelte    &#x2192; log console separata\n&#x2514;&#x2500;&#x2500; settings/+page.svelte &#x2192; preferenze (darkmode, ecc.)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2224,2232"}}],"payload":{"tag":"h2","lines":"2223,2224"}},{"content":"&#x2728; Step 1 &#x2013; Layout con Navbar + Dark Mode","children":[{"content":"<code>+layout.svelte</code>","children":[{"content":"<pre data-lines=\"2234,2258\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { page } from &apos;&#x24;app/stores&apos;;\n  let dark = false;\n\n  function toggleTheme() {\n    dark = !dark;\n    document.documentElement.classList.toggle(&apos;dark&apos;, dark);\n  }\n&lt;/script&gt;\n\n&lt;nav class=&quot;bg-gray-800 text-white p-4 flex justify-between items-center&quot;&gt;\n  &lt;div class=&quot;space-x-4&quot;&gt;\n    &lt;a href=&quot;/&quot; class=&quot;hover:underline&quot;&gt;Dashboard&lt;/a&gt;\n    &lt;a href=&quot;/logs&quot; class=&quot;hover:underline&quot;&gt;Logs&lt;/a&gt;\n    &lt;a href=&quot;/settings&quot; class=&quot;hover:underline&quot;&gt;Settings&lt;/a&gt;\n  &lt;/div&gt;\n  &lt;button on:click={toggleTheme}&gt;&#x1f313;&lt;/button&gt;\n&lt;/nav&gt;\n\n&lt;main class=&quot;p-6 bg-white dark:bg-gray-900 min-h-screen text-black dark:text-white&quot;&gt;\n  &lt;slot /&gt;\n&lt;/main&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2234,2258"}}],"payload":{"tag":"h3","lines":"2233,2234"}},{"content":"Global Tailwind (con dark mode)","children":[{"content":"<pre data-lines=\"2259,2268\"><code class=\"language-js\"><span class=\"hljs-comment\">// tailwind.config.js</span>\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = {\n  <span class=\"hljs-attr\">darkMode</span>: <span class=\"hljs-string\">&apos;class&apos;</span>, <span class=\"hljs-comment\">// &#x2b05;&#xfe0f; important</span>\n  <span class=\"hljs-attr\">content</span>: [<span class=\"hljs-string\">&apos;./src/**/*.{html,js,svelte,ts}&apos;</span>],\n  <span class=\"hljs-attr\">theme</span>: { <span class=\"hljs-attr\">extend</span>: {} },\n  <span class=\"hljs-attr\">plugins</span>: [],\n};\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2259,2268"}}],"payload":{"tag":"h3","lines":"2258,2259"}}],"payload":{"tag":"h2","lines":"2232,2233"}},{"content":"&#x1f9e0; Step 2 &#x2013; Tabbed Dashboard UI","children":[{"content":"<code>+page.svelte</code>","children":[{"content":"<pre data-lines=\"2270,2289\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import PlaybookRunner from &apos;&#x24;lib/PlaybookRunner.svelte&apos;;\n  import TofuRunner from &apos;&#x24;lib/TofuRunner.svelte&apos;;\n\n  let tab = &apos;playbook&apos;;\n&lt;/script&gt;\n\n&lt;div class=&quot;mb-4&quot;&gt;\n  &lt;button class=&quot;px-4 py-2 bg-blue-600 text-white mr-2&quot; on:click={() =&gt; tab = &apos;playbook&apos;}&gt;&#x1f4dc; Ansible&lt;/button&gt;\n  &lt;button class=&quot;px-4 py-2 bg-green-600 text-white&quot; on:click={() =&gt; tab = &apos;tofu&apos;}&gt;&#x1f331; OpenTofu&lt;/button&gt;\n&lt;/div&gt;\n\n{#if tab === &apos;playbook&apos;}\n  &lt;PlaybookRunner /&gt;\n{:else if tab === &apos;tofu&apos;}\n  &lt;TofuRunner /&gt;\n{/if}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2270,2289"}}],"payload":{"tag":"h3","lines":"2269,2270"}}],"payload":{"tag":"h2","lines":"2268,2269"}},{"content":"&#x1f4dc; Step 3 &#x2013; Componenti modulari","children":[{"content":"<code>lib/PlaybookRunner.svelte</code>","children":[{"content":"<pre data-lines=\"2291,2316\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { runPlaybook } from &apos;&#x24;lib/api&apos;;\n  import { connectToLogStream } from &apos;&#x24;lib/websocket&apos;;\n\n  let logs = &quot;&quot;, isRunning = false;\n\n  async function handleRun() {\n    isRunning = true;\n    logs = &quot;&quot;;\n    const { task_id } = await runPlaybook();\n    connectToLogStream(task_id, line =&gt; {\n      logs += line + &apos;\\n&apos;;\n    }).onclose = () =&gt; isRunning = false;\n  }\n&lt;/script&gt;\n\n&lt;div class=&quot;space-y-4&quot;&gt;\n  &lt;button on:click={handleRun} class=&quot;bg-blue-500 px-4 py-2 text-white rounded&quot;&gt;\n    {isRunning ? &quot;Running...&quot; : &quot;Run Playbook&quot;}\n  &lt;/button&gt;\n\n  &lt;pre class=&quot;bg-black text-green-400 p-4 rounded h-96 overflow-y-auto&quot;&gt;{logs}&lt;/pre&gt;\n&lt;/div&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2291,2316"}}],"payload":{"tag":"h3","lines":"2290,2291"}},{"content":"<code>lib/TofuRunner.svelte</code> &#x2013; simile, ma usa <code>runTofu()</code>","children":[],"payload":{"tag":"h3","lines":"2316,2317"}}],"payload":{"tag":"h2","lines":"2289,2290"}},{"content":"&#x1f9e9; Step 4 &#x2013; Logs pagina dedicata","children":[{"content":"<code>routes/logs/+page.svelte</code>","children":[{"content":"<pre data-lines=\"2319,2327\"><code class=\"language-svelte\">&lt;script&gt;\n  // In futuro: mostrare cronologia esecuzioni via API\n&lt;/script&gt;\n\n&lt;h1 class=&quot;text-xl font-bold mb-2&quot;&gt;Logs &amp; History&lt;/h1&gt;\n&lt;p&gt;Qui in futuro ci sar&#xe0; la cronologia delle esecuzioni completate.&lt;/p&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2319,2327"}}],"payload":{"tag":"h3","lines":"2318,2319"}}],"payload":{"tag":"h2","lines":"2317,2318"}},{"content":"&#x1f312; Step 5 &#x2013; Dark Mode persistente (localStorage)","children":[{"content":"<code>+layout.ts</code>","children":[{"content":"<pre data-lines=\"2329,2337\"><code class=\"language-ts\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">load</span> = (<span class=\"hljs-params\"></span>) =&gt; {\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-variable language_\">localStorage</span> !== <span class=\"hljs-string\">&apos;undefined&apos;</span>) {\n    <span class=\"hljs-keyword\">const</span> dark = <span class=\"hljs-variable language_\">localStorage</span>.<span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-string\">&apos;theme&apos;</span>) === <span class=\"hljs-string\">&apos;dark&apos;</span>;\n    <span class=\"hljs-keyword\">if</span> (dark) <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span>.<span class=\"hljs-property\">classList</span>.<span class=\"hljs-title function_\">add</span>(<span class=\"hljs-string\">&apos;dark&apos;</span>);\n  }\n};\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2329,2337"}}],"payload":{"tag":"h3","lines":"2328,2329"}}],"payload":{"tag":"h2","lines":"2327,2328"}},{"content":"&#x1f3af; Risultato finale","children":[{"content":"<table data-lines=\"2338,2349\">\n<thead data-lines=\"2338,2339\">\n<tr data-lines=\"2338,2339\">\n<th>Funzione</th>\n<th>Stato</th>\n</tr>\n</thead>\n<tbody data-lines=\"2340,2349\">\n<tr data-lines=\"2340,2341\">\n<td>UI a schede</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2341,2342\">\n<td>Log realtime</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2342,2343\">\n<td>Run Playbook</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2343,2344\">\n<td>Run Tofu</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2344,2345\">\n<td>Dark Mode</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2345,2346\">\n<td>Moduli separati</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2346,2347\">\n<td>Cronologia Logs</td>\n<td>&#x1f7e1; Strutturata, da implementare</td>\n</tr>\n<tr data-lines=\"2347,2348\">\n<td>Editor YAML inline</td>\n<td>&#x1f51c; Prossimo step</td>\n</tr>\n<tr data-lines=\"2348,2349\">\n<td>Autenticazione OAuth</td>\n<td>&#x1f51c; Modulo 4</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2338,2349"}}],"payload":{"tag":"h2","lines":"2337,2338"}},{"content":"&#x2728; Prossimi miglioramenti UI (se vuoi):","children":[{"content":"","children":[{"content":"Editor YAML online (con Monaco o CodeMirror)","children":[],"payload":{"tag":"li","lines":"2350,2351"}},{"content":"Upload di file <code>.yml</code> / <code>.tf</code>","children":[],"payload":{"tag":"li","lines":"2351,2352"}},{"content":"Gestione variabili da UI","children":[],"payload":{"tag":"li","lines":"2352,2353"}},{"content":"Modalit&#xe0; split log/output","children":[],"payload":{"tag":"li","lines":"2353,2354"}},{"content":"Notifiche Toast per successo/errore<br>\n&#x1f7e2; Se vuoi, possiamo ora:","children":[],"payload":{"tag":"li","lines":"2354,2356"}}],"payload":{"tag":"ul","lines":"2350,2356"}},{"content":"","children":[{"content":"1. Procedere con <strong>Modulo 4: Autenticazione GitHub/GitLab</strong>","children":[],"payload":{"tag":"li","lines":"2356,2357","listIndex":1}},{"content":"2. Continuare con <strong>Cronologia attivit&#xe0; + database</strong>","children":[],"payload":{"tag":"li","lines":"2357,2358","listIndex":2}},{"content":"3. Integrare <strong>editor YAML/TF da browser</strong><br>\nA te la scelta!<br>\nQuello che segue &#xe8; un progetto <strong>frontend modulare e maturo</strong>, pronto per essere usato in produzione o in un contesto DevOps interno. Sar&#xe0; il cuore visivo della tua piattaforma di automazione infrastrutturale dichiarativa.","children":[],"payload":{"tag":"li","lines":"2358,2361","listIndex":3}}],"payload":{"tag":"ol","lines":"2356,2361"}}],"payload":{"tag":"h2","lines":"2349,2350"}}],"payload":{"tag":"h1","lines":"2060,2061"}},{"content":"&#x1f9e0; Obiettivo","children":[{"content":"&#x1f9f1; Stack frontend aggiornato","children":[{"content":"<table data-lines=\"2372,2380\">\n<thead data-lines=\"2372,2373\">\n<tr data-lines=\"2372,2373\">\n<th>Tecnologia</th>\n<th>Scopo</th>\n</tr>\n</thead>\n<tbody data-lines=\"2374,2380\">\n<tr data-lines=\"2374,2375\">\n<td><strong>SvelteKit</strong></td>\n<td>Framework UI moderno (routing + SSR)</td>\n</tr>\n<tr data-lines=\"2375,2376\">\n<td><strong>TailwindCSS</strong></td>\n<td>Styling rapido e dark mode</td>\n</tr>\n<tr data-lines=\"2376,2377\">\n<td><strong>Monaco Editor</strong></td>\n<td>Editing YAML/TF con syntax highlight</td>\n</tr>\n<tr data-lines=\"2377,2378\">\n<td><strong>Socket/WebSocket</strong></td>\n<td>Log realtime</td>\n</tr>\n<tr data-lines=\"2378,2379\">\n<td><strong>SweetAlert2</strong></td>\n<td>Notifiche toast moderne</td>\n</tr>\n<tr data-lines=\"2379,2380\">\n<td><strong>localStorage</strong></td>\n<td>Persistenza dark mode &amp; settings</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2372,2380"}}],"payload":{"tag":"h2","lines":"2371,2372"}}],"payload":{"tag":"h1","lines":"2361,2362"}},{"content":"&#x2705; Funzionalit&#xe0;: Come vengono implementate","children":[{"content":"&#x1f4c1; Esempio struttura frontend aggiornata","children":[{"content":"<pre data-lines=\"2519,2541\"><code class=\"language-txt\">frontend/\n&#x251c;&#x2500;&#x2500; src/\n&#x2502;   &#x251c;&#x2500;&#x2500; lib/\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; api.ts\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; websocket.ts\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; components/\n&#x2502;   &#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; Editor.svelte\n&#x2502;   &#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; PlaybookRunner.svelte\n&#x2502;   &#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; TofuRunner.svelte\n&#x2502;   &#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; SplitRunner.svelte\n&#x2502;   &#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; RecentTasks.svelte\n&#x2502;   &#x251c;&#x2500;&#x2500; routes/\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; +layout.svelte\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; +page.svelte\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; logs/+page.svelte\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; settings/+page.svelte\n&#x251c;&#x2500;&#x2500; static/\n&#x251c;&#x2500;&#x2500; tailwind.config.js\n&#x251c;&#x2500;&#x2500; package.json\n&#x2514;&#x2500;&#x2500; vite.config.js\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2519,2541"}}],"payload":{"tag":"h2","lines":"2518,2519"}},{"content":"&#x2705; Progresso funzionalit&#xe0;","children":[{"content":"<table data-lines=\"2542,2553\">\n<thead data-lines=\"2542,2543\">\n<tr data-lines=\"2542,2543\">\n<th>Funzionalit&#xe0;</th>\n<th>Stato</th>\n</tr>\n</thead>\n<tbody data-lines=\"2544,2553\">\n<tr data-lines=\"2544,2545\">\n<td>Editor YAML integrato</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2545,2546\">\n<td>Upload file <code>.yml</code> / <code>.tf</code></td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2546,2547\">\n<td>Gestione variabili UI</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2547,2548\">\n<td>Modalit&#xe0; split log/output</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2548,2549\">\n<td>Notifiche toast</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2549,2550\">\n<td>Lista task recenti</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2550,2551\">\n<td>Tab UI Playbook/Tofu/Log</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2551,2552\">\n<td>Modalit&#xe0; Dark</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"2552,2553\">\n<td>Hosting statico (Vite / nginx / Codeberg)</td>\n<td>&#x2705; Pronto</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2542,2553"}}],"payload":{"tag":"h2","lines":"2541,2542"}},{"content":"&#x1f51c; Prossimi moduli (se vuoi):","children":[{"content":"","children":[{"content":"1. &#x1f510; <strong>Modulo 4 &#x2013; Autenticazione OAuth GitHub/GitLab</strong>","children":[],"payload":{"tag":"li","lines":"2554,2555","listIndex":1}},{"content":"2. &#x1f9e0; <strong>Modulo 5 &#x2013; Backend DB per task &amp; cronologia</strong>","children":[],"payload":{"tag":"li","lines":"2555,2556","listIndex":2}},{"content":"3. &#x1f4e6; <strong>Modulo 6 &#x2013; Packaging Helm + K8s deployment</strong><br>\nTi interessa procedere con uno di questi?<br>\nOppure vuoi che prepari direttamente la struttura <code>docker-compose</code> aggiornata, o uno script <code>make dev</code>?<br>\nOttimo, procediamo con una proposta architetturale + codice per:","children":[],"payload":{"tag":"li","lines":"2556,2560","listIndex":3}}],"payload":{"tag":"ol","lines":"2554,2560"}},{"content":"","children":[{"content":"<strong>Modulo 4: Autenticazione GitHub / GitLab (OAuth2)</strong>","children":[],"payload":{"tag":"li","lines":"2560,2561"}},{"content":"<strong>Modulo 5: Backend DB per task &amp; cronologia</strong><br>\nAlla fine avrai un backend che gestisce utenti via OAuth, registra task con stato, cronologia, e che puoi proteggere con permessi.","children":[],"payload":{"tag":"li","lines":"2561,2563"}}],"payload":{"tag":"ul","lines":"2560,2563"}}],"payload":{"tag":"h2","lines":"2553,2554"}},{"content":"Design ad alto livello: autenticazione + cronologia task","children":[{"content":"Concetti chiave","children":[{"content":"1. <strong>Utenti/Account</strong> &#x2013; identit&#xe0; legata a GitHub / GitLab tramite OAuth2.","children":[],"payload":{"tag":"li","lines":"2565,2566","listIndex":1}},{"content":"2. <strong>Ruoli / permessi</strong> &#x2013; ad esempio <code>admin</code>, <code>user</code>, <code>readonly</code>, per controllare chi pu&#xf2; lanciare playbook / tofu.","children":[],"payload":{"tag":"li","lines":"2566,2567","listIndex":2}},{"content":"3. <strong>Task / ExecutionLog</strong> &#x2013; ogni esecuzione di playbook/tofu &#xe8; un record nel DB: id, tipo, stato (<code>pending</code>, <code>running</code>, <code>success</code>, <code>failure</code>), timestamp, utente che l&#x2019;ha avviato, log path o puntatore a storage.","children":[],"payload":{"tag":"li","lines":"2567,2568","listIndex":3}},{"content":"4. <strong>Endpoint protetti</strong> &#x2013; solo utenti autenticati con certo ruolo possono chiamare <code>/run/</code>, <code>/run/tofu/</code> etc.","children":[],"payload":{"tag":"li","lines":"2568,2569","listIndex":4}},{"content":"5. <strong>WebSocket + DB sincronizzazione</strong> &#x2013; al termine del task, aggiorna lo stato nel DB, memorizza log o metadati.","children":[],"payload":{"tag":"li","lines":"2569,2570","listIndex":5}}],"payload":{"tag":"h3","lines":"2564,2565"}}],"payload":{"tag":"h2","lines":"2563,2564"}},{"content":"Scelta tecnologia per persistenza","children":[{"content":"<strong>SQLAlchemy 1.4+ / SQLModel</strong> oppure uso diretto di SQLAlchemy ORM + Pydantic per modelli.","children":[],"payload":{"tag":"li","lines":"2571,2572"}},{"content":"<strong>Database</strong>: SQLite per prototipo, PostgreSQL in produzione.","children":[],"payload":{"tag":"li","lines":"2572,2573"}},{"content":"<strong>Sessioni asincrone</strong> (AsyncSession) per compatibilit&#xe0; con FastAPI.<br>\nConsiglio: usare <strong>FastAPI Users</strong> (modulo <code>fastapi-users</code>) che supporta OAuth2, modelli utenti e integrazione OAuth. ([FastAPI Users][1])","children":[],"payload":{"tag":"li","lines":"2573,2575"}}],"payload":{"tag":"h2","lines":"2570,2571"}},{"content":"Struttura del backend aggiornata","children":[{"content":"<pre data-lines=\"2576,2592\"><code data-lines=\"2576,2592\">backend/\n&#x251c;&#x2500;&#x2500; app/\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-tag\">main</span><span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; auth<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; models<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; schemas<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; crud<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; tasks<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; websocket<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; log_queue<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; config<span class=\"hljs-selector-class\">.py</span>\n&#x251c;&#x2500;&#x2500; requirements<span class=\"hljs-selector-class\">.txt</span>\n&#x2514;&#x2500;&#x2500; tests/\n    &#x2514;&#x2500;&#x2500; test_auth_task<span class=\"hljs-selector-class\">.py</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2576,2592"}}],"payload":{"tag":"h2","lines":"2575,2576"}},{"content":"Codice di esempio","children":[{"content":"<code>requirements.txt</code>","children":[{"content":"<pre data-lines=\"2594,2605\"><code class=\"language-text\">fastapi\nuvicorn[standard]\ncelery\nredis\nsqlalchemy&gt;=1.4\nasyncpg\nfastapi-users[sqlalchemy, oauth]\npython-dotenv\nhttpx\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2594,2605"}}],"payload":{"tag":"h3","lines":"2593,2594"}},{"content":"<code>config.py</code>","children":[{"content":"<pre data-lines=\"2606,2617\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">from</span> dotenv <span class=\"hljs-keyword\">import</span> load_dotenv\n\nload_dotenv()\n\nDATABASE_URL = os.getenv(<span class=\"hljs-string\">&quot;DATABASE_URL&quot;</span>, <span class=\"hljs-string\">&quot;postgresql+asyncpg://user:pass@db:5432/infraflow&quot;</span>)\nSECRET = os.getenv(<span class=\"hljs-string\">&quot;SECRET_KEY&quot;</span>, <span class=\"hljs-string\">&quot;supersecretkey&quot;</span>)\nGITHUB_CLIENT_ID = os.getenv(<span class=\"hljs-string\">&quot;GITHUB_CLIENT_ID&quot;</span>, <span class=\"hljs-string\">&quot;&quot;</span>)\nGITHUB_CLIENT_SECRET = os.getenv(<span class=\"hljs-string\">&quot;GITHUB_CLIENT_SECRET&quot;</span>, <span class=\"hljs-string\">&quot;&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2606,2617"}}],"payload":{"tag":"h3","lines":"2605,2606"}},{"content":"<code>models.py</code>","children":[{"content":"<pre data-lines=\"2618,2661\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> sqlalchemy <span class=\"hljs-keyword\">import</span> Column, String, Integer, DateTime, ForeignKey, func, Enum\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> relationship\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.declarative <span class=\"hljs-keyword\">import</span> declarative_base\n<span class=\"hljs-keyword\">import</span> enum\n\nBase = declarative_base()\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">RoleEnum</span>(<span class=\"hljs-built_in\">str</span>, enum.Enum):\n    admin = <span class=\"hljs-string\">&quot;admin&quot;</span>\n    user = <span class=\"hljs-string\">&quot;user&quot;</span>\n    viewer = <span class=\"hljs-string\">&quot;viewer&quot;</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(<span class=\"hljs-title class_ inherited__\">Base</span>):\n    __tablename__ = <span class=\"hljs-string\">&quot;user&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    email = Column(String, unique=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>, nullable=<span class=\"hljs-literal\">False</span>)\n    hashed_password = Column(String, nullable=<span class=\"hljs-literal\">True</span>)\n    is_active = Column(Integer, default=<span class=\"hljs-number\">1</span>)\n    role = Column(Enum(RoleEnum), default=RoleEnum.user)\n\n    oauth_accounts = relationship(<span class=\"hljs-string\">&quot;OAuthAccount&quot;</span>, back_populates=<span class=\"hljs-string\">&quot;user&quot;</span>)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OAuthAccount</span>(<span class=\"hljs-title class_ inherited__\">Base</span>):\n    __tablename__ = <span class=\"hljs-string\">&quot;oauth_account&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    user_id = Column(Integer, ForeignKey(<span class=\"hljs-string\">&quot;user.id&quot;</span>, ondelete=<span class=\"hljs-string\">&quot;cascade&quot;</span>), nullable=<span class=\"hljs-literal\">False</span>)\n    oauth_name = Column(String, nullable=<span class=\"hljs-literal\">False</span>)  <span class=\"hljs-comment\"># e.g. &quot;github&quot;, &quot;gitlab&quot;</span>\n    oauth_account_id = Column(String, nullable=<span class=\"hljs-literal\">False</span>)\n    user = relationship(<span class=\"hljs-string\">&quot;User&quot;</span>, back_populates=<span class=\"hljs-string\">&quot;oauth_accounts&quot;</span>)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TaskRecord</span>(<span class=\"hljs-title class_ inherited__\">Base</span>):\n    __tablename__ = <span class=\"hljs-string\">&quot;task_record&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    task_id = Column(String, unique=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    <span class=\"hljs-built_in\">type</span> = Column(String)  <span class=\"hljs-comment\"># &quot;ansible&quot; or &quot;tofu&quot;</span>\n    status = Column(String, default=<span class=\"hljs-string\">&quot;pending&quot;</span>)\n    user_id = Column(Integer, ForeignKey(<span class=\"hljs-string\">&quot;user.id&quot;</span>, ondelete=<span class=\"hljs-string\">&quot;set null&quot;</span>))\n    created_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), server_default=func.now())\n    finished_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), nullable=<span class=\"hljs-literal\">True</span>)\n\n    user = relationship(<span class=\"hljs-string\">&quot;User&quot;</span>, backref=<span class=\"hljs-string\">&quot;tasks&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2618,2661"}}],"payload":{"tag":"h3","lines":"2617,2618"}},{"content":"<code>schemas.py</code>","children":[{"content":"<pre data-lines=\"2662,2684\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseModel\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">Optional</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-built_in\">id</span>: <span class=\"hljs-built_in\">int</span>\n    email: <span class=\"hljs-built_in\">str</span>\n    role: <span class=\"hljs-built_in\">str</span>\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TaskRecordRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    task_id: <span class=\"hljs-built_in\">str</span>\n    <span class=\"hljs-built_in\">type</span>: <span class=\"hljs-built_in\">str</span>\n    status: <span class=\"hljs-built_in\">str</span>\n    user_id: <span class=\"hljs-type\">Optional</span>[<span class=\"hljs-built_in\">int</span>]\n    created_at: datetime\n    finished_at: <span class=\"hljs-type\">Optional</span>[datetime]\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2662,2684"}}],"payload":{"tag":"h3","lines":"2661,2662"}},{"content":"<code>crud.py</code>","children":[{"content":"<pre data-lines=\"2685,2713\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession\n<span class=\"hljs-keyword\">from</span> sqlalchemy.future <span class=\"hljs-keyword\">import</span> select\n<span class=\"hljs-keyword\">from</span> . <span class=\"hljs-keyword\">import</span> models\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">create_task_record</span>(<span class=\"hljs-params\">db: AsyncSession, task_id: <span class=\"hljs-built_in\">str</span>, type_: <span class=\"hljs-built_in\">str</span>, user_id: <span class=\"hljs-built_in\">int</span></span>):\n    rec = models.TaskRecord(task_id=task_id, <span class=\"hljs-built_in\">type</span>=type_, user_id=user_id)\n    db.add(rec)\n    <span class=\"hljs-keyword\">await</span> db.commit()\n    <span class=\"hljs-keyword\">await</span> db.refresh(rec)\n    <span class=\"hljs-keyword\">return</span> rec\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">update_task_status</span>(<span class=\"hljs-params\">db: AsyncSession, task_id: <span class=\"hljs-built_in\">str</span>, status: <span class=\"hljs-built_in\">str</span></span>):\n    q = <span class=\"hljs-keyword\">await</span> db.execute(select(models.TaskRecord).<span class=\"hljs-built_in\">filter</span>(models.TaskRecord.task_id == task_id))\n    rec = q.scalars().first()\n    <span class=\"hljs-keyword\">if</span> rec:\n        rec.status = status\n        <span class=\"hljs-keyword\">if</span> status <span class=\"hljs-keyword\">in</span> (<span class=\"hljs-string\">&quot;success&quot;</span>, <span class=\"hljs-string\">&quot;failure&quot;</span>):\n            <span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n            rec.finished_at = datetime.utcnow()\n        <span class=\"hljs-keyword\">await</span> db.commit()\n        <span class=\"hljs-keyword\">await</span> db.refresh(rec)\n    <span class=\"hljs-keyword\">return</span> rec\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">list_tasks</span>(<span class=\"hljs-params\">db: AsyncSession, limit: <span class=\"hljs-built_in\">int</span> = <span class=\"hljs-number\">20</span></span>):\n    q = <span class=\"hljs-keyword\">await</span> db.execute(select(models.TaskRecord).order_by(models.TaskRecord.created_at.desc()).limit(limit))\n    <span class=\"hljs-keyword\">return</span> q.scalars().<span class=\"hljs-built_in\">all</span>()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2685,2713"}}],"payload":{"tag":"h3","lines":"2684,2685"}},{"content":"<code>auth.py</code>","children":[{"content":"<pre data-lines=\"2714,2792\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> Depends, HTTPException\n<span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> FastAPIUsers, models <span class=\"hljs-keyword\">as</span> fa_models\n<span class=\"hljs-keyword\">from</span> fastapi_users.db <span class=\"hljs-keyword\">import</span> SQLAlchemyUserDatabase, SQLAlchemyBaseOAuthAccountTable\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> JWTStrategy\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> AuthenticationBackend\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> BearerTransport\n<span class=\"hljs-keyword\">from</span> fastapi_users.oauth <span class=\"hljs-keyword\">import</span> OAuthAccount\n<span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> schemas <span class=\"hljs-keyword\">as</span> fa_schemas\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession, create_async_engine\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> sessionmaker\n<span class=\"hljs-keyword\">from</span> .config <span class=\"hljs-keyword\">import</span> SECRET, GITHUB_CLIENT_ID, GITHUB_CLIENT_SECRET\n<span class=\"hljs-keyword\">from</span> .models <span class=\"hljs-keyword\">import</span> Base, User, OAuthAccount <span class=\"hljs-keyword\">as</span> AppOAuthAccount\n<span class=\"hljs-keyword\">from</span> .config <span class=\"hljs-keyword\">import</span> DATABASE_URL\n<span class=\"hljs-keyword\">import</span> os\n\n<span class=\"hljs-comment\"># DB setup</span>\nengine = create_async_engine(DATABASE_URL, echo=<span class=\"hljs-literal\">True</span>)\nasync_session = sessionmaker(engine, expire_on_commit=<span class=\"hljs-literal\">False</span>, class_=AsyncSession)\n\n<span class=\"hljs-comment\"># User models</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(models.BaseUser):\n    role: <span class=\"hljs-built_in\">str</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserCreate</span>(models.BaseUserCreate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserUpdate</span>(models.BaseUserUpdate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserDB</span>(models.BaseUserDB, models.Base):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OAuthAccountModel</span>(SQLAlchemyBaseOAuthAccountTable[<span class=\"hljs-built_in\">int</span>], Base):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-comment\"># Instantiate user DB adapter</span>\nuser_db = SQLAlchemyUserDatabase(UserDB, async_session, OAuthAccountModel)\n\n<span class=\"hljs-comment\"># JWT auth backend</span>\nbearer_transport = BearerTransport(tokenUrl=<span class=\"hljs-string\">&quot;auth/jwt/login&quot;</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_jwt_strategy</span>() -&gt; JWTStrategy:\n    <span class=\"hljs-keyword\">return</span> JWTStrategy(secret=SECRET, lifetime_seconds=<span class=\"hljs-number\">3600</span>)\n\nauth_backend = AuthenticationBackend(\n    name=<span class=\"hljs-string\">&quot;jwt&quot;</span>,\n    transport=bearer_transport,\n    get_strategy=get_jwt_strategy,\n)\n\nfastapi_users = FastAPIUsers(\n    user_db,\n    [auth_backend],\n    User,\n    UserCreate,\n    UserUpdate,\n    UserDB,\n)\n\n<span class=\"hljs-comment\"># Routers to include</span>\ncurrent_active_user = fastapi_users.current_user(active=<span class=\"hljs-literal\">True</span>)\noauth_router = fastapi_users.get_oauth_router(\n    client_id=GITHUB_CLIENT_ID,\n    client_secret=GITHUB_CLIENT_SECRET,\n    name=<span class=\"hljs-string\">&quot;github&quot;</span>,\n    after_login=<span class=\"hljs-keyword\">lambda</span> user, token: user,\n)\n\njwt_router = fastapi_users.get_auth_router(auth_backend)\n\n<span class=\"hljs-comment\"># Dependable that returns user or raises</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">require_admin</span>(<span class=\"hljs-params\">user=Depends(<span class=\"hljs-params\">current_active_user</span>)</span>):\n    <span class=\"hljs-keyword\">from</span> .models <span class=\"hljs-keyword\">import</span> RoleEnum\n    <span class=\"hljs-keyword\">if</span> user.role != RoleEnum.admin.value:\n        <span class=\"hljs-keyword\">raise</span> HTTPException(status_code=<span class=\"hljs-number\">403</span>, detail=<span class=\"hljs-string\">&quot;Not allowed&quot;</span>)\n    <span class=\"hljs-keyword\">return</span> user\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2714,2792"}}],"payload":{"tag":"h3","lines":"2713,2714"}},{"content":"<code>main.py</code> &#x2013; integrazione autentificazione","children":[{"content":"<pre data-lines=\"2793,2859\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI, Depends\n<span class=\"hljs-keyword\">from</span> .auth <span class=\"hljs-keyword\">import</span> fastapi_users, oauth_router, jwt_router, current_active_user\n<span class=\"hljs-keyword\">from</span> .tasks <span class=\"hljs-keyword\">import</span> run_playbook, run_tofu\n<span class=\"hljs-keyword\">from</span> .websocket <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> websocket_router\n<span class=\"hljs-keyword\">from</span> .crud <span class=\"hljs-keyword\">import</span> create_task_record, update_task_status, list_tasks\n<span class=\"hljs-keyword\">from</span> .config <span class=\"hljs-keyword\">import</span> SECRET\n<span class=\"hljs-keyword\">from</span> fastapi.middleware.cors <span class=\"hljs-keyword\">import</span> CORSMiddleware\n<span class=\"hljs-keyword\">import</span> uuid\n\napp = FastAPI()\n\napp.include_router(jwt_router, prefix=<span class=\"hljs-string\">&quot;/auth/jwt&quot;</span>, tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>])\napp.include_router(oauth_router, prefix=<span class=\"hljs-string\">&quot;/auth/github&quot;</span>, tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>])\napp.include_router(websocket_router)\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_credentials=<span class=\"hljs-literal\">True</span>,\n    allow_methods=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_headers=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook_endpoint</span>(<span class=\"hljs-params\">user=Depends(<span class=\"hljs-params\">current_active_user</span>)</span>):\n    task_id = <span class=\"hljs-built_in\">str</span>(uuid.uuid4())\n    <span class=\"hljs-comment\"># registra prima che parta</span>\n    <span class=\"hljs-keyword\">from</span> .database <span class=\"hljs-keyword\">import</span> get_db\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> get_db() <span class=\"hljs-keyword\">as</span> db:\n        <span class=\"hljs-keyword\">await</span> create_task_record(db, task_id, <span class=\"hljs-string\">&quot;ansible&quot;</span>, user.<span class=\"hljs-built_in\">id</span>)\n    <span class=\"hljs-comment\"># esecuzione in background</span>\n    run_playbook.delay(task_id, <span class=\"hljs-string\">&quot;examples/playbook-sample.yml&quot;</span>)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task_id}\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/tofu/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_tofu_endpoint</span>(<span class=\"hljs-params\">user=Depends(<span class=\"hljs-params\">current_active_user</span>)</span>):\n    task_id = <span class=\"hljs-built_in\">str</span>(uuid.uuid4())\n    <span class=\"hljs-keyword\">from</span> .database <span class=\"hljs-keyword\">import</span> get_db\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> get_db() <span class=\"hljs-keyword\">as</span> db:\n        <span class=\"hljs-keyword\">await</span> create_task_record(db, task_id, <span class=\"hljs-string\">&quot;tofu&quot;</span>, user.<span class=\"hljs-built_in\">id</span>)\n    run_tofu.delay(task_id, <span class=\"hljs-string\">&quot;infrastructure/sample&quot;</span>)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task_id}\n\n<span class=\"hljs-meta\">@app.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/tasks/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_tasks</span>(<span class=\"hljs-params\">user=Depends(<span class=\"hljs-params\">current_active_user</span>)</span>):\n    <span class=\"hljs-keyword\">from</span> .database <span class=\"hljs-keyword\">import</span> get_db\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> get_db() <span class=\"hljs-keyword\">as</span> db:\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> list_tasks(db)\n\n<span class=\"hljs-comment\"># Quando log queue segnala &#x201c;end&#x201d;, possiamo aggiornare stato</span>\n<span class=\"hljs-comment\"># Puoi usare signal task_complete, o patch run_playbook / run_tofu</span>\n\n<span class=\"hljs-comment\"># At startup, crea tabelle</span>\n<span class=\"hljs-keyword\">from</span> .models <span class=\"hljs-keyword\">import</span> Base\n<span class=\"hljs-keyword\">from</span> .config <span class=\"hljs-keyword\">import</span> DATABASE_URL\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> create_async_engine\n<span class=\"hljs-keyword\">from</span> sqlalchemy <span class=\"hljs-keyword\">import</span> select\n\n<span class=\"hljs-meta\">@app.on_event(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;startup&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">on_startup</span>():\n    <span class=\"hljs-keyword\">from</span> sqlalchemy.engine <span class=\"hljs-keyword\">import</span> Engine\n    engine = create_async_engine(DATABASE_URL)\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> engine.begin() <span class=\"hljs-keyword\">as</span> conn:\n        <span class=\"hljs-keyword\">await</span> conn.run_sync(Base.metadata.create_all)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2793,2859"}}],"payload":{"tag":"h3","lines":"2792,2793"}},{"content":"<code>database.py</code>","children":[{"content":"<pre data-lines=\"2860,2872\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> .config <span class=\"hljs-keyword\">import</span> DATABASE_URL\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> create_async_engine, AsyncSession\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> sessionmaker\n\nengine = create_async_engine(DATABASE_URL, echo=<span class=\"hljs-literal\">True</span>)\nAsyncSessionLocal = sessionmaker(engine, class_=AsyncSession, expire_on_commit=<span class=\"hljs-literal\">False</span>)\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_db</span>():\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> AsyncSessionLocal() <span class=\"hljs-keyword\">as</span> session:\n        <span class=\"hljs-keyword\">yield</span> session\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2860,2872"}}],"payload":{"tag":"h3","lines":"2859,2860"}},{"content":"Estendere <code>tasks.py</code> per aggiornare DB","children":[{"content":"<pre data-lines=\"2873,2909\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/tasks.py (modifica run_playbook e run_tofu)</span>\n<span class=\"hljs-keyword\">from</span> .crud <span class=\"hljs-keyword\">import</span> update_task_status\n<span class=\"hljs-keyword\">from</span> .database <span class=\"hljs-keyword\">import</span> AsyncSessionLocal\n<span class=\"hljs-keyword\">import</span> asyncio\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">update_status_sync</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span>, status: <span class=\"hljs-built_in\">str</span></span>):\n    <span class=\"hljs-comment\"># helper per chiamare crud.update_task_status in contesto async</span>\n    <span class=\"hljs-keyword\">import</span> asyncio\n    loop = asyncio.get_event_loop()\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">_upd</span>():\n        <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> AsyncSessionLocal() <span class=\"hljs-keyword\">as</span> db:\n            <span class=\"hljs-keyword\">await</span> update_task_status(db, task_id, status)\n    loop.create_task(_upd())\n\n<span class=\"hljs-meta\">@shared_task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span>, playbook_path: <span class=\"hljs-built_in\">str</span></span>):\n    update_status_sync(task_id, <span class=\"hljs-string\">&quot;running&quot;</span>)\n    queue = get_log_queue(task_id)\n    <span class=\"hljs-keyword\">try</span>:\n        process = subprocess.Popen([...])\n        <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> process.stdout:\n            queue.put_nowait(line.strip())\n        process.wait()\n        <span class=\"hljs-keyword\">if</span> process.returncode == <span class=\"hljs-number\">0</span>:\n            update_status_sync(task_id, <span class=\"hljs-string\">&quot;success&quot;</span>)\n        <span class=\"hljs-keyword\">else</span>:\n            update_status_sync(task_id, <span class=\"hljs-string\">&quot;failure&quot;</span>)\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[exit] code: <span class=\"hljs-subst\">{process.returncode}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        update_status_sync(task_id, <span class=\"hljs-string\">&quot;failure&quot;</span>)\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[error] <span class=\"hljs-subst\">{<span class=\"hljs-built_in\">str</span>(e)}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">finally</span>:\n        queue.put_nowait(<span class=\"hljs-string\">&quot;[end]&quot;</span>)\n        remove_log_queue(task_id)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2873,2909"}}],"payload":{"tag":"h3","lines":"2872,2873"}}],"payload":{"tag":"h2","lines":"2592,2593"}},{"content":"Punti da affinare / note","children":[{"content":"La libreria <strong>FastAPI Users</strong> offre supporto OAuth2 integrato con backend SQLAlchemy. ([FastAPI Users][1])","children":[],"payload":{"tag":"li","lines":"2910,2911"}},{"content":"Ho semplificato molte parti per chiarezza, ma in un sistema reale serve:","children":[{"content":"Gestione errori robusta","children":[],"payload":{"tag":"li","lines":"2912,2913"}},{"content":"Timeout, retry, rollback","children":[],"payload":{"tag":"li","lines":"2913,2914"}},{"content":"Validazione input","children":[],"payload":{"tag":"li","lines":"2914,2915"}},{"content":"Controlli di sicurezza (CORS, CSRF, scoping)","children":[],"payload":{"tag":"li","lines":"2915,2916"}},{"content":"Sicurezza nei WebSocket (verifica token, autenticazione)<br>\nVuoi che prepari anche quella parte?<br>\n[1]: https://fastapi-users.github.io/fastapi-users/9.3/configuration/oauth/?utm_source=chatgpt.com &quot;OAuth2 - FastAPI Users&quot;<br>\nOttimo: procediamo con il <strong>codice frontend aggiornato</strong> per supportare login/logout tramite OAuth (GitHub/GitLab) + visualizzazione utente corrente + protezione UI + interfaccia per task recenti + aggiornamenti in base al ruolo.<br>\nTi presenter&#xf2; uno sketch coerente con il backend che abbiamo delineato (FastAPI + <code>fastapi-users</code> + OAuth) e mostrarti come integrare tutto in SvelteKit.","children":[],"payload":{"tag":"li","lines":"2916,2921"}}],"payload":{"tag":"li","lines":"2911,2921"}}],"payload":{"tag":"h2","lines":"2909,2910"}},{"content":"&#x1f3af; Frontend: Autenticazione, protezione, visualizzazione utente","children":[{"content":"&#x1f527; Dipendenze da installare","children":[{"content":"<pre data-lines=\"2924,2929\"><code class=\"language-bash\">npm install @auth/core @auth/sveltekit\nnpm install axios\nnpm install svelte-toastify\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2924,2929"}}],"payload":{"tag":"h3","lines":"2922,2923"}}],"payload":{"tag":"h2","lines":"2921,2922"}},{"content":"&#x1f9f1; Struttura modificata del frontend","children":[{"content":"<pre data-lines=\"2934,2958\"><code data-lines=\"2934,2958\">src<span class=\"hljs-symbol\">/</span>\n&#x251c;&#x2500;&#x2500; lib<span class=\"hljs-symbol\">/</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; api.ts\n&#x2502;   &#x251c;&#x2500;&#x2500; websocket.ts\n&#x2502;   &#x251c;&#x2500;&#x2500; auth.ts        <span class=\"hljs-comment\"># funzioni auth client</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; components<span class=\"hljs-symbol\">/</span>\n&#x2502;       &#x251c;&#x2500;&#x2500; Editor.svelte\n&#x2502;       &#x251c;&#x2500;&#x2500; PlaybookRunner.svelte\n&#x2502;       &#x251c;&#x2500;&#x2500; TofuRunner.svelte\n&#x2502;       &#x251c;&#x2500;&#x2500; SplitRunner.svelte\n&#x2502;       &#x251c;&#x2500;&#x2500; RecentTasks.svelte\n&#x2502;       &#x251c;&#x2500;&#x2500; Login.svelte\n&#x2502;       &#x2514;&#x2500;&#x2500; NavBar.svelte\n&#x251c;&#x2500;&#x2500; routes<span class=\"hljs-symbol\">/</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-operator\">+</span>layout.svelte\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-operator\">+</span>layout.ts\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-operator\">+</span>page.svelte        <span class=\"hljs-comment\"># dashboard (protetto)</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; login<span class=\"hljs-symbol\">/+page.svelte</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; callback<span class=\"hljs-symbol\">/+page.svelte</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; tasks<span class=\"hljs-symbol\">/+page.svelte</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; logs<span class=\"hljs-symbol\">/+page.svelte</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; settings<span class=\"hljs-symbol\">/+page.svelte</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2934,2958"}}],"payload":{"tag":"h2","lines":"2932,2933"}},{"content":"&#x1f4c3; File chiave","children":[{"content":"<code>src/lib/auth.ts</code>","children":[{"content":"<pre data-lines=\"2960,2985\"><code class=\"language-ts\"><span class=\"hljs-keyword\">import</span> { browser } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;&#x24;app/environment&apos;</span>;\n<span class=\"hljs-keyword\">import</span> { get, writable } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;svelte/store&apos;</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-keyword\">type</span> { <span class=\"hljs-title class_\">User</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;./api&apos;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> user = writable&lt;<span class=\"hljs-title class_\">User</span> | <span class=\"hljs-literal\">null</span>&gt;(<span class=\"hljs-literal\">null</span>);\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">fetchCurrentUser</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">try</span> {\n    <span class=\"hljs-keyword\">const</span> resp = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&apos;/api/users/me&apos;</span>);\n    <span class=\"hljs-keyword\">if</span> (resp.<span class=\"hljs-property\">ok</span>) {\n      <span class=\"hljs-keyword\">const</span> u = <span class=\"hljs-keyword\">await</span> resp.<span class=\"hljs-title function_\">json</span>();\n      user.<span class=\"hljs-title function_\">set</span>(u);\n    } <span class=\"hljs-keyword\">else</span> {\n      user.<span class=\"hljs-title function_\">set</span>(<span class=\"hljs-literal\">null</span>);\n    }\n  } <span class=\"hljs-keyword\">catch</span> (err) {\n    user.<span class=\"hljs-title function_\">set</span>(<span class=\"hljs-literal\">null</span>);\n  }\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">isAuthenticated</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> !!<span class=\"hljs-title function_\">get</span>(user);\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2960,2985"}}],"payload":{"tag":"h3","lines":"2959,2960"}},{"content":"<code>src/lib/api.ts</code>","children":[{"content":"<pre data-lines=\"2986,3023\"><code class=\"language-ts\"><span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;axios&apos;</span>;\n\n<span class=\"hljs-keyword\">const</span> api = axios.<span class=\"hljs-title function_\">create</span>({\n  <span class=\"hljs-attr\">baseURL</span>: <span class=\"hljs-string\">&apos;http://localhost:8000&apos;</span>,\n  <span class=\"hljs-attr\">withCredentials</span>: <span class=\"hljs-literal\">true</span>, <span class=\"hljs-comment\">// invia cookie/token</span>\n});\n\n<span class=\"hljs-comment\">// Endpoint auth</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getAuthUrl</span>(<span class=\"hljs-params\"><span class=\"hljs-attr\">provider</span>: <span class=\"hljs-built_in\">string</span></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">`/auth/<span class=\"hljs-subst\">&#x24;{provider}</span>/authorize`</span>);\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">logout</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">&apos;/auth/jwt/logout&apos;</span>);\n}\n\n<span class=\"hljs-comment\">// Endpoint user</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getCurrentUser</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&apos;/users/me&apos;</span>);\n}\n\n<span class=\"hljs-comment\">// Endpoint tasks</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">listTasks</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&apos;/tasks/&apos;</span>);\n}\n\n<span class=\"hljs-comment\">// Endpoint run workflow</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">runPlaybook</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">&apos;/run/&apos;</span>);\n}\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">runTofu</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">&apos;/run/tofu/&apos;</span>);\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> api;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2986,3023"}}],"payload":{"tag":"h3","lines":"2985,2986"}},{"content":"<code>src/routes/login/+page.svelte</code>","children":[{"content":"<pre data-lines=\"3024,3047\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { getAuthUrl } from &apos;&#x24;lib/api&apos;;\n\n  let providers = [&apos;github&apos;]; // puoi aggiungere gitlab\n\n  async function loginWith(provider: string) {\n    const resp = await getAuthUrl(provider);\n    if (resp.data &amp;&amp; resp.data.authorization_url) {\n      window.location.href = resp.data.authorization_url;\n    }\n  }\n&lt;/script&gt;\n\n&lt;main class=&quot;p-4&quot;&gt;\n  &lt;h1&gt;Login&lt;/h1&gt;\n  {#each providers as prov}\n    &lt;button on:click={() =&gt; loginWith(prov)} class=&quot;mx-2 p-2 bg-blue-500 text-white rounded&quot;&gt;\n      Login with {prov}\n    &lt;/button&gt;\n  {/each}\n&lt;/main&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3024,3047"}}],"payload":{"tag":"h3","lines":"3023,3024"}},{"content":"<code>src/routes/callback/+page.svelte</code>","children":[{"content":"<pre data-lines=\"3048,3064\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { page } from &apos;&#x24;app/stores&apos;;\n  import { goto } from &apos;&#x24;app/navigation&apos;;\n  import { fetchCurrentUser } from &apos;&#x24;lib/auth&apos;;\n\n  // Quando GitHub reindirizza a /callback?code=...&amp;state=...\n  onMount(async () =&gt; {\n    // Chiamare backend per completare il login\n    await fetchCurrentUser();\n    goto(&apos;/&apos;);\n  });\n&lt;/script&gt;\n\n&lt;p&gt;Processing login&#x2026;&lt;/p&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3048,3064"}}],"payload":{"tag":"h3","lines":"3047,3048"}},{"content":"<code>src/routes/+layout.svelte</code>","children":[{"content":"<pre data-lines=\"3065,3083\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { user, fetchCurrentUser } from &apos;&#x24;lib/auth&apos;;\n  import NavBar from &apos;&#x24;lib/components/NavBar.svelte&apos;;\n\n  // alla prima apertura, cerca utente autenticato\n  fetchCurrentUser();\n&lt;/script&gt;\n\n&lt;NavBar {user} /&gt;\n&lt;main&gt;\n  {#if &#x24;user}\n    &lt;slot /&gt;\n  {:else}\n    &lt;slot name=&quot;login&quot; /&gt;\n  {/if}\n&lt;/main&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3065,3083"}}],"payload":{"tag":"h3","lines":"3064,3065"}},{"content":"<code>src/lib/components/NavBar.svelte</code>","children":[{"content":"<pre data-lines=\"3084,3111\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { user } from &apos;&#x24;lib/auth&apos;;\n  import { logout } from &apos;&#x24;lib/api&apos;;\n  import { goto } from &apos;&#x24;app/navigation&apos;;\n\n  async function handleLogout() {\n    await logout();\n    user.set(null);\n    goto(&apos;/login&apos;);\n  }\n&lt;/script&gt;\n\n&lt;nav class=&quot;bg-gray-800 text-white p-4 flex justify-between&quot;&gt;\n  &lt;div&gt;\n    &lt;a href=&quot;/&quot; class=&quot;mx-2&quot;&gt;Dashboard&lt;/a&gt;\n    &lt;a href=&quot;/tasks&quot; class=&quot;mx-2&quot;&gt;Tasks&lt;/a&gt;\n    &lt;a href=&quot;/logs&quot; class=&quot;mx-2&quot;&gt;Logs&lt;/a&gt;\n  &lt;/div&gt;\n  {#if &#x24;user}\n    &lt;div&gt;\n      &lt;span&gt;{&#x24;user.email}&lt;/span&gt;\n      &lt;button class=&quot;ml-4 bg-red-500 px-2 py-1 rounded&quot; on:click={handleLogout}&gt;Logout&lt;/button&gt;\n    &lt;/div&gt;\n  {/if}\n&lt;/nav&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3084,3111"}}],"payload":{"tag":"h3","lines":"3083,3084"}},{"content":"<code>src/routes/tasks/+page.svelte</code>","children":[{"content":"<pre data-lines=\"3112,3144\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { onMount } from &apos;svelte&apos;;\n  import { listTasks } from &apos;&#x24;lib/api&apos;;\n  import type { TaskRecord } from &apos;&#x24;lib/api&apos;;\n  import { toast } from &apos;svelte-toastify&apos;;\n\n  let tasks: TaskRecord[] = [];\n\n  async function loadTasks() {\n    try {\n      const resp = await listTasks();\n      tasks = resp.data;\n    } catch (e) {\n      toast(&apos;Unable to fetch tasks&apos;, &apos;error&apos;);\n    }\n  }\n\n  onMount(loadTasks);\n&lt;/script&gt;\n\n&lt;main class=&quot;p-4&quot;&gt;\n  &lt;h1 class=&quot;text-xl mb-4&quot;&gt;Recent Tasks&lt;/h1&gt;\n  &lt;ul&gt;\n    {#each tasks as t}\n      &lt;li&gt;\n        &lt;span&gt;{t.type}&lt;/span&gt; &#xb7; &lt;span&gt;{t.status}&lt;/span&gt; &#xb7; &lt;span&gt;{new Date(t.created_at).toLocaleString()}&lt;/span&gt;\n      &lt;/li&gt;\n    {/each}\n  &lt;/ul&gt;\n&lt;/main&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3112,3144"}}],"payload":{"tag":"h3","lines":"3111,3112"}}],"payload":{"tag":"h2","lines":"2958,2959"}},{"content":"&#x2705; Flusso utente e protezione UI","children":[{"content":"1. L&#x2019;utente accede a <code>/login</code>, clicca &#x201c;Login with GitHub&#x201d; &#x2192; viene reindirizzato al provider OAuth.","children":[],"payload":{"tag":"li","lines":"3145,3146","listIndex":1}},{"content":"2. Il backend FastAPI via <code>fastapi-users</code> gestisce il callback, crea/aggiorna l&#x2019;utente, imposta cookie o token (JWT).","children":[],"payload":{"tag":"li","lines":"3146,3147","listIndex":2}},{"content":"3. Il frontend, dopo redirect su <code>/callback</code>, chiama <code>fetchCurrentUser()</code> che recupera la sessione utente e popola <code>&#x24;user</code>.","children":[],"payload":{"tag":"li","lines":"3147,3148","listIndex":3}},{"content":"4. Il layout (<code>+layout.svelte</code>) mostra NavBar e <code>slot</code> protetto solo se l&#x2019;utente &#xe8; presente; altrimenti mostra login.","children":[],"payload":{"tag":"li","lines":"3148,3149","listIndex":4}},{"content":"5. Le chiamate API (es. <code>/run/</code>, <code>/tasks/</code>) includono cookie o JWT tramite <code>axios</code> con <code>withCredentials: true</code>.","children":[],"payload":{"tag":"li","lines":"3149,3150","listIndex":5}},{"content":"6. La UI protegge visivamente le rotte non autorizzate e mostra logout, email utente, notifiche, ecc.","children":[],"payload":{"tag":"li","lines":"3150,3151","listIndex":6}}],"payload":{"tag":"h2","lines":"3144,3145"}},{"content":"&#x1f4cc; Note e dipendenze del backend per supportare questo flusso","children":[{"content":"Backend con <code>fastapi-users</code> deve supportare cors con <code>allow_credentials=True</code>","children":[],"payload":{"tag":"li","lines":"3152,3153"}},{"content":"I router OAuth (<code>oauth_router</code>) e JWT router devono essere configurati e il frontend deve conoscere gli endpoint (es. <code>/auth/github/authorize</code>, <code>/auth/jwt/login</code>)","children":[],"payload":{"tag":"li","lines":"3153,3154"}},{"content":"In <code>fastapi-users</code> l&#x2019;autenticazione con cookie JWT &#xe8; supportata, e il token &#xe8; inviato al frontend come cookie HTTP-only, il che consente l&#x2019;uso con <code>withCredentials</code>.<br>\n[1]: https://fastapi-users.github.io/fastapi-users/latest/usage/flow/?utm_source=chatgpt.com &quot;Flow - FastAPI Users&quot;","children":[],"payload":{"tag":"li","lines":"3154,3156"}},{"content":"Autenticazione via GitHub/GitLab OAuth con <code>fastapi-users</code>","children":[],"payload":{"tag":"li","lines":"3156,3157"}},{"content":"Gestione utenti, ruoli base (admin/user)","children":[],"payload":{"tag":"li","lines":"3157,3158"}},{"content":"CORS configurato per frontend (assumendo localhost:5173 o altro)","children":[],"payload":{"tag":"li","lines":"3158,3159"}},{"content":"Endpoints API per task, playbook, log (stub)","children":[],"payload":{"tag":"li","lines":"3159,3160"}},{"content":"Configurazione JWT con cookie HTTP-only per sicurezza e uso con frontend axios","children":[],"payload":{"tag":"li","lines":"3160,3161"}},{"content":"Setup Celery (placeholder)","children":[],"payload":{"tag":"li","lines":"3161,3162"}},{"content":"File <code>.env.example</code> per configurazioni","children":[],"payload":{"tag":"li","lines":"3162,3163"}},{"content":"<code>requirements.txt</code>","children":[],"payload":{"tag":"li","lines":"3163,3164"}},{"content":"Struttura progetto e README aggiornato","children":[],"payload":{"tag":"li","lines":"3164,3165"}}],"payload":{"tag":"h2","lines":"3151,3152"}},{"content":"Struttura backend proposta","children":[{"content":"<pre data-lines=\"3166,3187\"><code data-lines=\"3166,3187\">backend/\n&#x251c;&#x2500;&#x2500; app/\n&#x2502;   &#x251c;&#x2500;&#x2500; __init__<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-tag\">main</span><span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; config<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; db<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; models<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; schemas<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; users<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; tasks<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; auth<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; celery_worker<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; utils<span class=\"hljs-selector-class\">.py</span>\n&#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-class\">.env</span><span class=\"hljs-selector-class\">.example</span>\n&#x251c;&#x2500;&#x2500; requirements<span class=\"hljs-selector-class\">.txt</span>\n&#x251c;&#x2500;&#x2500; alembic<span class=\"hljs-selector-class\">.ini</span>\n&#x2514;&#x2500;&#x2500; alembic/\n    &#x2514;&#x2500;&#x2500; versions/\n        &#x2514;&#x2500;&#x2500; &lt;migration_files&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3166,3187"}}],"payload":{"tag":"h2","lines":"3165,3166"}},{"content":"1. <code>requirements.txt</code>","children":[{"content":"<pre data-lines=\"3188,3204\"><code class=\"language-text\">fastapi\nuvicorn[standard]\nfastapi-users[sqlalchemy2,jwt,oauth]\nsqlalchemy\ndatabases[asyncpg]\nasyncpg\npython-dotenv\npasslib[bcrypt]\nalembic\npydantic[email]\nhttpx\ncelery[redis]\nredis\npython-multipart\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3188,3204"}}],"payload":{"tag":"h2","lines":"3187,3188"}},{"content":"2. <code>.env.example</code>","children":[{"content":"<pre data-lines=\"3205,3214\"><code class=\"language-env\">DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/mydb\nSECRET_KEY=your-super-secret-key\nGITHUB_CLIENT_ID=your_github_client_id\nGITHUB_CLIENT_SECRET=your_github_client_secret\nGITLAB_CLIENT_ID=your_gitlab_client_id\nGITLAB_CLIENT_SECRET=your_gitlab_client_secret\nREDIS_URL=redis://localhost:6379/0\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3205,3214"}}],"payload":{"tag":"h2","lines":"3204,3205"}},{"content":"3. <code>app/config.py</code>","children":[{"content":"<pre data-lines=\"3215,3232\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseSettings\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Settings</span>(<span class=\"hljs-title class_ inherited__\">BaseSettings</span>):\n    DATABASE_URL: <span class=\"hljs-built_in\">str</span>\n    SECRET_KEY: <span class=\"hljs-built_in\">str</span>\n    GITHUB_CLIENT_ID: <span class=\"hljs-built_in\">str</span>\n    GITHUB_CLIENT_SECRET: <span class=\"hljs-built_in\">str</span>\n    GITLAB_CLIENT_ID: <span class=\"hljs-built_in\">str</span>\n    GITLAB_CLIENT_SECRET: <span class=\"hljs-built_in\">str</span>\n    REDIS_URL: <span class=\"hljs-built_in\">str</span> = <span class=\"hljs-string\">&quot;redis://localhost:6379/0&quot;</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        env_file = <span class=\"hljs-string\">&quot;.env&quot;</span>\n\nsettings = Settings()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3215,3232"}}],"payload":{"tag":"h2","lines":"3214,3215"}},{"content":"4. <code>app/db.py</code>","children":[{"content":"<pre data-lines=\"3233,3243\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> databases <span class=\"hljs-keyword\">import</span> Database\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> create_async_engine, AsyncSession\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> sessionmaker\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\ndatabase = Database(settings.DATABASE_URL)\nengine = create_async_engine(settings.DATABASE_URL, future=<span class=\"hljs-literal\">True</span>, echo=<span class=\"hljs-literal\">True</span>)\nasync_session = sessionmaker(engine, class_=AsyncSession, expire_on_commit=<span class=\"hljs-literal\">False</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3233,3243"}}],"payload":{"tag":"h2","lines":"3232,3233"}},{"content":"5. <code>app/models.py</code>","children":[{"content":"<pre data-lines=\"3244,3271\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> sqlalchemy <span class=\"hljs-keyword\">import</span> Boolean, Column, Integer, String, DateTime, ForeignKey\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> relationship\n<span class=\"hljs-keyword\">from</span> sqlalchemy.sql <span class=\"hljs-keyword\">import</span> func\n<span class=\"hljs-keyword\">from</span> fastapi_users.db <span class=\"hljs-keyword\">import</span> SQLAlchemyBaseUserTable\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.declarative <span class=\"hljs-keyword\">import</span> DeclarativeMeta, declarative_base\n\nBase: DeclarativeMeta = declarative_base()\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(SQLAlchemyBaseUserTable, Base):\n    __tablename__ = <span class=\"hljs-string\">&quot;user&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    is_active = Column(Boolean, default=<span class=\"hljs-literal\">True</span>)\n    is_superuser = Column(Boolean, default=<span class=\"hljs-literal\">False</span>)\n    is_verified = Column(Boolean, default=<span class=\"hljs-literal\">False</span>)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Task</span>(<span class=\"hljs-title class_ inherited__\">Base</span>):\n    __tablename__ = <span class=\"hljs-string\">&quot;tasks&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    <span class=\"hljs-built_in\">type</span> = Column(String, nullable=<span class=\"hljs-literal\">False</span>)\n    status = Column(String, default=<span class=\"hljs-string\">&quot;pending&quot;</span>)\n    created_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), server_default=func.now())\n    updated_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), onupdate=func.now())\n    user_id = Column(Integer, ForeignKey(<span class=\"hljs-string\">&quot;user.id&quot;</span>))\n    user = relationship(<span class=\"hljs-string\">&quot;User&quot;</span>, backref=<span class=\"hljs-string\">&quot;tasks&quot;</span>)\n    log = Column(String, default=<span class=\"hljs-string\">&quot;&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3244,3271"}}],"payload":{"tag":"h2","lines":"3243,3244"}},{"content":"6. <code>app/schemas.py</code>","children":[{"content":"<pre data-lines=\"3272,3303\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseModel, EmailStr\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">Optional</span>\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-built_in\">id</span>: <span class=\"hljs-built_in\">int</span>\n    email: EmailStr\n    is_active: <span class=\"hljs-built_in\">bool</span>\n    is_superuser: <span class=\"hljs-built_in\">bool</span>\n    is_verified: <span class=\"hljs-built_in\">bool</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserCreate</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    email: EmailStr\n    password: <span class=\"hljs-built_in\">str</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TaskRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-built_in\">id</span>: <span class=\"hljs-built_in\">int</span>\n    <span class=\"hljs-built_in\">type</span>: <span class=\"hljs-built_in\">str</span>\n    status: <span class=\"hljs-built_in\">str</span>\n    created_at: datetime\n    updated_at: <span class=\"hljs-type\">Optional</span>[datetime]\n    user_id: <span class=\"hljs-built_in\">int</span>\n    log: <span class=\"hljs-built_in\">str</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3272,3303"}}],"payload":{"tag":"h2","lines":"3271,3272"}},{"content":"7. <code>app/users.py</code>","children":[{"content":"<pre data-lines=\"3304,3349\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> FastAPIUsers, models <span class=\"hljs-keyword\">as</span> fa_models\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> JWTStrategy, CookieTransport, AuthenticationBackend\n<span class=\"hljs-keyword\">from</span> fastapi_users.db <span class=\"hljs-keyword\">import</span> SQLAlchemyUserDatabase\n<span class=\"hljs-keyword\">from</span> app.models <span class=\"hljs-keyword\">import</span> User\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> database, async_session\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(fa_models.BaseUser):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserCreate</span>(fa_models.BaseUserCreate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserUpdate</span>(fa_models.BaseUserUpdate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserDB</span>(User, fa_models.BaseUserDB):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_user_db</span>():\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> async_session() <span class=\"hljs-keyword\">as</span> session:\n        <span class=\"hljs-keyword\">yield</span> SQLAlchemyUserDatabase(UserDB, session, User)\n\ncookie_transport = CookieTransport(cookie_name=<span class=\"hljs-string\">&quot;auth&quot;</span>, cookie_secure=<span class=\"hljs-literal\">False</span>, cookie_http_only=<span class=\"hljs-literal\">True</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_jwt_strategy</span>() -&gt; JWTStrategy:\n    <span class=\"hljs-keyword\">return</span> JWTStrategy(secret=settings.SECRET_KEY, lifetime_seconds=<span class=\"hljs-number\">3600</span>)\n\nauth_backend = AuthenticationBackend(\n    name=<span class=\"hljs-string\">&quot;jwt&quot;</span>,\n    transport=cookie_transport,\n    get_strategy=get_jwt_strategy,\n)\n\nfastapi_users = FastAPIUsers[User, <span class=\"hljs-built_in\">int</span>](\n    get_user_db,\n    [auth_backend],\n    User,\n    UserCreate,\n    UserUpdate,\n    UserDB,\n)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3304,3349"}}],"payload":{"tag":"h2","lines":"3303,3304"}},{"content":"8. <code>app/auth.py</code>","children":[{"content":"<pre data-lines=\"3350,3393\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> OAuth2AuthorizationCodeBearer\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication.oauth2 <span class=\"hljs-keyword\">import</span> OAuth2AuthorizationCodeBearer\n\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\nrouter = APIRouter()\n\n<span class=\"hljs-comment\"># GitHub OAuth</span>\ngithub_oauth_client = OAuth2AuthorizationCodeBearer(\n    authorizationUrl=<span class=\"hljs-string\">&quot;https://github.com/login/oauth/authorize&quot;</span>,\n    tokenUrl=<span class=\"hljs-string\">&quot;https://github.com/login/oauth/access_token&quot;</span>,\n    client_id=settings.GITHUB_CLIENT_ID,\n    client_secret=settings.GITHUB_CLIENT_SECRET,\n    scopes=[<span class=\"hljs-string\">&quot;user:email&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@router.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/github/authorize&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">github_authorize</span>():\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;authorization_url&quot;</span>: github_oauth_client.authorizationUrl}\n\n<span class=\"hljs-comment\"># GitLab OAuth analogamente, oppure usa fastapi-users builtin OAuth routers</span>\n\nrouter.include_router(\n    fastapi_users.get_auth_router(auth_backend),\n    prefix=<span class=\"hljs-string\">&quot;/auth/jwt&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\nrouter.include_router(\n    fastapi_users.get_register_router(),\n    prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\nrouter.include_router(\n    fastapi_users.get_users_router(),\n    prefix=<span class=\"hljs-string\">&quot;/users&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;users&quot;</span>],\n)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3350,3393"}}],"payload":{"tag":"h2","lines":"3349,3350"}},{"content":"9. <code>app/tasks.py</code>","children":[{"content":"<pre data-lines=\"3394,3417\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter, Depends, HTTPException\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> async_session\n<span class=\"hljs-keyword\">from</span> app.schemas <span class=\"hljs-keyword\">import</span> TaskRead\n<span class=\"hljs-keyword\">from</span> app.models <span class=\"hljs-keyword\">import</span> Task\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">List</span>\n<span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> FastAPIUsers\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users, User\n\nrouter = APIRouter()\n\n<span class=\"hljs-meta\">@router.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/&quot;</span>, response_model=<span class=\"hljs-type\">List</span>[TaskRead]</span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">list_tasks</span>(<span class=\"hljs-params\">session: AsyncSession = Depends(<span class=\"hljs-params\">async_session</span>)</span>):\n    result = <span class=\"hljs-keyword\">await</span> session.execute(Task.__table__.select())\n    tasks = result.scalars().<span class=\"hljs-built_in\">all</span>()\n    <span class=\"hljs-keyword\">return</span> tasks\n\n<span class=\"hljs-meta\">@router.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>():\n    <span class=\"hljs-comment\"># <span class=\"hljs-doctag\">TODO:</span> avviare task playbook tramite Celery e salvare stato</span>\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;message&quot;</span>: <span class=\"hljs-string\">&quot;Playbook execution started&quot;</span>}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3394,3417"}}],"payload":{"tag":"h2","lines":"3393,3394"}},{"content":"10. <code>app/celery_worker.py</code>","children":[{"content":"<pre data-lines=\"3418,3433\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\ncelery_app = Celery(\n    <span class=\"hljs-string\">&quot;worker&quot;</span>,\n    broker=settings.REDIS_URL,\n    backend=settings.REDIS_URL,\n)\n\n<span class=\"hljs-meta\">@celery_app.task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook_task</span>(<span class=\"hljs-params\">playbook: <span class=\"hljs-built_in\">str</span>, user_id: <span class=\"hljs-built_in\">int</span></span>):\n    <span class=\"hljs-comment\"># Placeholder: esegui ansible-playbook, salva log, aggiorna DB</span>\n    <span class=\"hljs-keyword\">pass</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3418,3433"}}],"payload":{"tag":"h2","lines":"3417,3418"}},{"content":"11. <code>app/main.py</code>","children":[{"content":"<pre data-lines=\"3434,3487\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> uvicorn\n<span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI\n<span class=\"hljs-keyword\">from</span> fastapi.middleware.cors <span class=\"hljs-keyword\">import</span> CORSMiddleware\n\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> database\n<span class=\"hljs-keyword\">from</span> app.auth <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> auth_router\n<span class=\"hljs-keyword\">from</span> app.tasks <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> tasks_router\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users, auth_backend\n\napp = FastAPI(title=<span class=\"hljs-string\">&quot;Infra Automation API&quot;</span>)\n\norigins = [\n    <span class=\"hljs-string\">&quot;http://localhost:5173&quot;</span>,\n    <span class=\"hljs-string\">&quot;http://localhost:3000&quot;</span>,\n    <span class=\"hljs-comment\"># aggiungi dominio frontend</span>\n]\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=origins,\n    allow_credentials=<span class=\"hljs-literal\">True</span>,\n    allow_methods=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_headers=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n)\n\napp.include_router(auth_router, prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>, tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>])\napp.include_router(tasks_router, prefix=<span class=\"hljs-string\">&quot;/tasks&quot;</span>, tags=[<span class=\"hljs-string\">&quot;tasks&quot;</span>])\n\napp.include_router(\n    fastapi_users.get_auth_router(auth_backend),\n    prefix=<span class=\"hljs-string\">&quot;/auth/jwt&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\napp.include_router(\n    fastapi_users.get_register_router(),\n    prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\napp.include_router(\n    fastapi_users.get_users_router(),\n    prefix=<span class=\"hljs-string\">&quot;/users&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;users&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@app.on_event(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;startup&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">startup</span>():\n    <span class=\"hljs-keyword\">await</span> database.connect()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3434,3487"}}],"payload":{"tag":"h2","lines":"3433,3434"}},{"content":"Struttura backend proposta","children":[{"content":"<pre data-lines=\"3498,3519\"><code data-lines=\"3498,3519\">backend/\n&#x251c;&#x2500;&#x2500; app/\n&#x2502;   &#x251c;&#x2500;&#x2500; __init__<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-tag\">main</span><span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; config<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; db<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; models<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; schemas<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; users<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; tasks<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; auth<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; celery_worker<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; utils<span class=\"hljs-selector-class\">.py</span>\n&#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-class\">.env</span><span class=\"hljs-selector-class\">.example</span>\n&#x251c;&#x2500;&#x2500; requirements<span class=\"hljs-selector-class\">.txt</span>\n&#x251c;&#x2500;&#x2500; alembic<span class=\"hljs-selector-class\">.ini</span>\n&#x2514;&#x2500;&#x2500; alembic/\n    &#x2514;&#x2500;&#x2500; versions/\n        &#x2514;&#x2500;&#x2500; &lt;migration_files&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3498,3519"}}],"payload":{"tag":"h2","lines":"3497,3498"}},{"content":"1. <code>requirements.txt</code>","children":[{"content":"<pre data-lines=\"3520,3536\"><code class=\"language-text\">fastapi\nuvicorn[standard]\nfastapi-users[sqlalchemy2,jwt,oauth]\nsqlalchemy\ndatabases[asyncpg]\nasyncpg\npython-dotenv\npasslib[bcrypt]\nalembic\npydantic[email]\nhttpx\ncelery[redis]\nredis\npython-multipart\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3520,3536"}}],"payload":{"tag":"h2","lines":"3519,3520"}},{"content":"2. <code>.env.example</code>","children":[{"content":"<pre data-lines=\"3537,3546\"><code class=\"language-env\">DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/mydb\nSECRET_KEY=your-super-secret-key\nGITHUB_CLIENT_ID=your_github_client_id\nGITHUB_CLIENT_SECRET=your_github_client_secret\nGITLAB_CLIENT_ID=your_gitlab_client_id\nGITLAB_CLIENT_SECRET=your_gitlab_client_secret\nREDIS_URL=redis://localhost:6379/0\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3537,3546"}}],"payload":{"tag":"h2","lines":"3536,3537"}},{"content":"3. <code>app/config.py</code>","children":[{"content":"<pre data-lines=\"3547,3564\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseSettings\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Settings</span>(<span class=\"hljs-title class_ inherited__\">BaseSettings</span>):\n    DATABASE_URL: <span class=\"hljs-built_in\">str</span>\n    SECRET_KEY: <span class=\"hljs-built_in\">str</span>\n    GITHUB_CLIENT_ID: <span class=\"hljs-built_in\">str</span>\n    GITHUB_CLIENT_SECRET: <span class=\"hljs-built_in\">str</span>\n    GITLAB_CLIENT_ID: <span class=\"hljs-built_in\">str</span>\n    GITLAB_CLIENT_SECRET: <span class=\"hljs-built_in\">str</span>\n    REDIS_URL: <span class=\"hljs-built_in\">str</span> = <span class=\"hljs-string\">&quot;redis://localhost:6379/0&quot;</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        env_file = <span class=\"hljs-string\">&quot;.env&quot;</span>\n\nsettings = Settings()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3547,3564"}}],"payload":{"tag":"h2","lines":"3546,3547"}},{"content":"4. <code>app/db.py</code>","children":[{"content":"<pre data-lines=\"3565,3575\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> databases <span class=\"hljs-keyword\">import</span> Database\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> create_async_engine, AsyncSession\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> sessionmaker\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\ndatabase = Database(settings.DATABASE_URL)\nengine = create_async_engine(settings.DATABASE_URL, future=<span class=\"hljs-literal\">True</span>, echo=<span class=\"hljs-literal\">True</span>)\nasync_session = sessionmaker(engine, class_=AsyncSession, expire_on_commit=<span class=\"hljs-literal\">False</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3565,3575"}}],"payload":{"tag":"h2","lines":"3564,3565"}},{"content":"5. <code>app/models.py</code>","children":[{"content":"<pre data-lines=\"3576,3603\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> sqlalchemy <span class=\"hljs-keyword\">import</span> Boolean, Column, Integer, String, DateTime, ForeignKey\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> relationship\n<span class=\"hljs-keyword\">from</span> sqlalchemy.sql <span class=\"hljs-keyword\">import</span> func\n<span class=\"hljs-keyword\">from</span> fastapi_users.db <span class=\"hljs-keyword\">import</span> SQLAlchemyBaseUserTable\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.declarative <span class=\"hljs-keyword\">import</span> DeclarativeMeta, declarative_base\n\nBase: DeclarativeMeta = declarative_base()\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(SQLAlchemyBaseUserTable, Base):\n    __tablename__ = <span class=\"hljs-string\">&quot;user&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    is_active = Column(Boolean, default=<span class=\"hljs-literal\">True</span>)\n    is_superuser = Column(Boolean, default=<span class=\"hljs-literal\">False</span>)\n    is_verified = Column(Boolean, default=<span class=\"hljs-literal\">False</span>)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Task</span>(<span class=\"hljs-title class_ inherited__\">Base</span>):\n    __tablename__ = <span class=\"hljs-string\">&quot;tasks&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    <span class=\"hljs-built_in\">type</span> = Column(String, nullable=<span class=\"hljs-literal\">False</span>)\n    status = Column(String, default=<span class=\"hljs-string\">&quot;pending&quot;</span>)\n    created_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), server_default=func.now())\n    updated_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), onupdate=func.now())\n    user_id = Column(Integer, ForeignKey(<span class=\"hljs-string\">&quot;user.id&quot;</span>))\n    user = relationship(<span class=\"hljs-string\">&quot;User&quot;</span>, backref=<span class=\"hljs-string\">&quot;tasks&quot;</span>)\n    log = Column(String, default=<span class=\"hljs-string\">&quot;&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3576,3603"}}],"payload":{"tag":"h2","lines":"3575,3576"}},{"content":"6. <code>app/schemas.py</code>","children":[{"content":"<pre data-lines=\"3604,3635\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseModel, EmailStr\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">Optional</span>\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-built_in\">id</span>: <span class=\"hljs-built_in\">int</span>\n    email: EmailStr\n    is_active: <span class=\"hljs-built_in\">bool</span>\n    is_superuser: <span class=\"hljs-built_in\">bool</span>\n    is_verified: <span class=\"hljs-built_in\">bool</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserCreate</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    email: EmailStr\n    password: <span class=\"hljs-built_in\">str</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TaskRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-built_in\">id</span>: <span class=\"hljs-built_in\">int</span>\n    <span class=\"hljs-built_in\">type</span>: <span class=\"hljs-built_in\">str</span>\n    status: <span class=\"hljs-built_in\">str</span>\n    created_at: datetime\n    updated_at: <span class=\"hljs-type\">Optional</span>[datetime]\n    user_id: <span class=\"hljs-built_in\">int</span>\n    log: <span class=\"hljs-built_in\">str</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3604,3635"}}],"payload":{"tag":"h2","lines":"3603,3604"}},{"content":"7. <code>app/users.py</code>","children":[{"content":"<pre data-lines=\"3636,3681\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> FastAPIUsers, models <span class=\"hljs-keyword\">as</span> fa_models\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> JWTStrategy, CookieTransport, AuthenticationBackend\n<span class=\"hljs-keyword\">from</span> fastapi_users.db <span class=\"hljs-keyword\">import</span> SQLAlchemyUserDatabase\n<span class=\"hljs-keyword\">from</span> app.models <span class=\"hljs-keyword\">import</span> User\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> database, async_session\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(fa_models.BaseUser):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserCreate</span>(fa_models.BaseUserCreate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserUpdate</span>(fa_models.BaseUserUpdate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserDB</span>(User, fa_models.BaseUserDB):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_user_db</span>():\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> async_session() <span class=\"hljs-keyword\">as</span> session:\n        <span class=\"hljs-keyword\">yield</span> SQLAlchemyUserDatabase(UserDB, session, User)\n\ncookie_transport = CookieTransport(cookie_name=<span class=\"hljs-string\">&quot;auth&quot;</span>, cookie_secure=<span class=\"hljs-literal\">False</span>, cookie_http_only=<span class=\"hljs-literal\">True</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_jwt_strategy</span>() -&gt; JWTStrategy:\n    <span class=\"hljs-keyword\">return</span> JWTStrategy(secret=settings.SECRET_KEY, lifetime_seconds=<span class=\"hljs-number\">3600</span>)\n\nauth_backend = AuthenticationBackend(\n    name=<span class=\"hljs-string\">&quot;jwt&quot;</span>,\n    transport=cookie_transport,\n    get_strategy=get_jwt_strategy,\n)\n\nfastapi_users = FastAPIUsers[User, <span class=\"hljs-built_in\">int</span>](\n    get_user_db,\n    [auth_backend],\n    User,\n    UserCreate,\n    UserUpdate,\n    UserDB,\n)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3636,3681"}}],"payload":{"tag":"h2","lines":"3635,3636"}},{"content":"8. <code>app/auth.py</code>","children":[{"content":"<pre data-lines=\"3682,3725\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> OAuth2AuthorizationCodeBearer\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication.oauth2 <span class=\"hljs-keyword\">import</span> OAuth2AuthorizationCodeBearer\n\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\nrouter = APIRouter()\n\n<span class=\"hljs-comment\"># GitHub OAuth</span>\ngithub_oauth_client = OAuth2AuthorizationCodeBearer(\n    authorizationUrl=<span class=\"hljs-string\">&quot;https://github.com/login/oauth/authorize&quot;</span>,\n    tokenUrl=<span class=\"hljs-string\">&quot;https://github.com/login/oauth/access_token&quot;</span>,\n    client_id=settings.GITHUB_CLIENT_ID,\n    client_secret=settings.GITHUB_CLIENT_SECRET,\n    scopes=[<span class=\"hljs-string\">&quot;user:email&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@router.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/github/authorize&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">github_authorize</span>():\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;authorization_url&quot;</span>: github_oauth_client.authorizationUrl}\n\n<span class=\"hljs-comment\"># GitLab OAuth analogamente, oppure usa fastapi-users builtin OAuth routers</span>\n\nrouter.include_router(\n    fastapi_users.get_auth_router(auth_backend),\n    prefix=<span class=\"hljs-string\">&quot;/auth/jwt&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\nrouter.include_router(\n    fastapi_users.get_register_router(),\n    prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\nrouter.include_router(\n    fastapi_users.get_users_router(),\n    prefix=<span class=\"hljs-string\">&quot;/users&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;users&quot;</span>],\n)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3682,3725"}}],"payload":{"tag":"h2","lines":"3681,3682"}},{"content":"9. <code>app/tasks.py</code>","children":[{"content":"<pre data-lines=\"3726,3749\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter, Depends, HTTPException\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> async_session\n<span class=\"hljs-keyword\">from</span> app.schemas <span class=\"hljs-keyword\">import</span> TaskRead\n<span class=\"hljs-keyword\">from</span> app.models <span class=\"hljs-keyword\">import</span> Task\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">List</span>\n<span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> FastAPIUsers\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users, User\n\nrouter = APIRouter()\n\n<span class=\"hljs-meta\">@router.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/&quot;</span>, response_model=<span class=\"hljs-type\">List</span>[TaskRead]</span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">list_tasks</span>(<span class=\"hljs-params\">session: AsyncSession = Depends(<span class=\"hljs-params\">async_session</span>)</span>):\n    result = <span class=\"hljs-keyword\">await</span> session.execute(Task.__table__.select())\n    tasks = result.scalars().<span class=\"hljs-built_in\">all</span>()\n    <span class=\"hljs-keyword\">return</span> tasks\n\n<span class=\"hljs-meta\">@router.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>():\n    <span class=\"hljs-comment\"># <span class=\"hljs-doctag\">TODO:</span> avviare task playbook tramite Celery e salvare stato</span>\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;message&quot;</span>: <span class=\"hljs-string\">&quot;Playbook execution started&quot;</span>}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3726,3749"}}],"payload":{"tag":"h2","lines":"3725,3726"}},{"content":"10. <code>app/celery_worker.py</code>","children":[{"content":"<pre data-lines=\"3750,3765\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\ncelery_app = Celery(\n    <span class=\"hljs-string\">&quot;worker&quot;</span>,\n    broker=settings.REDIS_URL,\n    backend=settings.REDIS_URL,\n)\n\n<span class=\"hljs-meta\">@celery_app.task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook_task</span>(<span class=\"hljs-params\">playbook: <span class=\"hljs-built_in\">str</span>, user_id: <span class=\"hljs-built_in\">int</span></span>):\n    <span class=\"hljs-comment\"># Placeholder: esegui ansible-playbook, salva log, aggiorna DB</span>\n    <span class=\"hljs-keyword\">pass</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3750,3765"}}],"payload":{"tag":"h2","lines":"3749,3750"}},{"content":"11. <code>app/main.py</code>","children":[{"content":"<pre data-lines=\"3766,3819\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> uvicorn\n<span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI\n<span class=\"hljs-keyword\">from</span> fastapi.middleware.cors <span class=\"hljs-keyword\">import</span> CORSMiddleware\n\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> database\n<span class=\"hljs-keyword\">from</span> app.auth <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> auth_router\n<span class=\"hljs-keyword\">from</span> app.tasks <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> tasks_router\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users, auth_backend\n\napp = FastAPI(title=<span class=\"hljs-string\">&quot;Infra Automation API&quot;</span>)\n\norigins = [\n    <span class=\"hljs-string\">&quot;http://localhost:5173&quot;</span>,\n    <span class=\"hljs-string\">&quot;http://localhost:3000&quot;</span>,\n    <span class=\"hljs-comment\"># aggiungi dominio frontend</span>\n]\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=origins,\n    allow_credentials=<span class=\"hljs-literal\">True</span>,\n    allow_methods=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_headers=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n)\n\napp.include_router(auth_router, prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>, tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>])\napp.include_router(tasks_router, prefix=<span class=\"hljs-string\">&quot;/tasks&quot;</span>, tags=[<span class=\"hljs-string\">&quot;tasks&quot;</span>])\n\napp.include_router(\n    fastapi_users.get_auth_router(auth_backend),\n    prefix=<span class=\"hljs-string\">&quot;/auth/jwt&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\napp.include_router(\n    fastapi_users.get_register_router(),\n    prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\napp.include_router(\n    fastapi_users.get_users_router(),\n    prefix=<span class=\"hljs-string\">&quot;/users&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;users&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@app.on_event(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;startup&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">startup</span>():\n    <span class=\"hljs-keyword\">await</span> database.connect()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3766,3819"}},{"content":"<pre data-lines=\"3824,3853\"><code data-lines=\"3824,3853\">\n<span class=\"hljs-meta\">---\n</span>\n<span class=\"hljs-comment\">## 12. README.md (estratto)</span>\n\n<span class=\"hljs-string\">```markdown</span>\n<span class=\"hljs-comment\"># Infra Automation WebApp Backend</span>\n<span class=\"hljs-comment\">## Descrizione</span>\n<span class=\"hljs-string\">Backend</span> <span class=\"hljs-string\">FastAPI</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">un&apos;applicazione</span> <span class=\"hljs-string\">web</span> <span class=\"hljs-string\">di</span> <span class=\"hljs-string\">automazione</span> <span class=\"hljs-string\">infrastrutturale</span> <span class=\"hljs-string\">basata</span> <span class=\"hljs-string\">su</span> <span class=\"hljs-string\">workflow,</span> <span class=\"hljs-attr\">che integra:</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">Autenticazione</span> <span class=\"hljs-string\">utente</span> <span class=\"hljs-string\">via</span> <span class=\"hljs-string\">OAuth</span> <span class=\"hljs-string\">GitHub/GitLab</span> <span class=\"hljs-string\">con</span> <span class=\"hljs-string\">`fastapi-users`</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">Gestione</span> <span class=\"hljs-string\">task,</span> <span class=\"hljs-string\">cronologia,</span> <span class=\"hljs-string\">esecuzione</span> <span class=\"hljs-string\">playbook</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">Supporto</span> <span class=\"hljs-string\">Celery</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">task</span> <span class=\"hljs-string\">asincroni</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">Protezione</span> <span class=\"hljs-string\">JWT</span> <span class=\"hljs-string\">con</span> <span class=\"hljs-string\">cookie</span> <span class=\"hljs-string\">HTTP-only</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">sicurezza</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">API</span> <span class=\"hljs-string\">REST</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">frontend</span> <span class=\"hljs-string\">moderno</span> <span class=\"hljs-string\">(Svelte/React)</span>\n<span class=\"hljs-comment\">## Tecnologie</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">FastAPI</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">fastapi-users</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">SQLAlchemy</span> <span class=\"hljs-string\">Async</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">PostgreSQL</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">Celery</span> <span class=\"hljs-string\">+</span> <span class=\"hljs-string\">Redis</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">OAuth2</span> <span class=\"hljs-string\">(GitHub/GitLab)</span>\n<span class=\"hljs-comment\">## Setup</span>\n<span class=\"hljs-number\">1</span><span class=\"hljs-string\">.</span> <span class=\"hljs-string\">Copia</span> <span class=\"hljs-string\">`.env.example`</span> <span class=\"hljs-string\">in</span> <span class=\"hljs-string\">`.env`</span> <span class=\"hljs-string\">e</span> <span class=\"hljs-string\">configura</span> <span class=\"hljs-string\">variabili</span>\n<span class=\"hljs-attr\">2. Installa dipendenze:</span> <span class=\"hljs-string\">`pip</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">-r</span> <span class=\"hljs-string\">requirements.txt`</span>\n<span class=\"hljs-number\">3</span><span class=\"hljs-string\">.</span> <span class=\"hljs-string\">Esegui</span> <span class=\"hljs-string\">migrazioni</span> <span class=\"hljs-string\">con</span> <span class=\"hljs-string\">Alembic</span>\n<span class=\"hljs-attr\">4. Avvia backend:</span> <span class=\"hljs-string\">`uvicorn</span> <span class=\"hljs-string\">app.main:app</span> <span class=\"hljs-string\">--reload`</span>\n<span class=\"hljs-attr\">5. Avvia Celery worker:</span> <span class=\"hljs-string\">`celery</span> <span class=\"hljs-string\">-A</span> <span class=\"hljs-string\">app.celery_worker.celery_app</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">--loglevel=info`</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3824,3853"}}],"payload":{"tag":"h2","lines":"3765,3766"}},{"content":"1. <code>docker-compose.yml</code>","children":[{"content":"<pre data-lines=\"3877,3943\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&quot;3.9&quot;</span>\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">postgres:15-alpine</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-attr\">POSTGRES_USER:</span> <span class=\"hljs-string\">infra_user</span>\n      <span class=\"hljs-attr\">POSTGRES_PASSWORD:</span> <span class=\"hljs-string\">infra_pass</span>\n      <span class=\"hljs-attr\">POSTGRES_DB:</span> <span class=\"hljs-string\">infra_db</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres_data:/var/lib/postgresql/data</span>\n    <span class=\"hljs-attr\">networks:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">infra_net</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:7-alpine</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;6379:6379&quot;</span>\n    <span class=\"hljs-attr\">networks:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">infra_net</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">build:</span>\n      <span class=\"hljs-attr\">context:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">uvicorn</span> <span class=\"hljs-string\">app.main:app</span> <span class=\"hljs-string\">--host</span> <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> <span class=\"hljs-string\">--port</span> <span class=\"hljs-number\">8000</span> <span class=\"hljs-string\">--reload</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./backend:/app</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8000:8000&quot;</span>\n    <span class=\"hljs-attr\">env_file:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./backend/.env</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n    <span class=\"hljs-attr\">networks:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">infra_net</span>\n  <span class=\"hljs-attr\">celery_worker:</span>\n    <span class=\"hljs-attr\">build:</span>\n      <span class=\"hljs-attr\">context:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">-A</span> <span class=\"hljs-string\">app.celery_worker.celery_app</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">--loglevel=info</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./backend:/app</span>\n    <span class=\"hljs-attr\">env_file:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./backend/.env</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres</span>\n    <span class=\"hljs-attr\">networks:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">infra_net</span>\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">build:</span>\n      <span class=\"hljs-attr\">context:</span> <span class=\"hljs-string\">./frontend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">dev</span> <span class=\"hljs-string\">--</span> <span class=\"hljs-string\">--host</span> <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./frontend:/app</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/app/node_modules</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;5173:5173&quot;</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">VITE_API_URL=http://localhost:8000</span>\n    <span class=\"hljs-attr\">networks:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">infra_net</span>\n<span class=\"hljs-attr\">volumes:</span>\n  <span class=\"hljs-attr\">postgres_data:</span>\n<span class=\"hljs-attr\">networks:</span>\n  <span class=\"hljs-attr\">infra_net:</span>\n    <span class=\"hljs-attr\">driver:</span> <span class=\"hljs-string\">bridge</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3877,3943"}}],"payload":{"tag":"h2","lines":"3875,3876"}},{"content":"2. <code>backend/Dockerfile</code>","children":[{"content":"<pre data-lines=\"3948,3956\"><code class=\"language-dockerfile\"><span class=\"hljs-keyword\">FROM</span> python:<span class=\"hljs-number\">3.11</span>-slim\n<span class=\"hljs-keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span>\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> requirements.txt .</span>\n<span class=\"hljs-keyword\">RUN</span><span class=\"language-bash\"> pip install --no-cache-dir -r requirements.txt</span>\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> . .</span>\n<span class=\"hljs-keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"hljs-string\">&quot;uvicorn&quot;</span>, <span class=\"hljs-string\">&quot;app.main:app&quot;</span>, <span class=\"hljs-string\">&quot;--host&quot;</span>, <span class=\"hljs-string\">&quot;0.0.0.0&quot;</span>, <span class=\"hljs-string\">&quot;--port&quot;</span>, <span class=\"hljs-string\">&quot;8000&quot;</span>]</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3948,3956"}}],"payload":{"tag":"h2","lines":"3946,3947"}},{"content":"3. <code>frontend/Dockerfile</code>","children":[{"content":"<pre data-lines=\"3963,3971\"><code class=\"language-dockerfile\"><span class=\"hljs-keyword\">FROM</span> node:<span class=\"hljs-number\">20</span>-alpine\n<span class=\"hljs-keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span>\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> package.json package-lock.json ./</span>\n<span class=\"hljs-keyword\">RUN</span><span class=\"language-bash\"> npm install</span>\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> . .</span>\n<span class=\"hljs-keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"hljs-string\">&quot;npm&quot;</span>, <span class=\"hljs-string\">&quot;run&quot;</span>, <span class=\"hljs-string\">&quot;dev&quot;</span>, <span class=\"hljs-string\">&quot;--&quot;</span>, <span class=\"hljs-string\">&quot;--host&quot;</span>, <span class=\"hljs-string\">&quot;0.0.0.0&quot;</span>]</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3963,3971"}}],"payload":{"tag":"h2","lines":"3959,3960"}},{"content":"Note e consigli","children":[{"content":"","children":[{"content":"Frontend espone porta <code>5173</code> (Vite default)","children":[],"payload":{"tag":"li","lines":"3976,3977"}},{"content":"Backend <code>8000</code>","children":[],"payload":{"tag":"li","lines":"3977,3978"}},{"content":"Postgres + Redis come DB e broker Celery","children":[],"payload":{"tag":"li","lines":"3978,3979"}},{"content":"Volumi per persistenza DB","children":[],"payload":{"tag":"li","lines":"3979,3980"}},{"content":"Variabili d&#x2019;ambiente da <code>.env</code> per backend (es. connessioni, segreti)","children":[],"payload":{"tag":"li","lines":"3980,3981"}},{"content":"Puoi sostituire il frontend con build statiche (es. Codeberg Pages) se preferisci hosting statico","children":[],"payload":{"tag":"li","lines":"3981,3983"}}],"payload":{"tag":"ul","lines":"3976,3983"}},{"content":"","children":[{"content":"1. Configurazione <strong>Traefik</strong> come reverse proxy per il progetto Docker Compose.","children":[],"payload":{"tag":"li","lines":"3994,3995","listIndex":1}},{"content":"2. Un <strong>Helm Chart base</strong> per il deploy Kubernetes dell&#x2019;intero stack.","children":[],"payload":{"tag":"li","lines":"3995,3997","listIndex":2}}],"payload":{"tag":"ol","lines":"3994,3997"}}],"payload":{"tag":"h2","lines":"3974,3975"}}],"payload":{"tag":"h1","lines":"2380,2381"}},{"content":"1. Traefik reverse proxy per Docker Compose","children":[{"content":"1.1 <code>docker-compose_traefik.yml</code>","children":[{"content":"Note","children":[{"content":"Sostituisci <code>example.com</code> e <code>api.example.com</code> con i tuoi domini.","children":[],"payload":{"tag":"li","lines":"4105,4106"}},{"content":"Traefik si occupa di TLS automatico con Let&apos;s Encrypt.","children":[],"payload":{"tag":"li","lines":"4106,4107"}},{"content":"La dashboard Traefik &#xe8; disponibile su <code>http://localhost:8080</code>.","children":[],"payload":{"tag":"li","lines":"4107,4109"}}],"payload":{"tag":"h3","lines":"4103,4104"}}],"payload":{"tag":"h2","lines":"4003,4004"}}],"payload":{"tag":"h1","lines":"3999,4000"}},{"content":"2. Helm Chart base per Kubernetes","children":[{"content":"2.1 Struttura base Helm Chart: <code>infra-automation-chart/</code>","children":[{"content":"<pre data-lines=\"4117,4133\"><code data-lines=\"4117,4133\">infra-automation-chart/\n&#x251c;&#x2500;&#x2500; Chart<span class=\"hljs-selector-class\">.yaml</span>\n&#x251c;&#x2500;&#x2500; values<span class=\"hljs-selector-class\">.yaml</span>\n&#x251c;&#x2500;&#x2500; templates/\n&#x2502;   &#x251c;&#x2500;&#x2500; backend-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; backend-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; celery-worker-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; postgres-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; postgres-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; redis-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; redis-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; frontend-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; frontend-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; ingress<span class=\"hljs-selector-class\">.yaml</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4117,4133"}}],"payload":{"tag":"h2","lines":"4115,4116"}},{"content":"2.2 <code>Chart.yaml</code>","children":[{"content":"<pre data-lines=\"4138,4146\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v2</span>\n<span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-automation</span>\n<span class=\"hljs-attr\">description:</span> <span class=\"hljs-string\">Helm</span> <span class=\"hljs-string\">Chart</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">deploy</span> <span class=\"hljs-string\">completo</span> <span class=\"hljs-string\">di</span> <span class=\"hljs-string\">Infra</span> <span class=\"hljs-string\">Automation</span> <span class=\"hljs-string\">WebApp</span>\n<span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">application</span>\n<span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">0.1</span><span class=\"hljs-number\">.0</span>\n<span class=\"hljs-attr\">appVersion:</span> <span class=\"hljs-string\">&quot;1.0&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4138,4146"}}],"payload":{"tag":"h2","lines":"4136,4137"}},{"content":"2.3 <code>values.yaml</code>","children":[{"content":"<pre data-lines=\"4151,4205\"><code class=\"language-yaml\"><span class=\"hljs-attr\">replicaCount:</span> <span class=\"hljs-number\">1</span>\n<span class=\"hljs-attr\">image:</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-backend</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">celeryWorker:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-celery-worker</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-frontend</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">postgres:15-alpine</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:7-alpine</span>\n<span class=\"hljs-attr\">service:</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">8000</span>\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">80</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">5432</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">6379</span>\n<span class=\"hljs-attr\">ingress:</span>\n  <span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">annotations:</span>\n    <span class=\"hljs-attr\">kubernetes.io/ingress.class:</span> <span class=\"hljs-string\">traefik</span>\n  <span class=\"hljs-attr\">hosts:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> <span class=\"hljs-string\">example.com</span>\n      <span class=\"hljs-attr\">paths:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/</span>\n          <span class=\"hljs-attr\">pathType:</span> <span class=\"hljs-string\">Prefix</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> <span class=\"hljs-string\">api.example.com</span>\n      <span class=\"hljs-attr\">paths:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/</span>\n          <span class=\"hljs-attr\">pathType:</span> <span class=\"hljs-string\">Prefix</span>\n  <span class=\"hljs-attr\">tls:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">secretName:</span> <span class=\"hljs-string\">tls-secret</span>\n      <span class=\"hljs-attr\">hosts:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">example.com</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">api.example.com</span>\n<span class=\"hljs-attr\">postgres:</span>\n  <span class=\"hljs-attr\">user:</span> <span class=\"hljs-string\">infra_user</span>\n  <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">infra_pass</span>\n  <span class=\"hljs-attr\">db:</span> <span class=\"hljs-string\">infra_db</span>\n<span class=\"hljs-attr\">redis:</span>\n  <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">&quot;&quot;</span>\n<span class=\"hljs-attr\">env:</span>\n  <span class=\"hljs-attr\">DATABASE_URL:</span> <span class=\"hljs-string\">postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n  <span class=\"hljs-attr\">REDIS_URL:</span> <span class=\"hljs-string\">redis://redis:6379/0</span>\n  <span class=\"hljs-attr\">VITE_API_URL:</span> <span class=\"hljs-string\">https://api.example.com</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4151,4205"}}],"payload":{"tag":"h2","lines":"4149,4150"}},{"content":"2.4 Esempio <code>backend-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"4210,4248\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-backend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> {{ <span class=\"hljs-string\">.Values.replicaCount</span> }}\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">backend</span>\n          <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ .Values.image.backend.repository }}</span>:<span class=\"hljs-template-variable\">{{ .Values.image.backend.tag }}</span>&quot;</span>\n          <span class=\"hljs-attr\">ports:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">containerPort:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n          <span class=\"hljs-attr\">env:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">DATABASE_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.DATABASE_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">REDIS_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.REDIS_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n          <span class=\"hljs-attr\">readinessProbe:</span>\n            <span class=\"hljs-attr\">httpGet:</span>\n              <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/health</span>\n              <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n            <span class=\"hljs-attr\">initialDelaySeconds:</span> <span class=\"hljs-number\">10</span>\n            <span class=\"hljs-attr\">periodSeconds:</span> <span class=\"hljs-number\">5</span>\n          <span class=\"hljs-attr\">livenessProbe:</span>\n            <span class=\"hljs-attr\">httpGet:</span>\n              <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/health</span>\n              <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n            <span class=\"hljs-attr\">initialDelaySeconds:</span> <span class=\"hljs-number\">30</span>\n            <span class=\"hljs-attr\">periodSeconds:</span> <span class=\"hljs-number\">10</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4210,4248"}}],"payload":{"tag":"h2","lines":"4208,4209"}},{"content":"2.5 Esempio <code>backend-service.yaml</code>","children":[{"content":"<pre data-lines=\"4253,4267\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-backend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4253,4267"}}],"payload":{"tag":"h2","lines":"4251,4252"}},{"content":"2.6 Esempio <code>ingress.yaml</code>","children":[{"content":"<pre data-lines=\"4272,4306\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">networking.k8s.io/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Ingress</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-ingress</span>\n  <span class=\"hljs-attr\">annotations:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">&#x24;key</span>, <span class=\"hljs-string\">&#x24;value</span> <span class=\"hljs-string\">:=</span> <span class=\"hljs-string\">.Values.ingress.annotations</span> }}\n    {{ <span class=\"hljs-string\">&#x24;key</span> }}<span class=\"hljs-string\">:</span> {{ <span class=\"hljs-string\">&#x24;value</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">rules:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.Values.ingress.hosts</span> }}\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> {{ <span class=\"hljs-string\">.host</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n      <span class=\"hljs-attr\">http:</span>\n        <span class=\"hljs-attr\">paths:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.paths</span> }}\n          <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> {{ <span class=\"hljs-string\">.path</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-attr\">pathType:</span> {{ <span class=\"hljs-string\">.pathType</span> }}\n            <span class=\"hljs-attr\">backend:</span>\n              <span class=\"hljs-attr\">service:</span>\n                <span class=\"hljs-attr\">name:</span> {{ <span class=\"hljs-string\">if</span> <span class=\"hljs-string\">eq</span> <span class=\"hljs-string\">&#x24;.Values.ingress.hosts._index</span> <span class=\"hljs-string\">&#x24;.</span> }}<span class=\"hljs-string\">infra-frontend{{</span> <span class=\"hljs-string\">else</span> <span class=\"hljs-string\">}}infra-backend{{</span> <span class=\"hljs-string\">end</span> <span class=\"hljs-string\">}}</span>\n                <span class=\"hljs-attr\">port:</span>\n                  <span class=\"hljs-attr\">number:</span> {{ <span class=\"hljs-string\">if</span> <span class=\"hljs-string\">eq</span> <span class=\"hljs-string\">&#x24;.Values.ingress.hosts._index</span> <span class=\"hljs-string\">&#x24;.</span> }}{{ <span class=\"hljs-string\">&#x24;.Values.service.frontend.port</span> }}{{ <span class=\"hljs-string\">else</span> }}{{ <span class=\"hljs-string\">&#x24;.Values.service.backend.port</span> }}{{ <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n  <span class=\"hljs-attr\">tls:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.Values.ingress.tls</span> }}\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">secretName:</span> {{ <span class=\"hljs-string\">.secretName</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n      <span class=\"hljs-attr\">hosts:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.hosts</span> }}\n        <span class=\"hljs-bullet\">-</span> {{ <span class=\"hljs-string\">.</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4272,4306"}}],"payload":{"tag":"h2","lines":"4270,4271"}}],"payload":{"tag":"h1","lines":"4111,4112"}},{"content":"Conclusione","children":[{"content":"","children":[{"content":"<strong>Traefik</strong> gestisce TLS automatico e routing verso backend/ frontend.","children":[],"payload":{"tag":"li","lines":"4313,4314"}},{"content":"<strong>Helm Chart</strong> ti permette di deployare lo stack in Kubernetes in modo modulare, configurabile e scalabile.","children":[],"payload":{"tag":"li","lines":"4314,4316"}}],"payload":{"tag":"ul","lines":"4313,4316"}},{"content":"","children":[{"content":"Completare Helm Chart con tutti i componenti (celery, postgres, redis, ingress avanzato)","children":[],"payload":{"tag":"li","lines":"4320,4321"}},{"content":"Fornire script CI/CD per deploy automatico in K8s","children":[],"payload":{"tag":"li","lines":"4321,4322"}},{"content":"Integrare monitoring (Prometheus/Grafana)","children":[],"payload":{"tag":"li","lines":"4322,4324"}}],"payload":{"tag":"ul","lines":"4320,4324"}}],"payload":{"tag":"h1","lines":"4309,4310"}},{"content":"Helm Chart Completo: <code>infra-automation-chart</code>","children":[{"content":"Struttura finale","children":[{"content":"<pre data-lines=\"4339,4356\"><code data-lines=\"4339,4356\">infra-automation-chart/\n&#x251c;&#x2500;&#x2500; Chart<span class=\"hljs-selector-class\">.yaml</span>\n&#x251c;&#x2500;&#x2500; values<span class=\"hljs-selector-class\">.yaml</span>\n&#x251c;&#x2500;&#x2500; templates/\n&#x2502;   &#x251c;&#x2500;&#x2500; backend-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; backend-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; celery-worker-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; celery-worker-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; postgres-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; postgres-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; redis-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; redis-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; frontend-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; frontend-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; ingress<span class=\"hljs-selector-class\">.yaml</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4339,4356"}}],"payload":{"tag":"h2","lines":"4337,4338"}},{"content":"1. <code>Chart.yaml</code>","children":[{"content":"<pre data-lines=\"4361,4369\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v2</span>\n<span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-automation</span>\n<span class=\"hljs-attr\">description:</span> <span class=\"hljs-string\">Helm</span> <span class=\"hljs-string\">Chart</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">deploy</span> <span class=\"hljs-string\">completo</span> <span class=\"hljs-string\">di</span> <span class=\"hljs-string\">Infra</span> <span class=\"hljs-string\">Automation</span> <span class=\"hljs-string\">WebApp</span> <span class=\"hljs-string\">con</span> <span class=\"hljs-string\">backend,</span> <span class=\"hljs-string\">celery,</span> <span class=\"hljs-string\">postgres,</span> <span class=\"hljs-string\">redis,</span> <span class=\"hljs-string\">frontend</span> <span class=\"hljs-string\">e</span> <span class=\"hljs-string\">ingress</span>\n<span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">application</span>\n<span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">0.1</span><span class=\"hljs-number\">.0</span>\n<span class=\"hljs-attr\">appVersion:</span> <span class=\"hljs-string\">&quot;1.0&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4361,4369"}}],"payload":{"tag":"h2","lines":"4359,4360"}},{"content":"2. <code>values.yaml</code>","children":[{"content":"<pre data-lines=\"4374,4431\"><code class=\"language-yaml\"><span class=\"hljs-attr\">replicaCount:</span> <span class=\"hljs-number\">1</span>\n<span class=\"hljs-attr\">image:</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-backend</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">celeryWorker:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-celery-worker</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-frontend</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">postgres:15-alpine</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:7-alpine</span>\n<span class=\"hljs-attr\">service:</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">8000</span>\n  <span class=\"hljs-attr\">celeryWorker:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">5555</span> <span class=\"hljs-comment\"># porta Flower (opzionale)</span>\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">80</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">5432</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">6379</span>\n<span class=\"hljs-attr\">ingress:</span>\n  <span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">annotations:</span>\n    <span class=\"hljs-attr\">kubernetes.io/ingress.class:</span> <span class=\"hljs-string\">traefik</span>\n    <span class=\"hljs-attr\">traefik.ingress.kubernetes.io/router.entrypoints:</span> <span class=\"hljs-string\">websecure</span>\n  <span class=\"hljs-attr\">hosts:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> <span class=\"hljs-string\">example.com</span>\n      <span class=\"hljs-attr\">paths:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/</span>\n          <span class=\"hljs-attr\">pathType:</span> <span class=\"hljs-string\">Prefix</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> <span class=\"hljs-string\">api.example.com</span>\n      <span class=\"hljs-attr\">paths:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/</span>\n          <span class=\"hljs-attr\">pathType:</span> <span class=\"hljs-string\">Prefix</span>\n  <span class=\"hljs-attr\">tls:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">secretName:</span> <span class=\"hljs-string\">tls-secret</span>\n      <span class=\"hljs-attr\">hosts:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">example.com</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">api.example.com</span>\n<span class=\"hljs-attr\">postgres:</span>\n  <span class=\"hljs-attr\">user:</span> <span class=\"hljs-string\">infra_user</span>\n  <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">infra_pass</span>\n  <span class=\"hljs-attr\">db:</span> <span class=\"hljs-string\">infra_db</span>\n<span class=\"hljs-attr\">redis:</span>\n  <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">&quot;&quot;</span>\n<span class=\"hljs-attr\">env:</span>\n  <span class=\"hljs-attr\">DATABASE_URL:</span> <span class=\"hljs-string\">postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n  <span class=\"hljs-attr\">REDIS_URL:</span> <span class=\"hljs-string\">redis://redis:6379/0</span>\n  <span class=\"hljs-attr\">VITE_API_URL:</span> <span class=\"hljs-string\">https://api.example.com</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4374,4431"}}],"payload":{"tag":"h2","lines":"4372,4373"}},{"content":"3. <code>templates/backend-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"4436,4474\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-backend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> {{ <span class=\"hljs-string\">.Values.replicaCount</span> }}\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">backend</span>\n          <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ .Values.image.backend.repository }}</span>:<span class=\"hljs-template-variable\">{{ .Values.image.backend.tag }}</span>&quot;</span>\n          <span class=\"hljs-attr\">ports:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">containerPort:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n          <span class=\"hljs-attr\">env:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">DATABASE_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.DATABASE_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">REDIS_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.REDIS_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n          <span class=\"hljs-attr\">readinessProbe:</span>\n            <span class=\"hljs-attr\">httpGet:</span>\n              <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/health</span>\n              <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n            <span class=\"hljs-attr\">initialDelaySeconds:</span> <span class=\"hljs-number\">10</span>\n            <span class=\"hljs-attr\">periodSeconds:</span> <span class=\"hljs-number\">5</span>\n          <span class=\"hljs-attr\">livenessProbe:</span>\n            <span class=\"hljs-attr\">httpGet:</span>\n              <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/health</span>\n              <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n            <span class=\"hljs-attr\">initialDelaySeconds:</span> <span class=\"hljs-number\">30</span>\n            <span class=\"hljs-attr\">periodSeconds:</span> <span class=\"hljs-number\">10</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4436,4474"}}],"payload":{"tag":"h2","lines":"4434,4435"}},{"content":"4. <code>templates/backend-service.yaml</code>","children":[{"content":"<pre data-lines=\"4479,4493\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-backend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4479,4493"}}],"payload":{"tag":"h2","lines":"4477,4478"}},{"content":"5. <code>templates/celery-worker-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"4498,4523\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-celery-worker</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> {{ <span class=\"hljs-string\">.Values.replicaCount</span> }}\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-celery-worker</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-celery-worker</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">celery-worker</span>\n          <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ .Values.image.celeryWorker.repository }}</span>:<span class=\"hljs-template-variable\">{{ .Values.image.celeryWorker.tag }}</span>&quot;</span>\n          <span class=\"hljs-attr\">command:</span> [<span class=\"hljs-string\">&quot;celery&quot;</span>, <span class=\"hljs-string\">&quot;-A&quot;</span>, <span class=\"hljs-string\">&quot;app.celery_worker.celery_app&quot;</span>, <span class=\"hljs-string\">&quot;worker&quot;</span>, <span class=\"hljs-string\">&quot;--loglevel=info&quot;</span>]\n          <span class=\"hljs-attr\">env:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">DATABASE_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.DATABASE_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">REDIS_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.REDIS_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4498,4523"}}],"payload":{"tag":"h2","lines":"4496,4497"}},{"content":"6. <code>templates/celery-worker-service.yaml</code>","children":[{"content":"<pre data-lines=\"4528,4542\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-celery-worker</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-celery-worker</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.celeryWorker.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> {{ <span class=\"hljs-string\">.Values.service.celeryWorker.port</span> }}\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4528,4542"}}],"payload":{"tag":"h2","lines":"4526,4527"}},{"content":"7. <code>templates/postgres-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"4547,4581\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">postgres</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> <span class=\"hljs-number\">1</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">postgres</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">postgres</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">postgres</span>\n          <span class=\"hljs-attr\">image:</span> {{ <span class=\"hljs-string\">.Values.image.postgres.image</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n          <span class=\"hljs-attr\">env:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">POSTGRES_USER</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.postgres.user</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">POSTGRES_PASSWORD</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.postgres.password</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">POSTGRES_DB</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.postgres.db</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n          <span class=\"hljs-attr\">ports:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">containerPort:</span> {{ <span class=\"hljs-string\">.Values.service.postgres.port</span> }}\n          <span class=\"hljs-attr\">volumeMounts:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">mountPath:</span> <span class=\"hljs-string\">/var/lib/postgresql/data</span>\n              <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">postgres-storage</span>\n      <span class=\"hljs-attr\">volumes:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">postgres-storage</span>\n          <span class=\"hljs-attr\">emptyDir:</span> {}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4547,4581"}}],"payload":{"tag":"h2","lines":"4545,4546"}},{"content":"8. <code>templates/postgres-service.yaml</code>","children":[{"content":"<pre data-lines=\"4586,4600\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">postgres</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">postgres</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.postgres.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> {{ <span class=\"hljs-string\">.Values.service.postgres.port</span> }}\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4586,4600"}}],"payload":{"tag":"h2","lines":"4584,4585"}},{"content":"9. <code>templates/redis-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"4605,4626\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">redis</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> <span class=\"hljs-number\">1</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">redis</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">redis</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">redis</span>\n          <span class=\"hljs-attr\">image:</span> {{ <span class=\"hljs-string\">.Values.image.redis.image</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n          <span class=\"hljs-attr\">ports:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">containerPort:</span> {{ <span class=\"hljs-string\">.Values.service.redis.port</span> }}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4605,4626"}}],"payload":{"tag":"h2","lines":"4603,4604"}},{"content":"10. <code>templates/redis-service.yaml</code>","children":[{"content":"<pre data-lines=\"4631,4645\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">redis</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">redis</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.redis.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> {{ <span class=\"hljs-string\">.Values.service.redis.port</span> }}\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4631,4645"}}],"payload":{"tag":"h2","lines":"4629,4630"}},{"content":"11. <code>templates/frontend-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"4650,4674\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-frontend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> {{ <span class=\"hljs-string\">.Values.replicaCount</span> }}\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-frontend</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-frontend</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">frontend</span>\n          <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ .Values.image.frontend.repository }}</span>:<span class=\"hljs-template-variable\">{{ .Values.image.frontend.tag }}</span>&quot;</span>\n          <span class=\"hljs-attr\">ports:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">containerPort:</span> <span class=\"hljs-number\">5173</span>\n          <span class=\"hljs-attr\">env:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">VITE_API_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.VITE_API_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4650,4674"}}],"payload":{"tag":"h2","lines":"4648,4649"}},{"content":"12. <code>templates/frontend-service.yaml</code>","children":[{"content":"<pre data-lines=\"4679,4693\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-frontend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-frontend</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.frontend.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> <span class=\"hljs-number\">5173</span>\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4679,4693"}}],"payload":{"tag":"h2","lines":"4677,4678"}},{"content":"13. <code>templates/ingress.yaml</code>","children":[{"content":"<pre data-lines=\"4698,4732\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">networking.k8s.io/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Ingress</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-ingress</span>\n  <span class=\"hljs-attr\">annotations:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">&#x24;key</span>, <span class=\"hljs-string\">&#x24;value</span> <span class=\"hljs-string\">:=</span> <span class=\"hljs-string\">.Values.ingress.annotations</span> }}\n    {{ <span class=\"hljs-string\">&#x24;key</span> }}<span class=\"hljs-string\">:</span> {{ <span class=\"hljs-string\">&#x24;value</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">rules:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.Values.ingress.hosts</span> }}\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> {{ <span class=\"hljs-string\">.host</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n      <span class=\"hljs-attr\">http:</span>\n        <span class=\"hljs-attr\">paths:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.paths</span> }}\n          <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> {{ <span class=\"hljs-string\">.path</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-attr\">pathType:</span> {{ <span class=\"hljs-string\">.pathType</span> }}\n            <span class=\"hljs-attr\">backend:</span>\n              <span class=\"hljs-attr\">service:</span>\n                <span class=\"hljs-attr\">name:</span> {{ <span class=\"hljs-string\">if</span> <span class=\"hljs-string\">eq</span> <span class=\"hljs-string\">.host</span> <span class=\"hljs-string\">&quot;api.example.com&quot;</span> }}<span class=\"hljs-string\">infra-backend{{</span> <span class=\"hljs-string\">else</span> <span class=\"hljs-string\">}}infra-frontend{{</span> <span class=\"hljs-string\">end</span> <span class=\"hljs-string\">}}</span>\n                <span class=\"hljs-attr\">port:</span>\n                  <span class=\"hljs-attr\">number:</span> {{ <span class=\"hljs-string\">if</span> <span class=\"hljs-string\">eq</span> <span class=\"hljs-string\">.host</span> <span class=\"hljs-string\">&quot;api.example.com&quot;</span> }}{{ <span class=\"hljs-string\">&#x24;.Values.service.backend.port</span> }}{{ <span class=\"hljs-string\">else</span> }}{{ <span class=\"hljs-string\">&#x24;.Values.service.frontend.port</span> }}{{ <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n  <span class=\"hljs-attr\">tls:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.Values.ingress.tls</span> }}\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">secretName:</span> {{ <span class=\"hljs-string\">.secretName</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n      <span class=\"hljs-attr\">hosts:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.hosts</span> }}\n        <span class=\"hljs-bullet\">-</span> {{ <span class=\"hljs-string\">.</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4698,4732"}}],"payload":{"tag":"h2","lines":"4696,4697"}}],"payload":{"tag":"h1","lines":"4333,4334"}},{"content":"Script CI/CD base (GitHub Actions)","children":[{"content":"<pre data-lines=\"4741,4782\"><code class=\"language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Deploy</span> <span class=\"hljs-string\">Infra</span> <span class=\"hljs-string\">Automation</span> <span class=\"hljs-string\">App</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">Kubernetes</span>\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">branches:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">main</span>\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">build-and-deploy:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span> <span class=\"hljs-string\">repo</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v3</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Set</span> <span class=\"hljs-string\">up</span> <span class=\"hljs-string\">Docker</span> <span class=\"hljs-string\">Buildx</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">docker/setup-buildx-action@v2</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Log</span> <span class=\"hljs-string\">in</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">DockerHub</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">docker/login-action@v2</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.DOCKERHUB_USERNAME</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.DOCKERHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">backend</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-backend:latest ./backend\n          docker push yourdockerhub/infra-backend:latest\n</span>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-celery-worker:latest ./backend\n          docker push yourdockerhub/infra-celery-worker:latest\n</span>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">frontend</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-frontend:latest ./frontend\n          docker push yourdockerhub/infra-frontend:latest\n</span>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Set</span> <span class=\"hljs-string\">up</span> <span class=\"hljs-string\">kubectl</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">azure/setup-kubectl@v3</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&apos;latest&apos;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Deploy</span> <span class=\"hljs-string\">Helm</span> <span class=\"hljs-string\">Chart</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          helm upgrade --install infra-automation ./infra-automation-chart --namespace infra --create-namespace --wait\n</span>        <span class=\"hljs-attr\">env:</span>\n          <span class=\"hljs-attr\">KUBECONFIG:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.KUBECONFIG</span> <span class=\"hljs-string\">}}</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4741,4782"}}],"payload":{"tag":"h1","lines":"4735,4736"}},{"content":"Come funziona:","children":[{"content":"Alla push sul branch <code>main</code>, builda le immagini docker di backend, celery worker e frontend.","children":[],"payload":{"tag":"li","lines":"4787,4788"}},{"content":"Pusha le immagini su DockerHub (configura <code>DOCKERHUB_USERNAME</code> e <code>DOCKERHUB_TOKEN</code> nei secrets).","children":[],"payload":{"tag":"li","lines":"4788,4789"}},{"content":"Applica o aggiorna il chart Helm nel namespace <code>infra</code> del tuo cluster Kubernetes.","children":[],"payload":{"tag":"li","lines":"4789,4790"}},{"content":"Per <code>kubectl</code> si aspetta la configurazione KUBECONFIG in secrets (usa <code>kubectl config view --raw</code> e salvalo).","children":[],"payload":{"tag":"li","lines":"4790,4792"}}],"payload":{"tag":"h1","lines":"4785,4786"}},{"content":"Repository: <strong>infra-automation</strong>","children":[{"content":"README.md","children":[{"content":"Deployment in Kubernetes con Helm","children":[{"content":"<pre data-lines=\"4904,4907\"><code class=\"language-bash\">helm upgrade --install infra-automation ./infra-automation-chart --namespace infra --create-namespace --<span class=\"hljs-built_in\">wait</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4904,4907"}}],"payload":{"tag":"h3","lines":"4901,4902"}},{"content":"CI/CD automatico (GitHub Actions)","children":[{"content":"Builda e pubblica immagini Docker su DockerHub","children":[],"payload":{"tag":"li","lines":"4910,4911"}},{"content":"Esegue deploy Helm nel cluster K8s configurato tramite KUBECONFIG<br>\nAssicurati di aggiungere i segreti <code>DOCKERHUB_USERNAME</code>, <code>DOCKERHUB_TOKEN</code> e <code>KUBECONFIG</code> nel repo GitHub.","children":[],"payload":{"tag":"li","lines":"4911,4913"}}],"payload":{"tag":"h3","lines":"4908,4909"}}],"payload":{"tag":"h2","lines":"4811,4812"}},{"content":"Funzionalit&#xe0; Principali","children":[{"content":"<strong>Lista playbook Ansible</strong> caricati e modificabili via editor YAML integrato (Monaco)","children":[],"payload":{"tag":"li","lines":"4914,4915"}},{"content":"<strong>Upload file YAML / Terraform</strong> con validazione","children":[],"payload":{"tag":"li","lines":"4915,4916"}},{"content":"<strong>Esecuzione playbook con parametri</strong> personalizzabili via UI","children":[],"payload":{"tag":"li","lines":"4916,4917"}},{"content":"<strong>Streaming log realtime</strong> tramite WebSocket con modalit&#xe0; split output/log","children":[],"payload":{"tag":"li","lines":"4917,4918"}},{"content":"<strong>Notifiche toast</strong> per stato task (successo, errore)","children":[],"payload":{"tag":"li","lines":"4918,4919"}},{"content":"<strong>Lista task recenti</strong> con stato e cronologia completa","children":[],"payload":{"tag":"li","lines":"4919,4920"}},{"content":"<strong>Autenticazione OAuth</strong> con GitHub/GitLab e ruoli utenti","children":[],"payload":{"tag":"li","lines":"4920,4921"}},{"content":"<strong>Supporto provisioning cloud OpenTofu</strong>","children":[],"payload":{"tag":"li","lines":"4921,4922"}},{"content":"<strong>Integrazione Git forgejo / GitHub Actions</strong>","children":[],"payload":{"tag":"li","lines":"4922,4923"}},{"content":"<strong>Modalit&#xe0; Dark / Light UI</strong>","children":[],"payload":{"tag":"li","lines":"4923,4924"}},{"content":"<strong>Hosting statico su Codeberg Pages o via Vite + nginx</strong>","children":[],"payload":{"tag":"li","lines":"4924,4925"}}],"payload":{"tag":"h2","lines":"4913,4914"}},{"content":"Licenza","children":[],"payload":{"tag":"h2","lines":"4925,4926"}},{"content":"Contatti","children":[],"payload":{"tag":"h2","lines":"4927,4928"}},{"content":"Crediti","children":[{"content":"<pre data-lines=\"4938,4955\"><code data-lines=\"4938,4955\">\n<span class=\"hljs-comment\">---</span>\n\n<span class=\"hljs-comment\">## LICENSE (MIT)</span>\n\n```<span class=\"hljs-keyword\">text</span>\nMIT License\nCopyright (c) <span class=\"hljs-number\">2025</span>\nPermission is hereby granted, free <span class=\"hljs-keyword\">of</span> charge, <span class=\"hljs-built_in\">to</span> <span class=\"hljs-keyword\">any</span> person obtaining <span class=\"hljs-keyword\">a</span> copy\n<span class=\"hljs-keyword\">of</span> this software <span class=\"hljs-keyword\">and</span> associated documentation <span class=\"hljs-built_in\">files</span> (<span class=\"hljs-keyword\">the</span> <span class=\"hljs-string\">&quot;Software&quot;</span>), <span class=\"hljs-built_in\">to</span> deal\n<span class=\"hljs-keyword\">in</span> <span class=\"hljs-keyword\">the</span> Software <span class=\"hljs-keyword\">without</span> restriction, including <span class=\"hljs-keyword\">without</span> limitation <span class=\"hljs-keyword\">the</span> rights\n<span class=\"hljs-built_in\">to</span> use, copy, modify, <span class=\"hljs-built_in\">merge</span>, publish, distribute, sublicense, <span class=\"hljs-keyword\">and</span>/<span class=\"hljs-keyword\">or</span> sell\ncopies <span class=\"hljs-keyword\">of</span> <span class=\"hljs-keyword\">the</span> Software, <span class=\"hljs-keyword\">and</span> <span class=\"hljs-built_in\">to</span> permit persons <span class=\"hljs-built_in\">to</span> whom <span class=\"hljs-keyword\">the</span> Software is\nfurnished <span class=\"hljs-built_in\">to</span> <span class=\"hljs-built_in\">do</span> so, subject <span class=\"hljs-built_in\">to</span> <span class=\"hljs-keyword\">the</span> following conditions:\n... [rest <span class=\"hljs-keyword\">of</span> MIT license <span class=\"hljs-keyword\">text</span>] ...\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4938,4955"}}],"payload":{"tag":"h2","lines":"4929,4930"}},{"content":".gitignore","children":[{"content":"<pre data-lines=\"4960,4984\"><code data-lines=\"4960,4984\"><span class=\"hljs-comment\"># Python</span>\n__pycache__/\n*<span class=\"hljs-string\">.pyc</span>\n*<span class=\"hljs-string\">.pyo</span>\n*<span class=\"hljs-string\">.pyd</span>\n<span class=\"hljs-string\">.env</span>\nvenv/\n<span class=\"hljs-string\">.env.</span>*\n<span class=\"hljs-comment\"># Node</span>\nnode_modules/\ndist/\n<span class=\"hljs-string\">.vscode/</span>\n<span class=\"hljs-comment\"># Docker</span>\n*<span class=\"hljs-string\">.log</span>\ndocker-compose.override.yml\n<span class=\"hljs-comment\"># Kubernetes</span>\n*<span class=\"hljs-string\">.yaml</span>\n*<span class=\"hljs-string\">.yml</span>\n*<span class=\"hljs-string\">.json</span>\n<span class=\"hljs-comment\"># Editor</span>\n<span class=\"hljs-string\">.idea/</span>\n<span class=\"hljs-string\">.DS_Store</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4960,4984"}}],"payload":{"tag":"h2","lines":"4958,4959"}},{"content":"docker-compose.yml","children":[{"content":"<pre data-lines=\"4989,5031\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&quot;3.9&quot;</span>\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8000:8000&quot;</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DATABASE_URL=postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=redis://redis:6379/0</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n  <span class=\"hljs-attr\">celery-worker:</span>\n    <span class=\"hljs-attr\">build:</span>\n      <span class=\"hljs-attr\">context:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">-A</span> <span class=\"hljs-string\">app.celery_worker.celery_app</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">--loglevel=info</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DATABASE_URL=postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=redis://redis:6379/0</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">backend</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./frontend</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;5173:5173&quot;</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">VITE_API_URL=http://localhost:8000</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">postgres:15-alpine</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_USER=infra_user</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_PASSWORD=infra_pass</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_DB=infra_db</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres_data:/var/lib/postgresql/data</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:7-alpine</span>\n<span class=\"hljs-attr\">volumes:</span>\n  <span class=\"hljs-attr\">postgres_data:</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4989,5031"}}],"payload":{"tag":"h2","lines":"4987,4988"}},{"content":"docker-compose-traefik.yml","children":[{"content":"<pre data-lines=\"5036,5101\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&quot;3.9&quot;</span>\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">traefik:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">traefik:v2.10</span>\n    <span class=\"hljs-attr\">command:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--api.insecure=true</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--providers.docker=true</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--entrypoints.web.address=:80</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--entrypoints.websecure.address=:443</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--certificatesresolvers.myresolver.acme.tlschallenge=true</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--certificatesresolvers.myresolver.acme.email=youremail@example.com</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;80:80&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;443:443&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8080:8080&quot;</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/var/run/docker.sock:/var/run/docker.sock:ro</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">traefik_letsencrypt:/letsencrypt</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DATABASE_URL=postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=redis://redis:6379/0</span>\n    <span class=\"hljs-attr\">labels:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.enable=true&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.backend.rule=Host(`api.example.com`)&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.backend.entrypoints=websecure&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.backend.tls.certresolver=myresolver&quot;</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n  <span class=\"hljs-attr\">celery-worker:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">-A</span> <span class=\"hljs-string\">app.celery_worker.celery_app</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">--loglevel=info</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DATABASE_URL=postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=redis://redis:6379/0</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">backend</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./frontend</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">VITE_API_URL=https://example.com</span>\n    <span class=\"hljs-attr\">labels:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.enable=true&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.frontend.rule=Host(`example.com`)&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.frontend.entrypoints=websecure&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.frontend.tls.certresolver=myresolver&quot;</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">postgres:15-alpine</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_USER=infra_user</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_PASSWORD=infra_pass</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_DB=infra_db</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres_data:/var/lib/postgresql/data</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:7-alpine</span>\n<span class=\"hljs-attr\">volumes:</span>\n  <span class=\"hljs-attr\">postgres_data:</span>\n  <span class=\"hljs-attr\">traefik_letsencrypt:</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5036,5101"}}],"payload":{"tag":"h2","lines":"5034,5035"}},{"content":"infra-automation-chart/","children":[],"payload":{"tag":"h2","lines":"5104,5105"}},{"content":".github/workflows/deploy-k8s.yml","children":[{"content":"<pre data-lines=\"5112,5153\"><code class=\"language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Deploy</span> <span class=\"hljs-string\">Infra</span> <span class=\"hljs-string\">Automation</span> <span class=\"hljs-string\">App</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">Kubernetes</span>\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">branches:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">main</span>\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">build-and-deploy:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span> <span class=\"hljs-string\">repo</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v3</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Set</span> <span class=\"hljs-string\">up</span> <span class=\"hljs-string\">Docker</span> <span class=\"hljs-string\">Buildx</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">docker/setup-buildx-action@v2</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Log</span> <span class=\"hljs-string\">in</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">DockerHub</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">docker/login-action@v2</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.DOCKERHUB_USERNAME</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.DOCKERHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">backend</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-backend:latest ./backend\n          docker push yourdockerhub/infra-backend:latest\n</span>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-celery-worker:latest ./backend\n          docker push yourdockerhub/infra-celery-worker:latest\n</span>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">frontend</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-frontend:latest ./frontend\n          docker push yourdockerhub/infra-frontend:latest\n</span>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Set</span> <span class=\"hljs-string\">up</span> <span class=\"hljs-string\">kubectl</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">azure/setup-kubectl@v3</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&apos;latest&apos;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Deploy</span> <span class=\"hljs-string\">Helm</span> <span class=\"hljs-string\">Chart</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          helm upgrade --install infra-automation ./infra-automation-chart --namespace infra --create-namespace --wait\n</span>        <span class=\"hljs-attr\">env:</span>\n          <span class=\"hljs-attr\">KUBECONFIG:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.KUBECONFIG</span> <span class=\"hljs-string\">}}</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5112,5153"}}],"payload":{"tag":"h2","lines":"5110,5111"}},{"content":"backend/requirements.txt","children":[{"content":"<pre data-lines=\"5158,5172\"><code data-lines=\"5158,5172\"><span class=\"hljs-attribute\">fastapi</span>[<span class=\"hljs-literal\">all</span>]==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">95</span>.<span class=\"hljs-number\">1</span>\n<span class=\"hljs-attribute\">uvicorn</span>[standard]==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">22</span>.<span class=\"hljs-number\">0</span>\n<span class=\"hljs-attribute\">celery</span>[redis]==<span class=\"hljs-number\">5</span>.<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">7</span>\n<span class=\"hljs-attribute\">asyncpg</span>==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">27</span>.<span class=\"hljs-number\">0</span>\n<span class=\"hljs-attribute\">sqlalchemy</span>[asyncio]==<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">4</span>.<span class=\"hljs-number\">46</span>\n<span class=\"hljs-attribute\">databases</span>[postgresql]==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">6</span>.<span class=\"hljs-number\">1</span>\n<span class=\"hljs-attribute\">python</span>-dotenv==<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">0</span>\n<span class=\"hljs-attribute\">pyyaml</span>==<span class=\"hljs-number\">6</span>.<span class=\"hljs-number\">0</span>\n<span class=\"hljs-attribute\">httpx</span>==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">24</span>.<span class=\"hljs-number\">1</span>\n<span class=\"hljs-attribute\">python</span>-multipart==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">6</span>\n<span class=\"hljs-attribute\">passlib</span>[bcrypt]==<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">7</span>.<span class=\"hljs-number\">4</span>\n<span class=\"hljs-attribute\">authlib</span>==<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">0</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5158,5172"}}],"payload":{"tag":"h2","lines":"5156,5157"}},{"content":"backend/Dockerfile","children":[{"content":"<pre data-lines=\"5177,5185\"><code class=\"language-dockerfile\"><span class=\"hljs-keyword\">FROM</span> python:<span class=\"hljs-number\">3.11</span>-slim\n<span class=\"hljs-keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span>\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> requirements.txt .</span>\n<span class=\"hljs-keyword\">RUN</span><span class=\"language-bash\"> pip install --no-cache-dir -r requirements.txt</span>\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> ./app ./app</span>\n<span class=\"hljs-keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"hljs-string\">&quot;uvicorn&quot;</span>, <span class=\"hljs-string\">&quot;app.main:app&quot;</span>, <span class=\"hljs-string\">&quot;--host&quot;</span>, <span class=\"hljs-string\">&quot;0.0.0.0&quot;</span>, <span class=\"hljs-string\">&quot;--port&quot;</span>, <span class=\"hljs-string\">&quot;8000&quot;</span>]</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5177,5185"}}],"payload":{"tag":"h2","lines":"5175,5176"}},{"content":"frontend/package.json","children":[{"content":"<pre data-lines=\"5190,5211\"><code class=\"language-json\"><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;infra-frontend&quot;</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;version&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1.0.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;scripts&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">&quot;dev&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;vite&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;build&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;vite build&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;preview&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;vite preview&quot;</span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;dependencies&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">&quot;svelte&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^4.0.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;monaco-editor&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^0.40.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;svelte-toast&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^3.1.1&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;socket.io-client&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^4.5.1&quot;</span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;devDependencies&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">&quot;vite&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^4.1.4&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;@sveltejs/vite-plugin-svelte&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^1.2.0&quot;</span>\n  <span class=\"hljs-punctuation\">}</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5190,5211"}}],"payload":{"tag":"h2","lines":"5188,5189"}},{"content":"frontend/Dockerfile","children":[{"content":"<pre data-lines=\"5216,5226\"><code class=\"language-dockerfile\"><span class=\"hljs-keyword\">FROM</span> node:<span class=\"hljs-number\">20</span>-alpine\n<span class=\"hljs-keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span>\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> package.json package-lock.json* ./</span>\n<span class=\"hljs-keyword\">RUN</span><span class=\"language-bash\"> npm install</span>\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> . .</span>\n<span class=\"hljs-keyword\">RUN</span><span class=\"language-bash\"> npm run build</span>\n<span class=\"hljs-keyword\">EXPOSE</span> <span class=\"hljs-number\">5173</span>\n<span class=\"hljs-keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"hljs-string\">&quot;npm&quot;</span>, <span class=\"hljs-string\">&quot;run&quot;</span>, <span class=\"hljs-string\">&quot;preview&quot;</span>]</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5216,5226"}}],"payload":{"tag":"h2","lines":"5214,5215"}},{"content":"Note finali","children":[{"content":"","children":[{"content":"Per sicurezza, le variabili sensibili vanno spostate in Secret Manager / K8s Secrets","children":[],"payload":{"tag":"li","lines":"5231,5232"}},{"content":"Per l&#x2019;autenticazione OAuth GitHub/GitLab configurare le app nei rispettivi portali e inserire client_id/client_secret in backend.env","children":[],"payload":{"tag":"li","lines":"5232,5233"}},{"content":"I componenti (backend, celery, frontend) sono modulari e scalabili","children":[],"payload":{"tag":"li","lines":"5233,5234"}},{"content":"Il frontend Svelte usa stores per la gestione stato e websocket per streaming realtime","children":[],"payload":{"tag":"li","lines":"5234,5235"}},{"content":"Il backend FastAPI espone","children":[],"payload":{"tag":"li","lines":"5235,5238"}}],"payload":{"tag":"ul","lines":"5231,5238"}},{"content":"Celery consente task async per esecuzioni playbook / provisioning","children":[],"payload":{"tag":"li","lines":"5240,5242"}}],"payload":{"tag":"h2","lines":"5229,5230"}}],"payload":{"tag":"h1","lines":"4807,4808"}},{"content":"Backend &#x2014; FastAPI + Celery","children":[{"content":"backend/app/main.py","children":[{"content":"<pre data-lines=\"5263,5299\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI, WebSocket, Depends, HTTPException, status\n<span class=\"hljs-keyword\">from</span> fastapi.middleware.cors <span class=\"hljs-keyword\">import</span> CORSMiddleware\n<span class=\"hljs-keyword\">from</span> app.api <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> api_router\n<span class=\"hljs-keyword\">from</span> app.celery_worker <span class=\"hljs-keyword\">import</span> celery_app\n<span class=\"hljs-keyword\">from</span> app.core.auth <span class=\"hljs-keyword\">import</span> get_current_user\napp = FastAPI(\n    title=<span class=\"hljs-string\">&quot;Infra Automation Backend&quot;</span>,\n    description=<span class=\"hljs-string\">&quot;Backend API per gestione playbook Ansible e provisioning OpenTofu&quot;</span>,\n    version=<span class=\"hljs-string\">&quot;1.0.0&quot;</span>,\n)\n<span class=\"hljs-comment\"># Permetti CORS dal frontend (configura con il dominio frontend reale)</span>\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[<span class=\"hljs-string\">&quot;http://localhost:5173&quot;</span>],\n    allow_credentials=<span class=\"hljs-literal\">True</span>,\n    allow_methods=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_headers=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n)\n<span class=\"hljs-comment\"># Monta router API</span>\napp.include_router(api_router, prefix=<span class=\"hljs-string\">&quot;/api&quot;</span>)\n<span class=\"hljs-comment\"># WebSocket endpoint per streaming log realtime</span>\n<span class=\"hljs-meta\">@app.websocket(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/ws/logs/{task_id}&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">websocket_logs</span>(<span class=\"hljs-params\">websocket: WebSocket, task_id: <span class=\"hljs-built_in\">str</span>, user=Depends(<span class=\"hljs-params\">get_current_user</span>)</span>):\n    <span class=\"hljs-keyword\">await</span> websocket.accept()\n    <span class=\"hljs-keyword\">try</span>:\n        <span class=\"hljs-comment\"># Qui implementare la logica di connessione a Celery backend / Redis per stream log</span>\n        <span class=\"hljs-comment\"># Placeholder: echo loop</span>\n        <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n            data = <span class=\"hljs-keyword\">await</span> websocket.receive_text()\n            <span class=\"hljs-keyword\">await</span> websocket.send_text(<span class=\"hljs-string\">f&quot;Echo: <span class=\"hljs-subst\">{data}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;WebSocket closed: <span class=\"hljs-subst\">{e}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">finally</span>:\n        <span class=\"hljs-keyword\">await</span> websocket.close()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5263,5299"}}],"payload":{"tag":"h2","lines":"5261,5262"}},{"content":"backend/app/api/<strong>init</strong>.py","children":[{"content":"<pre data-lines=\"5304,5317\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter\n<span class=\"hljs-keyword\">from</span> .playbooks <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> playbooks_router\n<span class=\"hljs-keyword\">from</span> .auth <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> auth_router\n<span class=\"hljs-keyword\">from</span> .tasks <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> tasks_router\nrouter = APIRouter()\n<span class=\"hljs-comment\"># API route per playbook (lista, esecuzione, upload)</span>\nrouter.include_router(playbooks_router, prefix=<span class=\"hljs-string\">&quot;/playbooks&quot;</span>, tags=[<span class=\"hljs-string\">&quot;Playbooks&quot;</span>])\n<span class=\"hljs-comment\"># API route per autenticazione OAuth</span>\nrouter.include_router(auth_router, prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>, tags=[<span class=\"hljs-string\">&quot;Auth&quot;</span>])\n<span class=\"hljs-comment\"># API route per task (cronologia, stato)</span>\nrouter.include_router(tasks_router, prefix=<span class=\"hljs-string\">&quot;/tasks&quot;</span>, tags=[<span class=\"hljs-string\">&quot;Tasks&quot;</span>])\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5304,5317"}}],"payload":{"tag":"h2","lines":"5302,5303"}},{"content":"backend/app/api/playbooks.py","children":[{"content":"<pre data-lines=\"5322,5352\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter, UploadFile, File, HTTPException, Depends\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">List</span>\n<span class=\"hljs-keyword\">import</span> yaml\n<span class=\"hljs-keyword\">from</span> app.schemas <span class=\"hljs-keyword\">import</span> Playbook\n<span class=\"hljs-keyword\">from</span> app.core.auth <span class=\"hljs-keyword\">import</span> get_current_user\nrouter = APIRouter()\nplaybooks_store = {}  <span class=\"hljs-comment\"># In-memory playbook store (da sostituire DB reale)</span>\n<span class=\"hljs-meta\">@router.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/&quot;</span>, response_model=<span class=\"hljs-type\">List</span>[Playbook]</span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">list_playbooks</span>(<span class=\"hljs-params\">user=Depends(<span class=\"hljs-params\">get_current_user</span>)</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;Restituisce lista playbook disponibili&quot;&quot;&quot;</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">list</span>(playbooks_store.values())\n<span class=\"hljs-meta\">@router.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/upload&quot;</span>, response_model=Playbook</span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">upload_playbook</span>(<span class=\"hljs-params\">file: UploadFile = File(<span class=\"hljs-params\">...</span>), user=Depends(<span class=\"hljs-params\">get_current_user</span>)</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;Upload file YAML playbook e validazione&quot;&quot;&quot;</span>\n    content = <span class=\"hljs-keyword\">await</span> file.read()\n    <span class=\"hljs-keyword\">try</span>:\n        y = yaml.safe_load(content)\n        <span class=\"hljs-comment\"># Validazione base: esiste &quot;tasks&quot; ?</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">&quot;tasks&quot;</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> y:\n            <span class=\"hljs-keyword\">raise</span> HTTPException(status_code=<span class=\"hljs-number\">400</span>, detail=<span class=\"hljs-string\">&quot;YAML playbook missing &apos;tasks&apos; section&quot;</span>)\n        playbook = Playbook(\n            name=file.filename,\n            content=content.decode(<span class=\"hljs-string\">&quot;utf-8&quot;</span>)\n        )\n        playbooks_store[file.filename] = playbook\n        <span class=\"hljs-keyword\">return</span> playbook\n    <span class=\"hljs-keyword\">except</span> yaml.YAMLError <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-keyword\">raise</span> HTTPException(status_code=<span class=\"hljs-number\">400</span>, detail=<span class=\"hljs-string\">f&quot;YAML parsing error: <span class=\"hljs-subst\">{<span class=\"hljs-built_in\">str</span>(e)}</span>&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5322,5352"}}],"payload":{"tag":"h2","lines":"5320,5321"}},{"content":"backend/app/celery_worker.py","children":[{"content":"<pre data-lines=\"5357,5377\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">import</span> os\nredis_url = os.getenv(<span class=\"hljs-string\">&quot;REDIS_URL&quot;</span>, <span class=\"hljs-string\">&quot;redis://localhost:6379/0&quot;</span>)\nbackend_url = os.getenv(<span class=\"hljs-string\">&quot;DATABASE_URL&quot;</span>, <span class=\"hljs-string\">&quot;db+postgresql://user:pass@localhost/db&quot;</span>)\ncelery_app = Celery(\n    <span class=\"hljs-string\">&quot;infra_automation&quot;</span>,\n    broker=redis_url,\n    backend=redis_url,\n)\n<span class=\"hljs-comment\"># Task esempio: esegue playbook Ansible (placeholder)</span>\n<span class=\"hljs-meta\">@celery_app.task(<span class=\"hljs-params\">bind=<span class=\"hljs-literal\">True</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_ansible_playbook</span>(<span class=\"hljs-params\">self, playbook_content: <span class=\"hljs-built_in\">str</span>, extra_vars: <span class=\"hljs-built_in\">dict</span></span>):\n    <span class=\"hljs-comment\"># <span class=\"hljs-doctag\">TODO:</span> integra Ansible Runner o esecuzione shell con playbook YAML</span>\n    <span class=\"hljs-keyword\">import</span> time\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">10</span>):\n        <span class=\"hljs-variable language_\">self</span>.update_state(state=<span class=\"hljs-string\">&quot;PROGRESS&quot;</span>, meta={<span class=\"hljs-string\">&quot;step&quot;</span>: i})\n        time.sleep(<span class=\"hljs-number\">1</span>)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;status&quot;</span>: <span class=\"hljs-string\">&quot;completed&quot;</span>}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5357,5377"}}],"payload":{"tag":"h2","lines":"5355,5356"}},{"content":"backend/app/schemas.py","children":[{"content":"<pre data-lines=\"5382,5393\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseModel\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">Optional</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Playbook</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    name: <span class=\"hljs-built_in\">str</span>\n    content: <span class=\"hljs-built_in\">str</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TaskStatus</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    task_id: <span class=\"hljs-built_in\">str</span>\n    status: <span class=\"hljs-built_in\">str</span>\n    meta: <span class=\"hljs-type\">Optional</span>[<span class=\"hljs-built_in\">dict</span>] = <span class=\"hljs-literal\">None</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5382,5393"}}],"payload":{"tag":"h2","lines":"5380,5381"}}],"payload":{"tag":"h1","lines":"5257,5258"}},{"content":"Frontend &#x2014; Svelte + Vite","children":[{"content":"frontend/src/App.svelte","children":[{"content":"<pre data-lines=\"5402,5446\"><code class=\"language-svelte\">&lt;script&gt;\n  import { onMount } from &quot;svelte&quot;;\n  import PlaybookList from &quot;./components/PlaybookList.svelte&quot;;\n  import PlaybookEditor from &quot;./components/PlaybookEditor.svelte&quot;;\n  import TaskLogs from &quot;./components/TaskLogs.svelte&quot;;\n  import Toast from &quot;svelte-toast&quot;;\n  let selectedPlaybook = null;\n  let taskId = null;\n  function onPlaybookSelected(playbook) {\n    selectedPlaybook = playbook;\n  }\n  function onRunPlaybook(id) {\n    taskId = id;\n  }\n&lt;/script&gt;\n&lt;main&gt;\n  &lt;h1&gt;Infra Automation Dashboard&lt;/h1&gt;\n  &lt;Toast /&gt;\n  &lt;section&gt;\n    &lt;PlaybookList on:select={event =&gt; onPlaybookSelected(event.detail)} /&gt;\n  &lt;/section&gt;\n  {#if selectedPlaybook}\n    &lt;section&gt;\n      &lt;PlaybookEditor {selectedPlaybook} /&gt;\n      &lt;button on:click={() =&gt; onRunPlaybook(selectedPlaybook.name)}&gt;\n        Esegui Playbook\n      &lt;/button&gt;\n    &lt;/section&gt;\n  {/if}\n  {#if taskId}\n    &lt;section&gt;\n      &lt;TaskLogs {taskId} /&gt;\n    &lt;/section&gt;\n  {/if}\n&lt;/main&gt;\n&lt;style&gt;\n  main {\n    max-width: 900px;\n    margin: auto;\n    font-family: system-ui, sans-serif;\n  }\n&lt;/style&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5402,5446"}}],"payload":{"tag":"h2","lines":"5400,5401"}},{"content":"frontend/src/components/PlaybookList.svelte","children":[{"content":"<pre data-lines=\"5451,5474\"><code class=\"language-svelte\">&lt;script&gt;\n  import { onMount, createEventDispatcher } from &quot;svelte&quot;;\n  const API_URL = import.meta.env.VITE_API_URL || &quot;http://localhost:8000/api&quot;;\n  let playbooks = [];\n  const dispatch = createEventDispatcher();\n  onMount(async () =&gt; {\n    const res = await fetch(`&#x24;{API_URL}/playbooks/`);\n    if (res.ok) {\n      playbooks = await res.json();\n    }\n  });\n  function selectPlaybook(playbook) {\n    dispatch(&quot;select&quot;, playbook);\n  }\n&lt;/script&gt;\n&lt;h2&gt;Playbook disponibili&lt;/h2&gt;\n&lt;ul&gt;\n  {#each playbooks as pb}\n    &lt;li&gt;&lt;button on:click={() =&gt; selectPlaybook(pb)}&gt;{pb.name}&lt;/button&gt;&lt;/li&gt;\n  {/each}\n&lt;/ul&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5451,5474"}}],"payload":{"tag":"h2","lines":"5449,5450"}},{"content":"frontend/src/components/PlaybookEditor.svelte","children":[{"content":"<pre data-lines=\"5479,5501\"><code class=\"language-svelte\">&lt;script&gt;\n  import { onMount } from &quot;svelte&quot;;\n  import * as monaco from &quot;monaco-editor&quot;;\n  export let selectedPlaybook;\n  let editorDiv;\n  let editorInstance;\n  onMount(() =&gt; {\n    editorInstance = monaco.editor.create(editorDiv, {\n      value: selectedPlaybook.content,\n      language: &quot;yaml&quot;,\n      automaticLayout: true,\n      theme: &quot;vs-dark&quot;,\n    });\n  });\n  // Aggiorna contenuto editor se cambia playbook\n  &#x24;: if (editorInstance &amp;&amp; selectedPlaybook) {\n    editorInstance.setValue(selectedPlaybook.content);\n  }\n&lt;/script&gt;\n&lt;div bind:this={editorDiv} style=&quot;height: 400px; border: 1px solid #ccc;&quot;&gt;&lt;/div&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5479,5501"}}],"payload":{"tag":"h2","lines":"5477,5478"}},{"content":"frontend/src/components/TaskLogs.svelte","children":[{"content":"<pre data-lines=\"5506,5530\"><code class=\"language-svelte\">&lt;script&gt;\n  import { onMount, onDestroy } from &quot;svelte&quot;;\n  import { toast } from &quot;svelte-toast&quot;;\n  export let taskId;\n  let logs = &quot;&quot;;\n  let ws;\n  onMount(() =&gt; {\n    const API_URL = import.meta.env.VITE_API_URL || &quot;http://localhost:8000&quot;;\n    ws = new WebSocket(`&#x24;{API_URL.replace(/^http/, &quot;ws&quot;)}/ws/logs/&#x24;{taskId}`);\n    ws.onmessage = (event) =&gt; {\n      logs += event.data + &quot;\\n&quot;;\n    };\n    ws.onerror = () =&gt; {\n      toast.push(&quot;Errore nella connessione WebSocket&quot;, { theme: { &quot;--toastBackground&quot;: &quot;red&quot; } });\n    };\n  });\n  onDestroy(() =&gt; {\n    ws.close();\n  });\n&lt;/script&gt;\n&lt;h2&gt;Log in tempo reale per task: {taskId}&lt;/h2&gt;\n&lt;pre style=&quot;background:#000; color:#0f0; height: 300px; overflow-y: scroll;&quot;&gt;{logs}&lt;/pre&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5506,5530"}}],"payload":{"tag":"h2","lines":"5504,5505"}}],"payload":{"tag":"h1","lines":"5396,5397"}}]},null)</script>
</body>
</html>
