<!doctype html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
html {
  font-family: ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji',
    'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
.markmap-dark {
  background: #27272a;
  color: white;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.12/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/index.js"></script><script>((r) => {
          setTimeout(r);
        })(() => {
  const { markmap, mm } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute("style", "position:absolute;bottom:20px;right:20px");
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
              if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                document.documentElement.classList.add("markmap-dark");
              }
            })(() => window.markmap,null,{"content":"","children":[{"content":"&#x1f680; Proposta Rivoluzionata: Workflow DSL <strong>Multidominio</strong>, Modularit&#xe0; Avanzata e Integrazione Nativa","children":[{"content":"1. Problemi chiave da risolvere nel modello base","children":[{"content":"YAML piatto limita la <strong>modularit&#xe0; e composizione</strong> dei workflow.","children":[],"payload":{"tag":"li","lines":"635,636"}},{"content":"Variabili globali singole possono causare <strong>collisioni e poca tracciabilit&#xe0;</strong>.","children":[],"payload":{"tag":"li","lines":"636,637"}},{"content":"<strong>Error handling</strong> e branching poco espressivi.","children":[],"payload":{"tag":"li","lines":"637,638"}},{"content":"Assenza di <strong>eventi e callback</strong> per integrazione realtime.","children":[],"payload":{"tag":"li","lines":"638,639"}},{"content":"Nessun supporto nativo a <strong>stati e monitoraggio</strong> (idempotenza runtime).","children":[],"payload":{"tag":"li","lines":"639,640"}},{"content":"Difficolt&#xe0; nell&#x2019;<strong>estendere tipi di task</strong> senza complicare il parsing.","children":[],"payload":{"tag":"li","lines":"640,642"}}],"payload":{"tag":"h2","lines":"633,634"}},{"content":"2. Linee guida di design rivoluzionario","children":[{"content":"Struttura <strong>nested e gerarchica</strong> ma leggibile (bilanciando flat e nested).","children":[],"payload":{"tag":"li","lines":"646,647"}},{"content":"Scope variabili per <strong>step, modulo, global</strong> con override controllato.","children":[],"payload":{"tag":"li","lines":"647,648"}},{"content":"Introduzione di <strong>flussi condizionali e branching dichiarativi</strong> (<code>if</code>, <code>switch</code>).","children":[],"payload":{"tag":"li","lines":"648,649"}},{"content":"Definizione di <strong>eventi e hook</strong> per callback custom (es. onSuccess, onError).","children":[],"payload":{"tag":"li","lines":"649,650"}},{"content":"Stato runtime con <strong>checkpoint e rollback</strong> per garantire idempotenza avanzata.","children":[],"payload":{"tag":"li","lines":"650,651"}},{"content":"Task tipizzati e modulari con plugin system per <strong>aggiungere moduli senza toccare core</strong>.","children":[],"payload":{"tag":"li","lines":"651,652"}},{"content":"Output dei task accessibili per decisioni e variabili dinamiche downstream.","children":[],"payload":{"tag":"li","lines":"652,653"}},{"content":"Supporto nativo per <strong>parallelismo dichiarativo</strong> (con limitazioni e fallback).","children":[],"payload":{"tag":"li","lines":"653,655"}}],"payload":{"tag":"h2","lines":"644,645"}},{"content":"3. Nuova sintassi YAML ottimizzata (con commenti)","children":[{"content":"<pre data-lines=\"659,729\"><code class=\"language-yaml\"><span class=\"hljs-attr\">workflow:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">&quot;Deploy completo app&quot;</span>\n  <span class=\"hljs-attr\">vars:</span>                           <span class=\"hljs-comment\"># Scope globale variabili</span>\n    <span class=\"hljs-attr\">env:</span> <span class=\"hljs-string\">production</span>\n    <span class=\"hljs-attr\">api_url:</span> <span class=\"hljs-string\">&quot;https://api.myapp.com&quot;</span>\n    <span class=\"hljs-attr\">api_token:</span> <span class=\"hljs-string\">&quot;secret-token&quot;</span>\n\n  <span class=\"hljs-attr\">stages:</span>                        <span class=\"hljs-comment\"># Modularit&#xe0; e struttura</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Provision</span> <span class=\"hljs-string\">infrastruttura</span>\n      <span class=\"hljs-attr\">vars:</span>                      <span class=\"hljs-comment\"># Override vars locali</span>\n        <span class=\"hljs-attr\">infra_type:</span> <span class=\"hljs-string\">&quot;bare-metal&quot;</span>\n\n      <span class=\"hljs-attr\">tasks:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">provision_servers</span>\n          <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ansible</span>\n          <span class=\"hljs-attr\">playbook:</span> <span class=\"hljs-string\">deploy_infra.yml</span>\n          <span class=\"hljs-attr\">extra_vars:</span>\n            <span class=\"hljs-attr\">environment:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ env }}</span>&quot;</span>\n            <span class=\"hljs-attr\">infra_type:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ infra_type }}</span>&quot;</span>\n          <span class=\"hljs-attr\">onSuccess:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">emit:</span> <span class=\"hljs-string\">infra_ready</span>\n\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Database</span> <span class=\"hljs-string\">e</span> <span class=\"hljs-string\">Backend</span>\n      <span class=\"hljs-attr\">tasks:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">migrate_db</span>\n          <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">http_request</span>\n          <span class=\"hljs-attr\">method:</span> <span class=\"hljs-string\">POST</span>\n          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ api_url }}</span>/db/migrate&quot;</span>\n          <span class=\"hljs-attr\">headers:</span>\n            <span class=\"hljs-attr\">Authorization:</span> <span class=\"hljs-string\">&quot;Bearer <span class=\"hljs-template-variable\">{{ api_token }}</span>&quot;</span>\n          <span class=\"hljs-attr\">output:</span> <span class=\"hljs-string\">migration_result</span>     <span class=\"hljs-comment\"># Salva output per riferimento</span>\n          <span class=\"hljs-attr\">retries:</span> <span class=\"hljs-number\">3</span>\n          <span class=\"hljs-attr\">retry_delay:</span> <span class=\"hljs-number\">5</span>\n          <span class=\"hljs-attr\">onError:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">rollback:</span> <span class=\"hljs-string\">provision_servers</span>\n\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">notify_users</span>\n          <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">http_request</span>\n          <span class=\"hljs-attr\">method:</span> <span class=\"hljs-string\">POST</span>\n          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ api_url }}</span>/notify&quot;</span>\n          <span class=\"hljs-attr\">headers:</span>\n            <span class=\"hljs-attr\">Authorization:</span> <span class=\"hljs-string\">&quot;Bearer <span class=\"hljs-template-variable\">{{ api_token }}</span>&quot;</span>\n          <span class=\"hljs-attr\">body:</span>\n            <span class=\"hljs-attr\">message:</span> <span class=\"hljs-string\">&quot;Deploy completato con successo&quot;</span>\n\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Frontend</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">&amp;</span> <span class=\"hljs-string\">Deploy</span>\n      <span class=\"hljs-attr\">parallel:</span> <span class=\"hljs-literal\">true</span>               <span class=\"hljs-comment\"># Parallelismo dichiarativo</span>\n      <span class=\"hljs-attr\">tasks:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">build_frontend</span>\n          <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">shell</span>\n          <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">&quot;npm run build&quot;</span>\n          <span class=\"hljs-attr\">cwd:</span> <span class=\"hljs-string\">&quot;./frontend&quot;</span>\n          <span class=\"hljs-attr\">onSuccess:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">emit:</span> <span class=\"hljs-string\">frontend_built</span>\n\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">deploy_frontend</span>\n          <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">shell</span>\n          <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">&quot;./deploy_frontend.sh&quot;</span>\n          <span class=\"hljs-attr\">when:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ frontend_built == true }}</span>&quot;</span>    <span class=\"hljs-comment\"># Branching semplice</span>\n\n  <span class=\"hljs-attr\">events:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra_ready</span>\n      <span class=\"hljs-attr\">actions:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">log:</span> <span class=\"hljs-string\">&quot;Infrastruttura pronta, procedo con DB&quot;</span>\n\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">frontend_built</span>\n      <span class=\"hljs-attr\">actions:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">log:</span> <span class=\"hljs-string\">&quot;Frontend compilato, pronto al deploy&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"659,729"}}],"payload":{"tag":"h2","lines":"657,658"}},{"content":"4. Spiegazione delle innovazioni","children":[{"content":"<table data-lines=\"734,743\">\n<thead data-lines=\"734,735\">\n<tr data-lines=\"734,735\">\n<th>Caratteristica</th>\n<th>Descrizione &amp; Vantaggi</th>\n</tr>\n</thead>\n<tbody data-lines=\"736,743\">\n<tr data-lines=\"736,737\">\n<td><strong>Stages</strong></td>\n<td>Modularizza workflow in fasi, facilita debugging e riusabilit&#xe0;.</td>\n</tr>\n<tr data-lines=\"737,738\">\n<td><strong>Variabili a scope</strong></td>\n<td>Permette override controllato senza conflitti.</td>\n</tr>\n<tr data-lines=\"738,739\">\n<td><strong>Task con <code>id</code> e output</strong></td>\n<td>Permette riferimenti dinamici, flussi condizionali precisi.</td>\n</tr>\n<tr data-lines=\"739,740\">\n<td><strong>Eventi &amp; hook</strong></td>\n<td>Permette callback asincrone, logging, trigger su stati.</td>\n</tr>\n<tr data-lines=\"740,741\">\n<td><strong>Error handling avanzato</strong></td>\n<td>Retry, rollback e branching nativi, per affidabilit&#xe0; migliorata.</td>\n</tr>\n<tr data-lines=\"741,742\">\n<td><strong>Parallelismo dichiarato</strong></td>\n<td>Migliora performance mantenendo leggibilit&#xe0;.</td>\n</tr>\n<tr data-lines=\"742,743\">\n<td><strong>Branching semplice (<code>when</code>)</strong></td>\n<td>Permette percorsi condizionali senza complicare sintassi.</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"734,743"}}],"payload":{"tag":"h2","lines":"732,733"}},{"content":"5. Come implementare il motore","children":[{"content":"Parsing YAML basato su librerie mature (es. PyYAML).","children":[],"payload":{"tag":"li","lines":"748,749"}},{"content":"Modello interno ad oggetti con gestione scope variabili e stato.","children":[],"payload":{"tag":"li","lines":"749,750"}},{"content":"Event bus interno per eventi/hook (pub/sub).","children":[],"payload":{"tag":"li","lines":"750,751"}},{"content":"Executor task estendibile tramite plugin (ansible-runner, requests HTTP, subprocess shell).","children":[],"payload":{"tag":"li","lines":"751,752"}},{"content":"Scheduler interno per parallelismo e retry.","children":[],"payload":{"tag":"li","lines":"752,753"}},{"content":"Logging centralizzato e report stato.","children":[],"payload":{"tag":"li","lines":"753,755"}}],"payload":{"tag":"h2","lines":"746,747"}},{"content":"6. Documentazione wiki migliorata","children":[{"content":"<pre data-lines=\"759,773\"><code data-lines=\"759,773\">/docs\n&#x251c;&#x2500;&#x2500; Home.md\n&#x251c;&#x2500;&#x2500; Concepts.md            <span class=\"hljs-comment\"># Design principles e overview DSL</span>\n&#x251c;&#x2500;&#x2500; Workflow_Syntax.md     <span class=\"hljs-comment\"># Descrizione sintassi avanzata (stages, events, tasks)</span>\n&#x251c;&#x2500;&#x2500; Tasks_Modules.md       <span class=\"hljs-comment\"># Task types, plugin system, esempi avanzati</span>\n&#x251c;&#x2500;&#x2500; Error_Handling.md      <span class=\"hljs-comment\"># Retry, rollback, condizioni, esempi pratici</span>\n&#x251c;&#x2500;&#x2500; Events_and_Parallel.md <span class=\"hljs-comment\"># Eventi, hook, e parallelismo dichiarati</span>\n&#x251c;&#x2500;&#x2500; Integration_Ansible.md <span class=\"hljs-comment\"># Come integrare playbook ansible reali</span>\n&#x251c;&#x2500;&#x2500; Integration_API.md     <span class=\"hljs-comment\"># Usare Django REST e altre API HTTP</span>\n&#x251c;&#x2500;&#x2500; Frontend_React.md      <span class=\"hljs-comment\"># Consigli per integrazione UI e notifiche real-time</span>\n&#x251c;&#x2500;&#x2500; Examples.md            <span class=\"hljs-comment\"># Workflow completi commentati</span>\n&#x2514;&#x2500;&#x2500; Contributing.md        <span class=\"hljs-comment\"># Linee guida per estensioni e moduli</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"759,773"}}],"payload":{"tag":"h2","lines":"757,758"}},{"content":"7. Conclusione","children":[{"content":"","children":[{"content":"&#xc8; <strong>modulare, leggibile e potente</strong>,","children":[],"payload":{"tag":"li","lines":"780,781"}},{"content":"Gestisce <strong>errori, eventi, parallelismo e rollback</strong> senza ricorrere a logica imperativa,","children":[],"payload":{"tag":"li","lines":"781,782"}},{"content":"Facilita integrazione con Ansible, Django REST e frontend React,","children":[],"payload":{"tag":"li","lines":"782,783"}},{"content":"Permette di scalare e mantenere il progetto a lungo termine,","children":[],"payload":{"tag":"li","lines":"783,784"}},{"content":"Con una documentazione strutturata e facilmente navigabile in wiki Markdown.","children":[],"payload":{"tag":"li","lines":"784,786"}}],"payload":{"tag":"ul","lines":"780,786"}},{"content":"","children":[{"content":"Un parser + executor Python minimal per provarlo,","children":[],"payload":{"tag":"li","lines":"790,791"}},{"content":"Un esempio reale di playbook Ansible integrato,","children":[],"payload":{"tag":"li","lines":"791,792"}},{"content":"Un template di wiki con esempi e best practice.","children":[],"payload":{"tag":"li","lines":"792,794"}}],"payload":{"tag":"ul","lines":"790,794"}}],"payload":{"tag":"h2","lines":"776,777"}},{"content":"1. Django + React: punti di forza","children":[{"content":"Django (Backend)","children":[{"content":"<strong>Full-stack framework maturo</strong> con ORM, autenticazione, admin panel integrato.","children":[],"payload":{"tag":"li","lines":"814,815"}},{"content":"Ottimo per costruire API REST con <strong>Django REST Framework</strong>.","children":[],"payload":{"tag":"li","lines":"815,816"}},{"content":"Gestione sicura e robusta di DB, utenti, permessi.","children":[],"payload":{"tag":"li","lines":"816,817"}},{"content":"Ecosistema maturo e community attiva.","children":[],"payload":{"tag":"li","lines":"817,818"}},{"content":"Facilmente scalabile e customizzabile.","children":[],"payload":{"tag":"li","lines":"818,819"}},{"content":"Supporto nativo a task asincroni (con Celery, Channels).","children":[],"payload":{"tag":"li","lines":"819,820"}},{"content":"Buona integrazione con sistemi di automazione (es. chiamate a shell, playbook).","children":[],"payload":{"tag":"li","lines":"820,822"}}],"payload":{"tag":"h3","lines":"812,813"}},{"content":"React (Frontend)","children":[{"content":"UI declarativa, component-based, con ottimo supporto per state management (Redux, Recoil).","children":[],"payload":{"tag":"li","lines":"824,825"}},{"content":"Ecosistema immenso e in continua evoluzione.","children":[],"payload":{"tag":"li","lines":"825,826"}},{"content":"Ottimo per dashboard, notifiche real-time, visualizzazione flussi.","children":[],"payload":{"tag":"li","lines":"826,827"}},{"content":"Facilmente integrabile con websocket (es. Django Channels).","children":[],"payload":{"tag":"li","lines":"827,829"}}],"payload":{"tag":"h3","lines":"822,823"}}],"payload":{"tag":"h2","lines":"810,811"}},{"content":"2. Possibili limiti e alternative da considerare","children":[{"content":"<table data-lines=\"833,840\">\n<thead data-lines=\"833,834\">\n<tr data-lines=\"833,834\">\n<th>Area</th>\n<th>Criticit&#xe0; Django + React</th>\n<th>Alternative da valutare</th>\n</tr>\n</thead>\n<tbody data-lines=\"835,840\">\n<tr data-lines=\"835,836\">\n<td><strong>Backend</strong></td>\n<td>- Django &#xe8; monolitico, pu&#xf2; essere pesante per microservizi. <br> - Complessit&#xe0; nel gestire task concorrenti nativi (serve Celery/Channels).</td>\n<td>- <strong>FastAPI</strong> (Python) per API ultra-veloci e async nativo. <br> - <strong>Node.js + Express/NestJS</strong> per full JS stack (se vuoi restare su JS). <br> - <strong>Go (Gin, Fiber)</strong> per alta concorrenza e performance.</td>\n</tr>\n<tr data-lines=\"836,837\">\n<td><strong>Frontend</strong></td>\n<td>- React pu&#xf2; richiedere complessit&#xe0; nella gestione dello stato su app grandi. <br> - Richiede toolchain complessa (Webpack, Babel).</td>\n<td>- <strong>Vue.js</strong> o <strong>Svelte</strong>: pi&#xf9; leggeri, pi&#xf9; semplici da apprendere e integrare. <br> - Framework full-stack come <strong>Next.js</strong> o <strong>Remix</strong>: gestione lato server + client integrata.</td>\n</tr>\n<tr data-lines=\"837,838\">\n<td><strong>Comunicazione realtime</strong></td>\n<td>- Django Channels non &#xe8; trivialmente semplice da scalare. <br> - React ha bisogno di librerie esterne per websocket e gestione eventi.</td>\n<td>- Backend con supporto nativo websocket (es. FastAPI + WebSocket, or Go + Gorilla). <br> - Frontend con librerie pi&#xf9; leggere o integrate (SvelteKit, Nuxt).</td>\n</tr>\n<tr data-lines=\"838,839\">\n<td><strong>Automazione e task</strong></td>\n<td>- Django ha bisogno di integrazioni (Celery) per task asincroni e code management.</td>\n<td>- Sistemi specializzati come <strong>Temporal</strong>, <strong>Argo Workflows</strong> o <strong>Apache Airflow</strong> per orchestrazione complessa.</td>\n</tr>\n<tr data-lines=\"839,840\">\n<td><strong>Learning curve &amp; manutenzione</strong></td>\n<td>- Stack Django + React richiede conoscenza separata di due ecosistemi e toolchain.</td>\n<td>- Soluzioni full-stack JS (NestJS + React o Vue) possono semplificare la manutenzione per team JS.</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"833,840"}}],"payload":{"tag":"h2","lines":"831,832"}},{"content":"3. Approccio concettualmente pi&#xf9; &#x201c;pulito&#x201d;?","children":[{"content":"<strong>Microservizi + API Gateway</strong>: separare backend di automazione (es. Python FastAPI o Go) da backend di business logica (Django o Node), comunicando via API REST/gRPC.","children":[],"payload":{"tag":"li","lines":"845,846"}},{"content":"<strong>Event-driven architecture</strong>: usare un message broker (RabbitMQ, Kafka) per decoupling tra workflow engine e app.","children":[],"payload":{"tag":"li","lines":"846,847"}},{"content":"<strong>Workflow engine dedicati</strong>: adottare motori come Temporal o Airflow che gi&#xe0; gestiscono stato, retry, parallelismo, e esporre API per UI.","children":[],"payload":{"tag":"li","lines":"847,848"}},{"content":"<strong>Serverless o Functions as a Service</strong>: per task infrastrutturali, per scalare on-demand senza gestire server.","children":[],"payload":{"tag":"li","lines":"848,850"}}],"payload":{"tag":"h2","lines":"843,844"}},{"content":"4. Consiglio pragmatico","children":[{"content":"","children":[{"content":"Django REST + React &#xe8; una scelta solida e collaudata.","children":[],"payload":{"tag":"li","lines":"856,857"}},{"content":"Integra Celery per task asincroni, Channels per realtime.","children":[],"payload":{"tag":"li","lines":"857,858"}},{"content":"Mantieni la modularit&#xe0; per poter sostituire parti con alternative pi&#xf9; leggere (FastAPI o Vue) se serve.","children":[],"payload":{"tag":"li","lines":"858,860"}}],"payload":{"tag":"ul","lines":"856,860"}},{"content":"","children":[{"content":"Backend: <strong>FastAPI</strong> + Celery (async nativo, pi&#xf9; leggero).","children":[],"payload":{"tag":"li","lines":"862,863"}},{"content":"Frontend: <strong>Vue 3</strong> o <strong>Svelte</strong> per semplicit&#xe0; e reattivit&#xe0;.","children":[],"payload":{"tag":"li","lines":"863,864"}},{"content":"Workflow orchestration esterna: considera Temporal o Airflow.","children":[],"payload":{"tag":"li","lines":"864,866"}}],"payload":{"tag":"ul","lines":"862,866"}}],"payload":{"tag":"h2","lines":"852,853"}},{"content":"5. Per approfondire","children":[{"content":"","children":[{"content":"Guarda come <strong>Pulumi</strong> ha scelto di integrare backend API (Go/Python/Node) e frontend web.","children":[],"payload":{"tag":"li","lines":"870,871"}},{"content":"Studia l&#x2019;architettura di piattaforme come <strong>GitHub Actions</strong>, che sono basate su workflow YAML con API REST e UI React.","children":[],"payload":{"tag":"li","lines":"871,872"}},{"content":"Valuta anche <strong>OpenTofu/Terraform Cloud</strong> per ispirazione su gestione stato e interfaccia.","children":[],"payload":{"tag":"li","lines":"872,874"}}],"payload":{"tag":"ul","lines":"870,874"}},{"content":"","children":[{"content":"Scrivere un prototipo con Django REST + React.","children":[],"payload":{"tag":"li","lines":"878,879"}},{"content":"Fare un proof-of-concept con FastAPI + Vue.","children":[],"payload":{"tag":"li","lines":"879,880"}},{"content":"Disegnare l&#x2019;architettura scalabile usando microservizi/event-driven.","children":[],"payload":{"tag":"li","lines":"880,882"}}],"payload":{"tag":"ul","lines":"878,882"}}],"payload":{"tag":"h2","lines":"868,869"}}],"payload":{"tag":"h1","lines":"629,630"}},{"content":"&#x1f680; Stack moderno e snello per Automazione infrastrutturale con workflow YAML","children":[{"content":"1. Backend: <strong>FastAPI + Celery</strong>","children":[{"content":"Perch&#xe9; FastAPI?","children":[{"content":"<strong>Asincrono nativo</strong> con <code>async</code>/<code>await</code>, perfetto per IO-bound (chiamate API, file, DB).","children":[],"payload":{"tag":"li","lines":"915,916"}},{"content":"Molto pi&#xf9; leggero e performante di Django, startup rapido.","children":[],"payload":{"tag":"li","lines":"916,917"}},{"content":"Facile da integrare con Celery per task asincroni (es. esecuzione playbook Ansible, job lunghi).","children":[],"payload":{"tag":"li","lines":"917,918"}},{"content":"Documentazione automatica con Swagger/OpenAPI, ottimo per API pubbliche o interne.","children":[],"payload":{"tag":"li","lines":"918,919"}},{"content":"Semplice da testare e estendere.","children":[],"payload":{"tag":"li","lines":"919,921"}}],"payload":{"tag":"h3","lines":"913,914"}},{"content":"Perch&#xe9; Celery?","children":[{"content":"Task queue robusta per esecuzione asincrona e retry.","children":[],"payload":{"tag":"li","lines":"923,924"}},{"content":"Supporta broker diversi (RabbitMQ, Redis).","children":[],"payload":{"tag":"li","lines":"924,925"}},{"content":"Si integra bene con FastAPI, e ti permette di schedulare job complessi.","children":[],"payload":{"tag":"li","lines":"925,926"}},{"content":"Supporta workflow pi&#xf9; articolati (catene, gruppi, callback).","children":[],"payload":{"tag":"li","lines":"926,928"}}],"payload":{"tag":"h3","lines":"921,922"}}],"payload":{"tag":"h2","lines":"911,912"}},{"content":"2. Frontend: <strong>Svelte</strong>","children":[{"content":"Vantaggi di Svelte","children":[{"content":"<strong>Zero runtime framework</strong>: il codice &#xe8; compilato in vanilla JS, quindi app leggerissime e velocissime.","children":[],"payload":{"tag":"li","lines":"934,935"}},{"content":"Sintassi semplice e intuitiva, ideale per sviluppatori con esperienza JS che vogliono evitare boilerplate.","children":[],"payload":{"tag":"li","lines":"935,936"}},{"content":"Ottimo per UI reactive, dashboard di monitoring, notifiche in tempo reale.","children":[],"payload":{"tag":"li","lines":"936,937"}},{"content":"Supporto nativo per store e state management senza dipendenze esterne.","children":[],"payload":{"tag":"li","lines":"937,938"}},{"content":"Ottima integrazione con API REST o websocket.","children":[],"payload":{"tag":"li","lines":"938,940"}}],"payload":{"tag":"h3","lines":"932,933"}}],"payload":{"tag":"h2","lines":"930,931"}},{"content":"3. Workflow orchestration esterna: <strong>Temporal o Apache Airflow</strong>","children":[{"content":"Perch&#xe9; Temporal?","children":[{"content":"Gestione <strong>stateful workflows</strong> con retry automatici, timeout, parallelismo, rollback.","children":[],"payload":{"tag":"li","lines":"946,947"}},{"content":"SDK in Go, Java, Python (la tua combo pu&#xf2; interagire bene con SDK Python).","children":[],"payload":{"tag":"li","lines":"947,948"}},{"content":"Perfetto per pipeline di automazione infra che devono garantire consistenza.","children":[],"payload":{"tag":"li","lines":"948,949"}},{"content":"Event-driven, con visibilit&#xe0; e controllo centralizzati.","children":[],"payload":{"tag":"li","lines":"949,950"}},{"content":"Molto usato in ambito enterprise.","children":[],"payload":{"tag":"li","lines":"950,952"}}],"payload":{"tag":"h3","lines":"944,945"}},{"content":"Perch&#xe9; Apache Airflow?","children":[{"content":"Orchestratore di workflow pi&#xf9; tradizionale, basato su DAG Python.","children":[],"payload":{"tag":"li","lines":"954,955"}},{"content":"Ampia community e plugin per integrazione con cloud e strumenti.","children":[],"payload":{"tag":"li","lines":"955,956"}},{"content":"Interfaccia UI per monitorare e gestire i flussi.","children":[],"payload":{"tag":"li","lines":"956,957"}},{"content":"Pi&#xf9; complesso da integrare in un&#x2019;architettura microservices ma molto potente.","children":[],"payload":{"tag":"li","lines":"957,959"}}],"payload":{"tag":"h3","lines":"952,953"}}],"payload":{"tag":"h2","lines":"942,943"}},{"content":"4. Alternative o estensioni: <strong>Pulumi + Go</strong>","children":[{"content":"Pulumi ti permette di definire infrastruttura in linguaggi generali come Go, TypeScript, Python.","children":[],"payload":{"tag":"li","lines":"963,964"}},{"content":"Ottimo per infrastruttura &#x201c;as code&#x201d; programmabile e integra con CI/CD.","children":[],"payload":{"tag":"li","lines":"964,965"}},{"content":"Potresti usare Pulumi + Go per la parte di provisioning, chiamata da workflow orchestrati da Temporal/FastAPI.","children":[],"payload":{"tag":"li","lines":"965,966"}},{"content":"Ottimo compromesso tra potenza e controllo.","children":[],"payload":{"tag":"li","lines":"966,967"}},{"content":"Supporta gi&#xe0; concetti di stato e idempotenza.","children":[],"payload":{"tag":"li","lines":"967,969"}}],"payload":{"tag":"h2","lines":"961,962"}},{"content":"5. Integrazione con <strong>OpenTofu</strong> e <strong>GitHub Actions</strong>","children":[{"content":"<strong>OpenTofu</strong> (fork open source di Terraform) &#xe8; perfetto per provisioning infrastrutturale dichiarativo.","children":[],"payload":{"tag":"li","lines":"973,974"}},{"content":"Puoi orchestrare esecuzione OpenTofu tramite FastAPI (API) o tramite task Celery.","children":[],"payload":{"tag":"li","lines":"974,975"}},{"content":"<strong>GitHub Actions</strong>: puoi integrare la pipeline del workflow con eventi GitHub (push, PR) usando webhook o API.","children":[],"payload":{"tag":"li","lines":"975,976"}},{"content":"In pi&#xf9;, GitHub Actions pu&#xf2; lanciare workflow su Temporal o Airflow tramite API.","children":[],"payload":{"tag":"li","lines":"976,977"}},{"content":"Permette un ciclo di DevOps/GitOps perfettamente integrato.","children":[],"payload":{"tag":"li","lines":"977,979"}}],"payload":{"tag":"h2","lines":"971,972"}},{"content":"6. Schema architetturale semplice","children":[{"content":"<pre data-lines=\"983,992\"><code data-lines=\"983,992\">User &lt;--&gt; Svelte Frontend &lt;--&gt; FastAPI REST API &lt;--&gt; Celery Worker(s)\n                                       |\n                                       +--&gt; Temporal Workflow Engine\n                                       |\n                                       +--&gt; OpenTofu CLI / Pulumi Go SDK\n                                       |\n                                       +--&gt; GitHub Actions API (trigger/reports)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"983,992"}}],"payload":{"tag":"h2","lines":"981,982"}},{"content":"7. Prossimi passi concreti","children":[{"content":"Ti preparo un <strong>prototipo FastAPI + Celery</strong> che esegue task base (es. chiamata playbook Ansible).","children":[],"payload":{"tag":"li","lines":"997,998"}},{"content":"Un piccolo <strong>dashboard Svelte</strong> per monitorare task e notifiche realtime.","children":[],"payload":{"tag":"li","lines":"998,999"}},{"content":"Setup di un esempio base di workflow Temporal con Python SDK.","children":[],"payload":{"tag":"li","lines":"999,1000"}},{"content":"Demo di integrazione OpenTofu e GitHub Actions (trigger API).","children":[],"payload":{"tag":"li","lines":"1000,1002"}}],"payload":{"tag":"h2","lines":"995,996"}}],"payload":{"tag":"h1","lines":"907,908"}},{"content":"Come costruire uno stack moderno partendo da Ansible","children":[{"content":"1. Ansible come motore core","children":[{"content":"<strong>Ansible</strong> &#xe8; il tuo executor dichiarativo: scrivi playbook YAML, gestisci configurazioni, provisioning, deployment.","children":[],"payload":{"tag":"li","lines":"1025,1026"}},{"content":"&#xc8; <strong>agentless</strong>, usa SSH, quindi semplice da integrare.","children":[],"payload":{"tag":"li","lines":"1026,1027"}},{"content":"Ha ottimi moduli per Linux, cloud, networking.","children":[],"payload":{"tag":"li","lines":"1027,1028"}},{"content":"Pu&#xf2; essere chiamato da CLI, API wrapper, o task queue.","children":[],"payload":{"tag":"li","lines":"1028,1030"}}],"payload":{"tag":"h2","lines":"1023,1024"}},{"content":"2. Backend: <strong>FastAPI + Celery</strong> (per orchestrazione e API)","children":[{"content":"Perch&#xe9;?","children":[{"content":"\n<p data-lines=\"1036,1037\"><strong>FastAPI</strong>: espone API REST/GraphQL per il frontend o altri sistemi. &#xc8; asincrono e leggero, ottimo per scalare.</p>","children":[],"payload":{"tag":"li","lines":"1036,1037"}},{"content":"\n<p data-lines=\"1037,1038\"><strong>Celery</strong>: gestisce l&#x2019;esecuzione asincrona e parallela dei task Ansible (ad esempio, chiamate a <code>ansible-playbook</code> o tramite <code>ansible-runner</code>).</p>","children":[],"payload":{"tag":"li","lines":"1037,1038"}},{"content":"\n<p data-lines=\"1038,1039\">In questo modo, puoi:</p>","children":[{"content":"Accodare esecuzioni playbook.","children":[],"payload":{"tag":"li","lines":"1040,1041"}},{"content":"Gestire retries, timeout, errori.","children":[],"payload":{"tag":"li","lines":"1041,1042"}},{"content":"Avere visibilit&#xe0; sullo stato tramite API.","children":[],"payload":{"tag":"li","lines":"1042,1044"}}],"payload":{"tag":"li","lines":"1038,1044"}}],"payload":{"tag":"h3","lines":"1034,1035"}},{"content":"Esempio semplificato di task Celery che lancia Ansible:","children":[{"content":"<pre data-lines=\"1046,1058\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">import</span> subprocess\n\napp = Celery(<span class=\"hljs-string\">&apos;tasks&apos;</span>, broker=<span class=\"hljs-string\">&apos;redis://localhost:6379/0&apos;</span>)\n\n<span class=\"hljs-meta\">@app.task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>(<span class=\"hljs-params\">playbook_path, inventory_path</span>):\n    cmd = [<span class=\"hljs-string\">&apos;ansible-playbook&apos;</span>, <span class=\"hljs-string\">&apos;-i&apos;</span>, inventory_path, playbook_path]\n    result = subprocess.run(cmd, capture_output=<span class=\"hljs-literal\">True</span>, text=<span class=\"hljs-literal\">True</span>)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&apos;stdout&apos;</span>: result.stdout, <span class=\"hljs-string\">&apos;stderr&apos;</span>: result.stderr, <span class=\"hljs-string\">&apos;returncode&apos;</span>: result.returncode}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1046,1058"}}],"payload":{"tag":"h3","lines":"1044,1045"}}],"payload":{"tag":"h2","lines":"1032,1033"}},{"content":"3. Frontend: <strong>Svelte</strong>","children":[{"content":"\n<p data-lines=\"1063,1064\">UI leggera e moderna per visualizzare:</p>","children":[{"content":"Stato dei job (in esecuzione, completati, falliti).","children":[],"payload":{"tag":"li","lines":"1065,1066"}},{"content":"Log in tempo reale (tramite websocket o polling).","children":[],"payload":{"tag":"li","lines":"1066,1067"}},{"content":"Dashboard di controllo e configurazione.","children":[],"payload":{"tag":"li","lines":"1067,1068"}}],"payload":{"tag":"li","lines":"1063,1068"}},{"content":"\n<p data-lines=\"1068,1069\">Svelte permette reattivit&#xe0; e semplicit&#xe0; d&#x2019;uso senza complessit&#xe0; di toolchain e overhead.</p>","children":[],"payload":{"tag":"li","lines":"1068,1070"}}],"payload":{"tag":"h2","lines":"1061,1062"}},{"content":"4. Workflow orchestration esterna (opzionale)","children":[{"content":"Puoi usare <strong>Temporal</strong> o <strong>Apache Airflow</strong> per orchestrare sequenze pi&#xf9; complesse di playbook Ansible, retries, rollback.","children":[],"payload":{"tag":"li","lines":"1074,1075"}},{"content":"Temporal ha SDK Python: puoi integrare i task Celery (o chiamate dirette ad Ansible) all&#x2019;interno di workflow con stato.","children":[],"payload":{"tag":"li","lines":"1075,1076"}},{"content":"Se il tuo sistema cresce in complessit&#xe0;, questo livello aiuta a mantenere controllo e visibilit&#xe0;.","children":[],"payload":{"tag":"li","lines":"1076,1078"}}],"payload":{"tag":"h2","lines":"1072,1073"}},{"content":"5. Integrazione con Pulumi + Go e OpenTofu","children":[{"content":"<strong>Pulumi + Go</strong> o <strong>OpenTofu</strong> possono essere usati per la parte di provisioning infrastrutturale pi&#xf9; strutturata, quando vuoi definire l&#x2019;infrastruttura come codice in modo programmabile.","children":[],"payload":{"tag":"li","lines":"1082,1083"}},{"content":"Puoi integrare i loro comandi all&#x2019;interno del workflow Celery/FastAPI, magari chiamandoli da playbook Ansible o da task dedicati.","children":[],"payload":{"tag":"li","lines":"1083,1084"}},{"content":"OpenTofu pu&#xf2; essere richiamato da backend come CLI o libreria.","children":[],"payload":{"tag":"li","lines":"1084,1086"}}],"payload":{"tag":"h2","lines":"1080,1081"}},{"content":"6. GitHub Actions come trigger e integrazione DevOps","children":[{"content":"GitHub Actions pu&#xf2; attivare workflow tramite webhook o API FastAPI.","children":[],"payload":{"tag":"li","lines":"1090,1091"}},{"content":"Puoi avere pipeline CI/CD che aggiornano playbook, triggerano deployment o rollback automatici.","children":[],"payload":{"tag":"li","lines":"1091,1092"}},{"content":"Il sistema pu&#xf2; fornire feedback a GitHub Actions via API, per status e notifiche.","children":[],"payload":{"tag":"li","lines":"1092,1094"}}],"payload":{"tag":"h2","lines":"1088,1089"}},{"content":"7. Schema finale consigliato","children":[{"content":"<pre data-lines=\"1098,1107\"><code data-lines=\"1098,1107\">Utente &lt;--&gt; Frontend Svelte &lt;--&gt; Backend FastAPI &lt;--&gt; Celery Worker (esegue Ansible)\n                                              |\n                                              +--&gt; Temporal / Airflow (workflow complessi)\n                                              |\n                                              +--&gt; Pulumi/Go, OpenTofu (provisioning IaC)\n                                              |\n                                              +--&gt; GitHub Actions (trigger / notifiche)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1098,1107"}}],"payload":{"tag":"h2","lines":"1096,1097"}},{"content":"8. Vantaggi di questo approccio","children":[{"content":"<strong>Usi Ansible, che &#xe8; solido e diffuso, senza reinventare la ruota.</strong>","children":[],"payload":{"tag":"li","lines":"1112,1113"}},{"content":"Ottieni <strong>API moderne, asincronia e scalabilit&#xe0;</strong> grazie a FastAPI + Celery.","children":[],"payload":{"tag":"li","lines":"1113,1114"}},{"content":"UI semplice, moderna e performante con Svelte.","children":[],"payload":{"tag":"li","lines":"1114,1115"}},{"content":"Possibilit&#xe0; di integrare orchestratori di workflow per complessit&#xe0; futura.","children":[],"payload":{"tag":"li","lines":"1115,1116"}},{"content":"Puoi espandere con Pulumi/OpenTofu per IaC pi&#xf9; programmatico.","children":[],"payload":{"tag":"li","lines":"1116,1117"}},{"content":"Completa integrazione con pipeline DevOps/GitOps (GitHub Actions).","children":[],"payload":{"tag":"li","lines":"1117,1119"}}],"payload":{"tag":"h2","lines":"1110,1111"}},{"content":"Step 1: Prototipo backend FastAPI + Celery per eseguire playbook Ansible","children":[{"content":"Esporre un&#x2019;API REST per avviare un playbook Ansible","children":[],"payload":{"tag":"li","lines":"1137,1138"}},{"content":"Gestire l&#x2019;esecuzione asincrona tramite Celery","children":[],"payload":{"tag":"li","lines":"1138,1139"}},{"content":"Restituire lo stato e i log dell&#x2019;esecuzione","children":[],"payload":{"tag":"li","lines":"1139,1141"}}],"payload":{"tag":"h2","lines":"1133,1134"}},{"content":"Step 2: Frontend Svelte minimale","children":[{"content":"\n<p data-lines=\"1145,1146\">Dashboard semplice per:</p>","children":[{"content":"Inserire il path del playbook/inventory (o selezionare da lista)","children":[],"payload":{"tag":"li","lines":"1147,1148"}},{"content":"Triggerare l&#x2019;esecuzione","children":[],"payload":{"tag":"li","lines":"1148,1149"}},{"content":"Visualizzare lo stato e log in tempo reale (polling o websocket)","children":[],"payload":{"tag":"li","lines":"1149,1151"}}],"payload":{"tag":"li","lines":"1145,1151"}}],"payload":{"tag":"h2","lines":"1143,1144"}},{"content":"Step 3: Espandere (opzionale)","children":[{"content":"Integrazione con Temporal/Airflow per workflow complessi","children":[],"payload":{"tag":"li","lines":"1155,1156"}},{"content":"Supporto per Pulumi/OpenTofu tramite task Celery","children":[],"payload":{"tag":"li","lines":"1156,1157"}},{"content":"Integrazione GitHub Actions per trigger automatici","children":[],"payload":{"tag":"li","lines":"1157,1159"}}],"payload":{"tag":"h2","lines":"1153,1154"}}],"payload":{"tag":"h1","lines":"1019,1020"}},{"content":"Backend FastAPI + Celery: esempio minimo","children":[{"content":"1. Prerequisiti","children":[{"content":"Python 3.9+","children":[],"payload":{"tag":"li","lines":"1178,1179"}},{"content":"Redis (broker Celery)","children":[],"payload":{"tag":"li","lines":"1179,1180"}},{"content":"Ansible installato sul sistema","children":[],"payload":{"tag":"li","lines":"1180,1181"}},{"content":"Virtualenv consigliato","children":[],"payload":{"tag":"li","lines":"1181,1183"}}],"payload":{"tag":"h3","lines":"1176,1177"}},{"content":"2. Installazione pacchetti Python","children":[{"content":"<pre data-lines=\"1187,1190\"><code class=\"language-bash\">pip install fastapi uvicorn celery redis ansible-runner\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1187,1190"}}],"payload":{"tag":"h3","lines":"1185,1186"}},{"content":"3. Struttura progetto","children":[{"content":"<pre data-lines=\"1195,1204\"><code data-lines=\"1195,1204\">ansible_backend<span class=\"hljs-symbol\">/</span>\n&#x251c;&#x2500;&#x2500; app.py              <span class=\"hljs-comment\"># FastAPI app + API endpoint</span>\n&#x251c;&#x2500;&#x2500; tasks.py            <span class=\"hljs-comment\"># Celery tasks</span>\n&#x251c;&#x2500;&#x2500; celery_worker.py    <span class=\"hljs-comment\"># Avvio worker celery</span>\n&#x2514;&#x2500;&#x2500; playbooks<span class=\"hljs-symbol\">/</span>          <span class=\"hljs-comment\"># Cartella con playbook e inventory</span>\n    &#x251c;&#x2500;&#x2500; site.yml\n    &#x2514;&#x2500;&#x2500; inventory.ini\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1195,1204"}}],"payload":{"tag":"h3","lines":"1193,1194"}},{"content":"4. Codice <code>tasks.py</code> (task Celery)","children":[{"content":"<pre data-lines=\"1209,1222\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">import</span> ansible_runner\n\napp = Celery(<span class=\"hljs-string\">&apos;tasks&apos;</span>, broker=<span class=\"hljs-string\">&apos;redis://localhost:6379/0&apos;</span>)\n\n<span class=\"hljs-meta\">@app.task(<span class=\"hljs-params\">bind=<span class=\"hljs-literal\">True</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>(<span class=\"hljs-params\">self, playbook_name: <span class=\"hljs-built_in\">str</span></span>):\n    r = ansible_runner.run(private_data_dir=<span class=\"hljs-string\">&apos;./playbooks&apos;</span>, playbook=playbook_name)\n    <span class=\"hljs-keyword\">if</span> r.rc != <span class=\"hljs-number\">0</span>:\n        <span class=\"hljs-keyword\">raise</span> Exception(<span class=\"hljs-string\">f&quot;Playbook failed with rc=<span class=\"hljs-subst\">{r.rc}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&apos;status&apos;</span>: <span class=\"hljs-string\">&apos;success&apos;</span>, <span class=\"hljs-string\">&apos;stats&apos;</span>: r.stats, <span class=\"hljs-string\">&apos;rc&apos;</span>: r.rc}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1209,1222"}}],"payload":{"tag":"h3","lines":"1207,1208"}},{"content":"5. Codice <code>app.py</code> (FastAPI REST API)","children":[{"content":"<pre data-lines=\"1227,1255\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI, HTTPException\n<span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseModel\n<span class=\"hljs-keyword\">from</span> tasks <span class=\"hljs-keyword\">import</span> run_playbook\n<span class=\"hljs-keyword\">from</span> celery.result <span class=\"hljs-keyword\">import</span> AsyncResult\n\napp = FastAPI()\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">PlaybookRequest</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    playbook_name: <span class=\"hljs-built_in\">str</span>\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run-playbook/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook_endpoint</span>(<span class=\"hljs-params\">req: PlaybookRequest</span>):\n    task = run_playbook.delay(req.playbook_name)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task.<span class=\"hljs-built_in\">id</span>}\n\n<span class=\"hljs-meta\">@app.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/task-status/{task_id}&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_task_status</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span></span>):\n    task_result = AsyncResult(task_id)\n    <span class=\"hljs-keyword\">if</span> task_result.state == <span class=\"hljs-string\">&apos;PENDING&apos;</span>:\n        <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;state&quot;</span>: task_result.state, <span class=\"hljs-string\">&quot;status&quot;</span>: <span class=\"hljs-string\">&quot;Pending...&quot;</span>}\n    <span class=\"hljs-keyword\">elif</span> task_result.state == <span class=\"hljs-string\">&apos;SUCCESS&apos;</span>:\n        <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;state&quot;</span>: task_result.state, <span class=\"hljs-string\">&quot;result&quot;</span>: task_result.result}\n    <span class=\"hljs-keyword\">elif</span> task_result.state == <span class=\"hljs-string\">&apos;FAILURE&apos;</span>:\n        <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;state&quot;</span>: task_result.state, <span class=\"hljs-string\">&quot;error&quot;</span>: <span class=\"hljs-built_in\">str</span>(task_result.result)}\n    <span class=\"hljs-keyword\">else</span>:\n        <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;state&quot;</span>: task_result.state}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1227,1255"}}],"payload":{"tag":"h3","lines":"1225,1226"}},{"content":"6. Codice <code>celery_worker.py</code> (avvio worker Celery)","children":[{"content":"<pre data-lines=\"1260,1266\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> tasks <span class=\"hljs-keyword\">import</span> app\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n    app.worker_main()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1260,1266"}}],"payload":{"tag":"h3","lines":"1258,1259"}},{"content":"7. Esempio playbook e inventory (<code>playbooks/site.yml</code> e <code>playbooks/inventory.ini</code>)","children":[{"content":"<pre data-lines=\"1273,1279\"><code class=\"language-yaml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">all</span>\n  <span class=\"hljs-attr\">tasks:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Ping</span> <span class=\"hljs-string\">hosts</span>\n      <span class=\"hljs-attr\">ping:</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1273,1279"}},{"content":"<pre data-lines=\"1282,1285\"><code data-lines=\"1282,1285\">localhost <span class=\"hljs-attribute\">ansible_connection</span>=local\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1282,1285"}}],"payload":{"tag":"h3","lines":"1269,1270"}},{"content":"8. Come eseguire","children":[{"content":"<pre data-lines=\"1293,1296\"><code class=\"language-bash\">celery -A tasks worker --loglevel=info\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1293,1296"}},{"content":"<pre data-lines=\"1299,1302\"><code class=\"language-bash\">uvicorn app:app --reload\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1299,1302"}}],"payload":{"tag":"h3","lines":"1288,1289"}},{"content":"9. Test API","children":[{"content":"<pre data-lines=\"1309,1314\"><code class=\"language-json\"><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">&quot;playbook_name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;site.yml&quot;</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1309,1314"}}],"payload":{"tag":"h3","lines":"1305,1306"}}],"payload":{"tag":"h1","lines":"1172,1173"}},{"content":"Frontend Svelte: dashboard base per eseguire playbook Ansible","children":[{"content":"Visualizzazione log dettagliati (streaming websocket)<br>\nUI pi&#xf9; ricca (es. selezione host, parametri playbook)<br>\nIntegrazione con GitHub per autenticazione utente Actions e notifiche (tramite app mobile, email, ecc... come permette github)","children":[],"payload":{"tag":"h2","lines":"1454,1458"}}],"payload":{"tag":"h1","lines":"1332,1333"}},{"content":"Come il backend FastAPI+Celery + frontend Svelte diventa un&#x2019;App Web completa per automazione infrastrutturale","children":[{"content":"1. Punto di partenza: playbook YAML + Ansible","children":[{"content":"I tuoi file <strong>YAML (playbook Ansible)</strong> descrivono in modo dichiarativo la configurazione e le attivit&#xe0; da svolgere (es. installazione pacchetti, configurazioni, deploy).","children":[],"payload":{"tag":"li","lines":"1470,1471"}},{"content":"Ansible &#xe8; il motore che <strong>interpreta</strong> questi file e li esegue, garantendo idempotenza e gestione dello stato.","children":[],"payload":{"tag":"li","lines":"1471,1473"}}],"payload":{"tag":"h2","lines":"1468,1469"}},{"content":"2. Backend come <strong>motore di esecuzione e orchestrazione</strong>","children":[{"content":"\n<p data-lines=\"1477,1478\">Il backend (FastAPI + Celery):</p>","children":[{"content":"Espone API per caricare/eseguire playbook e gestire il loro stato (start, in corso, completato, errore).","children":[],"payload":{"tag":"li","lines":"1479,1480"}},{"content":"Accoda l&#x2019;esecuzione dei playbook in modo <strong>asincrono</strong> e scalabile (con Celery).","children":[],"payload":{"tag":"li","lines":"1480,1481"}},{"content":"Consente di ottenere lo stato e i risultati in tempo reale (polling o websocket).","children":[],"payload":{"tag":"li","lines":"1481,1482"}},{"content":"Pu&#xf2; orchestrare pi&#xf9; playbook in sequenza, parallelismo, gestendo retry, errori, rollback (usando strumenti come Temporal o Airflow se vuoi workflow pi&#xf9; complessi).","children":[],"payload":{"tag":"li","lines":"1482,1484"}}],"payload":{"tag":"li","lines":"1477,1484"}}],"payload":{"tag":"h2","lines":"1475,1476"}},{"content":"3. Frontend come <strong>interfaccia utente di gestione</strong>","children":[{"content":"\n<p data-lines=\"1488,1489\">Il frontend (Svelte):</p>","children":[{"content":"Permette agli utenti di selezionare o caricare playbook YAML.","children":[],"payload":{"tag":"li","lines":"1490,1491"}},{"content":"Visualizza lo stato dei workflow e i log in tempo reale.","children":[],"payload":{"tag":"li","lines":"1491,1492"}},{"content":"Offre strumenti di configurazione (parametri, selezione host, ecc).","children":[],"payload":{"tag":"li","lines":"1492,1493"}},{"content":"Gestisce autenticazione e autorizzazione utenti (es. OAuth GitHub).","children":[],"payload":{"tag":"li","lines":"1493,1494"}},{"content":"Notifica gli utenti via UI, email, mobile o integrazioni esterne.","children":[],"payload":{"tag":"li","lines":"1494,1496"}}],"payload":{"tag":"li","lines":"1488,1496"}}],"payload":{"tag":"h2","lines":"1486,1487"}},{"content":"4. Workflow &amp; pipeline tramite YAML interpretati","children":[{"content":"Ogni playbook &#xe8; un <strong>workflow</strong> o un <strong>passo di pipeline</strong>.","children":[],"payload":{"tag":"li","lines":"1500,1501"}},{"content":"Puoi comporre sequenze di playbook, creare dipendenze, condizioni e trigger.","children":[],"payload":{"tag":"li","lines":"1501,1502"}},{"content":"Il backend orchestra queste pipeline, facendo partire i playbook corretti al momento giusto.","children":[],"payload":{"tag":"li","lines":"1502,1503"}},{"content":"L&#x2019;utente ha pieno controllo da interfaccia o API REST.","children":[],"payload":{"tag":"li","lines":"1503,1505"}}],"payload":{"tag":"h2","lines":"1498,1499"}},{"content":"5. Integrazione con GitHub Actions &amp; autenticazione","children":[{"content":"\n<p data-lines=\"1509,1510\">Autenticazione con GitHub OAuth per accesso sicuro.</p>","children":[],"payload":{"tag":"li","lines":"1509,1510"}},{"content":"\n<p data-lines=\"1510,1511\">Possibilit&#xe0; di:</p>","children":[{"content":"<strong>Trigger automatici</strong> di workflow su push o PR via GitHub Actions che chiamano le API FastAPI.","children":[],"payload":{"tag":"li","lines":"1512,1513"}},{"content":"Ricevere notifiche sullo stato direttamente in GitHub, email o app mobile.","children":[],"payload":{"tag":"li","lines":"1513,1514"}}],"payload":{"tag":"li","lines":"1510,1514"}},{"content":"\n<p data-lines=\"1514,1515\">Questo permette una vera esperienza DevOps GitOps integrata.</p>","children":[],"payload":{"tag":"li","lines":"1514,1516"}}],"payload":{"tag":"h2","lines":"1507,1508"}},{"content":"6. Estensioni gi&#xe0; proposte","children":[{"content":"<strong>Lista playbook disponibili</strong>: il backend scandisce la cartella dei playbook o interroga un repo Git e fornisce la lista al frontend.","children":[],"payload":{"tag":"li","lines":"1520,1521"}},{"content":"<strong>Log dettagliati e streaming websocket</strong>: per mostrare in tempo reale output Ansible e stato task.","children":[],"payload":{"tag":"li","lines":"1521,1522"}},{"content":"<strong>UI ricca</strong>: gestione dinamica parametri playbook, selezione host/inventory, ruoli utente.","children":[],"payload":{"tag":"li","lines":"1522,1523"}},{"content":"<strong>Notifiche e integrazioni</strong>: email, Slack, mobile push, webhook.","children":[],"payload":{"tag":"li","lines":"1523,1525"}}],"payload":{"tag":"h2","lines":"1518,1519"}}],"payload":{"tag":"h1","lines":"1464,1465"}},{"content":"Schema riassuntivo","children":[{"content":"<pre data-lines=\"1529,1537\"><code data-lines=\"1529,1537\">Utente &lt;--&gt; Frontend Svelte (UI ricca, autenticazione)\n          &lt;--&gt; Backend FastAPI (API REST + websocket)\n               &lt;--&gt; Celery (esecuzione async Ansible playbook)\n                    &lt;--&gt; Ansible (esecuzione YAML)\n               &lt;--&gt; Temporal/Airflow (orchestrazione workflow complessi)\n               &lt;--&gt; GitHub (OAuth, trigger Actions, notifiche)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1529,1537"}}],"payload":{"tag":"h1","lines":"1527,1528"}},{"content":"In sintesi","children":[{"content":"","children":[{"content":"1. <strong>Il backend interpreta e esegue i playbook YAML tramite Ansible, gestendo l&#x2019;orchestrazione.</strong>","children":[],"payload":{"tag":"li","lines":"1542,1543","listIndex":1}},{"content":"2. <strong>Il frontend permette la gestione interattiva di questi workflow con feedback in tempo reale.</strong>","children":[],"payload":{"tag":"li","lines":"1543,1544","listIndex":2}},{"content":"3. <strong>La pipeline diventa un insieme di playbook YAML orchestrati con trigger, condizioni e notifiche.</strong>","children":[],"payload":{"tag":"li","lines":"1544,1545","listIndex":3}},{"content":"4. <strong>L&#x2019;integrazione GitHub Actions garantisce continuit&#xe0; con flussi DevOps esistenti.</strong>","children":[],"payload":{"tag":"li","lines":"1545,1547","listIndex":4}}],"payload":{"tag":"ol","lines":"1542,1547"}},{"content":"","children":[{"content":"Implementare la lista playbook disponibili via API","children":[],"payload":{"tag":"li","lines":"1551,1552"}},{"content":"Implementare streaming log via websocket","children":[],"payload":{"tag":"li","lines":"1552,1553"}},{"content":"Migliorare UI con selezione host e parametri","children":[],"payload":{"tag":"li","lines":"1553,1554"}},{"content":"Setup autenticazione GitHub e integrazione notifiche","children":[],"payload":{"tag":"li","lines":"1554,1556"}}],"payload":{"tag":"ul","lines":"1551,1556"}}],"payload":{"tag":"h1","lines":"1540,1541"}},{"content":"Stiamo reinventando la ruota con questo frontend per automazione?","children":[{"content":"&#x1f50d; Spiegazione dettagliata:","children":[{"content":"&#x2705; Semaphore:","children":[{"content":"&#xc8; una piattaforma <strong>alternativa</strong> a GitHub Actions.","children":[],"payload":{"tag":"li","lines":"1655,1656"}},{"content":"Ha un proprio sistema di pipeline YAML, runner, job, agent, parallelismo, ecc.","children":[],"payload":{"tag":"li","lines":"1656,1657"}},{"content":"&#xc8; spesso usata <strong>invece di GitHub Actions</strong>, non in combinazione con essa.","children":[],"payload":{"tag":"li","lines":"1657,1659"}}],"payload":{"tag":"h3","lines":"1653,1654"}},{"content":"&#x274c; Non esiste:","children":[{"content":"Un&#x2019;integrazione nativa in cui <strong>GitHub Actions viene orchestrato o gestito da Semaphore</strong>.","children":[],"payload":{"tag":"li","lines":"1661,1662"}},{"content":"Un modo per usare <strong>workflow di GitHub Actions dentro Semaphore</strong>, o viceversa.","children":[],"payload":{"tag":"li","lines":"1662,1664"}}],"payload":{"tag":"h3","lines":"1659,1660"}}],"payload":{"tag":"h2","lines":"1651,1652"}},{"content":"&#x1f501; Per&#xf2; puoi collegarli &quot;indirettamente&quot;","children":[{"content":"&#x2795; Soluzioni ibride (tipiche in progetti avanzati):","children":[{"content":"1. \n<p data-lines=\"1670,1671\"><strong>GitHub Actions come trigger di build Semaphore</strong></p>","children":[{"content":"Usando <code>curl</code> o <code>webhook</code> GitHub Action per chiamare un endpoint di Semaphore.","children":[],"payload":{"tag":"li","lines":"1672,1673"}},{"content":"Scenario: usi GitHub Actions per l&#x2019;integrazione e triggeri Semaphore per fare build/deploy complessi.","children":[],"payload":{"tag":"li","lines":"1673,1675"}}],"payload":{"tag":"li","lines":"1670,1675","listIndex":1}},{"content":"2. \n<p data-lines=\"1675,1676\"><strong>Semaphore che invoca GitHub Actions</strong></p>","children":[{"content":"Avvia workflow GitHub via <a href=\"https://docs.github.com/en/rest/actions/workflows\">GitHub REST API</a>.","children":[],"payload":{"tag":"li","lines":"1677,1678"}},{"content":"Potresti farlo da uno step in Semaphore (<code>curl</code>, <code>gh</code> CLI, ecc.).","children":[],"payload":{"tag":"li","lines":"1678,1680"}}],"payload":{"tag":"li","lines":"1675,1680","listIndex":2}}],"payload":{"tag":"h3","lines":"1668,1669"}}],"payload":{"tag":"h2","lines":"1666,1667"}},{"content":"&#x1f504; GitHub Actions vs Semaphore: Ruoli distinti","children":[{"content":"<table data-lines=\"1684,1692\">\n<thead data-lines=\"1684,1685\">\n<tr data-lines=\"1684,1685\">\n<th></th>\n<th><strong>GitHub Actions</strong></th>\n<th><strong>Semaphore</strong></th>\n</tr>\n</thead>\n<tbody data-lines=\"1686,1692\">\n<tr data-lines=\"1686,1687\">\n<td>Integrato in GitHub</td>\n<td>&#x2705; nativamente</td>\n<td>&#x274c; no, &#xe8; esterno</td>\n</tr>\n<tr data-lines=\"1687,1688\">\n<td>DSL</td>\n<td>YAML (<code>.github/workflows/*.yml</code>)</td>\n<td>YAML (<code>semaphore.yml</code>)</td>\n</tr>\n<tr data-lines=\"1688,1689\">\n<td>Runner</td>\n<td>GitHub-hosted o self-hosted</td>\n<td>Runner hosted (cloud) o self-hosted</td>\n</tr>\n<tr data-lines=\"1689,1690\">\n<td>Trigger</td>\n<td>PR, push, tag, schedule, webhook, API</td>\n<td>Trigger via Git, webhook, API</td>\n</tr>\n<tr data-lines=\"1690,1691\">\n<td>Estensibilit&#xe0;</td>\n<td>Enorme ecosistema di Action e plugin</td>\n<td>Meno esteso ma personalizzabile</td>\n</tr>\n<tr data-lines=\"1691,1692\">\n<td>Pricing</td>\n<td>Ottimo per progetti open source</td>\n<td>Pi&#xf9; flessibile per team enterprise</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1684,1692"}}],"payload":{"tag":"h2","lines":"1682,1683"}},{"content":"&#x2705; Conclusione","children":[{"content":"<strong>Semaphore &#x2260; orchestratore di GitHub Actions</strong>","children":[],"payload":{"tag":"li","lines":"1697,1698"}},{"content":"Piuttosto: <strong>sono concorrenti</strong> e <strong>scelte alternative</strong>.","children":[],"payload":{"tag":"li","lines":"1698,1699"}},{"content":"Se vuoi <strong>usare GitHub Actions</strong>, ti conviene costruire l&#x2019;app intorno a <strong>GitHub come sistema centrale</strong>, integrando eventualmente esecuzioni custom da backend tuo (es. per Ansible, OpenTofu, ecc.).","children":[],"payload":{"tag":"li","lines":"1699,1700"}},{"content":"Se vuoi un <strong>CI/CD completamente personalizzabile</strong>, <strong>il tuo stack FastAPI + Ansible + Svelte</strong> potrebbe completare o estendere Actions o Semaphore, <strong>non duplicarli</strong>.","children":[],"payload":{"tag":"li","lines":"1700,1702"}}],"payload":{"tag":"h2","lines":"1695,1696"}},{"content":"git mi piace ma non voglio legarmi a github. semaphore o ho altre alternative?","children":[],"payload":{"tag":"h2","lines":"1709,1711"}}],"payload":{"tag":"h1","lines":"1570,1571"}},{"content":"&#x2705; Riepilogo: Git s&#xec;, GitHub no &#x2014; che alternative hai?","children":[{"content":"&#x1f527; CI/CD + Workflow Engine alternativi (self-hosted o cloud)","children":[{"content":"<table data-lines=\"1729,1739\">\n<thead data-lines=\"1729,1730\">\n<tr data-lines=\"1729,1730\">\n<th>Nome</th>\n<th>Hosted / Self-hosted</th>\n<th>Note principali</th>\n</tr>\n</thead>\n<tbody data-lines=\"1731,1739\">\n<tr data-lines=\"1731,1732\">\n<td><strong>GitLab CI</strong></td>\n<td>&#x2705; entrambi</td>\n<td>YAML simile a GitHub, potente, integrato</td>\n</tr>\n<tr data-lines=\"1732,1733\">\n<td><strong>Woodpecker CI</strong></td>\n<td>&#x2705; self-hosted</td>\n<td>Minimal, leggero, fork di Drone CI</td>\n</tr>\n<tr data-lines=\"1733,1734\">\n<td><strong>Drone CI</strong></td>\n<td>&#x2705; self-hosted / SaaS</td>\n<td>Pipeline via YAML, container-native</td>\n</tr>\n<tr data-lines=\"1734,1735\">\n<td><strong>Jenkins</strong></td>\n<td>&#x2705; self-hosted</td>\n<td>Storico, estendibile, complesso per&#xf2; potente</td>\n</tr>\n<tr data-lines=\"1735,1736\">\n<td><strong>Buildkite</strong></td>\n<td>&#x2705; SaaS</td>\n<td>Git-agnostic, potente, usato da aziende top</td>\n</tr>\n<tr data-lines=\"1736,1737\">\n<td><strong>Tekton</strong></td>\n<td>&#x2705; Kubernetes-native</td>\n<td>Da Red Hat, cloud-native, estendibile</td>\n</tr>\n<tr data-lines=\"1737,1738\">\n<td><strong>Argo Workflows / Argo CD</strong></td>\n<td>&#x2705; cloud-native</td>\n<td>CI/CD su Kubernetes con dichiarativit&#xe0; spinta</td>\n</tr>\n<tr data-lines=\"1738,1739\">\n<td><strong>Concourse CI</strong></td>\n<td>&#x2705; container-native</td>\n<td>Pipeline come codice, compatibile Git</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1729,1739"}}],"payload":{"tag":"h2","lines":"1727,1728"}},{"content":"&#x2728; Lightweight / developer-friendly","children":[{"content":"<table data-lines=\"1744,1749\">\n<thead data-lines=\"1744,1745\">\n<tr data-lines=\"1744,1745\">\n<th>Nome</th>\n<th>Tipo</th>\n<th>Vantaggi principali</th>\n</tr>\n</thead>\n<tbody data-lines=\"1746,1749\">\n<tr data-lines=\"1746,1747\">\n<td><strong>Gitea Actions</strong></td>\n<td>Built-in CI in Gitea</td>\n<td>Se usi Gitea, integrazione nativa</td>\n</tr>\n<tr data-lines=\"1747,1748\">\n<td><strong>Dagger</strong></td>\n<td>CI/CD programmable via SDK (Go, Python, Node)</td>\n<td>Puoi comporre pipeline come codice</td>\n</tr>\n<tr data-lines=\"1748,1749\">\n<td><strong>Earthly</strong></td>\n<td>CI/CD container-based</td>\n<td>Semplifica e standardizza Docker + CI</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1744,1749"}}],"payload":{"tag":"h2","lines":"1742,1743"}},{"content":"&#x1f517; Git Hosting alternativi a GitHub","children":[{"content":"<table data-lines=\"1754,1761\">\n<thead data-lines=\"1754,1755\">\n<tr data-lines=\"1754,1755\">\n<th>Nome</th>\n<th>Tipo</th>\n<th>Note</th>\n</tr>\n</thead>\n<tbody data-lines=\"1756,1761\">\n<tr data-lines=\"1756,1757\">\n<td><strong>GitLab CE</strong></td>\n<td>Self-hosted</td>\n<td>Completo, con CI integrata</td>\n</tr>\n<tr data-lines=\"1757,1758\">\n<td><strong>Gitea</strong></td>\n<td>Self-hosted</td>\n<td>Leggero, veloce, open source</td>\n</tr>\n<tr data-lines=\"1758,1759\">\n<td><strong>Forgejo</strong></td>\n<td>Gitea fork</td>\n<td>Pi&#xf9; community-driven</td>\n</tr>\n<tr data-lines=\"1759,1760\">\n<td><strong>Bitbucket</strong></td>\n<td>SaaS</td>\n<td>Proprietario Atlassian</td>\n</tr>\n<tr data-lines=\"1760,1761\">\n<td><strong>SourceHut</strong></td>\n<td>SaaS</td>\n<td>Minimalista, shell-based</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1754,1761"}}],"payload":{"tag":"h2","lines":"1752,1753"}},{"content":"&#x1f680; E quindi cosa puoi fare tu?","children":[{"content":"&#x2705; Stack possibile (libero da GitHub):","children":[{"content":"Git Hosting:","children":[{"content":"<strong>Gitea</strong> (self-hosted, leggero)","children":[],"payload":{"tag":"li","lines":"1778,1779"}},{"content":"o <strong>GitLab CE</strong>","children":[],"payload":{"tag":"li","lines":"1779,1781"}}],"payload":{"tag":"h4","lines":"1776,1777"}},{"content":"CI/CD:","children":[{"content":"<strong>Woodpecker CI</strong>: se vuoi semplicit&#xe0; YAML","children":[],"payload":{"tag":"li","lines":"1783,1784"}},{"content":"o <strong>Drone CI</strong> (usato anche in aziende)","children":[],"payload":{"tag":"li","lines":"1784,1785"}},{"content":"o <strong>GitLab CI</strong> se gi&#xe0; usi GitLab","children":[],"payload":{"tag":"li","lines":"1785,1787"}}],"payload":{"tag":"h4","lines":"1781,1782"}},{"content":"Automazione:","children":[{"content":"La tua app con <strong>FastAPI + Celery + Ansible/OpenTofu</strong>","children":[],"payload":{"tag":"li","lines":"1789,1790"}},{"content":"Eventuali workflow orchestrati con <strong>Argo / Temporal / Airflow</strong>","children":[],"payload":{"tag":"li","lines":"1790,1791"}},{"content":"Notifiche: via webhook, email, Slack, o bot personalizzati","children":[],"payload":{"tag":"li","lines":"1791,1793"}}],"payload":{"tag":"h4","lines":"1787,1788"}}],"payload":{"tag":"h3","lines":"1774,1775"}},{"content":"&#x1f4e6; Esempio flusso completo:","children":[{"content":"<pre data-lines=\"1797,1806\"><code class=\"language-text\">&#x26ed; Git Hosting &#x2192; [Gitea]\n       &#x2193; webhook\n&#x1f680; CI/CD trigger &#x2192; [Woodpecker / Drone CI]\n       &#x2193; chiamata HTTP\n&#x2699;&#xfe0f; API FastAPI &#x2192; Esegue YAML con Ansible/OpenTofu\n       &#x2193;\n&#x1f4e2; Risultati &#x2192; Frontend (Svelte), + log, + notifiche\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1797,1806"}}],"payload":{"tag":"h3","lines":"1795,1796"}},{"content":"&#x1f512; Bonus: Tutto self-hosted, tutto tuo.","children":[{"content":"100% <strong>indipendente da GitHub</strong>","children":[],"payload":{"tag":"li","lines":"1813,1814"}},{"content":"Con <strong>file YAML come interfaccia principale</strong>","children":[],"payload":{"tag":"li","lines":"1814,1815"}},{"content":"Completamente estensibile","children":[],"payload":{"tag":"li","lines":"1815,1816"}},{"content":"Open Source (o quasi tutto)","children":[],"payload":{"tag":"li","lines":"1816,1818"}}],"payload":{"tag":"h3","lines":"1809,1810"}}],"payload":{"tag":"h2","lines":"1764,1765"}},{"content":"Vuoi che ti aiuti a progettare uno stack specifico tra questi?","children":[{"content":"","children":[{"content":"Gitea + Woodpecker","children":[],"payload":{"tag":"li","lines":"1824,1825"}},{"content":"o Gitea + Drone + tua app FastAPI","children":[],"payload":{"tag":"li","lines":"1825,1826"}},{"content":"o Gitea + ArgoCD + runner custom","children":[],"payload":{"tag":"li","lines":"1826,1828"}}],"payload":{"tag":"ul","lines":"1824,1828"}},{"content":"","children":[{"content":"supporto CI/CD","children":[],"payload":{"tag":"li","lines":"1835,1836"}},{"content":"apertura allo standard Git","children":[],"payload":{"tag":"li","lines":"1836,1837"}},{"content":"integrazione con strumenti esterni (es. Ansible, GitHub Actions, ecc.)","children":[],"payload":{"tag":"li","lines":"1837,1838"}},{"content":"supporto attivo e futuro sostenibile","children":[],"payload":{"tag":"li","lines":"1838,1840"}}],"payload":{"tag":"ul","lines":"1835,1840"}}],"payload":{"tag":"h2","lines":"1820,1821"}},{"content":"&#x2705; 1. <strong>Forgejo</strong> (consigliata)","children":[{"content":"<table data-lines=\"1844,1853\">\n<thead data-lines=\"1844,1845\">\n<tr data-lines=\"1844,1845\">\n<th></th>\n<th>Descrizione</th>\n</tr>\n</thead>\n<tbody data-lines=\"1846,1853\">\n<tr data-lines=\"1846,1847\">\n<td><strong>Origine</strong></td>\n<td>Fork community-driven di Gitea (a causa del crescente controllo aziendale su Gitea da parte di Gitea Ltd)</td>\n</tr>\n<tr data-lines=\"1847,1848\">\n<td><strong>Licenza</strong></td>\n<td>100% open source (MIT), no lock-in</td>\n</tr>\n<tr data-lines=\"1848,1849\">\n<td><strong>UI/UX</strong></td>\n<td>Identica a Gitea ma con fix e roadmap indipendente</td>\n</tr>\n<tr data-lines=\"1849,1850\">\n<td><strong>Integrazioni</strong></td>\n<td>GitHub Actions compatibili tramite <a href=\"https://github.com/forgejo/runner\">act runner</a> (in beta ma funziona)</td>\n</tr>\n<tr data-lines=\"1850,1851\">\n<td><strong>CI/CD</strong></td>\n<td>Integrato (Forgejo Actions), ispirato a GitHub Actions</td>\n</tr>\n<tr data-lines=\"1851,1852\">\n<td><strong>Hosting</strong></td>\n<td>Self-hosted, lightweight</td>\n</tr>\n<tr data-lines=\"1852,1853\">\n<td><strong>Note</strong></td>\n<td>&#xc8; oggi l&#x2019;opzione <em>pi&#xf9; vicina a GitHub self-hosted + Actions open source</em></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1844,1853"}}],"payload":{"tag":"h2","lines":"1842,1843"}},{"content":"&#x2705; 2. <strong>SourceHut</strong> (sorgente hut)","children":[{"content":"<table data-lines=\"1860,1868\">\n<thead data-lines=\"1860,1861\">\n<tr data-lines=\"1860,1861\">\n<th></th>\n<th>Descrizione</th>\n</tr>\n</thead>\n<tbody data-lines=\"1862,1868\">\n<tr data-lines=\"1862,1863\">\n<td><strong>Origine</strong></td>\n<td>Creato da Drew DeVault, orientato a minimalismo, controllo da shell</td>\n</tr>\n<tr data-lines=\"1863,1864\">\n<td><strong>UI/UX</strong></td>\n<td>Nessuna UI JavaScript, tutto testuale (anche pipeline)</td>\n</tr>\n<tr data-lines=\"1864,1865\">\n<td><strong>CI/CD</strong></td>\n<td>Integrato (builds.sr.ht), YAML + scripting shell</td>\n</tr>\n<tr data-lines=\"1865,1866\">\n<td><strong>Filosofia</strong></td>\n<td>Massimo controllo, niente lock-in, niente bullshit</td>\n</tr>\n<tr data-lines=\"1866,1867\">\n<td><strong>Hosting</strong></td>\n<td>SaaS o self-hosted (richiede un po&#x2019; di setup)</td>\n</tr>\n<tr data-lines=\"1867,1868\">\n<td><strong>Adatto a</strong></td>\n<td>Sviluppatori esperti, team UNIX-oriented, dev terminal-centrici</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1860,1868"}}],"payload":{"tag":"h2","lines":"1858,1859"}},{"content":"&#x2705; 3. <strong>GitLab CE / EE</strong>","children":[{"content":"<table data-lines=\"1875,1883\">\n<thead data-lines=\"1875,1876\">\n<tr data-lines=\"1875,1876\">\n<th></th>\n<th>Descrizione</th>\n</tr>\n</thead>\n<tbody data-lines=\"1877,1883\">\n<tr data-lines=\"1877,1878\">\n<td><strong>Licenza</strong></td>\n<td>CE &#xe8; open source (MIT), EE &#xe8; a pagamento</td>\n</tr>\n<tr data-lines=\"1878,1879\">\n<td><strong>UI/UX</strong></td>\n<td>Completa, simile a GitHub</td>\n</tr>\n<tr data-lines=\"1879,1880\">\n<td><strong>CI/CD</strong></td>\n<td>Estremamente potente, con runner flessibili e pipeline YAML</td>\n</tr>\n<tr data-lines=\"1880,1881\">\n<td><strong>Integrazioni</strong></td>\n<td>Forte supporto per Ansible, Terraform, Docker, Kubernetes, ecc.</td>\n</tr>\n<tr data-lines=\"1881,1882\">\n<td><strong>Hosting</strong></td>\n<td>Cloud o self-hosted (pi&#xf9; pesante di Forgejo/Gitea)</td>\n</tr>\n<tr data-lines=\"1882,1883\">\n<td><strong>Note</strong></td>\n<td>Richiede risorse, ma &#xe8; una suite completa all-in-one</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1875,1883"}}],"payload":{"tag":"h2","lines":"1873,1874"}},{"content":"&#x2705; 4. <strong>Pagure</strong> (da Red Hat, ma poco attivo)","children":[{"content":"<table data-lines=\"1890,1897\">\n<thead data-lines=\"1890,1891\">\n<tr data-lines=\"1890,1891\">\n<th></th>\n<th>Descrizione</th>\n</tr>\n</thead>\n<tbody data-lines=\"1892,1897\">\n<tr data-lines=\"1892,1893\">\n<td><strong>Origine</strong></td>\n<td>Utilizzato da Fedora, Red Hat, ecc.</td>\n</tr>\n<tr data-lines=\"1893,1894\">\n<td><strong>Licenza</strong></td>\n<td>MIT</td>\n</tr>\n<tr data-lines=\"1894,1895\">\n<td><strong>UI/UX</strong></td>\n<td>Buona ma datata</td>\n</tr>\n<tr data-lines=\"1895,1896\">\n<td><strong>CI/CD</strong></td>\n<td>Limitato, devi integrare sistemi esterni (es. Jenkins)</td>\n</tr>\n<tr data-lines=\"1896,1897\">\n<td><strong>Note</strong></td>\n<td>Progetto in declino, sviluppo molto rallentato</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1890,1897"}}],"payload":{"tag":"h2","lines":"1888,1889"}},{"content":"&#x2705; 5. <strong>Codeberg (basato su Forgejo)</strong>","children":[{"content":"<table data-lines=\"1904,1910\">\n<thead data-lines=\"1904,1905\">\n<tr data-lines=\"1904,1905\">\n<th></th>\n<th>Descrizione</th>\n</tr>\n</thead>\n<tbody data-lines=\"1906,1910\">\n<tr data-lines=\"1906,1907\">\n<td><strong>Tipo</strong></td>\n<td>Hosting gratuito e open, gestito da no-profit</td>\n</tr>\n<tr data-lines=\"1907,1908\">\n<td><strong>Motore</strong></td>\n<td>Forgejo</td>\n</tr>\n<tr data-lines=\"1908,1909\">\n<td><strong>CI/CD</strong></td>\n<td>Forgejo Actions</td>\n</tr>\n<tr data-lines=\"1909,1910\">\n<td><strong>Ideale per</strong></td>\n<td>Progetti pubblici, piccoli team indipendenti</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1904,1910"}}],"payload":{"tag":"h2","lines":"1902,1903"}},{"content":"Confronto sintetico","children":[{"content":"<table data-lines=\"1917,1924\">\n<thead data-lines=\"1917,1918\">\n<tr data-lines=\"1917,1918\">\n<th>Nome</th>\n<th>CI/CD integrata</th>\n<th>GitHub Actions compatibili</th>\n<th>UI moderna</th>\n<th>Self-hosted leggero</th>\n<th>Attivit&#xe0; progetto</th>\n</tr>\n</thead>\n<tbody data-lines=\"1919,1924\">\n<tr data-lines=\"1919,1920\">\n<td><strong>Forgejo</strong></td>\n<td>&#x2705; Forgejo Actions</td>\n<td>&#x2705; (act runner)</td>\n<td>&#x2705;</td>\n<td>&#x2705;</td>\n<td>&#x1f7e2; attivo, community</td>\n</tr>\n<tr data-lines=\"1920,1921\">\n<td><strong>SourceHut</strong></td>\n<td>&#x2705; sr.ht builds</td>\n<td>&#x274c;</td>\n<td>&#x274c;</td>\n<td>&#x2705; (solo se shell-first)</td>\n<td>&#x1f7e2; attivo, stabile</td>\n</tr>\n<tr data-lines=\"1921,1922\">\n<td><strong>GitLab CE</strong></td>\n<td>&#x2705; GitLab CI</td>\n<td>&#x274c;</td>\n<td>&#x2705;</td>\n<td>&#x26a0;&#xfe0f; pesante</td>\n<td>&#x1f7e2; molto attivo</td>\n</tr>\n<tr data-lines=\"1922,1923\">\n<td><strong>Pagure</strong></td>\n<td>&#x274c; (CI esterna)</td>\n<td>&#x274c;</td>\n<td>&#x26a0;&#xfe0f; datata</td>\n<td>&#x2705;</td>\n<td>&#x1f534; poco attivo</td>\n</tr>\n<tr data-lines=\"1923,1924\">\n<td><strong>Codeberg</strong></td>\n<td>&#x2705; (Forgejo hosted)</td>\n<td>&#x2705;</td>\n<td>&#x2705;</td>\n<td>&#x274c; (non self-hosted)</td>\n<td>&#x1f7e2; stabile</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"1917,1924"}}],"payload":{"tag":"h2","lines":"1915,1916"}},{"content":"&#x1f525; Raccomandazione finale","children":[{"content":"100% open source","children":[],"payload":{"tag":"li","lines":"1934,1935"}},{"content":"GitHub Actions compatibile (runner incluso)","children":[],"payload":{"tag":"li","lines":"1935,1936"}},{"content":"leggero come Gitea, ma mantenuto da una community etica","children":[],"payload":{"tag":"li","lines":"1936,1937"}},{"content":"pronto per essere esteso/integrato col tuo backend Ansible/OpenTofu","children":[],"payload":{"tag":"li","lines":"1937,1939"}}],"payload":{"tag":"h2","lines":"1927,1928"}},{"content":"Vuoi che ti aiuti a:","children":[{"content":"","children":[{"content":"creare uno stack <strong>Forgejo + act-runner</strong> (CI/CD YAML)?","children":[],"payload":{"tag":"li","lines":"1943,1944"}},{"content":"integrarlo col tuo backend (FastAPI + Celery)?","children":[],"payload":{"tag":"li","lines":"1944,1945"}},{"content":"costruire pipeline dichiarative collegate a Git push?","children":[],"payload":{"tag":"li","lines":"1945,1947"}}],"payload":{"tag":"ul","lines":"1943,1947"}},{"content":"","children":[{"content":"creare uno stack Forgejo + act-runner (CI/CD YAML)","children":[],"payload":{"tag":"li","lines":"1953,1954"}},{"content":"integrarlo col tuo backend (FastAPI + Celery)","children":[],"payload":{"tag":"li","lines":"1954,1955"}},{"content":"costruire pipeline dichiarative collegate a Git push","children":[],"payload":{"tag":"li","lines":"1955,1956"}},{"content":"frontend con codebergPages-server","children":[],"payload":{"tag":"li","lines":"1956,1957"}},{"content":"un docker-compose.yml pronto per deploy locale o su VPS ed una alternativa docker-compose_traefik.yml con reverse proxy","children":[],"payload":{"tag":"li","lines":"1957,1958"}}],"payload":{"tag":"ul","lines":"1953,1958"}},{"content":"","children":[{"content":"<code>docker-compose.yml</code>: stack base con Forgejo + runner + backend + redis + worker","children":[],"payload":{"tag":"li","lines":"1966,1967"}},{"content":"<code>docker-compose.traefik.yml</code>: variante con Traefik come reverse proxy (autoconfigurabile con label)","children":[],"payload":{"tag":"li","lines":"1967,1968"}},{"content":"<code>ci.yml</code> di esempio per pipeline compatibile GitHub Actions","children":[],"payload":{"tag":"li","lines":"1968,1969"}},{"content":"Struttura del frontend statico + server leggero per deploy tipo CodebergPages","children":[],"payload":{"tag":"li","lines":"1969,1971"}}],"payload":{"tag":"ul","lines":"1966,1971"}}],"payload":{"tag":"h2","lines":"1941,1942"}},{"content":"Fammi sapere se preferisci partire <strong>dal backend</strong>, <strong>dal CI/CD</strong>, o dal <strong>reverse proxy</strong>.","children":[{"content":"1. \n<p data-lines=\"1977,1978\">Una descrizione chiara e dettagliata nel file <code>README.md</code>, comprensiva di:</p>","children":[{"content":"Obiettivi del progetto","children":[],"payload":{"tag":"li","lines":"1979,1980"}},{"content":"Contesto e finalit&#xe0;","children":[],"payload":{"tag":"li","lines":"1980,1981"}},{"content":"Istruzioni per l&#x2019;installazione, l&#x2019;uso e l&#x2019;eventuale distribuzione","children":[],"payload":{"tag":"li","lines":"1981,1982"}},{"content":"Tecnologie utilizzate","children":[],"payload":{"tag":"li","lines":"1982,1984"}}],"payload":{"tag":"li","lines":"1977,1984","listIndex":1}},{"content":"2. \n<p data-lines=\"1984,1985\">La struttura completa delle cartelle e dei file del progetto, con un layout coerente e facilmente navigabile.</p>","children":[],"payload":{"tag":"li","lines":"1984,1986","listIndex":2}},{"content":"3. \n<p data-lines=\"1986,1987\">Il codice sorgente completo e funzionante, incluso:</p>","children":[{"content":"Tutti gli script o moduli principali","children":[],"payload":{"tag":"li","lines":"1988,1989"}},{"content":"Funzioni ben commentate e documentate","children":[],"payload":{"tag":"li","lines":"1989,1990"}},{"content":"Eventuali file di configurazione (<code>.env.example</code>, <code>config.json</code>, <code>settings.py</code>, ecc.)","children":[],"payload":{"tag":"li","lines":"1990,1992"}}],"payload":{"tag":"li","lines":"1986,1992","listIndex":3}},{"content":"4. \n<p data-lines=\"1992,1993\">Eventuali risorse accessorie:</p>","children":[{"content":"Esempi d&#x2019;uso (<code>examples/</code>)","children":[],"payload":{"tag":"li","lines":"1994,1995"}},{"content":"Script di test o automazione (<code>tests/</code>, <code>scripts/</code>)","children":[],"payload":{"tag":"li","lines":"1995,1996"}},{"content":"Dipendenze elencate (<code>requirements.txt</code>, <code>package.json</code>, ecc.)","children":[],"payload":{"tag":"li","lines":"1996,1998"}}],"payload":{"tag":"li","lines":"1992,1998","listIndex":4}},{"content":"5. \n<p data-lines=\"1998,1999\">Un file <code>.gitignore</code> coerente con il progetto</p>","children":[],"payload":{"tag":"li","lines":"1998,2000","listIndex":5}},{"content":"6. \n<p data-lines=\"2000,2001\">Licenza del progetto (<code>LICENSE</code>), preferibilmente una licenza open-source</p>","children":[],"payload":{"tag":"li","lines":"2000,2002","listIndex":6}}],"payload":{"tag":"h2","lines":"1971,1973"}},{"content":"L&#x2019;output deve essere completo, dettagliato e pronto per essere copiato/incollato come base per un vero repository su GitHub. Assicurati di non tralasciare nulla e di integrare tutte le informazioni discusse in chat in modo organico.","children":[],"payload":{"tag":"h2","lines":"2002,2004"}}],"payload":{"tag":"h1","lines":"1717,1718"}},{"content":"&#x1f4c1; <strong>Struttura del progetto</strong>","children":[{"content":"<pre data-lines=\"2012,2044\"><code data-lines=\"2012,2044\">infrastructure-automation-app/\n&#x251c;&#x2500;&#x2500; README<span class=\"hljs-selector-class\">.md</span>\n&#x251c;&#x2500;&#x2500; LICENSE\n&#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-class\">.gitignore</span>\n&#x251c;&#x2500;&#x2500; docker-compose<span class=\"hljs-selector-class\">.yml</span>\n&#x251c;&#x2500;&#x2500; docker-compose<span class=\"hljs-selector-class\">.traefik</span><span class=\"hljs-selector-class\">.yml</span>\n&#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-class\">.env</span><span class=\"hljs-selector-class\">.example</span>\n&#x251c;&#x2500;&#x2500; backend/\n&#x2502;   &#x251c;&#x2500;&#x2500; app/\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-tag\">main</span><span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; worker<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; tasks<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; config<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; utils<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; requirements<span class=\"hljs-selector-class\">.txt</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; tests/\n&#x2502;       &#x2514;&#x2500;&#x2500; test_tasks<span class=\"hljs-selector-class\">.py</span>\n&#x251c;&#x2500;&#x2500; frontend/\n&#x2502;   &#x251c;&#x2500;&#x2500; public/\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; index<span class=\"hljs-selector-class\">.html</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; pages-server/\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; server<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; README<span class=\"hljs-selector-class\">.md</span>\n&#x251c;&#x2500;&#x2500; ci/\n&#x2502;   &#x2514;&#x2500;&#x2500; forgejo-workflows/\n&#x2502;       &#x2514;&#x2500;&#x2500; default<span class=\"hljs-selector-class\">.yml</span>\n&#x251c;&#x2500;&#x2500; examples/\n&#x2502;   &#x2514;&#x2500;&#x2500; playbook-sample<span class=\"hljs-selector-class\">.yml</span>\n&#x2514;&#x2500;&#x2500; scripts/\n    &#x2514;&#x2500;&#x2500; bootstrap<span class=\"hljs-selector-class\">.sh</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2012,2044"}}],"payload":{"tag":"h1","lines":"2010,2011"}},{"content":"&#x1f4dd; <code>README.md</code>","children":[{"content":"&#x1f9ea; Test","children":[{"content":"<pre data-lines=\"2110,2113\"><code class=\"language-bash\">docker-compose <span class=\"hljs-built_in\">exec</span> backend pytest\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2110,2113"}}],"payload":{"tag":"h2","lines":"2108,2109"}},{"content":"&#x1f9ec; Esecuzione Playbook","children":[{"content":"I file <code>.yml</code> vengono interpretati dal backend","children":[],"payload":{"tag":"li","lines":"2118,2119"}},{"content":"Sono eseguiti tramite Ansible in sandbox (via Celery worker)","children":[],"payload":{"tag":"li","lines":"2119,2120"}},{"content":"Output streammato via WebSocket","children":[],"payload":{"tag":"li","lines":"2120,2122"}}],"payload":{"tag":"h2","lines":"2116,2117"}},{"content":"&#x1f517; CI/CD con Forgejo","children":[{"content":"1. Clona il repository in un&apos;istanza Forgejo","children":[],"payload":{"tag":"li","lines":"2126,2127","listIndex":1}},{"content":"2. Usa la directory <code>ci/forgejo-workflows/default.yml</code>","children":[],"payload":{"tag":"li","lines":"2127,2128","listIndex":2}},{"content":"3. Il runner act &#xe8; gi&#xe0; incluso nel <code>docker-compose.yml</code>","children":[],"payload":{"tag":"li","lines":"2128,2130","listIndex":3}}],"payload":{"tag":"h2","lines":"2124,2125"}},{"content":"&#x1f9f0; Integrazione Git e Pipeline","children":[{"content":"Git push &#x2192; trigger su Forgejo CI &#x2192; webhook &#x2192; backend","children":[],"payload":{"tag":"li","lines":"2134,2135"}},{"content":"Il backend esegue il playbook definito","children":[],"payload":{"tag":"li","lines":"2135,2136"}},{"content":"Logs in tempo reale disponibili via WebSocket","children":[],"payload":{"tag":"li","lines":"2136,2138"}}],"payload":{"tag":"h2","lines":"2132,2133"}},{"content":"&#x1f5bc;&#xfe0f; Frontend","children":[{"content":"Interfaccia semplice e reattiva","children":[],"payload":{"tag":"li","lines":"2142,2143"}},{"content":"Static site servito via <code>frontend/pages-server/server.py</code>","children":[],"payload":{"tag":"li","lines":"2143,2144"}},{"content":"Supporto a log, selezione playbook, parametri","children":[],"payload":{"tag":"li","lines":"2144,2146"}}],"payload":{"tag":"h2","lines":"2140,2141"}},{"content":"&#x1f4e6; Distribuzione","children":[{"content":"\n<p data-lines=\"2150,2151\">Puoi pubblicare il frontend statico su:</p>","children":[{"content":"Codeberg Pages","children":[],"payload":{"tag":"li","lines":"2152,2153"}},{"content":"GitHub Pages","children":[],"payload":{"tag":"li","lines":"2153,2154"}},{"content":"qualsiasi CDN o server web","children":[],"payload":{"tag":"li","lines":"2154,2155"}}],"payload":{"tag":"li","lines":"2150,2155"}},{"content":"\n<p data-lines=\"2155,2156\">Il backend &#xe8; self-hosted con Docker</p>","children":[],"payload":{"tag":"li","lines":"2155,2157"}}],"payload":{"tag":"h2","lines":"2148,2149"}},{"content":"&#x1faaa; Licenza","children":[],"payload":{"tag":"h2","lines":"2159,2160"}},{"content":"&#x1f4c1; Struttura file","children":[{"content":"<pre data-lines=\"2169,2191\"><code data-lines=\"2169,2191\">\n<span class=\"hljs-params\">---</span>\n\n<span class=\"hljs-comment\"># &#x1f4dd; `.gitignore`</span>\n\n```gitignore\n__pycache__/\n*<span class=\"hljs-string\">.pyc</span>\n*<span class=\"hljs-string\">.pyo</span>\n<span class=\"hljs-string\">.env</span>\n<span class=\"hljs-string\">.env.</span>*\n<span class=\"hljs-string\">.vscode/</span>\n<span class=\"hljs-string\">.idea/</span>\n*<span class=\"hljs-string\">.log</span>\n*<span class=\"hljs-string\">.sqlite3</span>\ncelerybeat-schedule\nnode_modules/\ndist/\nbuild/\nfrontend/public/*<span class=\"hljs-string\">.js</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2169,2191"}}],"payload":{"tag":"h2","lines":"2165,2166"}}],"payload":{"tag":"h1","lines":"2047,2048"}},{"content":"&#x1f9ea; <code>.env.example</code>","children":[{"content":"<pre data-lines=\"2196,2203\"><code class=\"language-env\">FASTAPI_HOST=0.0.0.0\nFASTAPI_PORT=8000\nREDIS_URL=redis://redis:6379/0\nFORGEJO_URL=http://forgejo:3000\nACT_RUNNER_TOKEN=changeme\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2196,2203"}}],"payload":{"tag":"h1","lines":"2194,2195"}},{"content":"&#x2699;&#xfe0f; <code>docker-compose.yml</code>","children":[{"content":"<pre data-lines=\"2208,2254\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&apos;3.8&apos;</span>\n\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:alpine</span>\n    <span class=\"hljs-attr\">ports:</span> [ <span class=\"hljs-string\">&quot;6379:6379&quot;</span> ]\n\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=&#x24;{REDIS_URL}</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./examples:/app/playbooks</span>\n    <span class=\"hljs-attr\">depends_on:</span> [ <span class=\"hljs-string\">redis</span> ]\n    <span class=\"hljs-attr\">ports:</span> [ <span class=\"hljs-string\">&quot;8000:8000&quot;</span> ]\n\n  <span class=\"hljs-attr\">celery-worker:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">-A</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">--loglevel=info</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=&#x24;{REDIS_URL}</span>\n    <span class=\"hljs-attr\">depends_on:</span> [ <span class=\"hljs-string\">redis</span>, <span class=\"hljs-string\">backend</span> ]\n\n  <span class=\"hljs-attr\">forgejo:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">codeberg.org/forgejo/forgejo:latest</span>\n    <span class=\"hljs-attr\">ports:</span> [ <span class=\"hljs-string\">&quot;3000:3000&quot;</span>, <span class=\"hljs-string\">&quot;22:22&quot;</span> ]\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">forgejo_data:/data</span>\n\n  <span class=\"hljs-attr\">act-runner:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">forgejo/act-runner:latest</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/var/run/docker.sock:/var/run/docker.sock</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">FORGEJO_INSTANCE=http://forgejo:3000</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">FORGEJO_TOKEN=&#x24;{ACT_RUNNER_TOKEN}</span>\n    <span class=\"hljs-attr\">depends_on:</span> [ <span class=\"hljs-string\">forgejo</span> ]\n\n  <span class=\"hljs-attr\">pages-server:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./frontend/pages-server</span>\n    <span class=\"hljs-attr\">ports:</span> [ <span class=\"hljs-string\">&quot;8080:80&quot;</span> ]\n\n<span class=\"hljs-attr\">volumes:</span>\n  <span class=\"hljs-attr\">forgejo_data:</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2208,2254"}}],"payload":{"tag":"h1","lines":"2206,2207"}},{"content":"&#x2699;&#xfe0f; <code>docker-compose.traefik.yml</code> (con Traefik)","children":[{"content":"<pre data-lines=\"2259,2286\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&apos;3.8&apos;</span>\n\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">traefik:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">traefik:v2.9</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;80:80&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;443:443&quot;</span>\n    <span class=\"hljs-attr\">command:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;--api.insecure=true&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;--providers.docker=true&quot;</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/var/run/docker.sock:/var/run/docker.sock</span>\n\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">labels:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.backend.rule=Host(`api.localhost`)&quot;</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=&#x24;{REDIS_URL}</span>\n\n  <span class=\"hljs-attr\">pages-server:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./frontend/pages-server</span>\n    <span class=\"hljs-attr\">labels:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.frontend.rule=Host(`frontend.localhost`)&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2259,2286"}}],"payload":{"tag":"h1","lines":"2257,2258"}},{"content":"&#x1f40d; <code>backend/app/main.py</code>","children":[{"content":"<pre data-lines=\"2291,2311\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI\n<span class=\"hljs-keyword\">from</span> fastapi.responses <span class=\"hljs-keyword\">import</span> JSONResponse\n<span class=\"hljs-keyword\">from</span> tasks <span class=\"hljs-keyword\">import</span> run_playbook\n<span class=\"hljs-keyword\">import</span> os\n\napp = FastAPI()\n\n<span class=\"hljs-meta\">@app.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">root</span>():\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;message&quot;</span>: <span class=\"hljs-string\">&quot;Infrastructure Automation API&quot;</span>}\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">execute_playbook</span>(<span class=\"hljs-params\">name: <span class=\"hljs-built_in\">str</span></span>):\n    path = <span class=\"hljs-string\">f&quot;/app/playbooks/<span class=\"hljs-subst\">{name}</span>.yml&quot;</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> os.path.exists(path):\n        <span class=\"hljs-keyword\">return</span> JSONResponse(status_code=<span class=\"hljs-number\">404</span>, content={<span class=\"hljs-string\">&quot;error&quot;</span>: <span class=\"hljs-string\">&quot;Playbook not found&quot;</span>})\n    task = run_playbook.delay(path)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task.<span class=\"hljs-built_in\">id</span>}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2291,2311"}}],"payload":{"tag":"h1","lines":"2289,2290"}},{"content":"&#x1f40d; <code>backend/app/tasks.py</code>","children":[{"content":"<pre data-lines=\"2316,2334\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">import</span> subprocess\n\napp = Celery(<span class=\"hljs-string\">&quot;worker&quot;</span>, broker=os.environ[<span class=\"hljs-string\">&quot;REDIS_URL&quot;</span>])\n\n<span class=\"hljs-meta\">@app.task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>(<span class=\"hljs-params\">playbook_path</span>):\n    <span class=\"hljs-keyword\">try</span>:\n        result = subprocess.run(\n            [<span class=\"hljs-string\">&quot;ansible-playbook&quot;</span>, playbook_path],\n            capture_output=<span class=\"hljs-literal\">True</span>,\n            text=<span class=\"hljs-literal\">True</span>\n        )\n        <span class=\"hljs-keyword\">return</span> result.stdout\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">str</span>(e)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2316,2334"}}],"payload":{"tag":"h1","lines":"2314,2315"}},{"content":"&#x1f40d; <code>backend/app/worker.py</code>","children":[{"content":"<pre data-lines=\"2339,2345\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> tasks <span class=\"hljs-keyword\">import</span> app <span class=\"hljs-keyword\">as</span> celery_app\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n    celery_app.start()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2339,2345"}}],"payload":{"tag":"h1","lines":"2337,2338"}},{"content":"&#x1f9ea; <code>backend/tests/test_tasks.py</code>","children":[{"content":"<pre data-lines=\"2350,2354\"><code class=\"language-python\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">test_dummy</span>():\n    <span class=\"hljs-keyword\">assert</span> <span class=\"hljs-number\">1</span> + <span class=\"hljs-number\">1</span> == <span class=\"hljs-number\">2</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2350,2354"}}],"payload":{"tag":"h1","lines":"2348,2349"}},{"content":"&#x1f4c4; <code>ci/forgejo-workflows/default.yml</code>","children":[{"content":"<pre data-lines=\"2359,2378\"><code class=\"language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">Ansible</span> <span class=\"hljs-string\">Playbook</span>\n\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">paths:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&apos;examples/*.yml&apos;</span>\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">run:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v3</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">Playbook</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          curl -X POST http://backend:8000\n</span></code></pre>","children":[],"payload":{"tag":"pre","lines":"2359,2378"}}],"payload":{"tag":"h1","lines":"2357,2358"}},{"content":"&#x1f4c4; <code>ci/forgejo-workflows/default.yml</code> (completato)","children":[{"content":"<pre data-lines=\"2388,2407\"><code class=\"language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">Ansible</span> <span class=\"hljs-string\">Playbook</span>\n\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">paths:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&apos;examples/*.yml&apos;</span>\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">run:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v3</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Trigger</span> <span class=\"hljs-string\">backend</span> <span class=\"hljs-string\">execution</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          curl -X POST http://backend:8000/run/?name=playbook-sample\n</span></code></pre>","children":[],"payload":{"tag":"pre","lines":"2388,2407"}}],"payload":{"tag":"h1","lines":"2386,2387"}},{"content":"&#x1f4c1; <code>examples/playbook-sample.yml</code>","children":[{"content":"<pre data-lines=\"2412,2427\"><code class=\"language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">&quot;Install Nginx&quot;</span>\n<span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">localhost</span>\n<span class=\"hljs-attr\">tasks:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Install</span> <span class=\"hljs-string\">nginx</span>\n    <span class=\"hljs-attr\">package:</span>\n      <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">nginx</span>\n      <span class=\"hljs-attr\">state:</span> <span class=\"hljs-string\">present</span>\n\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Ensure</span> <span class=\"hljs-string\">nginx</span> <span class=\"hljs-string\">is</span> <span class=\"hljs-string\">running</span>\n    <span class=\"hljs-attr\">service:</span>\n      <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">nginx</span>\n      <span class=\"hljs-attr\">state:</span> <span class=\"hljs-string\">started</span>\n      <span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2412,2427"}}],"payload":{"tag":"h1","lines":"2410,2411"}},{"content":"&#x1f5a5;&#xfe0f; <code>frontend/public/index.html</code> (pagina minimale)","children":[{"content":"<pre data-lines=\"2432,2460\"><code class=\"language-html\"><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">html</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;en&quot;</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">charset</span>=<span class=\"hljs-string\">&quot;UTF-8&quot;</span> /&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;viewport&quot;</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">&quot;width=device-width, initial-scale=1.0&quot;</span>/&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Infrastructure Automation<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Welcome to the Automation UI<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">form</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;playbook-form&quot;</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;text&quot;</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;playbook-name&quot;</span> <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Enter playbook name&quot;</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;submit&quot;</span>&gt;</span>Run<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">form</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pre</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;output&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pre</span>&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">\n    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;playbook-form&quot;</span>).<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">&quot;submit&quot;</span>, <span class=\"hljs-title function_\">async</span> (e) =&gt; {\n      e.<span class=\"hljs-title function_\">preventDefault</span>();\n      <span class=\"hljs-keyword\">const</span> name = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;playbook-name&quot;</span>).<span class=\"hljs-property\">value</span>;\n      <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`/run/?name=<span class=\"hljs-subst\">&#x24;{name}</span>`</span>, { <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span> });\n      <span class=\"hljs-keyword\">const</span> data = <span class=\"hljs-keyword\">await</span> res.<span class=\"hljs-title function_\">json</span>();\n      <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;output&quot;</span>).<span class=\"hljs-property\">textContent</span> = <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(data, <span class=\"hljs-literal\">null</span>, <span class=\"hljs-number\">2</span>);\n    });\n  </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2432,2460"}}],"payload":{"tag":"h1","lines":"2430,2431"}},{"content":"&#x1f40d; <code>frontend/pages-server/server.py</code>","children":[{"content":"<pre data-lines=\"2465,2480\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> http.server <span class=\"hljs-keyword\">import</span> SimpleHTTPRequestHandler\n<span class=\"hljs-keyword\">from</span> socketserver <span class=\"hljs-keyword\">import</span> TCPServer\n\nPORT = <span class=\"hljs-number\">80</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Handler</span>(<span class=\"hljs-title class_ inherited__\">SimpleHTTPRequestHandler</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">end_headers</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-variable language_\">self</span>.send_header(<span class=\"hljs-string\">&apos;Cache-Control&apos;</span>, <span class=\"hljs-string\">&apos;no-store&apos;</span>)\n        <span class=\"hljs-built_in\">super</span>().end_headers()\n\n<span class=\"hljs-keyword\">with</span> TCPServer((<span class=\"hljs-string\">&quot;&quot;</span>, PORT), Handler) <span class=\"hljs-keyword\">as</span> httpd:\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;Serving frontend on port <span class=\"hljs-subst\">{PORT}</span>&quot;</span>)\n    httpd.serve_forever()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2465,2480"}}],"payload":{"tag":"h1","lines":"2463,2464"}},{"content":"&#x1f4c4; <code>frontend/README.md</code>","children":[{"content":"<pre data-lines=\"2485,2501\"><code class=\"language-markdown\"><span class=\"hljs-section\"># Frontend - Static Pages</span>\n\nQuesta directory contiene l&apos;interfaccia utente minimale servita come sito statico (simile a CodebergPages o GitHub Pages).\n\n<span class=\"hljs-section\">### Contenuto</span>\n\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-code\">`public/index.html`</span>: UI base\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-code\">`pages-server/server.py`</span>: server Python semplice per development/local hosting\n\n<span class=\"hljs-section\">### Avvio locale</span>\n\n<span class=\"hljs-code\">```bash\ncd frontend/pages-server\npython server.py\n</span></code></pre>","children":[],"payload":{"tag":"pre","lines":"2485,2501"}},{"content":"<pre data-lines=\"2504,2519\"><code data-lines=\"2504,2519\">\n<span class=\"hljs-meta\">---\n</span>\n<span class=\"hljs-comment\"># &#x1f41a; `scripts/bootstrap.sh`</span>\n\n<span class=\"hljs-string\">```bash</span>\n<span class=\"hljs-comment\">#!/bin/bash</span>\n<span class=\"hljs-string\">echo</span> <span class=\"hljs-string\">&quot;&#x1f527; Bootstrapping Environment...&quot;</span>\n<span class=\"hljs-string\">cp</span> <span class=\"hljs-string\">.env.example</span> <span class=\"hljs-string\">.env</span>\n<span class=\"hljs-string\">echo</span> <span class=\"hljs-string\">&quot;&#x2705; .env file created.&quot;</span>\n\n<span class=\"hljs-string\">echo</span> <span class=\"hljs-string\">&quot;&#x1f680; Starting Docker stack...&quot;</span>\n<span class=\"hljs-string\">docker-compose</span> <span class=\"hljs-string\">up</span> <span class=\"hljs-string\">-d</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2504,2519"}}],"payload":{"tag":"h1","lines":"2483,2484"}},{"content":"&#x1f4dc; <code>LICENSE</code> (MIT)","children":[{"content":"<pre data-lines=\"2524,2532\"><code class=\"language-text\">MIT License\n\nCopyright (c) 2025 YourName\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\n...\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2524,2532"}}],"payload":{"tag":"h1","lines":"2522,2523"}},{"content":"&#x1f4cc; Considerazioni finali","children":[{"content":"&#x1f3f7;&#xfe0f; <strong>Nome e Descrizione per la Repo GitHub</strong>","children":[{"content":"&#x1f539; <strong>Nome repository</strong>","children":[{"content":"<pre data-lines=\"2571,2574\"><code class=\"language-txt\">infraflow\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2571,2574"}}],"payload":{"tag":"h3","lines":"2569,2570"}},{"content":"&#x1f539; <strong>Descrizione breve</strong>","children":[{"content":"<pre data-lines=\"2581,2584\"><code class=\"language-txt\">Web-based infrastructure automation platform using declarative YAML workflows, Ansible/OpenTofu execution, and Git-integrated pipelines.\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2581,2584"}}],"payload":{"tag":"h3","lines":"2579,2580"}},{"content":"&#x1f539; <strong>Descrizione lunga (per il README e GitHub)</strong>","children":[],"payload":{"tag":"h3","lines":"2587,2588"}}],"payload":{"tag":"h2","lines":"2567,2568"}},{"content":"&#x1f9e9; <strong>Task 1: WebSocket per log realtime nel frontend</strong>","children":[{"content":"&#x2705; Obiettivo","children":[],"payload":{"tag":"h3","lines":"2595,2596"}},{"content":"&#x1f527; Modifiche necessarie","children":[{"content":"1. \n<p data-lines=\"2601,2602\"><strong>Backend (FastAPI + Celery)</strong>:</p>","children":[{"content":"Usa un canale WebSocket (<code>/ws/logs/{task_id}</code>) per inviare progressivamente i log.","children":[],"payload":{"tag":"li","lines":"2603,2604"}},{"content":"Il Celery task invia messaggi su Redis Pub/Sub.","children":[],"payload":{"tag":"li","lines":"2604,2605"}},{"content":"Il server FastAPI ascolta e trasmette i log al client via WebSocket.","children":[],"payload":{"tag":"li","lines":"2605,2607"}}],"payload":{"tag":"li","lines":"2601,2607","listIndex":1}},{"content":"2. \n<p data-lines=\"2607,2608\"><strong>Frontend (HTML o Svelte)</strong>:</p>","children":[{"content":"Connetti a <code>ws://localhost:8000/ws/logs/&lt;task_id&gt;</code>","children":[],"payload":{"tag":"li","lines":"2609,2610"}},{"content":"Mostra i log man mano che arrivano.","children":[],"payload":{"tag":"li","lines":"2610,2612"}}],"payload":{"tag":"li","lines":"2607,2612","listIndex":2}},{"content":"3. \n<p data-lines=\"2612,2613\"><strong>Tecnologia WebSocket consigliata:</strong></p>","children":[{"content":"<code>websockets</code> + <code>asyncio</code> nel backend","children":[],"payload":{"tag":"li","lines":"2614,2615"}},{"content":"Vanilla JS o <code>svelte-websocket-store</code> nel frontend","children":[],"payload":{"tag":"li","lines":"2615,2617"}}],"payload":{"tag":"li","lines":"2612,2617","listIndex":3}}],"payload":{"tag":"h3","lines":"2599,2600"}}],"payload":{"tag":"h2","lines":"2593,2594"}},{"content":"&#x1f310; <strong>Task 2: Supporto a OpenTofu per provisioning</strong>","children":[{"content":"&#x2705; Obiettivo","children":[],"payload":{"tag":"h3","lines":"2621,2622"}},{"content":"&#x1f527; Come fare:","children":[{"content":"<pre data-lines=\"2634,2640\"><code data-lines=\"2634,2640\">infrastructure/\n&#x2514;&#x2500;&#x2500; example-vm/\n    &#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-tag\">main</span><span class=\"hljs-selector-class\">.tf</span>\n    &#x2514;&#x2500;&#x2500; variables<span class=\"hljs-selector-class\">.tf</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2634,2640"}}],"payload":{"tag":"h3","lines":"2625,2626"}}],"payload":{"tag":"h2","lines":"2619,2620"}},{"content":"&#x1f4bb; <strong>Task 3: Interfaccia utente con Svelte o React</strong>","children":[{"content":"&#x2705; Obiettivo","children":[],"payload":{"tag":"h3","lines":"2645,2646"}},{"content":"&#x1f527; Stack suggerito:","children":[{"content":"<strong>SvelteKit</strong> (pi&#xf9; leggero, semplice, integrabile in Pages)","children":[],"payload":{"tag":"li","lines":"2651,2652"}},{"content":"Oppure <strong>React + Vite + Zustand</strong> (pi&#xf9; standard e flessibile)","children":[],"payload":{"tag":"li","lines":"2652,2654"}}],"payload":{"tag":"h3","lines":"2649,2650"}},{"content":"&#x1f527; Funzionalit&#xe0; UI:","children":[{"content":"","children":[{"content":"Login/logout","children":[],"payload":{"tag":"li","lines":"2656,2657"}},{"content":"Lista playbook disponibili (da API)","children":[],"payload":{"tag":"li","lines":"2657,2658"}},{"content":"Parametri personalizzabili","children":[],"payload":{"tag":"li","lines":"2658,2659"}},{"content":"Visualizzazione log WebSocket live","children":[],"payload":{"tag":"li","lines":"2659,2660"}},{"content":"Stato job Celery","children":[],"payload":{"tag":"li","lines":"2660,2661"}},{"content":"Cronologia esecuzioni","children":[],"payload":{"tag":"li","lines":"2661,2663"}}],"payload":{"tag":"ul","lines":"2656,2663"}},{"content":"","children":[{"content":"<code>axios</code> o <code>fetch</code> per API","children":[],"payload":{"tag":"li","lines":"2665,2666"}},{"content":"<code>svelte-websocket-store</code> per log realtime","children":[],"payload":{"tag":"li","lines":"2666,2667"}},{"content":"Routing e moduli dinamici (modular YAML editor)","children":[],"payload":{"tag":"li","lines":"2667,2669"}}],"payload":{"tag":"ul","lines":"2665,2669"}}],"payload":{"tag":"h3","lines":"2654,2655"}}],"payload":{"tag":"h2","lines":"2643,2644"}},{"content":"&#x1f464; <strong>Task 4: Ruoli utente e login GitHub/GitLab</strong>","children":[{"content":"&#x2705; Obiettivo","children":[{"content":"Limitare accesso a UI/API","children":[],"payload":{"tag":"li","lines":"2677,2678"}},{"content":"Associare job/log a utenti","children":[],"payload":{"tag":"li","lines":"2678,2679"}},{"content":"In futuro, trigger da webhook autenticati","children":[],"payload":{"tag":"li","lines":"2679,2681"}}],"payload":{"tag":"h3","lines":"2673,2674"}},{"content":"&#x1f527; Stack consigliato:","children":[{"content":"<strong>Backend</strong>: FastAPI + <code>fastapi-users</code> con <code>OAuth2PasswordBearer</code> + GitHub/GitLab provider","children":[],"payload":{"tag":"li","lines":"2683,2684"}},{"content":"<strong>Frontend</strong>: login OAuth via redirect, token JWT usato nelle API","children":[],"payload":{"tag":"li","lines":"2684,2685"}},{"content":"<strong>Permessi</strong>: ruoli <code>admin</code>, <code>user</code>, <code>viewer</code>","children":[],"payload":{"tag":"li","lines":"2685,2687"}}],"payload":{"tag":"h3","lines":"2681,2682"}}],"payload":{"tag":"h2","lines":"2671,2672"}},{"content":"&#x2638;&#xfe0f; <strong>Task 5: Packaging con Helm/Kubernetes</strong>","children":[{"content":"&#x2705; Obiettivo","children":[],"payload":{"tag":"h3","lines":"2691,2692"}},{"content":"&#x1f4e6; Helm chart include:","children":[{"content":"<pre data-lines=\"2714,2725\"><code data-lines=\"2714,2725\">helm/\n&#x2514;&#x2500;&#x2500; infraflow/\n    &#x251c;&#x2500;&#x2500; Chart<span class=\"hljs-selector-class\">.yaml</span>\n    &#x251c;&#x2500;&#x2500; values<span class=\"hljs-selector-class\">.yaml</span>\n    &#x251c;&#x2500;&#x2500; templates/\n    &#x2502;   &#x251c;&#x2500;&#x2500; deployment-backend<span class=\"hljs-selector-class\">.yaml</span>\n    &#x2502;   &#x251c;&#x2500;&#x2500; service-backend<span class=\"hljs-selector-class\">.yaml</span>\n    &#x2502;   &#x251c;&#x2500;&#x2500; ingress<span class=\"hljs-selector-class\">.yaml</span>\n    &#x2502;   &#x2514;&#x2500;&#x2500; redis<span class=\"hljs-selector-class\">.yaml</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2714,2725"}}],"payload":{"tag":"h3","lines":"2695,2696"}}],"payload":{"tag":"h2","lines":"2689,2690"}},{"content":"&#x2705; Riassunto Prossimi Passi Implementativi","children":[{"content":"<table data-lines=\"2730,2738\">\n<thead data-lines=\"2730,2731\">\n<tr data-lines=\"2730,2731\">\n<th>Task</th>\n<th>Status</th>\n</tr>\n</thead>\n<tbody data-lines=\"2732,2738\">\n<tr data-lines=\"2732,2733\">\n<td>Nome repo e descrizione</td>\n<td>&#x2705; Fatto</td>\n</tr>\n<tr data-lines=\"2733,2734\">\n<td>WebSocket log realtime</td>\n<td>&#x1f51c; Da implementare</td>\n</tr>\n<tr data-lines=\"2734,2735\">\n<td>Supporto OpenTofu</td>\n<td>&#x1f51c; Da implementare</td>\n</tr>\n<tr data-lines=\"2735,2736\">\n<td>UI moderna (Svelte/React)</td>\n<td>&#x1f51c; Da implementare</td>\n</tr>\n<tr data-lines=\"2736,2737\">\n<td>Autenticazione GitHub/GitLab</td>\n<td>&#x1f51c; Da implementare</td>\n</tr>\n<tr data-lines=\"2737,2738\">\n<td>Helm/K8s packaging</td>\n<td>&#x1f51c; Da generare</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2730,2738"}}],"payload":{"tag":"h2","lines":"2728,2729"}}],"payload":{"tag":"h1","lines":"2537,2538"}},{"content":"&#x2705; Obiettivo","children":[{"content":"&#x1f4e6; Struttura generale dei componenti coinvolti","children":[{"content":"<pre data-lines=\"2765,2773\"><code class=\"language-text\">backend/\n&#x251c;&#x2500;&#x2500; main.py              # FastAPI app\n&#x251c;&#x2500;&#x2500; tasks.py             # Celery tasks\n&#x251c;&#x2500;&#x2500; websocket.py         # WebSocket handler\n&#x251c;&#x2500;&#x2500; log_queue.py         # Gestione coda/pub-sub per log (in memoria o Redis)\n&#x2514;&#x2500;&#x2500; utils.py             # Helpers (esecuzione subprocessi, ecc.)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2765,2773"}}],"payload":{"tag":"h2","lines":"2763,2764"}},{"content":"&#x1f501; Strategia: Pub/Sub per log in tempo reale","children":[{"content":"1. Quando parte un task (<code>run_playbook</code>), esegue Ansible via <code>subprocess</code>.","children":[],"payload":{"tag":"li","lines":"2778,2779","listIndex":1}},{"content":"2. Ogni riga di output viene pubblicata su una coda (es. <code>asyncio.Queue</code> o Redis Pub/Sub).","children":[],"payload":{"tag":"li","lines":"2779,2780","listIndex":2}},{"content":"3. Il WebSocket, collegato a <code>/ws/logs/{task_id}</code>, riceve quei log e li invia al client.","children":[],"payload":{"tag":"li","lines":"2780,2781","listIndex":3}},{"content":"4. Al termine del task, viene chiuso il canale.","children":[],"payload":{"tag":"li","lines":"2781,2783","listIndex":4}}],"payload":{"tag":"h2","lines":"2776,2777"}},{"content":"&#x1f9e0; Step 1 &#x2013; <code>log_queue.py</code>: coda per messaggi log","children":[{"content":"<pre data-lines=\"2789,2804\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/log_queue.py</span>\n\n<span class=\"hljs-keyword\">import</span> asyncio\n<span class=\"hljs-keyword\">from</span> collections <span class=\"hljs-keyword\">import</span> defaultdict\n\n<span class=\"hljs-comment\"># Una mappa: task_id -&gt; coda di messaggi</span>\nlog_queues = defaultdict(asyncio.Queue)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_log_queue</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span></span>) -&gt; asyncio.Queue:\n    <span class=\"hljs-keyword\">return</span> log_queues[task_id]\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">remove_log_queue</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span></span>):\n    log_queues.pop(task_id, <span class=\"hljs-literal\">None</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2789,2804"}}],"payload":{"tag":"h2","lines":"2785,2786"}},{"content":"&#x2699;&#xfe0f; Step 2 &#x2013; <code>tasks.py</code>: esecuzione del playbook e pubblicazione log","children":[{"content":"<pre data-lines=\"2809,2839\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/tasks.py</span>\n\n<span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> shared_task\n<span class=\"hljs-keyword\">import</span> subprocess\n<span class=\"hljs-keyword\">from</span> .log_queue <span class=\"hljs-keyword\">import</span> get_log_queue, remove_log_queue\n\n<span class=\"hljs-meta\">@shared_task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span>, playbook_path: <span class=\"hljs-built_in\">str</span></span>):\n    queue = get_log_queue(task_id)\n    <span class=\"hljs-keyword\">try</span>:\n        process = subprocess.Popen(\n            [<span class=\"hljs-string\">&quot;ansible-playbook&quot;</span>, playbook_path],\n            stdout=subprocess.PIPE,\n            stderr=subprocess.STDOUT,\n            text=<span class=\"hljs-literal\">True</span>,\n            bufsize=<span class=\"hljs-number\">1</span>,\n        )\n\n        <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> process.stdout:\n            queue.put_nowait(line.strip())\n\n        process.wait()\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[exit] code: <span class=\"hljs-subst\">{process.returncode}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[error] <span class=\"hljs-subst\">{<span class=\"hljs-built_in\">str</span>(e)}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">finally</span>:\n        queue.put_nowait(<span class=\"hljs-string\">&quot;[end]&quot;</span>)\n        remove_log_queue(task_id)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2809,2839"}}],"payload":{"tag":"h2","lines":"2807,2808"}},{"content":"&#x1f310; Step 3 &#x2013; <code>websocket.py</code>: endpoint WebSocket","children":[{"content":"<pre data-lines=\"2844,2865\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/websocket.py</span>\n\n<span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter, WebSocket, WebSocketDisconnect\n<span class=\"hljs-keyword\">from</span> .log_queue <span class=\"hljs-keyword\">import</span> get_log_queue\n\nrouter = APIRouter()\n\n<span class=\"hljs-meta\">@router.websocket(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/ws/logs/{task_id}&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">websocket_log_stream</span>(<span class=\"hljs-params\">websocket: WebSocket, task_id: <span class=\"hljs-built_in\">str</span></span>):\n    <span class=\"hljs-keyword\">await</span> websocket.accept()\n    queue = get_log_queue(task_id)\n    <span class=\"hljs-keyword\">try</span>:\n        <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n            message = <span class=\"hljs-keyword\">await</span> queue.get()\n            <span class=\"hljs-keyword\">await</span> websocket.send_text(message)\n            <span class=\"hljs-keyword\">if</span> message == <span class=\"hljs-string\">&quot;[end]&quot;</span>:\n                <span class=\"hljs-keyword\">break</span>\n    <span class=\"hljs-keyword\">except</span> WebSocketDisconnect:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;Client disconnected from task <span class=\"hljs-subst\">{task_id}</span>&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2844,2865"}}],"payload":{"tag":"h2","lines":"2842,2843"}},{"content":"&#x1f680; Step 4 &#x2013; <code>main.py</code>: registrazione router WebSocket e API","children":[{"content":"<pre data-lines=\"2870,2900\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/main.py</span>\n\n<span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI, BackgroundTasks\n<span class=\"hljs-keyword\">from</span> fastapi.middleware.cors <span class=\"hljs-keyword\">import</span> CORSMiddleware\n<span class=\"hljs-keyword\">import</span> uuid\n\n<span class=\"hljs-keyword\">from</span> .tasks <span class=\"hljs-keyword\">import</span> run_playbook\n<span class=\"hljs-keyword\">from</span> .websocket <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> websocket_router\n<span class=\"hljs-keyword\">from</span> .log_queue <span class=\"hljs-keyword\">import</span> get_log_queue\n\napp = FastAPI()\napp.include_router(websocket_router)\n\n<span class=\"hljs-comment\"># Permetti richieste CORS dal frontend</span>\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[<span class=\"hljs-string\">&quot;*&quot;</span>],  <span class=\"hljs-comment\"># o specifica il dominio del frontend</span>\n    allow_credentials=<span class=\"hljs-literal\">True</span>,\n    allow_methods=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_headers=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span class=\"hljs-params\">background_tasks: BackgroundTasks</span>):\n    task_id = <span class=\"hljs-built_in\">str</span>(uuid.uuid4())\n    playbook_path = <span class=\"hljs-string\">&quot;examples/playbook-sample.yml&quot;</span>\n    background_tasks.add_task(run_playbook.delay, task_id, playbook_path)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task_id}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2870,2900"}}],"payload":{"tag":"h2","lines":"2868,2869"}},{"content":"&#x1f5a5;&#xfe0f; Step 5 &#x2013; Frontend HTML (esempio base)","children":[{"content":"<pre data-lines=\"2905,2927\"><code class=\"language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;text&quot;</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;task-id&quot;</span> <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Task ID&quot;</span> /&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onclick</span>=<span class=\"hljs-string\">&quot;connect()&quot;</span>&gt;</span>Connect to Logs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pre</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;log-output&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pre</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">\n  <span class=\"hljs-keyword\">let</span> socket;\n\n  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">connect</span>(<span class=\"hljs-params\"></span>) {\n    <span class=\"hljs-keyword\">const</span> taskId = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;task-id&quot;</span>).<span class=\"hljs-property\">value</span>;\n    socket = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WebSocket</span>(<span class=\"hljs-string\">`ws://localhost:8000/ws/logs/<span class=\"hljs-subst\">&#x24;{taskId}</span>`</span>);\n\n    socket.<span class=\"hljs-property\">onmessage</span> = <span class=\"hljs-function\">(<span class=\"hljs-params\">event</span>) =&gt;</span> {\n      <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;log-output&quot;</span>).<span class=\"hljs-property\">textContent</span> += event.<span class=\"hljs-property\">data</span> + <span class=\"hljs-string\">&quot;\\n&quot;</span>;\n    };\n\n    socket.<span class=\"hljs-property\">onclose</span> = <span class=\"hljs-function\">() =&gt;</span> {\n      <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;log-output&quot;</span>).<span class=\"hljs-property\">textContent</span> += <span class=\"hljs-string\">&quot;[connection closed]\\n&quot;</span>;\n    };\n  }\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2905,2927"}}],"payload":{"tag":"h2","lines":"2903,2904"}},{"content":"&#x2705; Test veloce end-to-end","children":[{"content":"1. \n<p data-lines=\"2932,2933\">Avvia backend e Celery:</p>\n<pre data-lines=\"2934,2937\"><code class=\"language-bash\">docker-compose up -d\n</code></pre>","children":[],"payload":{"tag":"li","lines":"2932,2938","listIndex":1}},{"content":"2. \n<p data-lines=\"2938,2939\">Chiama <code>/run/</code> via API &#x2192; ottieni un <code>task_id</code>.</p>","children":[],"payload":{"tag":"li","lines":"2938,2940","listIndex":2}},{"content":"3. \n<p data-lines=\"2940,2941\">Connettiti via WebSocket a <code>ws://localhost:8000/ws/logs/{task_id}</code> &#x2192; visualizza i log in tempo reale!</p>","children":[],"payload":{"tag":"li","lines":"2940,2942","listIndex":3}}],"payload":{"tag":"h2","lines":"2930,2931"}},{"content":"&#x1f4e6; Estensioni future","children":[{"content":"<table data-lines=\"2946,2952\">\n<thead data-lines=\"2946,2947\">\n<tr data-lines=\"2946,2947\">\n<th>Funzionalit&#xe0;</th>\n<th>Possibile via</th>\n</tr>\n</thead>\n<tbody data-lines=\"2948,2952\">\n<tr data-lines=\"2948,2949\">\n<td>Multipli task concorrenti</td>\n<td><code>task_id</code> distinto</td>\n</tr>\n<tr data-lines=\"2949,2950\">\n<td>Salvataggio log persistente</td>\n<td>scrittura su file/log storage</td>\n</tr>\n<tr data-lines=\"2950,2951\">\n<td>Redis al posto di <code>asyncio.Queue</code></td>\n<td><code>aioredis</code>, Redis Streams</td>\n</tr>\n<tr data-lines=\"2951,2952\">\n<td>Sicurezza WebSocket</td>\n<td>JWT nei parametri o header</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2946,2952"}}],"payload":{"tag":"h2","lines":"2944,2945"}}],"payload":{"tag":"h1","lines":"2757,2758"}},{"content":"&#x2705; Modulo 2 &#x2013; Supporto a OpenTofu per provisioning","children":[{"content":"&#x1f3af; Obiettivo","children":[{"content":"Eseguire progetti <strong>OpenTofu</strong> scritti in <code>.tf</code> o <code>.tf.json</code>","children":[],"payload":{"tag":"li","lines":"2970,2971"}},{"content":"Usare <code>subprocess</code> per eseguire i comandi <code>tofu init</code> + <code>tofu apply -auto-approve</code>","children":[],"payload":{"tag":"li","lines":"2971,2972"}},{"content":"Inviare i log dell&#x2019;esecuzione in <strong>real-time via WebSocket</strong>, esattamente come per i playbook Ansible","children":[],"payload":{"tag":"li","lines":"2972,2974"}}],"payload":{"tag":"h2","lines":"2966,2967"}},{"content":"&#x1f4c1; Directory suggerita","children":[{"content":"<pre data-lines=\"2978,2984\"><code class=\"language-text\">infrastructure/\n&#x2514;&#x2500;&#x2500; sample/\n    &#x251c;&#x2500;&#x2500; main.tf\n    &#x2514;&#x2500;&#x2500; variables.tf\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2978,2984"}}],"payload":{"tag":"h2","lines":"2976,2977"}},{"content":"&#x1f501; Strategia","children":[{"content":"<code>task_id</code> per isolare l&apos;esecuzione","children":[],"payload":{"tag":"li","lines":"2991,2992"}},{"content":"log inviati via <code>asyncio.Queue</code>","children":[],"payload":{"tag":"li","lines":"2992,2993"}},{"content":"WebSocket gi&#xe0; esistente (<code>/ws/logs/{task_id}</code>)","children":[],"payload":{"tag":"li","lines":"2993,2995"}}],"payload":{"tag":"h2","lines":"2987,2988"}},{"content":"&#x1f9e0; Step 1 &#x2013; Esecuzione Tofu via subprocess","children":[{"content":"&#x1f527; <code>tasks.py</code> &#x2013; Aggiungi nuova funzione","children":[{"content":"<pre data-lines=\"3001,3043\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/tasks.py (continua)</span>\n\n<span class=\"hljs-meta\">@shared_task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_tofu</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span>, project_path: <span class=\"hljs-built_in\">str</span></span>):\n    queue = get_log_queue(task_id)\n    <span class=\"hljs-keyword\">try</span>:\n        <span class=\"hljs-comment\"># Init</span>\n        process_init = subprocess.Popen(\n            [<span class=\"hljs-string\">&quot;tofu&quot;</span>, <span class=\"hljs-string\">&quot;init&quot;</span>],\n            cwd=project_path,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.STDOUT,\n            text=<span class=\"hljs-literal\">True</span>,\n            bufsize=<span class=\"hljs-number\">1</span>,\n        )\n        <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> process_init.stdout:\n            queue.put_nowait(<span class=\"hljs-string\">f&quot;[init] <span class=\"hljs-subst\">{line.strip()}</span>&quot;</span>)\n\n        process_init.wait()\n\n        <span class=\"hljs-comment\"># Apply</span>\n        process_apply = subprocess.Popen(\n            [<span class=\"hljs-string\">&quot;tofu&quot;</span>, <span class=\"hljs-string\">&quot;apply&quot;</span>, <span class=\"hljs-string\">&quot;-auto-approve&quot;</span>],\n            cwd=project_path,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.STDOUT,\n            text=<span class=\"hljs-literal\">True</span>,\n            bufsize=<span class=\"hljs-number\">1</span>,\n        )\n\n        <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> process_apply.stdout:\n            queue.put_nowait(<span class=\"hljs-string\">f&quot;[apply] <span class=\"hljs-subst\">{line.strip()}</span>&quot;</span>)\n\n        process_apply.wait()\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[exit] code: <span class=\"hljs-subst\">{process_apply.returncode}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[error] <span class=\"hljs-subst\">{<span class=\"hljs-built_in\">str</span>(e)}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">finally</span>:\n        queue.put_nowait(<span class=\"hljs-string\">&quot;[end]&quot;</span>)\n        remove_log_queue(task_id)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3001,3043"}}],"payload":{"tag":"h3","lines":"2999,3000"}}],"payload":{"tag":"h2","lines":"2997,2998"}},{"content":"&#x1f680; Step 2 &#x2013; Nuovo endpoint <code>/run/tofu/</code>","children":[{"content":"&#x1f527; <code>main.py</code>","children":[{"content":"<pre data-lines=\"3050,3060\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/main.py (continua)</span>\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/tofu/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_tofu_handler</span>(<span class=\"hljs-params\">background_tasks: BackgroundTasks</span>):\n    task_id = <span class=\"hljs-built_in\">str</span>(uuid.uuid4())\n    project_path = <span class=\"hljs-string\">&quot;infrastructure/sample&quot;</span>\n    background_tasks.add_task(run_tofu.delay, task_id, project_path)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task_id}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3050,3060"}}],"payload":{"tag":"h3","lines":"3048,3049"}}],"payload":{"tag":"h2","lines":"3046,3047"}},{"content":"&#x1f5a5;&#xfe0f; Step 3 &#x2013; Frontend HTML d&apos;esempio","children":[{"content":"<pre data-lines=\"3067,3085\"><code class=\"language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onclick</span>=<span class=\"hljs-string\">&quot;runTofu()&quot;</span>&gt;</span>Run OpenTofu<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">runTofu</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&quot;/run/tofu/&quot;</span>, { <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span> });\n  <span class=\"hljs-keyword\">const</span> data = <span class=\"hljs-keyword\">await</span> res.<span class=\"hljs-title function_\">json</span>();\n  <span class=\"hljs-title function_\">connectToLogs</span>(data.<span class=\"hljs-property\">task_id</span>);\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">connectToLogs</span>(<span class=\"hljs-params\">taskId</span>) {\n  <span class=\"hljs-keyword\">const</span> socket = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WebSocket</span>(<span class=\"hljs-string\">`ws://localhost:8000/ws/logs/<span class=\"hljs-subst\">&#x24;{taskId}</span>`</span>);\n  socket.<span class=\"hljs-property\">onmessage</span> = <span class=\"hljs-function\">(<span class=\"hljs-params\">event</span>) =&gt;</span> {\n    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;log-output&quot;</span>).<span class=\"hljs-property\">textContent</span> += event.<span class=\"hljs-property\">data</span> + <span class=\"hljs-string\">&quot;\\n&quot;</span>;\n  };\n}\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3067,3085"}}],"payload":{"tag":"h2","lines":"3063,3064"}},{"content":"&#x1f4c2; Esempio <code>main.tf</code>","children":[{"content":"&#x1f527; <code>infrastructure/sample/main.tf</code>","children":[{"content":"<pre data-lines=\"3092,3108\"><code class=\"language-hcl\">terraform {\n  required_providers {\n    local = {\n      source = &quot;hashicorp/local&quot;\n    }\n  }\n}\n\nprovider &quot;local&quot; {}\n\nresource &quot;local_file&quot; &quot;test&quot; {\n  content  = &quot;Hello from OpenTofu&quot;\n  filename = &quot;&#x24;{path.module}/hello.txt&quot;\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3092,3108"}}],"payload":{"tag":"h3","lines":"3090,3091"}}],"payload":{"tag":"h2","lines":"3088,3089"}},{"content":"&#x2705; Verifica: Test completo","children":[{"content":"1. Assicurati di avere <code>tofu</code> installato nel container o nel path.","children":[],"payload":{"tag":"li","lines":"3113,3114","listIndex":1}},{"content":"2. Avvia il backend + Celery worker.","children":[],"payload":{"tag":"li","lines":"3114,3115","listIndex":2}},{"content":"3. Chiama <code>POST /run/tofu/</code> &#x2192; ricevi <code>task_id</code>","children":[],"payload":{"tag":"li","lines":"3115,3116","listIndex":3}},{"content":"4. Connettiti al WebSocket <code>ws://localhost:8000/ws/logs/{task_id}</code>","children":[],"payload":{"tag":"li","lines":"3116,3117","listIndex":4}},{"content":"5. Guarda i log dell&#x2019;invocazione <code>init</code> + <code>apply</code> in tempo reale","children":[],"payload":{"tag":"li","lines":"3117,3119","listIndex":5}}],"payload":{"tag":"h2","lines":"3111,3112"}},{"content":"&#x1f6e0;&#xfe0f; Prossimi miglioramenti (extra)","children":[{"content":"&#x27a1;&#xfe0f; Modulo 3: <strong>UI moderna (Svelte o React)?</strong>","children":[],"payload":{"tag":"h3","lines":"3135,3136"}}],"payload":{"tag":"h2","lines":"3121,3122"}}],"payload":{"tag":"h1","lines":"2964,2965"}},{"content":"&#x2705; Modulo 3 &#x2013; Interfaccia Web con Svelte","children":[{"content":"&#x1f9f1; Stack scelto per il frontend","children":[{"content":"<table data-lines=\"3156,3163\">\n<thead data-lines=\"3156,3157\">\n<tr data-lines=\"3156,3157\">\n<th>Tecnologia</th>\n<th>Ruolo</th>\n</tr>\n</thead>\n<tbody data-lines=\"3158,3163\">\n<tr data-lines=\"3158,3159\">\n<td><a href=\"https://kit.svelte.dev/\">SvelteKit</a></td>\n<td>UI interattiva, routing e SSR</td>\n</tr>\n<tr data-lines=\"3159,3160\">\n<td>TailwindCSS</td>\n<td>UI moderna e responsive</td>\n</tr>\n<tr data-lines=\"3160,3161\">\n<td>Axios / Fetch</td>\n<td>API REST con FastAPI</td>\n</tr>\n<tr data-lines=\"3161,3162\">\n<td>WebSocket API</td>\n<td>Log in realtime</td>\n</tr>\n<tr data-lines=\"3162,3163\">\n<td>Zustand-like Store</td>\n<td>Stato client minimale</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"3156,3163"}}],"payload":{"tag":"h2","lines":"3154,3155"}},{"content":"&#x1f4c1; Struttura del frontend","children":[{"content":"<pre data-lines=\"3168,3183\"><code class=\"language-txt\">frontend/\n&#x251c;&#x2500;&#x2500; src/\n&#x2502;   &#x251c;&#x2500;&#x2500; lib/\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; api.ts                # Funzioni API (run/playbook, tofu, ecc.)\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; websocket.ts          # Log stream WebSocket client\n&#x2502;   &#x251c;&#x2500;&#x2500; routes/\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; +page.svelte          # Dashboard principale\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; playbook/[id]/+page.svelte  # Pagina dettaglio task\n&#x2502;   &#x2514;&#x2500;&#x2500; app.html\n&#x251c;&#x2500;&#x2500; static/\n&#x251c;&#x2500;&#x2500; svelte.config.js\n&#x251c;&#x2500;&#x2500; tailwind.config.js\n&#x2514;&#x2500;&#x2500; package.json\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3168,3183"}}],"payload":{"tag":"h2","lines":"3166,3167"}},{"content":"&#x1f680; Step 1 &#x2013; Setup SvelteKit + Tailwind","children":[{"content":"&#x270f;&#xfe0f; <code>tailwind.config.js</code>","children":[{"content":"<pre data-lines=\"3201,3208\"><code class=\"language-js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = {\n  <span class=\"hljs-attr\">content</span>: [<span class=\"hljs-string\">&apos;./src/**/*.{html,js,svelte,ts}&apos;</span>],\n  <span class=\"hljs-attr\">theme</span>: { <span class=\"hljs-attr\">extend</span>: {} },\n  <span class=\"hljs-attr\">plugins</span>: [],\n};\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3201,3208"}}],"payload":{"tag":"h3","lines":"3199,3200"}},{"content":"&#x270f;&#xfe0f; <code>src/app.css</code>","children":[{"content":"<pre data-lines=\"3211,3216\"><code class=\"language-css\"><span class=\"hljs-keyword\">@tailwind</span> base;\n<span class=\"hljs-keyword\">@tailwind</span> components;\n<span class=\"hljs-keyword\">@tailwind</span> utilities;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3211,3216"}}],"payload":{"tag":"h3","lines":"3209,3210"}},{"content":"&#x270f;&#xfe0f; <code>src/routes/+layout.svelte</code>","children":[{"content":"<pre data-lines=\"3219,3226\"><code class=\"language-svelte\">&lt;script&gt;\n  import &quot;../app.css&quot;;\n&lt;/script&gt;\n\n&lt;slot /&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3219,3226"}}],"payload":{"tag":"h3","lines":"3217,3218"}}],"payload":{"tag":"h2","lines":"3186,3187"}},{"content":"&#x2699;&#xfe0f; Step 2 &#x2013; API client base (<code>lib/api.ts</code>)","children":[{"content":"<pre data-lines=\"3231,3246\"><code class=\"language-ts\"><span class=\"hljs-comment\">// src/lib/api.ts</span>\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">API_BASE</span> = <span class=\"hljs-string\">&quot;http://localhost:8000&quot;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">runPlaybook</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`<span class=\"hljs-subst\">&#x24;{API_BASE}</span>/run/`</span>, { <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span> });\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> res.<span class=\"hljs-title function_\">json</span>(); <span class=\"hljs-comment\">// { task_id: &quot;...&quot; }</span>\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">runTofu</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">`<span class=\"hljs-subst\">&#x24;{API_BASE}</span>/run/tofu/`</span>, { <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span> });\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> res.<span class=\"hljs-title function_\">json</span>(); <span class=\"hljs-comment\">// { task_id: &quot;...&quot; }</span>\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3231,3246"}}],"payload":{"tag":"h2","lines":"3229,3230"}},{"content":"&#x1f50c; Step 3 &#x2013; WebSocket client (<code>lib/websocket.ts</code>)","children":[{"content":"<pre data-lines=\"3251,3268\"><code class=\"language-ts\"><span class=\"hljs-comment\">// src/lib/websocket.ts</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">connectToLogStream</span>(<span class=\"hljs-params\"><span class=\"hljs-attr\">task_id</span>: <span class=\"hljs-built_in\">string</span>, <span class=\"hljs-attr\">onMessage</span>: (line: <span class=\"hljs-built_in\">string</span>) =&gt; <span class=\"hljs-built_in\">void</span></span>) {\n  <span class=\"hljs-keyword\">const</span> ws = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WebSocket</span>(<span class=\"hljs-string\">`ws://localhost:8000/ws/logs/<span class=\"hljs-subst\">&#x24;{task_id}</span>`</span>);\n\n  ws.<span class=\"hljs-property\">onmessage</span> = <span class=\"hljs-function\">(<span class=\"hljs-params\">event</span>) =&gt;</span> {\n    <span class=\"hljs-title function_\">onMessage</span>(event.<span class=\"hljs-property\">data</span>);\n  };\n\n  ws.<span class=\"hljs-property\">onclose</span> = <span class=\"hljs-function\">() =&gt;</span> {\n    <span class=\"hljs-title function_\">onMessage</span>(<span class=\"hljs-string\">&quot;[WebSocket closed]&quot;</span>);\n  };\n\n  <span class=\"hljs-keyword\">return</span> ws;\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3251,3268"}}],"payload":{"tag":"h2","lines":"3249,3250"}},{"content":"&#x1f9ea; Step 4 &#x2013; Pagina principale (<code>routes/+page.svelte</code>)","children":[{"content":"<pre data-lines=\"3273,3311\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { runPlaybook, runTofu } from &apos;&#x24;lib/api&apos;;\n  import { connectToLogStream } from &apos;&#x24;lib/websocket&apos;;\n\n  let logOutput = &quot;&quot;;\n  let currentWs: WebSocket | null = null;\n\n  async function handleRunPlaybook() {\n    const { task_id } = await runPlaybook();\n    startLog(task_id);\n  }\n\n  async function handleRunTofu() {\n    const { task_id } = await runTofu();\n    startLog(task_id);\n  }\n\n  function startLog(task_id: string) {\n    logOutput = `Task ID: &#x24;{task_id}\\n`;\n    currentWs?.close();\n    currentWs = connectToLogStream(task_id, (line) =&gt; {\n      logOutput += line + &quot;\\n&quot;;\n    });\n  }\n&lt;/script&gt;\n\n&lt;main class=&quot;p-6 space-y-4&quot;&gt;\n  &lt;h1 class=&quot;text-2xl font-bold&quot;&gt;InfraFlow Dashboard&lt;/h1&gt;\n\n  &lt;div class=&quot;space-x-2&quot;&gt;\n    &lt;button class=&quot;bg-blue-500 text-white px-4 py-2 rounded&quot; on:click={handleRunPlaybook}&gt;Run Playbook&lt;/button&gt;\n    &lt;button class=&quot;bg-green-600 text-white px-4 py-2 rounded&quot; on:click={handleRunTofu}&gt;Run OpenTofu&lt;/button&gt;\n  &lt;/div&gt;\n\n  &lt;pre class=&quot;bg-black text-green-400 p-4 rounded h-96 overflow-y-auto&quot;&gt;{logOutput}&lt;/pre&gt;\n&lt;/main&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3273,3311"}}],"payload":{"tag":"h2","lines":"3271,3272"}},{"content":"&#x2705; Cosa funziona ora?","children":[{"content":"Pulsante &quot;Run Playbook&quot; &#x2192; chiama <code>/run/</code> e apre WebSocket su <code>/ws/logs/{task_id}</code>","children":[],"payload":{"tag":"li","lines":"3316,3317"}},{"content":"Pulsante &quot;Run OpenTofu&quot; &#x2192; chiama <code>/run/tofu/</code> e stessa logica","children":[],"payload":{"tag":"li","lines":"3317,3318"}},{"content":"I log arrivano in tempo reale sulla UI","children":[],"payload":{"tag":"li","lines":"3318,3319"}},{"content":"Il codice &#xe8; modulare e gi&#xe0; pronto per routing dinamico, miglioramenti, gestione utenti, ecc.","children":[],"payload":{"tag":"li","lines":"3319,3321"}}],"payload":{"tag":"h2","lines":"3314,3315"}},{"content":"&#x1f510; Step 5 (prossimo): Autenticazione GitHub/GitLab","children":[{"content":"OAuth login GitHub o GitLab (<code>fastapi-users</code>)","children":[],"payload":{"tag":"li","lines":"3327,3328"}},{"content":"Limitazioni via ruoli: solo utenti autorizzati possono eseguire playbook","children":[],"payload":{"tag":"li","lines":"3328,3329"}},{"content":"Token salvato nel localStorage / header <code>Authorization</code> nelle API","children":[],"payload":{"tag":"li","lines":"3329,3331"}}],"payload":{"tag":"h2","lines":"3323,3324"}},{"content":"&#x1f4a1; Vuoi estendere?","children":[{"content":"Editor YAML integrato per modificare i playbook prima dell&#x2019;esecuzione","children":[],"payload":{"tag":"li","lines":"3337,3338"}},{"content":"Lista task recenti (con stato, cronologia)","children":[],"payload":{"tag":"li","lines":"3338,3339"}},{"content":"Tab separati (Tofu, Ansible, Logs)","children":[],"payload":{"tag":"li","lines":"3339,3340"}},{"content":"Modalit&#xe0; Dark","children":[],"payload":{"tag":"li","lines":"3340,3341"}},{"content":"Hosting su Codeberg Pages o Vite + nginx","children":[],"payload":{"tag":"li","lines":"3341,3343"}}],"payload":{"tag":"h2","lines":"3333,3334"}},{"content":"&#x1f3af; Obiettivo: Refinamento UI","children":[{"content":"&#x2705; Cosa aggiungiamo ora:","children":[{"content":"1. \n<p data-lines=\"3362,3363\">&#x2705; Interfaccia a schede (tab) per separare:</p>","children":[{"content":"Dashboard","children":[],"payload":{"tag":"li","lines":"3364,3365"}},{"content":"Esecuzione Playbook","children":[],"payload":{"tag":"li","lines":"3365,3366"}},{"content":"Esecuzione OpenTofu","children":[],"payload":{"tag":"li","lines":"3366,3367"}},{"content":"Log Console","children":[],"payload":{"tag":"li","lines":"3367,3369"}}],"payload":{"tag":"li","lines":"3362,3369","listIndex":1}},{"content":"2. \n<p data-lines=\"3369,3370\">&#x2705; Selettore YAML da UI per i playbook disponibili</p>","children":[],"payload":{"tag":"li","lines":"3369,3371","listIndex":2}},{"content":"3. \n<p data-lines=\"3371,3372\">&#x2705; Stato attivit&#xe0; con spinner, stato <code>running</code>/<code>completed</code></p>","children":[],"payload":{"tag":"li","lines":"3371,3373","listIndex":3}},{"content":"4. \n<p data-lines=\"3373,3374\">&#x2705; Dark mode toggle</p>","children":[],"payload":{"tag":"li","lines":"3373,3375","listIndex":4}},{"content":"5. \n<p data-lines=\"3375,3376\">&#x1f9e0; Preparazione per:</p>","children":[{"content":"Login utente","children":[],"payload":{"tag":"li","lines":"3377,3378"}},{"content":"Gestione ruoli","children":[],"payload":{"tag":"li","lines":"3378,3379"}},{"content":"Lista cronologica attivit&#xe0;","children":[],"payload":{"tag":"li","lines":"3379,3381"}}],"payload":{"tag":"li","lines":"3375,3381","listIndex":5}}],"payload":{"tag":"h3","lines":"3360,3361"}}],"payload":{"tag":"h2","lines":"3358,3359"}},{"content":"&#x1f9f1; Struttura rivisitata","children":[{"content":"<pre data-lines=\"3385,3393\"><code class=\"language-txt\">src/routes/\n&#x251c;&#x2500;&#x2500; +layout.svelte       &#x2192; layout comune (es. navbar)\n&#x251c;&#x2500;&#x2500; +layout.ts           &#x2192; setup app-wide (darkmode, auth, ecc.)\n&#x251c;&#x2500;&#x2500; +page.svelte         &#x2192; dashboard (tab interface)\n&#x251c;&#x2500;&#x2500; logs/+page.svelte    &#x2192; log console separata\n&#x2514;&#x2500;&#x2500; settings/+page.svelte &#x2192; preferenze (darkmode, ecc.)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3385,3393"}}],"payload":{"tag":"h2","lines":"3383,3384"}},{"content":"&#x2728; Step 1 &#x2013; Layout con Navbar + Dark Mode","children":[{"content":"<code>+layout.svelte</code>","children":[{"content":"<pre data-lines=\"3400,3424\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { page } from &apos;&#x24;app/stores&apos;;\n  let dark = false;\n\n  function toggleTheme() {\n    dark = !dark;\n    document.documentElement.classList.toggle(&apos;dark&apos;, dark);\n  }\n&lt;/script&gt;\n\n&lt;nav class=&quot;bg-gray-800 text-white p-4 flex justify-between items-center&quot;&gt;\n  &lt;div class=&quot;space-x-4&quot;&gt;\n    &lt;a href=&quot;/&quot; class=&quot;hover:underline&quot;&gt;Dashboard&lt;/a&gt;\n    &lt;a href=&quot;/logs&quot; class=&quot;hover:underline&quot;&gt;Logs&lt;/a&gt;\n    &lt;a href=&quot;/settings&quot; class=&quot;hover:underline&quot;&gt;Settings&lt;/a&gt;\n  &lt;/div&gt;\n  &lt;button on:click={toggleTheme}&gt;&#x1f313;&lt;/button&gt;\n&lt;/nav&gt;\n\n&lt;main class=&quot;p-6 bg-white dark:bg-gray-900 min-h-screen text-black dark:text-white&quot;&gt;\n  &lt;slot /&gt;\n&lt;/main&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3400,3424"}}],"payload":{"tag":"h3","lines":"3398,3399"}},{"content":"Global Tailwind (con dark mode)","children":[{"content":"<pre data-lines=\"3427,3436\"><code class=\"language-js\"><span class=\"hljs-comment\">// tailwind.config.js</span>\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = {\n  <span class=\"hljs-attr\">darkMode</span>: <span class=\"hljs-string\">&apos;class&apos;</span>, <span class=\"hljs-comment\">// &#x2b05;&#xfe0f; important</span>\n  <span class=\"hljs-attr\">content</span>: [<span class=\"hljs-string\">&apos;./src/**/*.{html,js,svelte,ts}&apos;</span>],\n  <span class=\"hljs-attr\">theme</span>: { <span class=\"hljs-attr\">extend</span>: {} },\n  <span class=\"hljs-attr\">plugins</span>: [],\n};\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3427,3436"}}],"payload":{"tag":"h3","lines":"3425,3426"}}],"payload":{"tag":"h2","lines":"3396,3397"}},{"content":"&#x1f9e0; Step 2 &#x2013; Tabbed Dashboard UI","children":[{"content":"<code>+page.svelte</code>","children":[{"content":"<pre data-lines=\"3443,3462\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import PlaybookRunner from &apos;&#x24;lib/PlaybookRunner.svelte&apos;;\n  import TofuRunner from &apos;&#x24;lib/TofuRunner.svelte&apos;;\n\n  let tab = &apos;playbook&apos;;\n&lt;/script&gt;\n\n&lt;div class=&quot;mb-4&quot;&gt;\n  &lt;button class=&quot;px-4 py-2 bg-blue-600 text-white mr-2&quot; on:click={() =&gt; tab = &apos;playbook&apos;}&gt;&#x1f4dc; Ansible&lt;/button&gt;\n  &lt;button class=&quot;px-4 py-2 bg-green-600 text-white&quot; on:click={() =&gt; tab = &apos;tofu&apos;}&gt;&#x1f331; OpenTofu&lt;/button&gt;\n&lt;/div&gt;\n\n{#if tab === &apos;playbook&apos;}\n  &lt;PlaybookRunner /&gt;\n{:else if tab === &apos;tofu&apos;}\n  &lt;TofuRunner /&gt;\n{/if}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3443,3462"}}],"payload":{"tag":"h3","lines":"3441,3442"}}],"payload":{"tag":"h2","lines":"3439,3440"}},{"content":"&#x1f4dc; Step 3 &#x2013; Componenti modulari","children":[{"content":"<code>lib/PlaybookRunner.svelte</code>","children":[{"content":"<pre data-lines=\"3469,3494\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { runPlaybook } from &apos;&#x24;lib/api&apos;;\n  import { connectToLogStream } from &apos;&#x24;lib/websocket&apos;;\n\n  let logs = &quot;&quot;, isRunning = false;\n\n  async function handleRun() {\n    isRunning = true;\n    logs = &quot;&quot;;\n    const { task_id } = await runPlaybook();\n    connectToLogStream(task_id, line =&gt; {\n      logs += line + &apos;\\n&apos;;\n    }).onclose = () =&gt; isRunning = false;\n  }\n&lt;/script&gt;\n\n&lt;div class=&quot;space-y-4&quot;&gt;\n  &lt;button on:click={handleRun} class=&quot;bg-blue-500 px-4 py-2 text-white rounded&quot;&gt;\n    {isRunning ? &quot;Running...&quot; : &quot;Run Playbook&quot;}\n  &lt;/button&gt;\n\n  &lt;pre class=&quot;bg-black text-green-400 p-4 rounded h-96 overflow-y-auto&quot;&gt;{logs}&lt;/pre&gt;\n&lt;/div&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3469,3494"}}],"payload":{"tag":"h3","lines":"3467,3468"}},{"content":"<code>lib/TofuRunner.svelte</code> &#x2013; simile, ma usa <code>runTofu()</code>","children":[],"payload":{"tag":"h3","lines":"3495,3496"}}],"payload":{"tag":"h2","lines":"3465,3466"}},{"content":"&#x1f9e9; Step 4 &#x2013; Logs pagina dedicata","children":[{"content":"<code>routes/logs/+page.svelte</code>","children":[{"content":"<pre data-lines=\"3503,3511\"><code class=\"language-svelte\">&lt;script&gt;\n  // In futuro: mostrare cronologia esecuzioni via API\n&lt;/script&gt;\n\n&lt;h1 class=&quot;text-xl font-bold mb-2&quot;&gt;Logs &amp; History&lt;/h1&gt;\n&lt;p&gt;Qui in futuro ci sar&#xe0; la cronologia delle esecuzioni completate.&lt;/p&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3503,3511"}}],"payload":{"tag":"h3","lines":"3501,3502"}}],"payload":{"tag":"h2","lines":"3499,3500"}},{"content":"&#x1f312; Step 5 &#x2013; Dark Mode persistente (localStorage)","children":[{"content":"<code>+layout.ts</code>","children":[{"content":"<pre data-lines=\"3518,3526\"><code class=\"language-ts\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">load</span> = (<span class=\"hljs-params\"></span>) =&gt; {\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-variable language_\">localStorage</span> !== <span class=\"hljs-string\">&apos;undefined&apos;</span>) {\n    <span class=\"hljs-keyword\">const</span> dark = <span class=\"hljs-variable language_\">localStorage</span>.<span class=\"hljs-title function_\">getItem</span>(<span class=\"hljs-string\">&apos;theme&apos;</span>) === <span class=\"hljs-string\">&apos;dark&apos;</span>;\n    <span class=\"hljs-keyword\">if</span> (dark) <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">documentElement</span>.<span class=\"hljs-property\">classList</span>.<span class=\"hljs-title function_\">add</span>(<span class=\"hljs-string\">&apos;dark&apos;</span>);\n  }\n};\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3518,3526"}}],"payload":{"tag":"h3","lines":"3516,3517"}}],"payload":{"tag":"h2","lines":"3514,3515"}},{"content":"&#x1f3af; Risultato finale","children":[{"content":"<table data-lines=\"3531,3542\">\n<thead data-lines=\"3531,3532\">\n<tr data-lines=\"3531,3532\">\n<th>Funzione</th>\n<th>Stato</th>\n</tr>\n</thead>\n<tbody data-lines=\"3533,3542\">\n<tr data-lines=\"3533,3534\">\n<td>UI a schede</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3534,3535\">\n<td>Log realtime</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3535,3536\">\n<td>Run Playbook</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3536,3537\">\n<td>Run Tofu</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3537,3538\">\n<td>Dark Mode</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3538,3539\">\n<td>Moduli separati</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3539,3540\">\n<td>Cronologia Logs</td>\n<td>&#x1f7e1; Strutturata, da implementare</td>\n</tr>\n<tr data-lines=\"3540,3541\">\n<td>Editor YAML inline</td>\n<td>&#x1f51c; Prossimo step</td>\n</tr>\n<tr data-lines=\"3541,3542\">\n<td>Autenticazione OAuth</td>\n<td>&#x1f51c; Modulo 4</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"3531,3542"}}],"payload":{"tag":"h2","lines":"3529,3530"}},{"content":"&#x2728; Prossimi miglioramenti UI (se vuoi):","children":[{"content":"","children":[{"content":"Editor YAML online (con Monaco o CodeMirror)","children":[],"payload":{"tag":"li","lines":"3547,3548"}},{"content":"Upload di file <code>.yml</code> / <code>.tf</code>","children":[],"payload":{"tag":"li","lines":"3548,3549"}},{"content":"Gestione variabili da UI","children":[],"payload":{"tag":"li","lines":"3549,3550"}},{"content":"Modalit&#xe0; split log/output","children":[],"payload":{"tag":"li","lines":"3550,3551"}},{"content":"Notifiche Toast per successo/errore","children":[],"payload":{"tag":"li","lines":"3551,3553"}}],"payload":{"tag":"ul","lines":"3547,3553"}},{"content":"","children":[{"content":"1. Procedere con <strong>Modulo 4: Autenticazione GitHub/GitLab</strong>","children":[],"payload":{"tag":"li","lines":"3557,3558","listIndex":1}},{"content":"2. Continuare con <strong>Cronologia attivit&#xe0; + database</strong>","children":[],"payload":{"tag":"li","lines":"3558,3559","listIndex":2}},{"content":"3. Integrare <strong>editor YAML/TF da browser</strong>","children":[],"payload":{"tag":"li","lines":"3559,3561","listIndex":3}}],"payload":{"tag":"ol","lines":"3557,3561"}}],"payload":{"tag":"h2","lines":"3545,3546"}}],"payload":{"tag":"h1","lines":"3148,3149"}},{"content":"&#x1f9e0; Obiettivo","children":[{"content":"&#x1f9f1; Stack frontend aggiornato","children":[{"content":"<table data-lines=\"3589,3597\">\n<thead data-lines=\"3589,3590\">\n<tr data-lines=\"3589,3590\">\n<th>Tecnologia</th>\n<th>Scopo</th>\n</tr>\n</thead>\n<tbody data-lines=\"3591,3597\">\n<tr data-lines=\"3591,3592\">\n<td><strong>SvelteKit</strong></td>\n<td>Framework UI moderno (routing + SSR)</td>\n</tr>\n<tr data-lines=\"3592,3593\">\n<td><strong>TailwindCSS</strong></td>\n<td>Styling rapido e dark mode</td>\n</tr>\n<tr data-lines=\"3593,3594\">\n<td><strong>Monaco Editor</strong></td>\n<td>Editing YAML/TF con syntax highlight</td>\n</tr>\n<tr data-lines=\"3594,3595\">\n<td><strong>Socket/WebSocket</strong></td>\n<td>Log realtime</td>\n</tr>\n<tr data-lines=\"3595,3596\">\n<td><strong>SweetAlert2</strong></td>\n<td>Notifiche toast moderne</td>\n</tr>\n<tr data-lines=\"3596,3597\">\n<td><strong>localStorage</strong></td>\n<td>Persistenza dark mode &amp; settings</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"3589,3597"}}],"payload":{"tag":"h2","lines":"3587,3588"}}],"payload":{"tag":"h1","lines":"3572,3573"}},{"content":"&#x2705; Funzionalit&#xe0;: Come vengono implementate","children":[{"content":"&#x1f4c1; Esempio struttura frontend aggiornata","children":[{"content":"<pre data-lines=\"3796,3818\"><code class=\"language-txt\">frontend/\n&#x251c;&#x2500;&#x2500; src/\n&#x2502;   &#x251c;&#x2500;&#x2500; lib/\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; api.ts\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; websocket.ts\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; components/\n&#x2502;   &#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; Editor.svelte\n&#x2502;   &#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; PlaybookRunner.svelte\n&#x2502;   &#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; TofuRunner.svelte\n&#x2502;   &#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; SplitRunner.svelte\n&#x2502;   &#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; RecentTasks.svelte\n&#x2502;   &#x251c;&#x2500;&#x2500; routes/\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; +layout.svelte\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; +page.svelte\n&#x2502;   &#x2502;   &#x251c;&#x2500;&#x2500; logs/+page.svelte\n&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; settings/+page.svelte\n&#x251c;&#x2500;&#x2500; static/\n&#x251c;&#x2500;&#x2500; tailwind.config.js\n&#x251c;&#x2500;&#x2500; package.json\n&#x2514;&#x2500;&#x2500; vite.config.js\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3796,3818"}}],"payload":{"tag":"h2","lines":"3794,3795"}},{"content":"&#x2705; Progresso funzionalit&#xe0;","children":[{"content":"<table data-lines=\"3823,3834\">\n<thead data-lines=\"3823,3824\">\n<tr data-lines=\"3823,3824\">\n<th>Funzionalit&#xe0;</th>\n<th>Stato</th>\n</tr>\n</thead>\n<tbody data-lines=\"3825,3834\">\n<tr data-lines=\"3825,3826\">\n<td>Editor YAML integrato</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3826,3827\">\n<td>Upload file <code>.yml</code> / <code>.tf</code></td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3827,3828\">\n<td>Gestione variabili UI</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3828,3829\">\n<td>Modalit&#xe0; split log/output</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3829,3830\">\n<td>Notifiche toast</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3830,3831\">\n<td>Lista task recenti</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3831,3832\">\n<td>Tab UI Playbook/Tofu/Log</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3832,3833\">\n<td>Modalit&#xe0; Dark</td>\n<td>&#x2705; Completato</td>\n</tr>\n<tr data-lines=\"3833,3834\">\n<td>Hosting statico (Vite / nginx / Codeberg)</td>\n<td>&#x2705; Pronto</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"3823,3834"}}],"payload":{"tag":"h2","lines":"3821,3822"}},{"content":"&#x1f51c; Prossimi moduli (se vuoi):","children":[{"content":"","children":[{"content":"1. &#x1f510; <strong>Modulo 4 &#x2013; Autenticazione OAuth GitHub/GitLab</strong>","children":[],"payload":{"tag":"li","lines":"3839,3840","listIndex":1}},{"content":"2. &#x1f9e0; <strong>Modulo 5 &#x2013; Backend DB per task &amp; cronologia</strong>","children":[],"payload":{"tag":"li","lines":"3840,3841","listIndex":2}},{"content":"3. &#x1f4e6; <strong>Modulo 6 &#x2013; Packaging Helm + K8s deployment</strong>","children":[],"payload":{"tag":"li","lines":"3841,3843","listIndex":3}}],"payload":{"tag":"ol","lines":"3839,3843"}},{"content":"","children":[{"content":"<strong>Modulo 4: Autenticazione GitHub / GitLab (OAuth2)</strong>","children":[],"payload":{"tag":"li","lines":"3856,3857"}},{"content":"<strong>Modulo 5: Backend DB per task &amp; cronologia</strong>","children":[],"payload":{"tag":"li","lines":"3857,3859"}}],"payload":{"tag":"ul","lines":"3856,3859"}}],"payload":{"tag":"h2","lines":"3837,3838"}},{"content":"Design ad alto livello: autenticazione + cronologia task","children":[{"content":"Concetti chiave","children":[{"content":"1. <strong>Utenti/Account</strong> &#x2013; identit&#xe0; legata a GitHub / GitLab tramite OAuth2.","children":[],"payload":{"tag":"li","lines":"3867,3868","listIndex":1}},{"content":"2. <strong>Ruoli / permessi</strong> &#x2013; ad esempio <code>admin</code>, <code>user</code>, <code>readonly</code>, per controllare chi pu&#xf2; lanciare playbook / tofu.","children":[],"payload":{"tag":"li","lines":"3868,3869","listIndex":2}},{"content":"3. <strong>Task / ExecutionLog</strong> &#x2013; ogni esecuzione di playbook/tofu &#xe8; un record nel DB: id, tipo, stato (<code>pending</code>, <code>running</code>, <code>success</code>, <code>failure</code>), timestamp, utente che l&#x2019;ha avviato, log path o puntatore a storage.","children":[],"payload":{"tag":"li","lines":"3869,3870","listIndex":3}},{"content":"4. <strong>Endpoint protetti</strong> &#x2013; solo utenti autenticati con certo ruolo possono chiamare <code>/run/</code>, <code>/run/tofu/</code> etc.","children":[],"payload":{"tag":"li","lines":"3870,3871","listIndex":4}},{"content":"5. <strong>WebSocket + DB sincronizzazione</strong> &#x2013; al termine del task, aggiorna lo stato nel DB, memorizza log o metadati.","children":[],"payload":{"tag":"li","lines":"3871,3873","listIndex":5}}],"payload":{"tag":"h3","lines":"3865,3866"}}],"payload":{"tag":"h2","lines":"3863,3864"}},{"content":"Scelta tecnologia per persistenza","children":[{"content":"<strong>SQLAlchemy 1.4+ / SQLModel</strong> oppure uso diretto di SQLAlchemy ORM + Pydantic per modelli.","children":[],"payload":{"tag":"li","lines":"3877,3878"}},{"content":"<strong>Database</strong>: SQLite per prototipo, PostgreSQL in produzione.","children":[],"payload":{"tag":"li","lines":"3878,3879"}},{"content":"<strong>Sessioni asincrone</strong> (AsyncSession) per compatibilit&#xe0; con FastAPI.","children":[],"payload":{"tag":"li","lines":"3879,3881"}}],"payload":{"tag":"h2","lines":"3875,3876"}},{"content":"Struttura del backend aggiornata","children":[{"content":"<pre data-lines=\"3887,3903\"><code data-lines=\"3887,3903\">backend/\n&#x251c;&#x2500;&#x2500; app/\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-tag\">main</span><span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; auth<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; models<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; schemas<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; crud<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; tasks<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; websocket<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; log_queue<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; config<span class=\"hljs-selector-class\">.py</span>\n&#x251c;&#x2500;&#x2500; requirements<span class=\"hljs-selector-class\">.txt</span>\n&#x2514;&#x2500;&#x2500; tests/\n    &#x2514;&#x2500;&#x2500; test_auth_task<span class=\"hljs-selector-class\">.py</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3887,3903"}}],"payload":{"tag":"h2","lines":"3885,3886"}},{"content":"Codice di esempio","children":[{"content":"<code>requirements.txt</code>","children":[{"content":"<pre data-lines=\"3910,3921\"><code class=\"language-text\">fastapi\nuvicorn[standard]\ncelery\nredis\nsqlalchemy&gt;=1.4\nasyncpg\nfastapi-users[sqlalchemy, oauth]\npython-dotenv\nhttpx\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3910,3921"}}],"payload":{"tag":"h3","lines":"3908,3909"}},{"content":"<code>config.py</code>","children":[{"content":"<pre data-lines=\"3924,3935\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">from</span> dotenv <span class=\"hljs-keyword\">import</span> load_dotenv\n\nload_dotenv()\n\nDATABASE_URL = os.getenv(<span class=\"hljs-string\">&quot;DATABASE_URL&quot;</span>, <span class=\"hljs-string\">&quot;postgresql+asyncpg://user:pass@db:5432/infraflow&quot;</span>)\nSECRET = os.getenv(<span class=\"hljs-string\">&quot;SECRET_KEY&quot;</span>, <span class=\"hljs-string\">&quot;supersecretkey&quot;</span>)\nGITHUB_CLIENT_ID = os.getenv(<span class=\"hljs-string\">&quot;GITHUB_CLIENT_ID&quot;</span>, <span class=\"hljs-string\">&quot;&quot;</span>)\nGITHUB_CLIENT_SECRET = os.getenv(<span class=\"hljs-string\">&quot;GITHUB_CLIENT_SECRET&quot;</span>, <span class=\"hljs-string\">&quot;&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3924,3935"}}],"payload":{"tag":"h3","lines":"3922,3923"}},{"content":"<code>models.py</code>","children":[{"content":"<pre data-lines=\"3938,3981\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> sqlalchemy <span class=\"hljs-keyword\">import</span> Column, String, Integer, DateTime, ForeignKey, func, Enum\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> relationship\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.declarative <span class=\"hljs-keyword\">import</span> declarative_base\n<span class=\"hljs-keyword\">import</span> enum\n\nBase = declarative_base()\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">RoleEnum</span>(<span class=\"hljs-built_in\">str</span>, enum.Enum):\n    admin = <span class=\"hljs-string\">&quot;admin&quot;</span>\n    user = <span class=\"hljs-string\">&quot;user&quot;</span>\n    viewer = <span class=\"hljs-string\">&quot;viewer&quot;</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(<span class=\"hljs-title class_ inherited__\">Base</span>):\n    __tablename__ = <span class=\"hljs-string\">&quot;user&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    email = Column(String, unique=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>, nullable=<span class=\"hljs-literal\">False</span>)\n    hashed_password = Column(String, nullable=<span class=\"hljs-literal\">True</span>)\n    is_active = Column(Integer, default=<span class=\"hljs-number\">1</span>)\n    role = Column(Enum(RoleEnum), default=RoleEnum.user)\n\n    oauth_accounts = relationship(<span class=\"hljs-string\">&quot;OAuthAccount&quot;</span>, back_populates=<span class=\"hljs-string\">&quot;user&quot;</span>)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OAuthAccount</span>(<span class=\"hljs-title class_ inherited__\">Base</span>):\n    __tablename__ = <span class=\"hljs-string\">&quot;oauth_account&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    user_id = Column(Integer, ForeignKey(<span class=\"hljs-string\">&quot;user.id&quot;</span>, ondelete=<span class=\"hljs-string\">&quot;cascade&quot;</span>), nullable=<span class=\"hljs-literal\">False</span>)\n    oauth_name = Column(String, nullable=<span class=\"hljs-literal\">False</span>)  <span class=\"hljs-comment\"># e.g. &quot;github&quot;, &quot;gitlab&quot;</span>\n    oauth_account_id = Column(String, nullable=<span class=\"hljs-literal\">False</span>)\n    user = relationship(<span class=\"hljs-string\">&quot;User&quot;</span>, back_populates=<span class=\"hljs-string\">&quot;oauth_accounts&quot;</span>)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TaskRecord</span>(<span class=\"hljs-title class_ inherited__\">Base</span>):\n    __tablename__ = <span class=\"hljs-string\">&quot;task_record&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    task_id = Column(String, unique=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    <span class=\"hljs-built_in\">type</span> = Column(String)  <span class=\"hljs-comment\"># &quot;ansible&quot; or &quot;tofu&quot;</span>\n    status = Column(String, default=<span class=\"hljs-string\">&quot;pending&quot;</span>)\n    user_id = Column(Integer, ForeignKey(<span class=\"hljs-string\">&quot;user.id&quot;</span>, ondelete=<span class=\"hljs-string\">&quot;set null&quot;</span>))\n    created_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), server_default=func.now())\n    finished_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), nullable=<span class=\"hljs-literal\">True</span>)\n\n    user = relationship(<span class=\"hljs-string\">&quot;User&quot;</span>, backref=<span class=\"hljs-string\">&quot;tasks&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3938,3981"}}],"payload":{"tag":"h3","lines":"3936,3937"}},{"content":"<code>schemas.py</code>","children":[{"content":"<pre data-lines=\"3984,4006\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseModel\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">Optional</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-built_in\">id</span>: <span class=\"hljs-built_in\">int</span>\n    email: <span class=\"hljs-built_in\">str</span>\n    role: <span class=\"hljs-built_in\">str</span>\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TaskRecordRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    task_id: <span class=\"hljs-built_in\">str</span>\n    <span class=\"hljs-built_in\">type</span>: <span class=\"hljs-built_in\">str</span>\n    status: <span class=\"hljs-built_in\">str</span>\n    user_id: <span class=\"hljs-type\">Optional</span>[<span class=\"hljs-built_in\">int</span>]\n    created_at: datetime\n    finished_at: <span class=\"hljs-type\">Optional</span>[datetime]\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3984,4006"}}],"payload":{"tag":"h3","lines":"3982,3983"}},{"content":"<code>crud.py</code>","children":[{"content":"<pre data-lines=\"4009,4037\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession\n<span class=\"hljs-keyword\">from</span> sqlalchemy.future <span class=\"hljs-keyword\">import</span> select\n<span class=\"hljs-keyword\">from</span> . <span class=\"hljs-keyword\">import</span> models\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">create_task_record</span>(<span class=\"hljs-params\">db: AsyncSession, task_id: <span class=\"hljs-built_in\">str</span>, type_: <span class=\"hljs-built_in\">str</span>, user_id: <span class=\"hljs-built_in\">int</span></span>):\n    rec = models.TaskRecord(task_id=task_id, <span class=\"hljs-built_in\">type</span>=type_, user_id=user_id)\n    db.add(rec)\n    <span class=\"hljs-keyword\">await</span> db.commit()\n    <span class=\"hljs-keyword\">await</span> db.refresh(rec)\n    <span class=\"hljs-keyword\">return</span> rec\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">update_task_status</span>(<span class=\"hljs-params\">db: AsyncSession, task_id: <span class=\"hljs-built_in\">str</span>, status: <span class=\"hljs-built_in\">str</span></span>):\n    q = <span class=\"hljs-keyword\">await</span> db.execute(select(models.TaskRecord).<span class=\"hljs-built_in\">filter</span>(models.TaskRecord.task_id == task_id))\n    rec = q.scalars().first()\n    <span class=\"hljs-keyword\">if</span> rec:\n        rec.status = status\n        <span class=\"hljs-keyword\">if</span> status <span class=\"hljs-keyword\">in</span> (<span class=\"hljs-string\">&quot;success&quot;</span>, <span class=\"hljs-string\">&quot;failure&quot;</span>):\n            <span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n            rec.finished_at = datetime.utcnow()\n        <span class=\"hljs-keyword\">await</span> db.commit()\n        <span class=\"hljs-keyword\">await</span> db.refresh(rec)\n    <span class=\"hljs-keyword\">return</span> rec\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">list_tasks</span>(<span class=\"hljs-params\">db: AsyncSession, limit: <span class=\"hljs-built_in\">int</span> = <span class=\"hljs-number\">20</span></span>):\n    q = <span class=\"hljs-keyword\">await</span> db.execute(select(models.TaskRecord).order_by(models.TaskRecord.created_at.desc()).limit(limit))\n    <span class=\"hljs-keyword\">return</span> q.scalars().<span class=\"hljs-built_in\">all</span>()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4009,4037"}}],"payload":{"tag":"h3","lines":"4007,4008"}},{"content":"<code>auth.py</code>","children":[{"content":"<pre data-lines=\"4040,4118\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> Depends, HTTPException\n<span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> FastAPIUsers, models <span class=\"hljs-keyword\">as</span> fa_models\n<span class=\"hljs-keyword\">from</span> fastapi_users.db <span class=\"hljs-keyword\">import</span> SQLAlchemyUserDatabase, SQLAlchemyBaseOAuthAccountTable\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> JWTStrategy\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> AuthenticationBackend\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> BearerTransport\n<span class=\"hljs-keyword\">from</span> fastapi_users.oauth <span class=\"hljs-keyword\">import</span> OAuthAccount\n<span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> schemas <span class=\"hljs-keyword\">as</span> fa_schemas\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession, create_async_engine\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> sessionmaker\n<span class=\"hljs-keyword\">from</span> .config <span class=\"hljs-keyword\">import</span> SECRET, GITHUB_CLIENT_ID, GITHUB_CLIENT_SECRET\n<span class=\"hljs-keyword\">from</span> .models <span class=\"hljs-keyword\">import</span> Base, User, OAuthAccount <span class=\"hljs-keyword\">as</span> AppOAuthAccount\n<span class=\"hljs-keyword\">from</span> .config <span class=\"hljs-keyword\">import</span> DATABASE_URL\n<span class=\"hljs-keyword\">import</span> os\n\n<span class=\"hljs-comment\"># DB setup</span>\nengine = create_async_engine(DATABASE_URL, echo=<span class=\"hljs-literal\">True</span>)\nasync_session = sessionmaker(engine, expire_on_commit=<span class=\"hljs-literal\">False</span>, class_=AsyncSession)\n\n<span class=\"hljs-comment\"># User models</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(models.BaseUser):\n    role: <span class=\"hljs-built_in\">str</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserCreate</span>(models.BaseUserCreate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserUpdate</span>(models.BaseUserUpdate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserDB</span>(models.BaseUserDB, models.Base):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OAuthAccountModel</span>(SQLAlchemyBaseOAuthAccountTable[<span class=\"hljs-built_in\">int</span>], Base):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-comment\"># Instantiate user DB adapter</span>\nuser_db = SQLAlchemyUserDatabase(UserDB, async_session, OAuthAccountModel)\n\n<span class=\"hljs-comment\"># JWT auth backend</span>\nbearer_transport = BearerTransport(tokenUrl=<span class=\"hljs-string\">&quot;auth/jwt/login&quot;</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_jwt_strategy</span>() -&gt; JWTStrategy:\n    <span class=\"hljs-keyword\">return</span> JWTStrategy(secret=SECRET, lifetime_seconds=<span class=\"hljs-number\">3600</span>)\n\nauth_backend = AuthenticationBackend(\n    name=<span class=\"hljs-string\">&quot;jwt&quot;</span>,\n    transport=bearer_transport,\n    get_strategy=get_jwt_strategy,\n)\n\nfastapi_users = FastAPIUsers(\n    user_db,\n    [auth_backend],\n    User,\n    UserCreate,\n    UserUpdate,\n    UserDB,\n)\n\n<span class=\"hljs-comment\"># Routers to include</span>\ncurrent_active_user = fastapi_users.current_user(active=<span class=\"hljs-literal\">True</span>)\noauth_router = fastapi_users.get_oauth_router(\n    client_id=GITHUB_CLIENT_ID,\n    client_secret=GITHUB_CLIENT_SECRET,\n    name=<span class=\"hljs-string\">&quot;github&quot;</span>,\n    after_login=<span class=\"hljs-keyword\">lambda</span> user, token: user,\n)\n\njwt_router = fastapi_users.get_auth_router(auth_backend)\n\n<span class=\"hljs-comment\"># Dependable that returns user or raises</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">require_admin</span>(<span class=\"hljs-params\">user=Depends(<span class=\"hljs-params\">current_active_user</span>)</span>):\n    <span class=\"hljs-keyword\">from</span> .models <span class=\"hljs-keyword\">import</span> RoleEnum\n    <span class=\"hljs-keyword\">if</span> user.role != RoleEnum.admin.value:\n        <span class=\"hljs-keyword\">raise</span> HTTPException(status_code=<span class=\"hljs-number\">403</span>, detail=<span class=\"hljs-string\">&quot;Not allowed&quot;</span>)\n    <span class=\"hljs-keyword\">return</span> user\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4040,4118"}}],"payload":{"tag":"h3","lines":"4038,4039"}},{"content":"<code>main.py</code> &#x2013; integrazione autentificazione","children":[{"content":"<pre data-lines=\"4121,4187\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI, Depends\n<span class=\"hljs-keyword\">from</span> .auth <span class=\"hljs-keyword\">import</span> fastapi_users, oauth_router, jwt_router, current_active_user\n<span class=\"hljs-keyword\">from</span> .tasks <span class=\"hljs-keyword\">import</span> run_playbook, run_tofu\n<span class=\"hljs-keyword\">from</span> .websocket <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> websocket_router\n<span class=\"hljs-keyword\">from</span> .crud <span class=\"hljs-keyword\">import</span> create_task_record, update_task_status, list_tasks\n<span class=\"hljs-keyword\">from</span> .config <span class=\"hljs-keyword\">import</span> SECRET\n<span class=\"hljs-keyword\">from</span> fastapi.middleware.cors <span class=\"hljs-keyword\">import</span> CORSMiddleware\n<span class=\"hljs-keyword\">import</span> uuid\n\napp = FastAPI()\n\napp.include_router(jwt_router, prefix=<span class=\"hljs-string\">&quot;/auth/jwt&quot;</span>, tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>])\napp.include_router(oauth_router, prefix=<span class=\"hljs-string\">&quot;/auth/github&quot;</span>, tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>])\napp.include_router(websocket_router)\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_credentials=<span class=\"hljs-literal\">True</span>,\n    allow_methods=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_headers=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook_endpoint</span>(<span class=\"hljs-params\">user=Depends(<span class=\"hljs-params\">current_active_user</span>)</span>):\n    task_id = <span class=\"hljs-built_in\">str</span>(uuid.uuid4())\n    <span class=\"hljs-comment\"># registra prima che parta</span>\n    <span class=\"hljs-keyword\">from</span> .database <span class=\"hljs-keyword\">import</span> get_db\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> get_db() <span class=\"hljs-keyword\">as</span> db:\n        <span class=\"hljs-keyword\">await</span> create_task_record(db, task_id, <span class=\"hljs-string\">&quot;ansible&quot;</span>, user.<span class=\"hljs-built_in\">id</span>)\n    <span class=\"hljs-comment\"># esecuzione in background</span>\n    run_playbook.delay(task_id, <span class=\"hljs-string\">&quot;examples/playbook-sample.yml&quot;</span>)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task_id}\n\n<span class=\"hljs-meta\">@app.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/tofu/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_tofu_endpoint</span>(<span class=\"hljs-params\">user=Depends(<span class=\"hljs-params\">current_active_user</span>)</span>):\n    task_id = <span class=\"hljs-built_in\">str</span>(uuid.uuid4())\n    <span class=\"hljs-keyword\">from</span> .database <span class=\"hljs-keyword\">import</span> get_db\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> get_db() <span class=\"hljs-keyword\">as</span> db:\n        <span class=\"hljs-keyword\">await</span> create_task_record(db, task_id, <span class=\"hljs-string\">&quot;tofu&quot;</span>, user.<span class=\"hljs-built_in\">id</span>)\n    run_tofu.delay(task_id, <span class=\"hljs-string\">&quot;infrastructure/sample&quot;</span>)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;task_id&quot;</span>: task_id}\n\n<span class=\"hljs-meta\">@app.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/tasks/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_tasks</span>(<span class=\"hljs-params\">user=Depends(<span class=\"hljs-params\">current_active_user</span>)</span>):\n    <span class=\"hljs-keyword\">from</span> .database <span class=\"hljs-keyword\">import</span> get_db\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> get_db() <span class=\"hljs-keyword\">as</span> db:\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> list_tasks(db)\n\n<span class=\"hljs-comment\"># Quando log queue segnala &#x201c;end&#x201d;, possiamo aggiornare stato</span>\n<span class=\"hljs-comment\"># Puoi usare signal task_complete, o patch run_playbook / run_tofu</span>\n\n<span class=\"hljs-comment\"># At startup, crea tabelle</span>\n<span class=\"hljs-keyword\">from</span> .models <span class=\"hljs-keyword\">import</span> Base\n<span class=\"hljs-keyword\">from</span> .config <span class=\"hljs-keyword\">import</span> DATABASE_URL\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> create_async_engine\n<span class=\"hljs-keyword\">from</span> sqlalchemy <span class=\"hljs-keyword\">import</span> select\n\n<span class=\"hljs-meta\">@app.on_event(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;startup&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">on_startup</span>():\n    <span class=\"hljs-keyword\">from</span> sqlalchemy.engine <span class=\"hljs-keyword\">import</span> Engine\n    engine = create_async_engine(DATABASE_URL)\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> engine.begin() <span class=\"hljs-keyword\">as</span> conn:\n        <span class=\"hljs-keyword\">await</span> conn.run_sync(Base.metadata.create_all)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4121,4187"}}],"payload":{"tag":"h3","lines":"4119,4120"}},{"content":"<code>database.py</code>","children":[{"content":"<pre data-lines=\"4190,4202\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> .config <span class=\"hljs-keyword\">import</span> DATABASE_URL\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> create_async_engine, AsyncSession\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> sessionmaker\n\nengine = create_async_engine(DATABASE_URL, echo=<span class=\"hljs-literal\">True</span>)\nAsyncSessionLocal = sessionmaker(engine, class_=AsyncSession, expire_on_commit=<span class=\"hljs-literal\">False</span>)\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_db</span>():\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> AsyncSessionLocal() <span class=\"hljs-keyword\">as</span> session:\n        <span class=\"hljs-keyword\">yield</span> session\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4190,4202"}}],"payload":{"tag":"h3","lines":"4188,4189"}},{"content":"Estendere <code>tasks.py</code> per aggiornare DB","children":[{"content":"<pre data-lines=\"4205,4241\"><code class=\"language-python\"><span class=\"hljs-comment\"># backend/tasks.py (modifica run_playbook e run_tofu)</span>\n<span class=\"hljs-keyword\">from</span> .crud <span class=\"hljs-keyword\">import</span> update_task_status\n<span class=\"hljs-keyword\">from</span> .database <span class=\"hljs-keyword\">import</span> AsyncSessionLocal\n<span class=\"hljs-keyword\">import</span> asyncio\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">update_status_sync</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span>, status: <span class=\"hljs-built_in\">str</span></span>):\n    <span class=\"hljs-comment\"># helper per chiamare crud.update_task_status in contesto async</span>\n    <span class=\"hljs-keyword\">import</span> asyncio\n    loop = asyncio.get_event_loop()\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">_upd</span>():\n        <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> AsyncSessionLocal() <span class=\"hljs-keyword\">as</span> db:\n            <span class=\"hljs-keyword\">await</span> update_task_status(db, task_id, status)\n    loop.create_task(_upd())\n\n<span class=\"hljs-meta\">@shared_task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>(<span class=\"hljs-params\">task_id: <span class=\"hljs-built_in\">str</span>, playbook_path: <span class=\"hljs-built_in\">str</span></span>):\n    update_status_sync(task_id, <span class=\"hljs-string\">&quot;running&quot;</span>)\n    queue = get_log_queue(task_id)\n    <span class=\"hljs-keyword\">try</span>:\n        process = subprocess.Popen([...])\n        <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> process.stdout:\n            queue.put_nowait(line.strip())\n        process.wait()\n        <span class=\"hljs-keyword\">if</span> process.returncode == <span class=\"hljs-number\">0</span>:\n            update_status_sync(task_id, <span class=\"hljs-string\">&quot;success&quot;</span>)\n        <span class=\"hljs-keyword\">else</span>:\n            update_status_sync(task_id, <span class=\"hljs-string\">&quot;failure&quot;</span>)\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[exit] code: <span class=\"hljs-subst\">{process.returncode}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        update_status_sync(task_id, <span class=\"hljs-string\">&quot;failure&quot;</span>)\n        queue.put_nowait(<span class=\"hljs-string\">f&quot;[error] <span class=\"hljs-subst\">{<span class=\"hljs-built_in\">str</span>(e)}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">finally</span>:\n        queue.put_nowait(<span class=\"hljs-string\">&quot;[end]&quot;</span>)\n        remove_log_queue(task_id)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4205,4241"}}],"payload":{"tag":"h3","lines":"4203,4204"}}],"payload":{"tag":"h2","lines":"3906,3907"}},{"content":"Punti da affinare / note","children":[{"content":"\n<p data-lines=\"4246,4247\">La libreria <strong>FastAPI Users</strong> offre supporto OAuth2 integrato con backend SQLAlchemy. (<a href=\"https://fastapi-users.github.io/fastapi-users/9.3/configuration/oauth/?utm_source=chatgpt.com\" title=\"OAuth2 - FastAPI Users\">FastAPI Users</a>)</p>","children":[],"payload":{"tag":"li","lines":"4246,4247"}},{"content":"\n<p data-lines=\"4247,4248\">Ho semplificato molte parti per chiarezza, ma in un sistema reale serve:</p>","children":[{"content":"Gestione errori robusta","children":[],"payload":{"tag":"li","lines":"4249,4250"}},{"content":"Timeout, retry, rollback","children":[],"payload":{"tag":"li","lines":"4250,4251"}},{"content":"Validazione input","children":[],"payload":{"tag":"li","lines":"4251,4252"}},{"content":"Controlli di sicurezza (CORS, CSRF, scoping)","children":[],"payload":{"tag":"li","lines":"4252,4253"}},{"content":"Sicurezza nei WebSocket (verifica token, autenticazione)","children":[],"payload":{"tag":"li","lines":"4253,4255"}}],"payload":{"tag":"li","lines":"4247,4255"}}],"payload":{"tag":"h2","lines":"4244,4245"}},{"content":"&#x1f3af; Frontend: Autenticazione, protezione, visualizzazione utente","children":[{"content":"&#x1f527; Dipendenze da installare","children":[{"content":"<pre data-lines=\"4277,4282\"><code class=\"language-bash\">npm install @auth/core @auth/sveltekit\nnpm install axios\nnpm install svelte-toastify\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4277,4282"}}],"payload":{"tag":"h3","lines":"4273,4274"}}],"payload":{"tag":"h2","lines":"4271,4272"}},{"content":"&#x1f9f1; Struttura modificata del frontend","children":[{"content":"<pre data-lines=\"4293,4317\"><code data-lines=\"4293,4317\">src<span class=\"hljs-symbol\">/</span>\n&#x251c;&#x2500;&#x2500; lib<span class=\"hljs-symbol\">/</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; api.ts\n&#x2502;   &#x251c;&#x2500;&#x2500; websocket.ts\n&#x2502;   &#x251c;&#x2500;&#x2500; auth.ts        <span class=\"hljs-comment\"># funzioni auth client</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; components<span class=\"hljs-symbol\">/</span>\n&#x2502;       &#x251c;&#x2500;&#x2500; Editor.svelte\n&#x2502;       &#x251c;&#x2500;&#x2500; PlaybookRunner.svelte\n&#x2502;       &#x251c;&#x2500;&#x2500; TofuRunner.svelte\n&#x2502;       &#x251c;&#x2500;&#x2500; SplitRunner.svelte\n&#x2502;       &#x251c;&#x2500;&#x2500; RecentTasks.svelte\n&#x2502;       &#x251c;&#x2500;&#x2500; Login.svelte\n&#x2502;       &#x2514;&#x2500;&#x2500; NavBar.svelte\n&#x251c;&#x2500;&#x2500; routes<span class=\"hljs-symbol\">/</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-operator\">+</span>layout.svelte\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-operator\">+</span>layout.ts\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-operator\">+</span>page.svelte        <span class=\"hljs-comment\"># dashboard (protetto)</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; login<span class=\"hljs-symbol\">/+page.svelte</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; callback<span class=\"hljs-symbol\">/+page.svelte</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; tasks<span class=\"hljs-symbol\">/+page.svelte</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; logs<span class=\"hljs-symbol\">/+page.svelte</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; settings<span class=\"hljs-symbol\">/+page.svelte</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4293,4317"}}],"payload":{"tag":"h2","lines":"4289,4290"}},{"content":"&#x1f4c3; File chiave","children":[{"content":"<code>src/lib/auth.ts</code>","children":[{"content":"<pre data-lines=\"4324,4349\"><code class=\"language-ts\"><span class=\"hljs-keyword\">import</span> { browser } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;&#x24;app/environment&apos;</span>;\n<span class=\"hljs-keyword\">import</span> { get, writable } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;svelte/store&apos;</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-keyword\">type</span> { <span class=\"hljs-title class_\">User</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;./api&apos;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> user = writable&lt;<span class=\"hljs-title class_\">User</span> | <span class=\"hljs-literal\">null</span>&gt;(<span class=\"hljs-literal\">null</span>);\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">fetchCurrentUser</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">try</span> {\n    <span class=\"hljs-keyword\">const</span> resp = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&apos;/api/users/me&apos;</span>);\n    <span class=\"hljs-keyword\">if</span> (resp.<span class=\"hljs-property\">ok</span>) {\n      <span class=\"hljs-keyword\">const</span> u = <span class=\"hljs-keyword\">await</span> resp.<span class=\"hljs-title function_\">json</span>();\n      user.<span class=\"hljs-title function_\">set</span>(u);\n    } <span class=\"hljs-keyword\">else</span> {\n      user.<span class=\"hljs-title function_\">set</span>(<span class=\"hljs-literal\">null</span>);\n    }\n  } <span class=\"hljs-keyword\">catch</span> (err) {\n    user.<span class=\"hljs-title function_\">set</span>(<span class=\"hljs-literal\">null</span>);\n  }\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">isAuthenticated</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> !!<span class=\"hljs-title function_\">get</span>(user);\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4324,4349"}}],"payload":{"tag":"h3","lines":"4322,4323"}},{"content":"<code>src/lib/api.ts</code>","children":[{"content":"<pre data-lines=\"4352,4389\"><code class=\"language-ts\"><span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;axios&apos;</span>;\n\n<span class=\"hljs-keyword\">const</span> api = axios.<span class=\"hljs-title function_\">create</span>({\n  <span class=\"hljs-attr\">baseURL</span>: <span class=\"hljs-string\">&apos;http://localhost:8000&apos;</span>,\n  <span class=\"hljs-attr\">withCredentials</span>: <span class=\"hljs-literal\">true</span>, <span class=\"hljs-comment\">// invia cookie/token</span>\n});\n\n<span class=\"hljs-comment\">// Endpoint auth</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getAuthUrl</span>(<span class=\"hljs-params\"><span class=\"hljs-attr\">provider</span>: <span class=\"hljs-built_in\">string</span></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">`/auth/<span class=\"hljs-subst\">&#x24;{provider}</span>/authorize`</span>);\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">logout</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">&apos;/auth/jwt/logout&apos;</span>);\n}\n\n<span class=\"hljs-comment\">// Endpoint user</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getCurrentUser</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&apos;/users/me&apos;</span>);\n}\n\n<span class=\"hljs-comment\">// Endpoint tasks</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">listTasks</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&apos;/tasks/&apos;</span>);\n}\n\n<span class=\"hljs-comment\">// Endpoint run workflow</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">runPlaybook</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">&apos;/run/&apos;</span>);\n}\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">runTofu</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> api.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">&apos;/run/tofu/&apos;</span>);\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> api;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4352,4389"}}],"payload":{"tag":"h3","lines":"4350,4351"}},{"content":"<code>src/routes/login/+page.svelte</code>","children":[{"content":"<pre data-lines=\"4392,4415\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { getAuthUrl } from &apos;&#x24;lib/api&apos;;\n\n  let providers = [&apos;github&apos;]; // puoi aggiungere gitlab\n\n  async function loginWith(provider: string) {\n    const resp = await getAuthUrl(provider);\n    if (resp.data &amp;&amp; resp.data.authorization_url) {\n      window.location.href = resp.data.authorization_url;\n    }\n  }\n&lt;/script&gt;\n\n&lt;main class=&quot;p-4&quot;&gt;\n  &lt;h1&gt;Login&lt;/h1&gt;\n  {#each providers as prov}\n    &lt;button on:click={() =&gt; loginWith(prov)} class=&quot;mx-2 p-2 bg-blue-500 text-white rounded&quot;&gt;\n      Login with {prov}\n    &lt;/button&gt;\n  {/each}\n&lt;/main&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4392,4415"}}],"payload":{"tag":"h3","lines":"4390,4391"}},{"content":"<code>src/routes/callback/+page.svelte</code>","children":[{"content":"<pre data-lines=\"4418,4434\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { page } from &apos;&#x24;app/stores&apos;;\n  import { goto } from &apos;&#x24;app/navigation&apos;;\n  import { fetchCurrentUser } from &apos;&#x24;lib/auth&apos;;\n\n  // Quando GitHub reindirizza a /callback?code=...&amp;state=...\n  onMount(async () =&gt; {\n    // Chiamare backend per completare il login\n    await fetchCurrentUser();\n    goto(&apos;/&apos;);\n  });\n&lt;/script&gt;\n\n&lt;p&gt;Processing login&#x2026;&lt;/p&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4418,4434"}}],"payload":{"tag":"h3","lines":"4416,4417"}},{"content":"<code>src/routes/+layout.svelte</code>","children":[{"content":"<pre data-lines=\"4437,4455\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { user, fetchCurrentUser } from &apos;&#x24;lib/auth&apos;;\n  import NavBar from &apos;&#x24;lib/components/NavBar.svelte&apos;;\n\n  // alla prima apertura, cerca utente autenticato\n  fetchCurrentUser();\n&lt;/script&gt;\n\n&lt;NavBar {user} /&gt;\n&lt;main&gt;\n  {#if &#x24;user}\n    &lt;slot /&gt;\n  {:else}\n    &lt;slot name=&quot;login&quot; /&gt;\n  {/if}\n&lt;/main&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4437,4455"}}],"payload":{"tag":"h3","lines":"4435,4436"}},{"content":"<code>src/lib/components/NavBar.svelte</code>","children":[{"content":"<pre data-lines=\"4458,4485\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { user } from &apos;&#x24;lib/auth&apos;;\n  import { logout } from &apos;&#x24;lib/api&apos;;\n  import { goto } from &apos;&#x24;app/navigation&apos;;\n\n  async function handleLogout() {\n    await logout();\n    user.set(null);\n    goto(&apos;/login&apos;);\n  }\n&lt;/script&gt;\n\n&lt;nav class=&quot;bg-gray-800 text-white p-4 flex justify-between&quot;&gt;\n  &lt;div&gt;\n    &lt;a href=&quot;/&quot; class=&quot;mx-2&quot;&gt;Dashboard&lt;/a&gt;\n    &lt;a href=&quot;/tasks&quot; class=&quot;mx-2&quot;&gt;Tasks&lt;/a&gt;\n    &lt;a href=&quot;/logs&quot; class=&quot;mx-2&quot;&gt;Logs&lt;/a&gt;\n  &lt;/div&gt;\n  {#if &#x24;user}\n    &lt;div&gt;\n      &lt;span&gt;{&#x24;user.email}&lt;/span&gt;\n      &lt;button class=&quot;ml-4 bg-red-500 px-2 py-1 rounded&quot; on:click={handleLogout}&gt;Logout&lt;/button&gt;\n    &lt;/div&gt;\n  {/if}\n&lt;/nav&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4458,4485"}}],"payload":{"tag":"h3","lines":"4456,4457"}},{"content":"<code>src/routes/tasks/+page.svelte</code>","children":[{"content":"<pre data-lines=\"4488,4520\"><code class=\"language-svelte\">&lt;script lang=&quot;ts&quot;&gt;\n  import { onMount } from &apos;svelte&apos;;\n  import { listTasks } from &apos;&#x24;lib/api&apos;;\n  import type { TaskRecord } from &apos;&#x24;lib/api&apos;;\n  import { toast } from &apos;svelte-toastify&apos;;\n\n  let tasks: TaskRecord[] = [];\n\n  async function loadTasks() {\n    try {\n      const resp = await listTasks();\n      tasks = resp.data;\n    } catch (e) {\n      toast(&apos;Unable to fetch tasks&apos;, &apos;error&apos;);\n    }\n  }\n\n  onMount(loadTasks);\n&lt;/script&gt;\n\n&lt;main class=&quot;p-4&quot;&gt;\n  &lt;h1 class=&quot;text-xl mb-4&quot;&gt;Recent Tasks&lt;/h1&gt;\n  &lt;ul&gt;\n    {#each tasks as t}\n      &lt;li&gt;\n        &lt;span&gt;{t.type}&lt;/span&gt; &#xb7; &lt;span&gt;{t.status}&lt;/span&gt; &#xb7; &lt;span&gt;{new Date(t.created_at).toLocaleString()}&lt;/span&gt;\n      &lt;/li&gt;\n    {/each}\n  &lt;/ul&gt;\n&lt;/main&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4488,4520"}}],"payload":{"tag":"h3","lines":"4486,4487"}}],"payload":{"tag":"h2","lines":"4320,4321"}},{"content":"&#x2705; Flusso utente e protezione UI","children":[{"content":"1. L&#x2019;utente accede a <code>/login</code>, clicca &#x201c;Login with GitHub&#x201d; &#x2192; viene reindirizzato al provider OAuth.","children":[],"payload":{"tag":"li","lines":"4525,4526","listIndex":1}},{"content":"2. Il backend FastAPI via <code>fastapi-users</code> gestisce il callback, crea/aggiorna l&#x2019;utente, imposta cookie o token (JWT).","children":[],"payload":{"tag":"li","lines":"4526,4527","listIndex":2}},{"content":"3. Il frontend, dopo redirect su <code>/callback</code>, chiama <code>fetchCurrentUser()</code> che recupera la sessione utente e popola <code>&#x24;user</code>.","children":[],"payload":{"tag":"li","lines":"4527,4528","listIndex":3}},{"content":"4. Il layout (<code>+layout.svelte</code>) mostra NavBar e <code>slot</code> protetto solo se l&#x2019;utente &#xe8; presente; altrimenti mostra login.","children":[],"payload":{"tag":"li","lines":"4528,4529","listIndex":4}},{"content":"5. Le chiamate API (es. <code>/run/</code>, <code>/tasks/</code>) includono cookie o JWT tramite <code>axios</code> con <code>withCredentials: true</code>.","children":[],"payload":{"tag":"li","lines":"4529,4530","listIndex":5}},{"content":"6. La UI protegge visivamente le rotte non autorizzate e mostra logout, email utente, notifiche, ecc.","children":[],"payload":{"tag":"li","lines":"4530,4532","listIndex":6}}],"payload":{"tag":"h2","lines":"4523,4524"}},{"content":"&#x1f4cc; Note e dipendenze del backend per supportare questo flusso","children":[{"content":"","children":[{"content":"\n<p data-lines=\"4536,4537\">Backend con <code>fastapi-users</code> deve supportare cors con <code>allow_credentials=True</code></p>","children":[],"payload":{"tag":"li","lines":"4536,4537"}},{"content":"\n<p data-lines=\"4537,4538\">I router OAuth (<code>oauth_router</code>) e JWT router devono essere configurati e il frontend deve conoscere gli endpoint (es. <code>/auth/github/authorize</code>, <code>/auth/jwt/login</code>)</p>","children":[],"payload":{"tag":"li","lines":"4537,4538"}},{"content":"\n<p data-lines=\"4538,4539\">In <code>fastapi-users</code> l&#x2019;autenticazione con cookie JWT &#xe8; supportata, e il token &#xe8; inviato al frontend come cookie HTTP-only, il che consente l&#x2019;uso con <code>withCredentials</code>.</p>\n<blockquote data-lines=\"4540,4541\">\n<p data-lines=\"4540,4541\">Vedi esempio <code>fastapi-users</code> flow docs (<a href=\"https://fastapi-users.github.io/fastapi-users/9.3/configuration/oauth/?utm_source=chatgpt.com\" title=\"OAuth2 - FastAPI Users\">FastAPI Users</a>)</p>\n</blockquote>","children":[],"payload":{"tag":"li","lines":"4538,4542"}}],"payload":{"tag":"ul","lines":"4536,4542"}},{"content":"","children":[{"content":"Autenticazione via GitHub/GitLab OAuth con <code>fastapi-users</code>","children":[],"payload":{"tag":"li","lines":"4552,4553"}},{"content":"Gestione utenti, ruoli base (admin/user)","children":[],"payload":{"tag":"li","lines":"4553,4554"}},{"content":"CORS configurato per frontend (assumendo localhost:5173 o altro)","children":[],"payload":{"tag":"li","lines":"4554,4555"}},{"content":"Endpoints API per task, playbook, log (stub)","children":[],"payload":{"tag":"li","lines":"4555,4556"}},{"content":"Configurazione JWT con cookie HTTP-only per sicurezza e uso con frontend axios","children":[],"payload":{"tag":"li","lines":"4556,4557"}},{"content":"Setup Celery (placeholder)","children":[],"payload":{"tag":"li","lines":"4557,4558"}},{"content":"File <code>.env.example</code> per configurazioni","children":[],"payload":{"tag":"li","lines":"4558,4559"}},{"content":"<code>requirements.txt</code>","children":[],"payload":{"tag":"li","lines":"4559,4560"}},{"content":"Struttura progetto e README aggiornato","children":[],"payload":{"tag":"li","lines":"4560,4562"}}],"payload":{"tag":"ul","lines":"4552,4562"}}],"payload":{"tag":"h2","lines":"4534,4535"}},{"content":"Struttura backend proposta","children":[{"content":"<pre data-lines=\"4566,4587\"><code data-lines=\"4566,4587\">backend/\n&#x251c;&#x2500;&#x2500; app/\n&#x2502;   &#x251c;&#x2500;&#x2500; __init__<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-tag\">main</span><span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; config<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; db<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; models<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; schemas<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; users<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; tasks<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; auth<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; celery_worker<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; utils<span class=\"hljs-selector-class\">.py</span>\n&#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-class\">.env</span><span class=\"hljs-selector-class\">.example</span>\n&#x251c;&#x2500;&#x2500; requirements<span class=\"hljs-selector-class\">.txt</span>\n&#x251c;&#x2500;&#x2500; alembic<span class=\"hljs-selector-class\">.ini</span>\n&#x2514;&#x2500;&#x2500; alembic/\n    &#x2514;&#x2500;&#x2500; versions/\n        &#x2514;&#x2500;&#x2500; &lt;migration_files&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4566,4587"}}],"payload":{"tag":"h2","lines":"4564,4565"}},{"content":"1. <code>requirements.txt</code>","children":[{"content":"<pre data-lines=\"4592,4608\"><code class=\"language-text\">fastapi\nuvicorn[standard]\nfastapi-users[sqlalchemy2,jwt,oauth]\nsqlalchemy\ndatabases[asyncpg]\nasyncpg\npython-dotenv\npasslib[bcrypt]\nalembic\npydantic[email]\nhttpx\ncelery[redis]\nredis\npython-multipart\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4592,4608"}}],"payload":{"tag":"h2","lines":"4590,4591"}},{"content":"2. <code>.env.example</code>","children":[{"content":"<pre data-lines=\"4613,4622\"><code class=\"language-env\">DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/mydb\nSECRET_KEY=your-super-secret-key\nGITHUB_CLIENT_ID=your_github_client_id\nGITHUB_CLIENT_SECRET=your_github_client_secret\nGITLAB_CLIENT_ID=your_gitlab_client_id\nGITLAB_CLIENT_SECRET=your_gitlab_client_secret\nREDIS_URL=redis://localhost:6379/0\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4613,4622"}}],"payload":{"tag":"h2","lines":"4611,4612"}},{"content":"3. <code>app/config.py</code>","children":[{"content":"<pre data-lines=\"4627,4644\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseSettings\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Settings</span>(<span class=\"hljs-title class_ inherited__\">BaseSettings</span>):\n    DATABASE_URL: <span class=\"hljs-built_in\">str</span>\n    SECRET_KEY: <span class=\"hljs-built_in\">str</span>\n    GITHUB_CLIENT_ID: <span class=\"hljs-built_in\">str</span>\n    GITHUB_CLIENT_SECRET: <span class=\"hljs-built_in\">str</span>\n    GITLAB_CLIENT_ID: <span class=\"hljs-built_in\">str</span>\n    GITLAB_CLIENT_SECRET: <span class=\"hljs-built_in\">str</span>\n    REDIS_URL: <span class=\"hljs-built_in\">str</span> = <span class=\"hljs-string\">&quot;redis://localhost:6379/0&quot;</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        env_file = <span class=\"hljs-string\">&quot;.env&quot;</span>\n\nsettings = Settings()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4627,4644"}}],"payload":{"tag":"h2","lines":"4625,4626"}},{"content":"4. <code>app/db.py</code>","children":[{"content":"<pre data-lines=\"4649,4659\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> databases <span class=\"hljs-keyword\">import</span> Database\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> create_async_engine, AsyncSession\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> sessionmaker\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\ndatabase = Database(settings.DATABASE_URL)\nengine = create_async_engine(settings.DATABASE_URL, future=<span class=\"hljs-literal\">True</span>, echo=<span class=\"hljs-literal\">True</span>)\nasync_session = sessionmaker(engine, class_=AsyncSession, expire_on_commit=<span class=\"hljs-literal\">False</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4649,4659"}}],"payload":{"tag":"h2","lines":"4647,4648"}},{"content":"5. <code>app/models.py</code>","children":[{"content":"<pre data-lines=\"4664,4691\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> sqlalchemy <span class=\"hljs-keyword\">import</span> Boolean, Column, Integer, String, DateTime, ForeignKey\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> relationship\n<span class=\"hljs-keyword\">from</span> sqlalchemy.sql <span class=\"hljs-keyword\">import</span> func\n<span class=\"hljs-keyword\">from</span> fastapi_users.db <span class=\"hljs-keyword\">import</span> SQLAlchemyBaseUserTable\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.declarative <span class=\"hljs-keyword\">import</span> DeclarativeMeta, declarative_base\n\nBase: DeclarativeMeta = declarative_base()\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(SQLAlchemyBaseUserTable, Base):\n    __tablename__ = <span class=\"hljs-string\">&quot;user&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    is_active = Column(Boolean, default=<span class=\"hljs-literal\">True</span>)\n    is_superuser = Column(Boolean, default=<span class=\"hljs-literal\">False</span>)\n    is_verified = Column(Boolean, default=<span class=\"hljs-literal\">False</span>)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Task</span>(<span class=\"hljs-title class_ inherited__\">Base</span>):\n    __tablename__ = <span class=\"hljs-string\">&quot;tasks&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    <span class=\"hljs-built_in\">type</span> = Column(String, nullable=<span class=\"hljs-literal\">False</span>)\n    status = Column(String, default=<span class=\"hljs-string\">&quot;pending&quot;</span>)\n    created_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), server_default=func.now())\n    updated_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), onupdate=func.now())\n    user_id = Column(Integer, ForeignKey(<span class=\"hljs-string\">&quot;user.id&quot;</span>))\n    user = relationship(<span class=\"hljs-string\">&quot;User&quot;</span>, backref=<span class=\"hljs-string\">&quot;tasks&quot;</span>)\n    log = Column(String, default=<span class=\"hljs-string\">&quot;&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4664,4691"}}],"payload":{"tag":"h2","lines":"4662,4663"}},{"content":"6. <code>app/schemas.py</code>","children":[{"content":"<pre data-lines=\"4696,4727\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseModel, EmailStr\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">Optional</span>\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-built_in\">id</span>: <span class=\"hljs-built_in\">int</span>\n    email: EmailStr\n    is_active: <span class=\"hljs-built_in\">bool</span>\n    is_superuser: <span class=\"hljs-built_in\">bool</span>\n    is_verified: <span class=\"hljs-built_in\">bool</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserCreate</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    email: EmailStr\n    password: <span class=\"hljs-built_in\">str</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TaskRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-built_in\">id</span>: <span class=\"hljs-built_in\">int</span>\n    <span class=\"hljs-built_in\">type</span>: <span class=\"hljs-built_in\">str</span>\n    status: <span class=\"hljs-built_in\">str</span>\n    created_at: datetime\n    updated_at: <span class=\"hljs-type\">Optional</span>[datetime]\n    user_id: <span class=\"hljs-built_in\">int</span>\n    log: <span class=\"hljs-built_in\">str</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4696,4727"}}],"payload":{"tag":"h2","lines":"4694,4695"}},{"content":"7. <code>app/users.py</code>","children":[{"content":"<pre data-lines=\"4732,4777\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> FastAPIUsers, models <span class=\"hljs-keyword\">as</span> fa_models\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> JWTStrategy, CookieTransport, AuthenticationBackend\n<span class=\"hljs-keyword\">from</span> fastapi_users.db <span class=\"hljs-keyword\">import</span> SQLAlchemyUserDatabase\n<span class=\"hljs-keyword\">from</span> app.models <span class=\"hljs-keyword\">import</span> User\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> database, async_session\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(fa_models.BaseUser):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserCreate</span>(fa_models.BaseUserCreate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserUpdate</span>(fa_models.BaseUserUpdate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserDB</span>(User, fa_models.BaseUserDB):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_user_db</span>():\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> async_session() <span class=\"hljs-keyword\">as</span> session:\n        <span class=\"hljs-keyword\">yield</span> SQLAlchemyUserDatabase(UserDB, session, User)\n\ncookie_transport = CookieTransport(cookie_name=<span class=\"hljs-string\">&quot;auth&quot;</span>, cookie_secure=<span class=\"hljs-literal\">False</span>, cookie_http_only=<span class=\"hljs-literal\">True</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_jwt_strategy</span>() -&gt; JWTStrategy:\n    <span class=\"hljs-keyword\">return</span> JWTStrategy(secret=settings.SECRET_KEY, lifetime_seconds=<span class=\"hljs-number\">3600</span>)\n\nauth_backend = AuthenticationBackend(\n    name=<span class=\"hljs-string\">&quot;jwt&quot;</span>,\n    transport=cookie_transport,\n    get_strategy=get_jwt_strategy,\n)\n\nfastapi_users = FastAPIUsers[User, <span class=\"hljs-built_in\">int</span>](\n    get_user_db,\n    [auth_backend],\n    User,\n    UserCreate,\n    UserUpdate,\n    UserDB,\n)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4732,4777"}}],"payload":{"tag":"h2","lines":"4730,4731"}},{"content":"8. <code>app/auth.py</code>","children":[{"content":"<pre data-lines=\"4782,4825\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> OAuth2AuthorizationCodeBearer\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication.oauth2 <span class=\"hljs-keyword\">import</span> OAuth2AuthorizationCodeBearer\n\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\nrouter = APIRouter()\n\n<span class=\"hljs-comment\"># GitHub OAuth</span>\ngithub_oauth_client = OAuth2AuthorizationCodeBearer(\n    authorizationUrl=<span class=\"hljs-string\">&quot;https://github.com/login/oauth/authorize&quot;</span>,\n    tokenUrl=<span class=\"hljs-string\">&quot;https://github.com/login/oauth/access_token&quot;</span>,\n    client_id=settings.GITHUB_CLIENT_ID,\n    client_secret=settings.GITHUB_CLIENT_SECRET,\n    scopes=[<span class=\"hljs-string\">&quot;user:email&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@router.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/github/authorize&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">github_authorize</span>():\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;authorization_url&quot;</span>: github_oauth_client.authorizationUrl}\n\n<span class=\"hljs-comment\"># GitLab OAuth analogamente, oppure usa fastapi-users builtin OAuth routers</span>\n\nrouter.include_router(\n    fastapi_users.get_auth_router(auth_backend),\n    prefix=<span class=\"hljs-string\">&quot;/auth/jwt&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\nrouter.include_router(\n    fastapi_users.get_register_router(),\n    prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\nrouter.include_router(\n    fastapi_users.get_users_router(),\n    prefix=<span class=\"hljs-string\">&quot;/users&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;users&quot;</span>],\n)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4782,4825"}}],"payload":{"tag":"h2","lines":"4780,4781"}},{"content":"9. <code>app/tasks.py</code>","children":[{"content":"<pre data-lines=\"4830,4853\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter, Depends, HTTPException\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> async_session\n<span class=\"hljs-keyword\">from</span> app.schemas <span class=\"hljs-keyword\">import</span> TaskRead\n<span class=\"hljs-keyword\">from</span> app.models <span class=\"hljs-keyword\">import</span> Task\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">List</span>\n<span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> FastAPIUsers\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users, User\n\nrouter = APIRouter()\n\n<span class=\"hljs-meta\">@router.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/&quot;</span>, response_model=<span class=\"hljs-type\">List</span>[TaskRead]</span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">list_tasks</span>(<span class=\"hljs-params\">session: AsyncSession = Depends(<span class=\"hljs-params\">async_session</span>)</span>):\n    result = <span class=\"hljs-keyword\">await</span> session.execute(Task.__table__.select())\n    tasks = result.scalars().<span class=\"hljs-built_in\">all</span>()\n    <span class=\"hljs-keyword\">return</span> tasks\n\n<span class=\"hljs-meta\">@router.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>():\n    <span class=\"hljs-comment\"># <span class=\"hljs-doctag\">TODO:</span> avviare task playbook tramite Celery e salvare stato</span>\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;message&quot;</span>: <span class=\"hljs-string\">&quot;Playbook execution started&quot;</span>}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4830,4853"}}],"payload":{"tag":"h2","lines":"4828,4829"}},{"content":"10. <code>app/celery_worker.py</code>","children":[{"content":"<pre data-lines=\"4858,4873\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\ncelery_app = Celery(\n    <span class=\"hljs-string\">&quot;worker&quot;</span>,\n    broker=settings.REDIS_URL,\n    backend=settings.REDIS_URL,\n)\n\n<span class=\"hljs-meta\">@celery_app.task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook_task</span>(<span class=\"hljs-params\">playbook: <span class=\"hljs-built_in\">str</span>, user_id: <span class=\"hljs-built_in\">int</span></span>):\n    <span class=\"hljs-comment\"># Placeholder: esegui ansible-playbook, salva log, aggiorna DB</span>\n    <span class=\"hljs-keyword\">pass</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4858,4873"}}],"payload":{"tag":"h2","lines":"4856,4857"}},{"content":"11. <code>app/main.py</code>","children":[{"content":"<pre data-lines=\"4878,4931\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> uvicorn\n<span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI\n<span class=\"hljs-keyword\">from</span> fastapi.middleware.cors <span class=\"hljs-keyword\">import</span> CORSMiddleware\n\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> database\n<span class=\"hljs-keyword\">from</span> app.auth <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> auth_router\n<span class=\"hljs-keyword\">from</span> app.tasks <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> tasks_router\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users, auth_backend\n\napp = FastAPI(title=<span class=\"hljs-string\">&quot;Infra Automation API&quot;</span>)\n\norigins = [\n    <span class=\"hljs-string\">&quot;http://localhost:5173&quot;</span>,\n    <span class=\"hljs-string\">&quot;http://localhost:3000&quot;</span>,\n    <span class=\"hljs-comment\"># aggiungi dominio frontend</span>\n]\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=origins,\n    allow_credentials=<span class=\"hljs-literal\">True</span>,\n    allow_methods=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_headers=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n)\n\napp.include_router(auth_router, prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>, tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>])\napp.include_router(tasks_router, prefix=<span class=\"hljs-string\">&quot;/tasks&quot;</span>, tags=[<span class=\"hljs-string\">&quot;tasks&quot;</span>])\n\napp.include_router(\n    fastapi_users.get_auth_router(auth_backend),\n    prefix=<span class=\"hljs-string\">&quot;/auth/jwt&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\napp.include_router(\n    fastapi_users.get_register_router(),\n    prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\napp.include_router(\n    fastapi_users.get_users_router(),\n    prefix=<span class=\"hljs-string\">&quot;/users&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;users&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@app.on_event(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;startup&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">startup</span>():\n    <span class=\"hljs-keyword\">await</span> database.connect()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4878,4931"}}],"payload":{"tag":"h2","lines":"4876,4877"}},{"content":"[ contiue / repeat ]","children":[{"content":"Autenticazione via GitHub/GitLab OAuth con <code>fastapi-users</code>","children":[],"payload":{"tag":"li","lines":"4942,4943"}},{"content":"Gestione utenti, ruoli base (admin/user)","children":[],"payload":{"tag":"li","lines":"4943,4944"}},{"content":"CORS configurato per frontend (assumendo localhost:5173 o altro)","children":[],"payload":{"tag":"li","lines":"4944,4945"}},{"content":"Endpoints API per task, playbook, log (stub)","children":[],"payload":{"tag":"li","lines":"4945,4946"}},{"content":"Configurazione JWT con cookie HTTP-only per sicurezza e uso con frontend axios","children":[],"payload":{"tag":"li","lines":"4946,4947"}},{"content":"Setup Celery (placeholder)","children":[],"payload":{"tag":"li","lines":"4947,4948"}},{"content":"File <code>.env.example</code> per configurazioni","children":[],"payload":{"tag":"li","lines":"4948,4949"}},{"content":"<code>requirements.txt</code>","children":[],"payload":{"tag":"li","lines":"4949,4950"}},{"content":"Struttura progetto e README aggiornato","children":[],"payload":{"tag":"li","lines":"4950,4952"}}],"payload":{"tag":"h2","lines":"4936,4938"}},{"content":"Struttura backend proposta","children":[{"content":"<pre data-lines=\"4956,4977\"><code data-lines=\"4956,4977\">backend/\n&#x251c;&#x2500;&#x2500; app/\n&#x2502;   &#x251c;&#x2500;&#x2500; __init__<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-tag\">main</span><span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; config<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; db<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; models<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; schemas<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; users<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; tasks<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; auth<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; celery_worker<span class=\"hljs-selector-class\">.py</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; utils<span class=\"hljs-selector-class\">.py</span>\n&#x251c;&#x2500;&#x2500; <span class=\"hljs-selector-class\">.env</span><span class=\"hljs-selector-class\">.example</span>\n&#x251c;&#x2500;&#x2500; requirements<span class=\"hljs-selector-class\">.txt</span>\n&#x251c;&#x2500;&#x2500; alembic<span class=\"hljs-selector-class\">.ini</span>\n&#x2514;&#x2500;&#x2500; alembic/\n    &#x2514;&#x2500;&#x2500; versions/\n        &#x2514;&#x2500;&#x2500; &lt;migration_files&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4956,4977"}}],"payload":{"tag":"h2","lines":"4954,4955"}},{"content":"1. <code>requirements.txt</code>","children":[{"content":"<pre data-lines=\"4982,4998\"><code class=\"language-text\">fastapi\nuvicorn[standard]\nfastapi-users[sqlalchemy2,jwt,oauth]\nsqlalchemy\ndatabases[asyncpg]\nasyncpg\npython-dotenv\npasslib[bcrypt]\nalembic\npydantic[email]\nhttpx\ncelery[redis]\nredis\npython-multipart\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4982,4998"}}],"payload":{"tag":"h2","lines":"4980,4981"}},{"content":"2. <code>.env.example</code>","children":[{"content":"<pre data-lines=\"5003,5012\"><code class=\"language-env\">DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/mydb\nSECRET_KEY=your-super-secret-key\nGITHUB_CLIENT_ID=your_github_client_id\nGITHUB_CLIENT_SECRET=your_github_client_secret\nGITLAB_CLIENT_ID=your_gitlab_client_id\nGITLAB_CLIENT_SECRET=your_gitlab_client_secret\nREDIS_URL=redis://localhost:6379/0\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5003,5012"}}],"payload":{"tag":"h2","lines":"5001,5002"}},{"content":"3. <code>app/config.py</code>","children":[{"content":"<pre data-lines=\"5017,5034\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseSettings\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Settings</span>(<span class=\"hljs-title class_ inherited__\">BaseSettings</span>):\n    DATABASE_URL: <span class=\"hljs-built_in\">str</span>\n    SECRET_KEY: <span class=\"hljs-built_in\">str</span>\n    GITHUB_CLIENT_ID: <span class=\"hljs-built_in\">str</span>\n    GITHUB_CLIENT_SECRET: <span class=\"hljs-built_in\">str</span>\n    GITLAB_CLIENT_ID: <span class=\"hljs-built_in\">str</span>\n    GITLAB_CLIENT_SECRET: <span class=\"hljs-built_in\">str</span>\n    REDIS_URL: <span class=\"hljs-built_in\">str</span> = <span class=\"hljs-string\">&quot;redis://localhost:6379/0&quot;</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        env_file = <span class=\"hljs-string\">&quot;.env&quot;</span>\n\nsettings = Settings()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5017,5034"}}],"payload":{"tag":"h2","lines":"5015,5016"}},{"content":"4. <code>app/db.py</code>","children":[{"content":"<pre data-lines=\"5039,5049\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> databases <span class=\"hljs-keyword\">import</span> Database\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> create_async_engine, AsyncSession\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> sessionmaker\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\ndatabase = Database(settings.DATABASE_URL)\nengine = create_async_engine(settings.DATABASE_URL, future=<span class=\"hljs-literal\">True</span>, echo=<span class=\"hljs-literal\">True</span>)\nasync_session = sessionmaker(engine, class_=AsyncSession, expire_on_commit=<span class=\"hljs-literal\">False</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5039,5049"}}],"payload":{"tag":"h2","lines":"5037,5038"}},{"content":"5. <code>app/models.py</code>","children":[{"content":"<pre data-lines=\"5054,5081\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> sqlalchemy <span class=\"hljs-keyword\">import</span> Boolean, Column, Integer, String, DateTime, ForeignKey\n<span class=\"hljs-keyword\">from</span> sqlalchemy.orm <span class=\"hljs-keyword\">import</span> relationship\n<span class=\"hljs-keyword\">from</span> sqlalchemy.sql <span class=\"hljs-keyword\">import</span> func\n<span class=\"hljs-keyword\">from</span> fastapi_users.db <span class=\"hljs-keyword\">import</span> SQLAlchemyBaseUserTable\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.declarative <span class=\"hljs-keyword\">import</span> DeclarativeMeta, declarative_base\n\nBase: DeclarativeMeta = declarative_base()\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(SQLAlchemyBaseUserTable, Base):\n    __tablename__ = <span class=\"hljs-string\">&quot;user&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    is_active = Column(Boolean, default=<span class=\"hljs-literal\">True</span>)\n    is_superuser = Column(Boolean, default=<span class=\"hljs-literal\">False</span>)\n    is_verified = Column(Boolean, default=<span class=\"hljs-literal\">False</span>)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Task</span>(<span class=\"hljs-title class_ inherited__\">Base</span>):\n    __tablename__ = <span class=\"hljs-string\">&quot;tasks&quot;</span>\n    <span class=\"hljs-built_in\">id</span> = Column(Integer, primary_key=<span class=\"hljs-literal\">True</span>, index=<span class=\"hljs-literal\">True</span>)\n    <span class=\"hljs-built_in\">type</span> = Column(String, nullable=<span class=\"hljs-literal\">False</span>)\n    status = Column(String, default=<span class=\"hljs-string\">&quot;pending&quot;</span>)\n    created_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), server_default=func.now())\n    updated_at = Column(DateTime(timezone=<span class=\"hljs-literal\">True</span>), onupdate=func.now())\n    user_id = Column(Integer, ForeignKey(<span class=\"hljs-string\">&quot;user.id&quot;</span>))\n    user = relationship(<span class=\"hljs-string\">&quot;User&quot;</span>, backref=<span class=\"hljs-string\">&quot;tasks&quot;</span>)\n    log = Column(String, default=<span class=\"hljs-string\">&quot;&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5054,5081"}}],"payload":{"tag":"h2","lines":"5052,5053"}},{"content":"6. <code>app/schemas.py</code>","children":[{"content":"<pre data-lines=\"5086,5117\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseModel, EmailStr\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">Optional</span>\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-built_in\">id</span>: <span class=\"hljs-built_in\">int</span>\n    email: EmailStr\n    is_active: <span class=\"hljs-built_in\">bool</span>\n    is_superuser: <span class=\"hljs-built_in\">bool</span>\n    is_verified: <span class=\"hljs-built_in\">bool</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserCreate</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    email: EmailStr\n    password: <span class=\"hljs-built_in\">str</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TaskRead</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-built_in\">id</span>: <span class=\"hljs-built_in\">int</span>\n    <span class=\"hljs-built_in\">type</span>: <span class=\"hljs-built_in\">str</span>\n    status: <span class=\"hljs-built_in\">str</span>\n    created_at: datetime\n    updated_at: <span class=\"hljs-type\">Optional</span>[datetime]\n    user_id: <span class=\"hljs-built_in\">int</span>\n    log: <span class=\"hljs-built_in\">str</span>\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Config</span>:\n        orm_mode = <span class=\"hljs-literal\">True</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5086,5117"}}],"payload":{"tag":"h2","lines":"5084,5085"}},{"content":"7. <code>app/users.py</code>","children":[{"content":"<pre data-lines=\"5122,5167\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> FastAPIUsers, models <span class=\"hljs-keyword\">as</span> fa_models\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> JWTStrategy, CookieTransport, AuthenticationBackend\n<span class=\"hljs-keyword\">from</span> fastapi_users.db <span class=\"hljs-keyword\">import</span> SQLAlchemyUserDatabase\n<span class=\"hljs-keyword\">from</span> app.models <span class=\"hljs-keyword\">import</span> User\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> database, async_session\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span>(fa_models.BaseUser):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserCreate</span>(fa_models.BaseUserCreate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserUpdate</span>(fa_models.BaseUserUpdate):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserDB</span>(User, fa_models.BaseUserDB):\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_user_db</span>():\n    <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">with</span> async_session() <span class=\"hljs-keyword\">as</span> session:\n        <span class=\"hljs-keyword\">yield</span> SQLAlchemyUserDatabase(UserDB, session, User)\n\ncookie_transport = CookieTransport(cookie_name=<span class=\"hljs-string\">&quot;auth&quot;</span>, cookie_secure=<span class=\"hljs-literal\">False</span>, cookie_http_only=<span class=\"hljs-literal\">True</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_jwt_strategy</span>() -&gt; JWTStrategy:\n    <span class=\"hljs-keyword\">return</span> JWTStrategy(secret=settings.SECRET_KEY, lifetime_seconds=<span class=\"hljs-number\">3600</span>)\n\nauth_backend = AuthenticationBackend(\n    name=<span class=\"hljs-string\">&quot;jwt&quot;</span>,\n    transport=cookie_transport,\n    get_strategy=get_jwt_strategy,\n)\n\nfastapi_users = FastAPIUsers[User, <span class=\"hljs-built_in\">int</span>](\n    get_user_db,\n    [auth_backend],\n    User,\n    UserCreate,\n    UserUpdate,\n    UserDB,\n)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5122,5167"}}],"payload":{"tag":"h2","lines":"5120,5121"}},{"content":"8. <code>app/auth.py</code>","children":[{"content":"<pre data-lines=\"5172,5215\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication <span class=\"hljs-keyword\">import</span> OAuth2AuthorizationCodeBearer\n<span class=\"hljs-keyword\">from</span> fastapi_users.authentication.oauth2 <span class=\"hljs-keyword\">import</span> OAuth2AuthorizationCodeBearer\n\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\nrouter = APIRouter()\n\n<span class=\"hljs-comment\"># GitHub OAuth</span>\ngithub_oauth_client = OAuth2AuthorizationCodeBearer(\n    authorizationUrl=<span class=\"hljs-string\">&quot;https://github.com/login/oauth/authorize&quot;</span>,\n    tokenUrl=<span class=\"hljs-string\">&quot;https://github.com/login/oauth/access_token&quot;</span>,\n    client_id=settings.GITHUB_CLIENT_ID,\n    client_secret=settings.GITHUB_CLIENT_SECRET,\n    scopes=[<span class=\"hljs-string\">&quot;user:email&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@router.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/github/authorize&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">github_authorize</span>():\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;authorization_url&quot;</span>: github_oauth_client.authorizationUrl}\n\n<span class=\"hljs-comment\"># GitLab OAuth analogamente, oppure usa fastapi-users builtin OAuth routers</span>\n\nrouter.include_router(\n    fastapi_users.get_auth_router(auth_backend),\n    prefix=<span class=\"hljs-string\">&quot;/auth/jwt&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\nrouter.include_router(\n    fastapi_users.get_register_router(),\n    prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\nrouter.include_router(\n    fastapi_users.get_users_router(),\n    prefix=<span class=\"hljs-string\">&quot;/users&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;users&quot;</span>],\n)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5172,5215"}}],"payload":{"tag":"h2","lines":"5170,5171"}},{"content":"9. <code>app/tasks.py</code>","children":[{"content":"<pre data-lines=\"5220,5243\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter, Depends, HTTPException\n<span class=\"hljs-keyword\">from</span> sqlalchemy.ext.asyncio <span class=\"hljs-keyword\">import</span> AsyncSession\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> async_session\n<span class=\"hljs-keyword\">from</span> app.schemas <span class=\"hljs-keyword\">import</span> TaskRead\n<span class=\"hljs-keyword\">from</span> app.models <span class=\"hljs-keyword\">import</span> Task\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">List</span>\n<span class=\"hljs-keyword\">from</span> fastapi_users <span class=\"hljs-keyword\">import</span> FastAPIUsers\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users, User\n\nrouter = APIRouter()\n\n<span class=\"hljs-meta\">@router.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/&quot;</span>, response_model=<span class=\"hljs-type\">List</span>[TaskRead]</span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">list_tasks</span>(<span class=\"hljs-params\">session: AsyncSession = Depends(<span class=\"hljs-params\">async_session</span>)</span>):\n    result = <span class=\"hljs-keyword\">await</span> session.execute(Task.__table__.select())\n    tasks = result.scalars().<span class=\"hljs-built_in\">all</span>()\n    <span class=\"hljs-keyword\">return</span> tasks\n\n<span class=\"hljs-meta\">@router.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/run/&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook</span>():\n    <span class=\"hljs-comment\"># <span class=\"hljs-doctag\">TODO:</span> avviare task playbook tramite Celery e salvare stato</span>\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;message&quot;</span>: <span class=\"hljs-string\">&quot;Playbook execution started&quot;</span>}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5220,5243"}}],"payload":{"tag":"h2","lines":"5218,5219"}},{"content":"10. <code>app/celery_worker.py</code>","children":[{"content":"<pre data-lines=\"5248,5263\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n\ncelery_app = Celery(\n    <span class=\"hljs-string\">&quot;worker&quot;</span>,\n    broker=settings.REDIS_URL,\n    backend=settings.REDIS_URL,\n)\n\n<span class=\"hljs-meta\">@celery_app.task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_playbook_task</span>(<span class=\"hljs-params\">playbook: <span class=\"hljs-built_in\">str</span>, user_id: <span class=\"hljs-built_in\">int</span></span>):\n    <span class=\"hljs-comment\"># Placeholder: esegui ansible-playbook, salva log, aggiorna DB</span>\n    <span class=\"hljs-keyword\">pass</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5248,5263"}}],"payload":{"tag":"h2","lines":"5246,5247"}},{"content":"11. <code>app/main.py</code>","children":[{"content":"<pre data-lines=\"5268,5321\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> uvicorn\n<span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI\n<span class=\"hljs-keyword\">from</span> fastapi.middleware.cors <span class=\"hljs-keyword\">import</span> CORSMiddleware\n\n<span class=\"hljs-keyword\">from</span> app.config <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> app.db <span class=\"hljs-keyword\">import</span> database\n<span class=\"hljs-keyword\">from</span> app.auth <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> auth_router\n<span class=\"hljs-keyword\">from</span> app.tasks <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> tasks_router\n<span class=\"hljs-keyword\">from</span> app.users <span class=\"hljs-keyword\">import</span> fastapi_users, auth_backend\n\napp = FastAPI(title=<span class=\"hljs-string\">&quot;Infra Automation API&quot;</span>)\n\norigins = [\n    <span class=\"hljs-string\">&quot;http://localhost:5173&quot;</span>,\n    <span class=\"hljs-string\">&quot;http://localhost:3000&quot;</span>,\n    <span class=\"hljs-comment\"># aggiungi dominio frontend</span>\n]\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=origins,\n    allow_credentials=<span class=\"hljs-literal\">True</span>,\n    allow_methods=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_headers=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n)\n\napp.include_router(auth_router, prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>, tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>])\napp.include_router(tasks_router, prefix=<span class=\"hljs-string\">&quot;/tasks&quot;</span>, tags=[<span class=\"hljs-string\">&quot;tasks&quot;</span>])\n\napp.include_router(\n    fastapi_users.get_auth_router(auth_backend),\n    prefix=<span class=\"hljs-string\">&quot;/auth/jwt&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\napp.include_router(\n    fastapi_users.get_register_router(),\n    prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;auth&quot;</span>],\n)\n\napp.include_router(\n    fastapi_users.get_users_router(),\n    prefix=<span class=\"hljs-string\">&quot;/users&quot;</span>,\n    tags=[<span class=\"hljs-string\">&quot;users&quot;</span>],\n)\n\n<span class=\"hljs-meta\">@app.on_event(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;startup&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">startup</span>():\n    <span class=\"hljs-keyword\">await</span> database.connect()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5268,5321"}},{"content":"<pre data-lines=\"5330,5364\"><code data-lines=\"5330,5364\">\n<span class=\"hljs-meta\">---\n</span>\n<span class=\"hljs-comment\">## 12. README.md (estratto)</span>\n\n<span class=\"hljs-string\">```markdown</span>\n<span class=\"hljs-comment\"># Infra Automation WebApp Backend</span>\n\n<span class=\"hljs-comment\">## Descrizione</span>\n<span class=\"hljs-string\">Backend</span> <span class=\"hljs-string\">FastAPI</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">un&apos;applicazione</span> <span class=\"hljs-string\">web</span> <span class=\"hljs-string\">di</span> <span class=\"hljs-string\">automazione</span> <span class=\"hljs-string\">infrastrutturale</span> <span class=\"hljs-string\">basata</span> <span class=\"hljs-string\">su</span> <span class=\"hljs-string\">workflow,</span> <span class=\"hljs-attr\">che integra:</span>\n\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">Autenticazione</span> <span class=\"hljs-string\">utente</span> <span class=\"hljs-string\">via</span> <span class=\"hljs-string\">OAuth</span> <span class=\"hljs-string\">GitHub/GitLab</span> <span class=\"hljs-string\">con</span> <span class=\"hljs-string\">`fastapi-users`</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">Gestione</span> <span class=\"hljs-string\">task,</span> <span class=\"hljs-string\">cronologia,</span> <span class=\"hljs-string\">esecuzione</span> <span class=\"hljs-string\">playbook</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">Supporto</span> <span class=\"hljs-string\">Celery</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">task</span> <span class=\"hljs-string\">asincroni</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">Protezione</span> <span class=\"hljs-string\">JWT</span> <span class=\"hljs-string\">con</span> <span class=\"hljs-string\">cookie</span> <span class=\"hljs-string\">HTTP-only</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">sicurezza</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">API</span> <span class=\"hljs-string\">REST</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">frontend</span> <span class=\"hljs-string\">moderno</span> <span class=\"hljs-string\">(Svelte/React)</span>\n\n<span class=\"hljs-comment\">## Tecnologie</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">FastAPI</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">fastapi-users</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">SQLAlchemy</span> <span class=\"hljs-string\">Async</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">PostgreSQL</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">Celery</span> <span class=\"hljs-string\">+</span> <span class=\"hljs-string\">Redis</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">OAuth2</span> <span class=\"hljs-string\">(GitHub/GitLab)</span>\n\n<span class=\"hljs-comment\">## Setup</span>\n\n<span class=\"hljs-number\">1</span><span class=\"hljs-string\">.</span> <span class=\"hljs-string\">Copia</span> <span class=\"hljs-string\">`.env.example`</span> <span class=\"hljs-string\">in</span> <span class=\"hljs-string\">`.env`</span> <span class=\"hljs-string\">e</span> <span class=\"hljs-string\">configura</span> <span class=\"hljs-string\">variabili</span>\n<span class=\"hljs-attr\">2. Installa dipendenze:</span> <span class=\"hljs-string\">`pip</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">-r</span> <span class=\"hljs-string\">requirements.txt`</span>\n<span class=\"hljs-number\">3</span><span class=\"hljs-string\">.</span> <span class=\"hljs-string\">Esegui</span> <span class=\"hljs-string\">migrazioni</span> <span class=\"hljs-string\">con</span> <span class=\"hljs-string\">Alembic</span>\n<span class=\"hljs-attr\">4. Avvia backend:</span> <span class=\"hljs-string\">`uvicorn</span> <span class=\"hljs-string\">app.main:app</span> <span class=\"hljs-string\">--reload`</span>\n<span class=\"hljs-attr\">5. Avvia Celery worker:</span> <span class=\"hljs-string\">`celery</span> <span class=\"hljs-string\">-A</span> <span class=\"hljs-string\">app.celery_worker.celery_app</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">--loglevel=info`</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5330,5364"}}],"payload":{"tag":"h2","lines":"5266,5267"}},{"content":"1. <code>docker-compose.yml</code>","children":[{"content":"<pre data-lines=\"5388,5461\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&quot;3.9&quot;</span>\n\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">postgres:15-alpine</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-attr\">POSTGRES_USER:</span> <span class=\"hljs-string\">infra_user</span>\n      <span class=\"hljs-attr\">POSTGRES_PASSWORD:</span> <span class=\"hljs-string\">infra_pass</span>\n      <span class=\"hljs-attr\">POSTGRES_DB:</span> <span class=\"hljs-string\">infra_db</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres_data:/var/lib/postgresql/data</span>\n    <span class=\"hljs-attr\">networks:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">infra_net</span>\n\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:7-alpine</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;6379:6379&quot;</span>\n    <span class=\"hljs-attr\">networks:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">infra_net</span>\n\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">build:</span>\n      <span class=\"hljs-attr\">context:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">uvicorn</span> <span class=\"hljs-string\">app.main:app</span> <span class=\"hljs-string\">--host</span> <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> <span class=\"hljs-string\">--port</span> <span class=\"hljs-number\">8000</span> <span class=\"hljs-string\">--reload</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./backend:/app</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8000:8000&quot;</span>\n    <span class=\"hljs-attr\">env_file:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./backend/.env</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n    <span class=\"hljs-attr\">networks:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">infra_net</span>\n\n  <span class=\"hljs-attr\">celery_worker:</span>\n    <span class=\"hljs-attr\">build:</span>\n      <span class=\"hljs-attr\">context:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">-A</span> <span class=\"hljs-string\">app.celery_worker.celery_app</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">--loglevel=info</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./backend:/app</span>\n    <span class=\"hljs-attr\">env_file:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./backend/.env</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres</span>\n    <span class=\"hljs-attr\">networks:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">infra_net</span>\n\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">build:</span>\n      <span class=\"hljs-attr\">context:</span> <span class=\"hljs-string\">./frontend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">dev</span> <span class=\"hljs-string\">--</span> <span class=\"hljs-string\">--host</span> <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">./frontend:/app</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/app/node_modules</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;5173:5173&quot;</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">VITE_API_URL=http://localhost:8000</span>\n    <span class=\"hljs-attr\">networks:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">infra_net</span>\n\n<span class=\"hljs-attr\">volumes:</span>\n  <span class=\"hljs-attr\">postgres_data:</span>\n\n<span class=\"hljs-attr\">networks:</span>\n  <span class=\"hljs-attr\">infra_net:</span>\n    <span class=\"hljs-attr\">driver:</span> <span class=\"hljs-string\">bridge</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5388,5461"}}],"payload":{"tag":"h2","lines":"5386,5387"}},{"content":"2. <code>backend/Dockerfile</code>","children":[{"content":"<pre data-lines=\"5466,5478\"><code class=\"language-dockerfile\"><span class=\"hljs-keyword\">FROM</span> python:<span class=\"hljs-number\">3.11</span>-slim\n\n<span class=\"hljs-keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span>\n\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> requirements.txt .</span>\n<span class=\"hljs-keyword\">RUN</span><span class=\"language-bash\"> pip install --no-cache-dir -r requirements.txt</span>\n\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> . .</span>\n\n<span class=\"hljs-keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"hljs-string\">&quot;uvicorn&quot;</span>, <span class=\"hljs-string\">&quot;app.main:app&quot;</span>, <span class=\"hljs-string\">&quot;--host&quot;</span>, <span class=\"hljs-string\">&quot;0.0.0.0&quot;</span>, <span class=\"hljs-string\">&quot;--port&quot;</span>, <span class=\"hljs-string\">&quot;8000&quot;</span>]</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5466,5478"}}],"payload":{"tag":"h2","lines":"5464,5465"}},{"content":"3. <code>frontend/Dockerfile</code>","children":[{"content":"<pre data-lines=\"5485,5497\"><code class=\"language-dockerfile\"><span class=\"hljs-keyword\">FROM</span> node:<span class=\"hljs-number\">20</span>-alpine\n\n<span class=\"hljs-keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span>\n\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> package.json package-lock.json ./</span>\n<span class=\"hljs-keyword\">RUN</span><span class=\"language-bash\"> npm install</span>\n\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> . .</span>\n\n<span class=\"hljs-keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"hljs-string\">&quot;npm&quot;</span>, <span class=\"hljs-string\">&quot;run&quot;</span>, <span class=\"hljs-string\">&quot;dev&quot;</span>, <span class=\"hljs-string\">&quot;--&quot;</span>, <span class=\"hljs-string\">&quot;--host&quot;</span>, <span class=\"hljs-string\">&quot;0.0.0.0&quot;</span>]</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5485,5497"}}],"payload":{"tag":"h2","lines":"5481,5482"}},{"content":"Note e consigli","children":[{"content":"","children":[{"content":"Frontend espone porta <code>5173</code> (Vite default)","children":[],"payload":{"tag":"li","lines":"5502,5503"}},{"content":"Backend <code>8000</code>","children":[],"payload":{"tag":"li","lines":"5503,5504"}},{"content":"Postgres + Redis come DB e broker Celery","children":[],"payload":{"tag":"li","lines":"5504,5505"}},{"content":"Volumi per persistenza DB","children":[],"payload":{"tag":"li","lines":"5505,5506"}},{"content":"Variabili d&#x2019;ambiente da <code>.env</code> per backend (es. connessioni, segreti)","children":[],"payload":{"tag":"li","lines":"5506,5507"}},{"content":"Puoi sostituire il frontend con build statiche (es. Codeberg Pages) se preferisci hosting statico","children":[],"payload":{"tag":"li","lines":"5507,5509"}}],"payload":{"tag":"ul","lines":"5502,5509"}},{"content":"","children":[{"content":"1. Configurazione <strong>Traefik</strong> come reverse proxy per il progetto Docker Compose.","children":[],"payload":{"tag":"li","lines":"5520,5521","listIndex":1}},{"content":"2. Un <strong>Helm Chart base</strong> per il deploy Kubernetes dell&#x2019;intero stack.","children":[],"payload":{"tag":"li","lines":"5521,5523","listIndex":2}}],"payload":{"tag":"ol","lines":"5520,5523"}}],"payload":{"tag":"h2","lines":"5500,5501"}}],"payload":{"tag":"h1","lines":"3600,3601"}},{"content":"1. Traefik reverse proxy per Docker Compose","children":[{"content":"1.1 <code>docker-compose_traefik.yml</code>","children":[{"content":"Note","children":[{"content":"Sostituisci <code>example.com</code> e <code>api.example.com</code> con i tuoi domini.","children":[],"payload":{"tag":"li","lines":"5639,5640"}},{"content":"Traefik si occupa di TLS automatico con Let&apos;s Encrypt.","children":[],"payload":{"tag":"li","lines":"5640,5641"}},{"content":"La dashboard Traefik &#xe8; disponibile su <code>http://localhost:8080</code>.","children":[],"payload":{"tag":"li","lines":"5641,5643"}}],"payload":{"tag":"h3","lines":"5637,5638"}}],"payload":{"tag":"h2","lines":"5529,5530"}}],"payload":{"tag":"h1","lines":"5525,5526"}},{"content":"2. Helm Chart base per Kubernetes","children":[{"content":"2.1 Struttura base Helm Chart: <code>infra-automation-chart/</code>","children":[{"content":"<pre data-lines=\"5651,5667\"><code data-lines=\"5651,5667\">infra-automation-chart/\n&#x251c;&#x2500;&#x2500; Chart<span class=\"hljs-selector-class\">.yaml</span>\n&#x251c;&#x2500;&#x2500; values<span class=\"hljs-selector-class\">.yaml</span>\n&#x251c;&#x2500;&#x2500; templates/\n&#x2502;   &#x251c;&#x2500;&#x2500; backend-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; backend-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; celery-worker-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; postgres-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; postgres-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; redis-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; redis-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; frontend-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; frontend-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; ingress<span class=\"hljs-selector-class\">.yaml</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5651,5667"}}],"payload":{"tag":"h2","lines":"5649,5650"}},{"content":"2.2 <code>Chart.yaml</code>","children":[{"content":"<pre data-lines=\"5672,5680\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v2</span>\n<span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-automation</span>\n<span class=\"hljs-attr\">description:</span> <span class=\"hljs-string\">Helm</span> <span class=\"hljs-string\">Chart</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">deploy</span> <span class=\"hljs-string\">completo</span> <span class=\"hljs-string\">di</span> <span class=\"hljs-string\">Infra</span> <span class=\"hljs-string\">Automation</span> <span class=\"hljs-string\">WebApp</span>\n<span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">application</span>\n<span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">0.1</span><span class=\"hljs-number\">.0</span>\n<span class=\"hljs-attr\">appVersion:</span> <span class=\"hljs-string\">&quot;1.0&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5672,5680"}}],"payload":{"tag":"h2","lines":"5670,5671"}},{"content":"2.3 <code>values.yaml</code>","children":[{"content":"<pre data-lines=\"5685,5745\"><code class=\"language-yaml\"><span class=\"hljs-attr\">replicaCount:</span> <span class=\"hljs-number\">1</span>\n\n<span class=\"hljs-attr\">image:</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-backend</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">celeryWorker:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-celery-worker</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-frontend</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">postgres:15-alpine</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:7-alpine</span>\n\n<span class=\"hljs-attr\">service:</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">8000</span>\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">80</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">5432</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">6379</span>\n\n<span class=\"hljs-attr\">ingress:</span>\n  <span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">annotations:</span>\n    <span class=\"hljs-attr\">kubernetes.io/ingress.class:</span> <span class=\"hljs-string\">traefik</span>\n  <span class=\"hljs-attr\">hosts:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> <span class=\"hljs-string\">example.com</span>\n      <span class=\"hljs-attr\">paths:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/</span>\n          <span class=\"hljs-attr\">pathType:</span> <span class=\"hljs-string\">Prefix</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> <span class=\"hljs-string\">api.example.com</span>\n      <span class=\"hljs-attr\">paths:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/</span>\n          <span class=\"hljs-attr\">pathType:</span> <span class=\"hljs-string\">Prefix</span>\n  <span class=\"hljs-attr\">tls:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">secretName:</span> <span class=\"hljs-string\">tls-secret</span>\n      <span class=\"hljs-attr\">hosts:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">example.com</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">api.example.com</span>\n\n<span class=\"hljs-attr\">postgres:</span>\n  <span class=\"hljs-attr\">user:</span> <span class=\"hljs-string\">infra_user</span>\n  <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">infra_pass</span>\n  <span class=\"hljs-attr\">db:</span> <span class=\"hljs-string\">infra_db</span>\n\n<span class=\"hljs-attr\">redis:</span>\n  <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">&quot;&quot;</span>\n\n<span class=\"hljs-attr\">env:</span>\n  <span class=\"hljs-attr\">DATABASE_URL:</span> <span class=\"hljs-string\">postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n  <span class=\"hljs-attr\">REDIS_URL:</span> <span class=\"hljs-string\">redis://redis:6379/0</span>\n  <span class=\"hljs-attr\">VITE_API_URL:</span> <span class=\"hljs-string\">https://api.example.com</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5685,5745"}}],"payload":{"tag":"h2","lines":"5683,5684"}},{"content":"2.4 Esempio <code>backend-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"5750,5788\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-backend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> {{ <span class=\"hljs-string\">.Values.replicaCount</span> }}\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">backend</span>\n          <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ .Values.image.backend.repository }}</span>:<span class=\"hljs-template-variable\">{{ .Values.image.backend.tag }}</span>&quot;</span>\n          <span class=\"hljs-attr\">ports:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">containerPort:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n          <span class=\"hljs-attr\">env:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">DATABASE_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.DATABASE_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">REDIS_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.REDIS_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n          <span class=\"hljs-attr\">readinessProbe:</span>\n            <span class=\"hljs-attr\">httpGet:</span>\n              <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/health</span>\n              <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n            <span class=\"hljs-attr\">initialDelaySeconds:</span> <span class=\"hljs-number\">10</span>\n            <span class=\"hljs-attr\">periodSeconds:</span> <span class=\"hljs-number\">5</span>\n          <span class=\"hljs-attr\">livenessProbe:</span>\n            <span class=\"hljs-attr\">httpGet:</span>\n              <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/health</span>\n              <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n            <span class=\"hljs-attr\">initialDelaySeconds:</span> <span class=\"hljs-number\">30</span>\n            <span class=\"hljs-attr\">periodSeconds:</span> <span class=\"hljs-number\">10</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5750,5788"}}],"payload":{"tag":"h2","lines":"5748,5749"}},{"content":"2.5 Esempio <code>backend-service.yaml</code>","children":[{"content":"<pre data-lines=\"5793,5807\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-backend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5793,5807"}}],"payload":{"tag":"h2","lines":"5791,5792"}},{"content":"2.6 Esempio <code>ingress.yaml</code>","children":[{"content":"<pre data-lines=\"5812,5846\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">networking.k8s.io/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Ingress</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-ingress</span>\n  <span class=\"hljs-attr\">annotations:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">&#x24;key</span>, <span class=\"hljs-string\">&#x24;value</span> <span class=\"hljs-string\">:=</span> <span class=\"hljs-string\">.Values.ingress.annotations</span> }}\n    {{ <span class=\"hljs-string\">&#x24;key</span> }}<span class=\"hljs-string\">:</span> {{ <span class=\"hljs-string\">&#x24;value</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">rules:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.Values.ingress.hosts</span> }}\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> {{ <span class=\"hljs-string\">.host</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n      <span class=\"hljs-attr\">http:</span>\n        <span class=\"hljs-attr\">paths:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.paths</span> }}\n          <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> {{ <span class=\"hljs-string\">.path</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-attr\">pathType:</span> {{ <span class=\"hljs-string\">.pathType</span> }}\n            <span class=\"hljs-attr\">backend:</span>\n              <span class=\"hljs-attr\">service:</span>\n                <span class=\"hljs-attr\">name:</span> {{ <span class=\"hljs-string\">if</span> <span class=\"hljs-string\">eq</span> <span class=\"hljs-string\">&#x24;.Values.ingress.hosts._index</span> <span class=\"hljs-string\">&#x24;.</span> }}<span class=\"hljs-string\">infra-frontend{{</span> <span class=\"hljs-string\">else</span> <span class=\"hljs-string\">}}infra-backend{{</span> <span class=\"hljs-string\">end</span> <span class=\"hljs-string\">}}</span>\n                <span class=\"hljs-attr\">port:</span>\n                  <span class=\"hljs-attr\">number:</span> {{ <span class=\"hljs-string\">if</span> <span class=\"hljs-string\">eq</span> <span class=\"hljs-string\">&#x24;.Values.ingress.hosts._index</span> <span class=\"hljs-string\">&#x24;.</span> }}{{ <span class=\"hljs-string\">&#x24;.Values.service.frontend.port</span> }}{{ <span class=\"hljs-string\">else</span> }}{{ <span class=\"hljs-string\">&#x24;.Values.service.backend.port</span> }}{{ <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n  <span class=\"hljs-attr\">tls:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.Values.ingress.tls</span> }}\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">secretName:</span> {{ <span class=\"hljs-string\">.secretName</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n      <span class=\"hljs-attr\">hosts:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.hosts</span> }}\n        <span class=\"hljs-bullet\">-</span> {{ <span class=\"hljs-string\">.</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5812,5846"}}],"payload":{"tag":"h2","lines":"5810,5811"}}],"payload":{"tag":"h1","lines":"5645,5646"}},{"content":"Conclusione","children":[{"content":"","children":[{"content":"<strong>Traefik</strong> gestisce TLS automatico e routing verso backend/ frontend.","children":[],"payload":{"tag":"li","lines":"5853,5854"}},{"content":"<strong>Helm Chart</strong> ti permette di deployare lo stack in Kubernetes in modo modulare, configurabile e scalabile.","children":[],"payload":{"tag":"li","lines":"5854,5856"}}],"payload":{"tag":"ul","lines":"5853,5856"}},{"content":"","children":[{"content":"Completare Helm Chart con tutti i componenti (celery, postgres, redis, ingress avanzato)","children":[],"payload":{"tag":"li","lines":"5860,5861"}},{"content":"Fornire script CI/CD per deploy automatico in K8s","children":[],"payload":{"tag":"li","lines":"5861,5862"}},{"content":"Integrare monitoring (Prometheus/Grafana)","children":[],"payload":{"tag":"li","lines":"5862,5864"}}],"payload":{"tag":"ul","lines":"5860,5864"}}],"payload":{"tag":"h1","lines":"5849,5850"}},{"content":"Helm Chart Completo: <code>infra-automation-chart</code>","children":[{"content":"Struttura finale","children":[{"content":"<pre data-lines=\"5879,5896\"><code data-lines=\"5879,5896\">infra-automation-chart/\n&#x251c;&#x2500;&#x2500; Chart<span class=\"hljs-selector-class\">.yaml</span>\n&#x251c;&#x2500;&#x2500; values<span class=\"hljs-selector-class\">.yaml</span>\n&#x251c;&#x2500;&#x2500; templates/\n&#x2502;   &#x251c;&#x2500;&#x2500; backend-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; backend-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; celery-worker-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; celery-worker-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; postgres-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; postgres-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; redis-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; redis-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; frontend-deployment<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x251c;&#x2500;&#x2500; frontend-service<span class=\"hljs-selector-class\">.yaml</span>\n&#x2502;   &#x2514;&#x2500;&#x2500; ingress<span class=\"hljs-selector-class\">.yaml</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5879,5896"}}],"payload":{"tag":"h2","lines":"5877,5878"}},{"content":"1. <code>Chart.yaml</code>","children":[{"content":"<pre data-lines=\"5901,5909\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v2</span>\n<span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-automation</span>\n<span class=\"hljs-attr\">description:</span> <span class=\"hljs-string\">Helm</span> <span class=\"hljs-string\">Chart</span> <span class=\"hljs-string\">per</span> <span class=\"hljs-string\">deploy</span> <span class=\"hljs-string\">completo</span> <span class=\"hljs-string\">di</span> <span class=\"hljs-string\">Infra</span> <span class=\"hljs-string\">Automation</span> <span class=\"hljs-string\">WebApp</span> <span class=\"hljs-string\">con</span> <span class=\"hljs-string\">backend,</span> <span class=\"hljs-string\">celery,</span> <span class=\"hljs-string\">postgres,</span> <span class=\"hljs-string\">redis,</span> <span class=\"hljs-string\">frontend</span> <span class=\"hljs-string\">e</span> <span class=\"hljs-string\">ingress</span>\n<span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">application</span>\n<span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">0.1</span><span class=\"hljs-number\">.0</span>\n<span class=\"hljs-attr\">appVersion:</span> <span class=\"hljs-string\">&quot;1.0&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5901,5909"}}],"payload":{"tag":"h2","lines":"5899,5900"}},{"content":"2. <code>values.yaml</code>","children":[{"content":"<pre data-lines=\"5914,5977\"><code class=\"language-yaml\"><span class=\"hljs-attr\">replicaCount:</span> <span class=\"hljs-number\">1</span>\n\n<span class=\"hljs-attr\">image:</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-backend</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">celeryWorker:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-celery-worker</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">yourdockerhub/infra-frontend</span>\n    <span class=\"hljs-attr\">tag:</span> <span class=\"hljs-string\">latest</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">postgres:15-alpine</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:7-alpine</span>\n\n<span class=\"hljs-attr\">service:</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">8000</span>\n  <span class=\"hljs-attr\">celeryWorker:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">5555</span> <span class=\"hljs-comment\"># porta Flower (opzionale)</span>\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">80</span>\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">5432</span>\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">6379</span>\n\n<span class=\"hljs-attr\">ingress:</span>\n  <span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">annotations:</span>\n    <span class=\"hljs-attr\">kubernetes.io/ingress.class:</span> <span class=\"hljs-string\">traefik</span>\n    <span class=\"hljs-attr\">traefik.ingress.kubernetes.io/router.entrypoints:</span> <span class=\"hljs-string\">websecure</span>\n  <span class=\"hljs-attr\">hosts:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> <span class=\"hljs-string\">example.com</span>\n      <span class=\"hljs-attr\">paths:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/</span>\n          <span class=\"hljs-attr\">pathType:</span> <span class=\"hljs-string\">Prefix</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> <span class=\"hljs-string\">api.example.com</span>\n      <span class=\"hljs-attr\">paths:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/</span>\n          <span class=\"hljs-attr\">pathType:</span> <span class=\"hljs-string\">Prefix</span>\n  <span class=\"hljs-attr\">tls:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">secretName:</span> <span class=\"hljs-string\">tls-secret</span>\n      <span class=\"hljs-attr\">hosts:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">example.com</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">api.example.com</span>\n\n<span class=\"hljs-attr\">postgres:</span>\n  <span class=\"hljs-attr\">user:</span> <span class=\"hljs-string\">infra_user</span>\n  <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">infra_pass</span>\n  <span class=\"hljs-attr\">db:</span> <span class=\"hljs-string\">infra_db</span>\n\n<span class=\"hljs-attr\">redis:</span>\n  <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">&quot;&quot;</span>\n\n<span class=\"hljs-attr\">env:</span>\n  <span class=\"hljs-attr\">DATABASE_URL:</span> <span class=\"hljs-string\">postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n  <span class=\"hljs-attr\">REDIS_URL:</span> <span class=\"hljs-string\">redis://redis:6379/0</span>\n  <span class=\"hljs-attr\">VITE_API_URL:</span> <span class=\"hljs-string\">https://api.example.com</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5914,5977"}}],"payload":{"tag":"h2","lines":"5912,5913"}},{"content":"3. <code>templates/backend-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"5982,6020\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-backend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> {{ <span class=\"hljs-string\">.Values.replicaCount</span> }}\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">backend</span>\n          <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ .Values.image.backend.repository }}</span>:<span class=\"hljs-template-variable\">{{ .Values.image.backend.tag }}</span>&quot;</span>\n          <span class=\"hljs-attr\">ports:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">containerPort:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n          <span class=\"hljs-attr\">env:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">DATABASE_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.DATABASE_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">REDIS_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.REDIS_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n          <span class=\"hljs-attr\">readinessProbe:</span>\n            <span class=\"hljs-attr\">httpGet:</span>\n              <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/health</span>\n              <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n            <span class=\"hljs-attr\">initialDelaySeconds:</span> <span class=\"hljs-number\">10</span>\n            <span class=\"hljs-attr\">periodSeconds:</span> <span class=\"hljs-number\">5</span>\n          <span class=\"hljs-attr\">livenessProbe:</span>\n            <span class=\"hljs-attr\">httpGet:</span>\n              <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">/health</span>\n              <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n            <span class=\"hljs-attr\">initialDelaySeconds:</span> <span class=\"hljs-number\">30</span>\n            <span class=\"hljs-attr\">periodSeconds:</span> <span class=\"hljs-number\">10</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5982,6020"}}],"payload":{"tag":"h2","lines":"5980,5981"}},{"content":"4. <code>templates/backend-service.yaml</code>","children":[{"content":"<pre data-lines=\"6025,6039\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-backend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-backend</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> {{ <span class=\"hljs-string\">.Values.service.backend.port</span> }}\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6025,6039"}}],"payload":{"tag":"h2","lines":"6023,6024"}},{"content":"5. <code>templates/celery-worker-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"6044,6069\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-celery-worker</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> {{ <span class=\"hljs-string\">.Values.replicaCount</span> }}\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-celery-worker</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-celery-worker</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">celery-worker</span>\n          <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ .Values.image.celeryWorker.repository }}</span>:<span class=\"hljs-template-variable\">{{ .Values.image.celeryWorker.tag }}</span>&quot;</span>\n          <span class=\"hljs-attr\">command:</span> [<span class=\"hljs-string\">&quot;celery&quot;</span>, <span class=\"hljs-string\">&quot;-A&quot;</span>, <span class=\"hljs-string\">&quot;app.celery_worker.celery_app&quot;</span>, <span class=\"hljs-string\">&quot;worker&quot;</span>, <span class=\"hljs-string\">&quot;--loglevel=info&quot;</span>]\n          <span class=\"hljs-attr\">env:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">DATABASE_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.DATABASE_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">REDIS_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.REDIS_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6044,6069"}}],"payload":{"tag":"h2","lines":"6042,6043"}},{"content":"6. <code>templates/celery-worker-service.yaml</code>","children":[{"content":"<pre data-lines=\"6074,6088\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-celery-worker</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-celery-worker</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.celeryWorker.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> {{ <span class=\"hljs-string\">.Values.service.celeryWorker.port</span> }}\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6074,6088"}}],"payload":{"tag":"h2","lines":"6072,6073"}},{"content":"7. <code>templates/postgres-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"6093,6127\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">postgres</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> <span class=\"hljs-number\">1</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">postgres</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">postgres</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">postgres</span>\n          <span class=\"hljs-attr\">image:</span> {{ <span class=\"hljs-string\">.Values.image.postgres.image</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n          <span class=\"hljs-attr\">env:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">POSTGRES_USER</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.postgres.user</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">POSTGRES_PASSWORD</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.postgres.password</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">POSTGRES_DB</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.postgres.db</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n          <span class=\"hljs-attr\">ports:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">containerPort:</span> {{ <span class=\"hljs-string\">.Values.service.postgres.port</span> }}\n          <span class=\"hljs-attr\">volumeMounts:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">mountPath:</span> <span class=\"hljs-string\">/var/lib/postgresql/data</span>\n              <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">postgres-storage</span>\n      <span class=\"hljs-attr\">volumes:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">postgres-storage</span>\n          <span class=\"hljs-attr\">emptyDir:</span> {}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6093,6127"}}],"payload":{"tag":"h2","lines":"6091,6092"}},{"content":"8. <code>templates/postgres-service.yaml</code>","children":[{"content":"<pre data-lines=\"6132,6146\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">postgres</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">postgres</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.postgres.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> {{ <span class=\"hljs-string\">.Values.service.postgres.port</span> }}\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6132,6146"}}],"payload":{"tag":"h2","lines":"6130,6131"}},{"content":"9. <code>templates/redis-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"6151,6172\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">redis</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> <span class=\"hljs-number\">1</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">redis</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">redis</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">redis</span>\n          <span class=\"hljs-attr\">image:</span> {{ <span class=\"hljs-string\">.Values.image.redis.image</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n          <span class=\"hljs-attr\">ports:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">containerPort:</span> {{ <span class=\"hljs-string\">.Values.service.redis.port</span> }}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6151,6172"}}],"payload":{"tag":"h2","lines":"6149,6150"}},{"content":"10. <code>templates/redis-service.yaml</code>","children":[{"content":"<pre data-lines=\"6177,6191\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">redis</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">redis</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.redis.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> {{ <span class=\"hljs-string\">.Values.service.redis.port</span> }}\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6177,6191"}}],"payload":{"tag":"h2","lines":"6175,6176"}},{"content":"11. <code>templates/frontend-deployment.yaml</code>","children":[{"content":"<pre data-lines=\"6196,6220\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Deployment</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-frontend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">replicas:</span> {{ <span class=\"hljs-string\">.Values.replicaCount</span> }}\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">matchLabels:</span>\n      <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-frontend</span>\n  <span class=\"hljs-attr\">template:</span>\n    <span class=\"hljs-attr\">metadata:</span>\n      <span class=\"hljs-attr\">labels:</span>\n        <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-frontend</span>\n    <span class=\"hljs-attr\">spec:</span>\n      <span class=\"hljs-attr\">containers:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">frontend</span>\n          <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ .Values.image.frontend.repository }}</span>:<span class=\"hljs-template-variable\">{{ .Values.image.frontend.tag }}</span>&quot;</span>\n          <span class=\"hljs-attr\">ports:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">containerPort:</span> <span class=\"hljs-number\">5173</span>\n          <span class=\"hljs-attr\">env:</span>\n            <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">VITE_API_URL</span>\n              <span class=\"hljs-attr\">value:</span> {{ <span class=\"hljs-string\">.Values.env.VITE_API_URL</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6196,6220"}}],"payload":{"tag":"h2","lines":"6194,6195"}},{"content":"12. <code>templates/frontend-service.yaml</code>","children":[{"content":"<pre data-lines=\"6225,6239\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Service</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-frontend</span>\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">selector:</span>\n    <span class=\"hljs-attr\">app:</span> <span class=\"hljs-string\">infra-frontend</span>\n  <span class=\"hljs-attr\">ports:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">TCP</span>\n      <span class=\"hljs-attr\">port:</span> {{ <span class=\"hljs-string\">.Values.service.frontend.port</span> }}\n      <span class=\"hljs-attr\">targetPort:</span> <span class=\"hljs-number\">5173</span>\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">ClusterIP</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6225,6239"}}],"payload":{"tag":"h2","lines":"6223,6224"}},{"content":"13. <code>templates/ingress.yaml</code>","children":[{"content":"<pre data-lines=\"6244,6278\"><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">networking.k8s.io/v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Ingress</span>\n<span class=\"hljs-attr\">metadata:</span>\n  <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">infra-ingress</span>\n  <span class=\"hljs-attr\">annotations:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">&#x24;key</span>, <span class=\"hljs-string\">&#x24;value</span> <span class=\"hljs-string\">:=</span> <span class=\"hljs-string\">.Values.ingress.annotations</span> }}\n    {{ <span class=\"hljs-string\">&#x24;key</span> }}<span class=\"hljs-string\">:</span> {{ <span class=\"hljs-string\">&#x24;value</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n<span class=\"hljs-attr\">spec:</span>\n  <span class=\"hljs-attr\">rules:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.Values.ingress.hosts</span> }}\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">host:</span> {{ <span class=\"hljs-string\">.host</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n      <span class=\"hljs-attr\">http:</span>\n        <span class=\"hljs-attr\">paths:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.paths</span> }}\n          <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">path:</span> {{ <span class=\"hljs-string\">.path</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n            <span class=\"hljs-attr\">pathType:</span> {{ <span class=\"hljs-string\">.pathType</span> }}\n            <span class=\"hljs-attr\">backend:</span>\n              <span class=\"hljs-attr\">service:</span>\n                <span class=\"hljs-attr\">name:</span> {{ <span class=\"hljs-string\">if</span> <span class=\"hljs-string\">eq</span> <span class=\"hljs-string\">.host</span> <span class=\"hljs-string\">&quot;api.example.com&quot;</span> }}<span class=\"hljs-string\">infra-backend{{</span> <span class=\"hljs-string\">else</span> <span class=\"hljs-string\">}}infra-frontend{{</span> <span class=\"hljs-string\">end</span> <span class=\"hljs-string\">}}</span>\n                <span class=\"hljs-attr\">port:</span>\n                  <span class=\"hljs-attr\">number:</span> {{ <span class=\"hljs-string\">if</span> <span class=\"hljs-string\">eq</span> <span class=\"hljs-string\">.host</span> <span class=\"hljs-string\">&quot;api.example.com&quot;</span> }}{{ <span class=\"hljs-string\">&#x24;.Values.service.backend.port</span> }}{{ <span class=\"hljs-string\">else</span> }}{{ <span class=\"hljs-string\">&#x24;.Values.service.frontend.port</span> }}{{ <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n  <span class=\"hljs-attr\">tls:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.Values.ingress.tls</span> }}\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">secretName:</span> {{ <span class=\"hljs-string\">.secretName</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n      <span class=\"hljs-attr\">hosts:</span>\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">range</span> <span class=\"hljs-string\">.hosts</span> }}\n        <span class=\"hljs-bullet\">-</span> {{ <span class=\"hljs-string\">.</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">quote</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n{{<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">end</span> }}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6244,6278"}}],"payload":{"tag":"h2","lines":"6242,6243"}}],"payload":{"tag":"h1","lines":"5873,5874"}},{"content":"Script CI/CD base (GitHub Actions)","children":[{"content":"<pre data-lines=\"6287,6338\"><code class=\"language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Deploy</span> <span class=\"hljs-string\">Infra</span> <span class=\"hljs-string\">Automation</span> <span class=\"hljs-string\">App</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">Kubernetes</span>\n\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">branches:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">main</span>\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">build-and-deploy:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span> <span class=\"hljs-string\">repo</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v3</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Set</span> <span class=\"hljs-string\">up</span> <span class=\"hljs-string\">Docker</span> <span class=\"hljs-string\">Buildx</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">docker/setup-buildx-action@v2</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Log</span> <span class=\"hljs-string\">in</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">DockerHub</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">docker/login-action@v2</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.DOCKERHUB_USERNAME</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.DOCKERHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">backend</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-backend:latest ./backend\n          docker push yourdockerhub/infra-backend:latest\n</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-celery-worker:latest ./backend\n          docker push yourdockerhub/infra-celery-worker:latest\n</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">frontend</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-frontend:latest ./frontend\n          docker push yourdockerhub/infra-frontend:latest\n</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Set</span> <span class=\"hljs-string\">up</span> <span class=\"hljs-string\">kubectl</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">azure/setup-kubectl@v3</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&apos;latest&apos;</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Deploy</span> <span class=\"hljs-string\">Helm</span> <span class=\"hljs-string\">Chart</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          helm upgrade --install infra-automation ./infra-automation-chart --namespace infra --create-namespace --wait\n</span>        <span class=\"hljs-attr\">env:</span>\n          <span class=\"hljs-attr\">KUBECONFIG:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.KUBECONFIG</span> <span class=\"hljs-string\">}}</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6287,6338"}}],"payload":{"tag":"h1","lines":"6281,6282"}},{"content":"Come funziona:","children":[{"content":"Alla push sul branch <code>main</code>, builda le immagini docker di backend, celery worker e frontend.","children":[],"payload":{"tag":"li","lines":"6343,6344"}},{"content":"Pusha le immagini su DockerHub (configura <code>DOCKERHUB_USERNAME</code> e <code>DOCKERHUB_TOKEN</code> nei secrets).","children":[],"payload":{"tag":"li","lines":"6344,6345"}},{"content":"Applica o aggiorna il chart Helm nel namespace <code>infra</code> del tuo cluster Kubernetes.","children":[],"payload":{"tag":"li","lines":"6345,6346"}},{"content":"Per <code>kubectl</code> si aspetta la configurazione KUBECONFIG in secrets (usa <code>kubectl config view --raw</code> e salvalo).","children":[],"payload":{"tag":"li","lines":"6346,6348"}}],"payload":{"tag":"h1","lines":"6341,6342"}},{"content":"Repository: <strong>infra-automation</strong>","children":[{"content":"README.md","children":[{"content":"Deployment in Kubernetes con Helm","children":[{"content":"<pre data-lines=\"6489,6492\"><code class=\"language-bash\">helm upgrade --install infra-automation ./infra-automation-chart --namespace infra --create-namespace --<span class=\"hljs-built_in\">wait</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6489,6492"}}],"payload":{"tag":"h3","lines":"6484,6485"}},{"content":"CI/CD automatico (GitHub Actions)","children":[{"content":"Builda e pubblica immagini Docker su DockerHub","children":[],"payload":{"tag":"li","lines":"6501,6502"}},{"content":"Esegue deploy Helm nel cluster K8s configurato tramite KUBECONFIG","children":[],"payload":{"tag":"li","lines":"6502,6504"}}],"payload":{"tag":"h3","lines":"6497,6498"}}],"payload":{"tag":"h2","lines":"6367,6368"}},{"content":"Funzionalit&#xe0; Principali","children":[{"content":"<strong>Lista playbook Ansible</strong> caricati e modificabili via editor YAML integrato (Monaco)","children":[],"payload":{"tag":"li","lines":"6510,6511"}},{"content":"<strong>Upload file YAML / Terraform</strong> con validazione","children":[],"payload":{"tag":"li","lines":"6511,6512"}},{"content":"<strong>Esecuzione playbook con parametri</strong> personalizzabili via UI","children":[],"payload":{"tag":"li","lines":"6512,6513"}},{"content":"<strong>Streaming log realtime</strong> tramite WebSocket con modalit&#xe0; split output/log","children":[],"payload":{"tag":"li","lines":"6513,6514"}},{"content":"<strong>Notifiche toast</strong> per stato task (successo, errore)","children":[],"payload":{"tag":"li","lines":"6514,6515"}},{"content":"<strong>Lista task recenti</strong> con stato e cronologia completa","children":[],"payload":{"tag":"li","lines":"6515,6516"}},{"content":"<strong>Autenticazione OAuth</strong> con GitHub/GitLab e ruoli utenti","children":[],"payload":{"tag":"li","lines":"6516,6517"}},{"content":"<strong>Supporto provisioning cloud OpenTofu</strong>","children":[],"payload":{"tag":"li","lines":"6517,6518"}},{"content":"<strong>Integrazione Git forgejo / GitHub Actions</strong>","children":[],"payload":{"tag":"li","lines":"6518,6519"}},{"content":"<strong>Modalit&#xe0; Dark / Light UI</strong>","children":[],"payload":{"tag":"li","lines":"6519,6520"}},{"content":"<strong>Hosting statico su Codeberg Pages o via Vite + nginx</strong>","children":[],"payload":{"tag":"li","lines":"6520,6522"}}],"payload":{"tag":"h2","lines":"6508,6509"}},{"content":"Licenza","children":[],"payload":{"tag":"h2","lines":"6524,6525"}},{"content":"Contatti","children":[],"payload":{"tag":"h2","lines":"6530,6531"}},{"content":"Crediti","children":[{"content":"<pre data-lines=\"6547,6567\"><code data-lines=\"6547,6567\">\n<span class=\"hljs-comment\">---</span>\n\n<span class=\"hljs-comment\">## LICENSE (MIT)</span>\n\n```<span class=\"hljs-keyword\">text</span>\nMIT License\n\nCopyright (c) <span class=\"hljs-number\">2025</span>\n\nPermission is hereby granted, free <span class=\"hljs-keyword\">of</span> charge, <span class=\"hljs-built_in\">to</span> <span class=\"hljs-keyword\">any</span> person obtaining <span class=\"hljs-keyword\">a</span> copy\n<span class=\"hljs-keyword\">of</span> this software <span class=\"hljs-keyword\">and</span> associated documentation <span class=\"hljs-built_in\">files</span> (<span class=\"hljs-keyword\">the</span> <span class=\"hljs-string\">&quot;Software&quot;</span>), <span class=\"hljs-built_in\">to</span> deal\n<span class=\"hljs-keyword\">in</span> <span class=\"hljs-keyword\">the</span> Software <span class=\"hljs-keyword\">without</span> restriction, including <span class=\"hljs-keyword\">without</span> limitation <span class=\"hljs-keyword\">the</span> rights\n<span class=\"hljs-built_in\">to</span> use, copy, modify, <span class=\"hljs-built_in\">merge</span>, publish, distribute, sublicense, <span class=\"hljs-keyword\">and</span>/<span class=\"hljs-keyword\">or</span> sell\ncopies <span class=\"hljs-keyword\">of</span> <span class=\"hljs-keyword\">the</span> Software, <span class=\"hljs-keyword\">and</span> <span class=\"hljs-built_in\">to</span> permit persons <span class=\"hljs-built_in\">to</span> whom <span class=\"hljs-keyword\">the</span> Software is\nfurnished <span class=\"hljs-built_in\">to</span> <span class=\"hljs-built_in\">do</span> so, subject <span class=\"hljs-built_in\">to</span> <span class=\"hljs-keyword\">the</span> following conditions:\n\n... [rest <span class=\"hljs-keyword\">of</span> MIT license <span class=\"hljs-keyword\">text</span>] ...\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6547,6567"}}],"payload":{"tag":"h2","lines":"6536,6537"}},{"content":".gitignore","children":[{"content":"<pre data-lines=\"6572,6600\"><code data-lines=\"6572,6600\"><span class=\"hljs-comment\"># Python</span>\n__pycache__/\n*<span class=\"hljs-string\">.pyc</span>\n*<span class=\"hljs-string\">.pyo</span>\n*<span class=\"hljs-string\">.pyd</span>\n<span class=\"hljs-string\">.env</span>\nvenv/\n<span class=\"hljs-string\">.env.</span>*\n\n<span class=\"hljs-comment\"># Node</span>\nnode_modules/\ndist/\n<span class=\"hljs-string\">.vscode/</span>\n\n<span class=\"hljs-comment\"># Docker</span>\n*<span class=\"hljs-string\">.log</span>\ndocker-compose.override.yml\n\n<span class=\"hljs-comment\"># Kubernetes</span>\n*<span class=\"hljs-string\">.yaml</span>\n*<span class=\"hljs-string\">.yml</span>\n*<span class=\"hljs-string\">.json</span>\n\n<span class=\"hljs-comment\"># Editor</span>\n<span class=\"hljs-string\">.idea/</span>\n<span class=\"hljs-string\">.DS_Store</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6572,6600"}}],"payload":{"tag":"h2","lines":"6570,6571"}},{"content":"docker-compose.yml","children":[{"content":"<pre data-lines=\"6605,6652\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&quot;3.9&quot;</span>\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8000:8000&quot;</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DATABASE_URL=postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=redis://redis:6379/0</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n\n  <span class=\"hljs-attr\">celery-worker:</span>\n    <span class=\"hljs-attr\">build:</span>\n      <span class=\"hljs-attr\">context:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">-A</span> <span class=\"hljs-string\">app.celery_worker.celery_app</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">--loglevel=info</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DATABASE_URL=postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=redis://redis:6379/0</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">backend</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./frontend</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;5173:5173&quot;</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">VITE_API_URL=http://localhost:8000</span>\n\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">postgres:15-alpine</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_USER=infra_user</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_PASSWORD=infra_pass</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_DB=infra_db</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres_data:/var/lib/postgresql/data</span>\n\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:7-alpine</span>\n\n<span class=\"hljs-attr\">volumes:</span>\n  <span class=\"hljs-attr\">postgres_data:</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6605,6652"}}],"payload":{"tag":"h2","lines":"6603,6604"}},{"content":"docker-compose-traefik.yml","children":[{"content":"<pre data-lines=\"6657,6728\"><code class=\"language-yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&quot;3.9&quot;</span>\n<span class=\"hljs-attr\">services:</span>\n  <span class=\"hljs-attr\">traefik:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">traefik:v2.10</span>\n    <span class=\"hljs-attr\">command:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--api.insecure=true</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--providers.docker=true</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--entrypoints.web.address=:80</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--entrypoints.websecure.address=:443</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--certificatesresolvers.myresolver.acme.tlschallenge=true</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--certificatesresolvers.myresolver.acme.email=youremail@example.com</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json</span>\n    <span class=\"hljs-attr\">ports:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;80:80&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;443:443&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;8080:8080&quot;</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/var/run/docker.sock:/var/run/docker.sock:ro</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">traefik_letsencrypt:/letsencrypt</span>\n\n  <span class=\"hljs-attr\">backend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DATABASE_URL=postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=redis://redis:6379/0</span>\n    <span class=\"hljs-attr\">labels:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.enable=true&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.backend.rule=Host(`api.example.com`)&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.backend.entrypoints=websecure&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.backend.tls.certresolver=myresolver&quot;</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n\n  <span class=\"hljs-attr\">celery-worker:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./backend</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">-A</span> <span class=\"hljs-string\">app.celery_worker.celery_app</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">--loglevel=info</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">DATABASE_URL=postgresql+asyncpg://infra_user:infra_pass@postgres/infra_db</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">REDIS_URL=redis://redis:6379/0</span>\n    <span class=\"hljs-attr\">depends_on:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">backend</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">redis</span>\n\n  <span class=\"hljs-attr\">frontend:</span>\n    <span class=\"hljs-attr\">build:</span> <span class=\"hljs-string\">./frontend</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">VITE_API_URL=https://example.com</span>\n    <span class=\"hljs-attr\">labels:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.enable=true&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.frontend.rule=Host(`example.com`)&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.frontend.entrypoints=websecure&quot;</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;traefik.http.routers.frontend.tls.certresolver=myresolver&quot;</span>\n\n  <span class=\"hljs-attr\">postgres:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">postgres:15-alpine</span>\n    <span class=\"hljs-attr\">environment:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_USER=infra_user</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_PASSWORD=infra_pass</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">POSTGRES_DB=infra_db</span>\n    <span class=\"hljs-attr\">volumes:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">postgres_data:/var/lib/postgresql/data</span>\n\n  <span class=\"hljs-attr\">redis:</span>\n    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">redis:7-alpine</span>\n\n<span class=\"hljs-attr\">volumes:</span>\n  <span class=\"hljs-attr\">postgres_data:</span>\n  <span class=\"hljs-attr\">traefik_letsencrypt:</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6657,6728"}}],"payload":{"tag":"h2","lines":"6655,6656"}},{"content":"infra-automation-chart/","children":[],"payload":{"tag":"h2","lines":"6731,6732"}},{"content":".github/workflows/deploy-k8s.yml","children":[{"content":"<pre data-lines=\"6739,6790\"><code class=\"language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Deploy</span> <span class=\"hljs-string\">Infra</span> <span class=\"hljs-string\">Automation</span> <span class=\"hljs-string\">App</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">Kubernetes</span>\n\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">branches:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">main</span>\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">build-and-deploy:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span> <span class=\"hljs-string\">repo</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v3</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Set</span> <span class=\"hljs-string\">up</span> <span class=\"hljs-string\">Docker</span> <span class=\"hljs-string\">Buildx</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">docker/setup-buildx-action@v2</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Log</span> <span class=\"hljs-string\">in</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">DockerHub</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">docker/login-action@v2</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.DOCKERHUB_USERNAME</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.DOCKERHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">backend</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-backend:latest ./backend\n          docker push yourdockerhub/infra-backend:latest\n</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">celery</span> <span class=\"hljs-string\">worker</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-celery-worker:latest ./backend\n          docker push yourdockerhub/infra-celery-worker:latest\n</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">push</span> <span class=\"hljs-string\">frontend</span> <span class=\"hljs-string\">image</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          docker build -t yourdockerhub/infra-frontend:latest ./frontend\n          docker push yourdockerhub/infra-frontend:latest\n</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Set</span> <span class=\"hljs-string\">up</span> <span class=\"hljs-string\">kubectl</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">azure/setup-kubectl@v3</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&apos;latest&apos;</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Deploy</span> <span class=\"hljs-string\">Helm</span> <span class=\"hljs-string\">Chart</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          helm upgrade --install infra-automation ./infra-automation-chart --namespace infra --create-namespace --wait\n</span>        <span class=\"hljs-attr\">env:</span>\n          <span class=\"hljs-attr\">KUBECONFIG:</span> <span class=\"hljs-string\">&#x24;{{</span> <span class=\"hljs-string\">secrets.KUBECONFIG</span> <span class=\"hljs-string\">}}</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6739,6790"}}],"payload":{"tag":"h2","lines":"6737,6738"}},{"content":"backend/requirements.txt","children":[{"content":"<pre data-lines=\"6795,6809\"><code data-lines=\"6795,6809\"><span class=\"hljs-attribute\">fastapi</span>[<span class=\"hljs-literal\">all</span>]==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">95</span>.<span class=\"hljs-number\">1</span>\n<span class=\"hljs-attribute\">uvicorn</span>[standard]==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">22</span>.<span class=\"hljs-number\">0</span>\n<span class=\"hljs-attribute\">celery</span>[redis]==<span class=\"hljs-number\">5</span>.<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">7</span>\n<span class=\"hljs-attribute\">asyncpg</span>==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">27</span>.<span class=\"hljs-number\">0</span>\n<span class=\"hljs-attribute\">sqlalchemy</span>[asyncio]==<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">4</span>.<span class=\"hljs-number\">46</span>\n<span class=\"hljs-attribute\">databases</span>[postgresql]==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">6</span>.<span class=\"hljs-number\">1</span>\n<span class=\"hljs-attribute\">python</span>-dotenv==<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">0</span>\n<span class=\"hljs-attribute\">pyyaml</span>==<span class=\"hljs-number\">6</span>.<span class=\"hljs-number\">0</span>\n<span class=\"hljs-attribute\">httpx</span>==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">24</span>.<span class=\"hljs-number\">1</span>\n<span class=\"hljs-attribute\">python</span>-multipart==<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">0</span>.<span class=\"hljs-number\">6</span>\n<span class=\"hljs-attribute\">passlib</span>[bcrypt]==<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">7</span>.<span class=\"hljs-number\">4</span>\n<span class=\"hljs-attribute\">authlib</span>==<span class=\"hljs-number\">1</span>.<span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">0</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6795,6809"}}],"payload":{"tag":"h2","lines":"6793,6794"}},{"content":"backend/Dockerfile","children":[{"content":"<pre data-lines=\"6814,6826\"><code class=\"language-dockerfile\"><span class=\"hljs-keyword\">FROM</span> python:<span class=\"hljs-number\">3.11</span>-slim\n\n<span class=\"hljs-keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span>\n\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> requirements.txt .</span>\n<span class=\"hljs-keyword\">RUN</span><span class=\"language-bash\"> pip install --no-cache-dir -r requirements.txt</span>\n\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> ./app ./app</span>\n\n<span class=\"hljs-keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"hljs-string\">&quot;uvicorn&quot;</span>, <span class=\"hljs-string\">&quot;app.main:app&quot;</span>, <span class=\"hljs-string\">&quot;--host&quot;</span>, <span class=\"hljs-string\">&quot;0.0.0.0&quot;</span>, <span class=\"hljs-string\">&quot;--port&quot;</span>, <span class=\"hljs-string\">&quot;8000&quot;</span>]</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6814,6826"}}],"payload":{"tag":"h2","lines":"6812,6813"}},{"content":"frontend/package.json","children":[{"content":"<pre data-lines=\"6831,6852\"><code class=\"language-json\"><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;infra-frontend&quot;</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;version&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1.0.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;scripts&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">&quot;dev&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;vite&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;build&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;vite build&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;preview&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;vite preview&quot;</span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;dependencies&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">&quot;svelte&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^4.0.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;monaco-editor&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^0.40.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;svelte-toast&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^3.1.1&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;socket.io-client&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^4.5.1&quot;</span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;devDependencies&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">&quot;vite&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^4.1.4&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;@sveltejs/vite-plugin-svelte&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^1.2.0&quot;</span>\n  <span class=\"hljs-punctuation\">}</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6831,6852"}}],"payload":{"tag":"h2","lines":"6829,6830"}},{"content":"frontend/Dockerfile","children":[{"content":"<pre data-lines=\"6857,6872\"><code class=\"language-dockerfile\"><span class=\"hljs-keyword\">FROM</span> node:<span class=\"hljs-number\">20</span>-alpine\n\n<span class=\"hljs-keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span>\n\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> package.json package-lock.json* ./</span>\n<span class=\"hljs-keyword\">RUN</span><span class=\"language-bash\"> npm install</span>\n\n<span class=\"hljs-keyword\">COPY</span><span class=\"language-bash\"> . .</span>\n\n<span class=\"hljs-keyword\">RUN</span><span class=\"language-bash\"> npm run build</span>\n\n<span class=\"hljs-keyword\">EXPOSE</span> <span class=\"hljs-number\">5173</span>\n<span class=\"hljs-keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"hljs-string\">&quot;npm&quot;</span>, <span class=\"hljs-string\">&quot;run&quot;</span>, <span class=\"hljs-string\">&quot;preview&quot;</span>]</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6857,6872"}}],"payload":{"tag":"h2","lines":"6855,6856"}},{"content":"Note finali","children":[{"content":"","children":[{"content":"Per sicurezza, le variabili sensibili vanno spostate in Secret Manager / K8s Secrets","children":[],"payload":{"tag":"li","lines":"6877,6878"}},{"content":"Per l&#x2019;autenticazione OAuth GitHub/GitLab configurare le app nei rispettivi portali e inserire client_id/client_secret in backend.env","children":[],"payload":{"tag":"li","lines":"6878,6879"}},{"content":"I componenti (backend, celery, frontend) sono modulari e scalabili","children":[],"payload":{"tag":"li","lines":"6879,6880"}},{"content":"Il frontend Svelte usa stores per la gestione stato e websocket per streaming realtime","children":[],"payload":{"tag":"li","lines":"6880,6881"}},{"content":"Il backend FastAPI espone","children":[],"payload":{"tag":"li","lines":"6881,6884"}}],"payload":{"tag":"ul","lines":"6877,6884"}},{"content":"Celery consente task async per esecuzioni playbook / provisioning","children":[],"payload":{"tag":"li","lines":"6886,6888"}}],"payload":{"tag":"h2","lines":"6875,6876"}}],"payload":{"tag":"h1","lines":"6363,6364"}},{"content":"Backend &#x2014; FastAPI + Celery","children":[{"content":"backend/app/main.py","children":[{"content":"<pre data-lines=\"6909,6949\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> FastAPI, WebSocket, Depends, HTTPException, status\n<span class=\"hljs-keyword\">from</span> fastapi.middleware.cors <span class=\"hljs-keyword\">import</span> CORSMiddleware\n<span class=\"hljs-keyword\">from</span> app.api <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> api_router\n<span class=\"hljs-keyword\">from</span> app.celery_worker <span class=\"hljs-keyword\">import</span> celery_app\n<span class=\"hljs-keyword\">from</span> app.core.auth <span class=\"hljs-keyword\">import</span> get_current_user\n\napp = FastAPI(\n    title=<span class=\"hljs-string\">&quot;Infra Automation Backend&quot;</span>,\n    description=<span class=\"hljs-string\">&quot;Backend API per gestione playbook Ansible e provisioning OpenTofu&quot;</span>,\n    version=<span class=\"hljs-string\">&quot;1.0.0&quot;</span>,\n)\n\n<span class=\"hljs-comment\"># Permetti CORS dal frontend (configura con il dominio frontend reale)</span>\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[<span class=\"hljs-string\">&quot;http://localhost:5173&quot;</span>],\n    allow_credentials=<span class=\"hljs-literal\">True</span>,\n    allow_methods=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n    allow_headers=[<span class=\"hljs-string\">&quot;*&quot;</span>],\n)\n\n<span class=\"hljs-comment\"># Monta router API</span>\napp.include_router(api_router, prefix=<span class=\"hljs-string\">&quot;/api&quot;</span>)\n\n<span class=\"hljs-comment\"># WebSocket endpoint per streaming log realtime</span>\n<span class=\"hljs-meta\">@app.websocket(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/ws/logs/{task_id}&quot;</span></span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">websocket_logs</span>(<span class=\"hljs-params\">websocket: WebSocket, task_id: <span class=\"hljs-built_in\">str</span>, user=Depends(<span class=\"hljs-params\">get_current_user</span>)</span>):\n    <span class=\"hljs-keyword\">await</span> websocket.accept()\n    <span class=\"hljs-keyword\">try</span>:\n        <span class=\"hljs-comment\"># Qui implementare la logica di connessione a Celery backend / Redis per stream log</span>\n        <span class=\"hljs-comment\"># Placeholder: echo loop</span>\n        <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n            data = <span class=\"hljs-keyword\">await</span> websocket.receive_text()\n            <span class=\"hljs-keyword\">await</span> websocket.send_text(<span class=\"hljs-string\">f&quot;Echo: <span class=\"hljs-subst\">{data}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;WebSocket closed: <span class=\"hljs-subst\">{e}</span>&quot;</span>)\n    <span class=\"hljs-keyword\">finally</span>:\n        <span class=\"hljs-keyword\">await</span> websocket.close()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6909,6949"}}],"payload":{"tag":"h2","lines":"6907,6908"}},{"content":"backend/app/api/<strong>init</strong>.py","children":[{"content":"<pre data-lines=\"6954,6971\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter\n<span class=\"hljs-keyword\">from</span> .playbooks <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> playbooks_router\n<span class=\"hljs-keyword\">from</span> .auth <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> auth_router\n<span class=\"hljs-keyword\">from</span> .tasks <span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">as</span> tasks_router\n\nrouter = APIRouter()\n\n<span class=\"hljs-comment\"># API route per playbook (lista, esecuzione, upload)</span>\nrouter.include_router(playbooks_router, prefix=<span class=\"hljs-string\">&quot;/playbooks&quot;</span>, tags=[<span class=\"hljs-string\">&quot;Playbooks&quot;</span>])\n\n<span class=\"hljs-comment\"># API route per autenticazione OAuth</span>\nrouter.include_router(auth_router, prefix=<span class=\"hljs-string\">&quot;/auth&quot;</span>, tags=[<span class=\"hljs-string\">&quot;Auth&quot;</span>])\n\n<span class=\"hljs-comment\"># API route per task (cronologia, stato)</span>\nrouter.include_router(tasks_router, prefix=<span class=\"hljs-string\">&quot;/tasks&quot;</span>, tags=[<span class=\"hljs-string\">&quot;Tasks&quot;</span>])\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6954,6971"}}],"payload":{"tag":"h2","lines":"6952,6953"}},{"content":"backend/app/api/playbooks.py","children":[{"content":"<pre data-lines=\"6976,7010\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> fastapi <span class=\"hljs-keyword\">import</span> APIRouter, UploadFile, File, HTTPException, Depends\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">List</span>\n<span class=\"hljs-keyword\">import</span> yaml\n<span class=\"hljs-keyword\">from</span> app.schemas <span class=\"hljs-keyword\">import</span> Playbook\n<span class=\"hljs-keyword\">from</span> app.core.auth <span class=\"hljs-keyword\">import</span> get_current_user\n\nrouter = APIRouter()\n\nplaybooks_store = {}  <span class=\"hljs-comment\"># In-memory playbook store (da sostituire DB reale)</span>\n\n<span class=\"hljs-meta\">@router.get(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/&quot;</span>, response_model=<span class=\"hljs-type\">List</span>[Playbook]</span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">list_playbooks</span>(<span class=\"hljs-params\">user=Depends(<span class=\"hljs-params\">get_current_user</span>)</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;Restituisce lista playbook disponibili&quot;&quot;&quot;</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">list</span>(playbooks_store.values())\n\n<span class=\"hljs-meta\">@router.post(<span class=\"hljs-params\"><span class=\"hljs-string\">&quot;/upload&quot;</span>, response_model=Playbook</span>)</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">upload_playbook</span>(<span class=\"hljs-params\">file: UploadFile = File(<span class=\"hljs-params\">...</span>), user=Depends(<span class=\"hljs-params\">get_current_user</span>)</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;Upload file YAML playbook e validazione&quot;&quot;&quot;</span>\n    content = <span class=\"hljs-keyword\">await</span> file.read()\n    <span class=\"hljs-keyword\">try</span>:\n        y = yaml.safe_load(content)\n        <span class=\"hljs-comment\"># Validazione base: esiste &quot;tasks&quot; ?</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">&quot;tasks&quot;</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> y:\n            <span class=\"hljs-keyword\">raise</span> HTTPException(status_code=<span class=\"hljs-number\">400</span>, detail=<span class=\"hljs-string\">&quot;YAML playbook missing &apos;tasks&apos; section&quot;</span>)\n        playbook = Playbook(\n            name=file.filename,\n            content=content.decode(<span class=\"hljs-string\">&quot;utf-8&quot;</span>)\n        )\n        playbooks_store[file.filename] = playbook\n        <span class=\"hljs-keyword\">return</span> playbook\n    <span class=\"hljs-keyword\">except</span> yaml.YAMLError <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-keyword\">raise</span> HTTPException(status_code=<span class=\"hljs-number\">400</span>, detail=<span class=\"hljs-string\">f&quot;YAML parsing error: <span class=\"hljs-subst\">{<span class=\"hljs-built_in\">str</span>(e)}</span>&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6976,7010"}}],"payload":{"tag":"h2","lines":"6974,6975"}},{"content":"backend/app/celery_worker.py","children":[{"content":"<pre data-lines=\"7015,7038\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">import</span> os\n\nredis_url = os.getenv(<span class=\"hljs-string\">&quot;REDIS_URL&quot;</span>, <span class=\"hljs-string\">&quot;redis://localhost:6379/0&quot;</span>)\nbackend_url = os.getenv(<span class=\"hljs-string\">&quot;DATABASE_URL&quot;</span>, <span class=\"hljs-string\">&quot;db+postgresql://user:pass@localhost/db&quot;</span>)\n\ncelery_app = Celery(\n    <span class=\"hljs-string\">&quot;infra_automation&quot;</span>,\n    broker=redis_url,\n    backend=redis_url,\n)\n\n<span class=\"hljs-comment\"># Task esempio: esegue playbook Ansible (placeholder)</span>\n<span class=\"hljs-meta\">@celery_app.task(<span class=\"hljs-params\">bind=<span class=\"hljs-literal\">True</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run_ansible_playbook</span>(<span class=\"hljs-params\">self, playbook_content: <span class=\"hljs-built_in\">str</span>, extra_vars: <span class=\"hljs-built_in\">dict</span></span>):\n    <span class=\"hljs-comment\"># <span class=\"hljs-doctag\">TODO:</span> integra Ansible Runner o esecuzione shell con playbook YAML</span>\n    <span class=\"hljs-keyword\">import</span> time\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">10</span>):\n        <span class=\"hljs-variable language_\">self</span>.update_state(state=<span class=\"hljs-string\">&quot;PROGRESS&quot;</span>, meta={<span class=\"hljs-string\">&quot;step&quot;</span>: i})\n        time.sleep(<span class=\"hljs-number\">1</span>)\n    <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-string\">&quot;status&quot;</span>: <span class=\"hljs-string\">&quot;completed&quot;</span>}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"7015,7038"}}],"payload":{"tag":"h2","lines":"7013,7014"}},{"content":"backend/app/schemas.py","children":[{"content":"<pre data-lines=\"7043,7056\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> pydantic <span class=\"hljs-keyword\">import</span> BaseModel\n<span class=\"hljs-keyword\">from</span> typing <span class=\"hljs-keyword\">import</span> <span class=\"hljs-type\">Optional</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Playbook</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    name: <span class=\"hljs-built_in\">str</span>\n    content: <span class=\"hljs-built_in\">str</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TaskStatus</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    task_id: <span class=\"hljs-built_in\">str</span>\n    status: <span class=\"hljs-built_in\">str</span>\n    meta: <span class=\"hljs-type\">Optional</span>[<span class=\"hljs-built_in\">dict</span>] = <span class=\"hljs-literal\">None</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"7043,7056"}}],"payload":{"tag":"h2","lines":"7041,7042"}}],"payload":{"tag":"h1","lines":"6903,6904"}},{"content":"Frontend &#x2014; Svelte + Vite","children":[{"content":"frontend/src/App.svelte","children":[{"content":"<pre data-lines=\"7065,7118\"><code class=\"language-svelte\">&lt;script&gt;\n  import { onMount } from &quot;svelte&quot;;\n  import PlaybookList from &quot;./components/PlaybookList.svelte&quot;;\n  import PlaybookEditor from &quot;./components/PlaybookEditor.svelte&quot;;\n  import TaskLogs from &quot;./components/TaskLogs.svelte&quot;;\n  import Toast from &quot;svelte-toast&quot;;\n\n  let selectedPlaybook = null;\n  let taskId = null;\n\n  function onPlaybookSelected(playbook) {\n    selectedPlaybook = playbook;\n  }\n\n  function onRunPlaybook(id) {\n    taskId = id;\n  }\n&lt;/script&gt;\n\n&lt;main&gt;\n  &lt;h1&gt;Infra Automation Dashboard&lt;/h1&gt;\n\n  &lt;Toast /&gt;\n\n  &lt;section&gt;\n    &lt;PlaybookList on:select={event =&gt; onPlaybookSelected(event.detail)} /&gt;\n  &lt;/section&gt;\n\n  {#if selectedPlaybook}\n    &lt;section&gt;\n      &lt;PlaybookEditor {selectedPlaybook} /&gt;\n      &lt;button on:click={() =&gt; onRunPlaybook(selectedPlaybook.name)}&gt;\n        Esegui Playbook\n      &lt;/button&gt;\n    &lt;/section&gt;\n  {/if}\n\n  {#if taskId}\n    &lt;section&gt;\n      &lt;TaskLogs {taskId} /&gt;\n    &lt;/section&gt;\n  {/if}\n&lt;/main&gt;\n\n&lt;style&gt;\n  main {\n    max-width: 900px;\n    margin: auto;\n    font-family: system-ui, sans-serif;\n  }\n&lt;/style&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"7065,7118"}}],"payload":{"tag":"h2","lines":"7063,7064"}},{"content":"frontend/src/components/PlaybookList.svelte","children":[{"content":"<pre data-lines=\"7123,7150\"><code class=\"language-svelte\">&lt;script&gt;\n  import { onMount, createEventDispatcher } from &quot;svelte&quot;;\n  const API_URL = import.meta.env.VITE_API_URL || &quot;http://localhost:8000/api&quot;;\n\n  let playbooks = [];\n  const dispatch = createEventDispatcher();\n\n  onMount(async () =&gt; {\n    const res = await fetch(`&#x24;{API_URL}/playbooks/`);\n    if (res.ok) {\n      playbooks = await res.json();\n    }\n  });\n\n  function selectPlaybook(playbook) {\n    dispatch(&quot;select&quot;, playbook);\n  }\n&lt;/script&gt;\n\n&lt;h2&gt;Playbook disponibili&lt;/h2&gt;\n&lt;ul&gt;\n  {#each playbooks as pb}\n    &lt;li&gt;&lt;button on:click={() =&gt; selectPlaybook(pb)}&gt;{pb.name}&lt;/button&gt;&lt;/li&gt;\n  {/each}\n&lt;/ul&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"7123,7150"}}],"payload":{"tag":"h2","lines":"7121,7122"}},{"content":"frontend/src/components/PlaybookEditor.svelte","children":[{"content":"<pre data-lines=\"7155,7182\"><code class=\"language-svelte\">&lt;script&gt;\n  import { onMount } from &quot;svelte&quot;;\n  import * as monaco from &quot;monaco-editor&quot;;\n\n  export let selectedPlaybook;\n\n  let editorDiv;\n  let editorInstance;\n\n  onMount(() =&gt; {\n    editorInstance = monaco.editor.create(editorDiv, {\n      value: selectedPlaybook.content,\n      language: &quot;yaml&quot;,\n      automaticLayout: true,\n      theme: &quot;vs-dark&quot;,\n    });\n  });\n\n  // Aggiorna contenuto editor se cambia playbook\n  &#x24;: if (editorInstance &amp;&amp; selectedPlaybook) {\n    editorInstance.setValue(selectedPlaybook.content);\n  }\n&lt;/script&gt;\n\n&lt;div bind:this={editorDiv} style=&quot;height: 400px; border: 1px solid #ccc;&quot;&gt;&lt;/div&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"7155,7182"}}],"payload":{"tag":"h2","lines":"7153,7154"}},{"content":"frontend/src/components/TaskLogs.svelte","children":[{"content":"<pre data-lines=\"7187,7217\"><code class=\"language-svelte\">&lt;script&gt;\n  import { onMount, onDestroy } from &quot;svelte&quot;;\n  import { toast } from &quot;svelte-toast&quot;;\n\n  export let taskId;\n  let logs = &quot;&quot;;\n  let ws;\n\n  onMount(() =&gt; {\n    const API_URL = import.meta.env.VITE_API_URL || &quot;http://localhost:8000&quot;;\n    ws = new WebSocket(`&#x24;{API_URL.replace(/^http/, &quot;ws&quot;)}/ws/logs/&#x24;{taskId}`);\n\n    ws.onmessage = (event) =&gt; {\n      logs += event.data + &quot;\\n&quot;;\n    };\n\n    ws.onerror = () =&gt; {\n      toast.push(&quot;Errore nella connessione WebSocket&quot;, { theme: { &quot;--toastBackground&quot;: &quot;red&quot; } });\n    };\n  });\n\n  onDestroy(() =&gt; {\n    ws.close();\n  });\n&lt;/script&gt;\n\n&lt;h2&gt;Log in tempo reale per task: {taskId}&lt;/h2&gt;\n&lt;pre style=&quot;background:#000; color:#0f0; height: 300px; overflow-y: scroll;&quot;&gt;{logs}&lt;/pre&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"7187,7217"}}],"payload":{"tag":"h2","lines":"7185,7186"}}],"payload":{"tag":"h1","lines":"7059,7060"}}]},null)</script>
</body>
</html>
